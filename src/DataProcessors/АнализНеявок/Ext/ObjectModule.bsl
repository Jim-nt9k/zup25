Перем мДлинаСуток;

////////////////////////////////////////////////////////////////////////////////
// ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ
//

Функция СформируемСпискоВидовНеявок() Экспорт
	
	МассивВидовНеявок = Новый СписокЗначений;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ
		|	КлассификаторИспользованияРабочегоВремени.Ссылка КАК ВидВремени
		|ИЗ
		|	Справочник.КлассификаторИспользованияРабочегоВремени КАК КлассификаторИспользованияРабочегоВремени
		|ГДЕ
		|	(НЕ КлассификаторИспользованияРабочегоВремени.ПометкаУдаления)
		|	И КлассификаторИспользованияРабочегоВремени.ОплачиваемыеНевыходы = ИСТИНА";
	
	Результат = Запрос.Выполнить().Выбрать();

	Пока Результат.Следующий() Цикл
		МассивВидовНеявок.Добавить(Результат.ВидВремени);
	КонецЦикла;
	
    Возврат МассивВидовНеявок;

КонецФункции

Функция ПолучитьРасчетныйДокумент(Сотрудник,ФизЛицо, ДатаНачала, ДатаОкончания, ВидРасчета, ПроцентОплаты, ПериодРегистрации)
	Запрос = Новый Запрос;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ОплатаПоСреднемуЗаработку.Ссылка
	|ИЗ
	|	Документ.ОплатаПоСреднемуЗаработку КАК ОплатаПоСреднемуЗаработку
	|ГДЕ
	|	ОплатаПоСреднемуЗаработку.ВидРасчета = &ВидРасчета
	|	И ОплатаПоСреднемуЗаработку.Сотрудник = &Сотрудник
	|	И ОплатаПоСреднемуЗаработку.Физлицо = &Физлицо
	|	И ОплатаПоСреднемуЗаработку.ПроцентОплаты = &ПроцентОплаты
	|	И ОплатаПоСреднемуЗаработку.ДатаНачала = &ДатаНачала
	|	И ОплатаПоСреднемуЗаработку.ДатаОкончания = &ДатаОкончания
	|	И ОплатаПоСреднемуЗаработку.СпособРегистрацииВремени = &СпособРегистрацииВремени
	|	И ОплатаПоСреднемуЗаработку.ПериодРегистрации = &ДатаНач";
	
	Запрос.УстановитьПараметр("ВидРасчета", ВидРасчета);
	Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
	Запрос.УстановитьПараметр("Физлицо", Физлицо);
	Запрос.УстановитьПараметр("ПроцентОплаты", ПроцентОплаты);
	Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
	Запрос.УстановитьПараметр("ДатаНач", ПериодРегистрации);
	Запрос.УстановитьПараметр("СпособРегистрацииВремени", Перечисления.СпособыРегистрацииВремени.РегистрацияДляЦелойСмены);

	Запрос.Текст = ТекстЗапроса;
	Результат = Запрос.Выполнить().Выбрать();
	
	Если Результат.Следующий() тогда
		Возврат Результат.Ссылка;
	Иначе
		Возврат Документы.ОплатаПоСреднемуЗаработку.ПустаяСсылка();
	КонецЕсли;
КонецФункции

// Формирует запрос по регистру СостояниеРаботниковОрганизаций
//
// Параметры:
//	Нет
//
// Возвращаемое значение:
//	Результат запроса
//
Функция СформироватьЗапрос()

	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Если ОтбиратьСобытияПоДокументу Тогда
		ДатаН = КадровыйДокумент.Дата;
		Запрос.УстановитьПараметр("Регистратор",			КадровыйДокумент);
		Запрос.УстановитьПараметр("ДатаНачала",				НачалоДня(ДатаН));
		Запрос.УстановитьПараметр("ДатаОкончания",			КонецДня(ДатаН));
	Иначе
		Запрос.УстановитьПараметр("ДатаНачала",				ДатаНачала);
		Запрос.УстановитьПараметр("ДатаОкончания",			КонецДня(ДатаОкончания));
	КонецЕсли;
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",		ОбщегоНазначения.ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ПодразделениеОрганизации",	ПодразделениеОрганизации);
	
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если НЕ ПоТабелям И ВидНеявкиПеречисление.Количество() > 0 Тогда
		Запрос.УстановитьПараметр("СписокВидНеявкиПеречисление",ВидНеявкиПеречисление);
	КонецЕсли;
	//Аверсон 23.03.2023 КВВ СВФР-010563 )
	
	// Все возможные значения перечисления СостоянияРаботникаОрганизации
	ЗначенияПеречисления = Метаданные.Перечисления.СостоянияРаботникаОрганизации.ЗначенияПеречисления;
	Для Каждого ТекущееЗначение Из ЗначенияПеречисления Цикл
		Запрос.УстановитьПараметр(ТекущееЗначение.Имя, Перечисления.СостоянияРаботникаОрганизации[ТекущееЗначение.Имя]);
	КонецЦикла;

	// Все возможные значения перечисления СостоянияРаботникаОрганизации
	ЗначенияПеречисления = Метаданные.Перечисления.НамеченныеСобытияПоПерсоналу.ЗначенияПеречисления;
	Для Каждого ТекущееЗначение Из ЗначенияПеречисления Цикл
		Запрос.УстановитьПараметр(ТекущееЗначение.Имя + "Намеченный", Перечисления.НамеченныеСобытияПоПерсоналу[ТекущееЗначение.Имя]);
	КонецЦикла;
	
	// Элементы из классификатора использования рабочего времени
	МассивНеоплачиваемыеОтпуска = Новый Массив();
	МассивНеоплачиваемыеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.НеоплачиваемыйОтпускПоРазрешениюРаботодателя);
	МассивНеоплачиваемыеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.НеоплачиваемыйОтпускПоЗаконодательству);
	МассивНеоплачиваемыеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.НеоплачиваемыйДополнительныйОтпуск);
	Запрос.УстановитьПараметр("УчетВремениНеоплачиваемыеОтпуска",					МассивНеоплачиваемыеОтпуска);
	
	МассивОплачиваемыеУчебныеОтпуска = Новый Массив();
	МассивОплачиваемыеУчебныеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ОтпускНаОбучение);
	МассивОплачиваемыеУчебныеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ПовышениеКвалификации);
	МассивОплачиваемыеУчебныеОтпуска.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ПовышениеКвалификацииВДругойМестности);
	Запрос.УстановитьПараметр("УчетВремениОплачиваемыеУчебныеОтпуска", МассивОплачиваемыеУчебныеОтпуска);

	МассивРасчетыОтпуска = Новый Массив;
	МассивРасчетыОтпуска.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоШестидневке);
	МассивРасчетыОтпуска.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоКалендарнымДням);
	Запрос.УстановитьПараметр("РасчетыОтпуска", МассивРасчетыОтпуска);
	
	// Определим периоды смены (реальные или намеченные) состояния работников за указанный пользователем интервал.
	// Выбираем намеченные события, зарегистрированные тем же регистратором.
	СостояниеРаботниковТекст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	СостояниеРаботников.Сотрудник,
	|	СостояниеРаботников.Сотрудник.ФизЛицо КАК ФизЛицо,
	|	СостояниеРаботников.Период КАК ДатаНачала,
	
	//СВЭЙ 31.10.2023 КВВ СВФР-011738 (
	//|	ЕСТЬNULL(МИНИМУМ(ДОБАВИТЬКДАТЕ(СостояниеБудущее.Период, ДЕНЬ, -1)), БудущиеНамеченныеСобытия.Период) КАК ДатаОкончания,
	|ВЫБОР КОГДА СостояниеРаботников.Регистратор ССЫЛКА Документ.КомандировкиОрганизаций
	|ТОГДА
	|ВЫБОР КОГДА ДОБАВИТЬКДАТЕ(СостояниеРаботников.ПериодЗавершения, ДЕНЬ, -1) > &ДатаОкончания
	|ТОГДА &ДатаОкончания
	|ИНАЧЕ ДОБАВИТЬКДАТЕ(СостояниеРаботников.ПериодЗавершения, ДЕНЬ, -1)
	|КОНЕЦ
	|ИНАЧЕ
	|ЕСТЬNULL(МИНИМУМ(ДОБАВИТЬКДАТЕ(СостояниеБудущее.Период, ДЕНЬ, -1)), БудущиеНамеченныеСобытия.Период)
	|КОНЕЦ КАК ДатаОкончания,
	//СВЭЙ 31.10.2023 КВВ СВФР-011738 )
	
	|	СостояниеРаботников.Состояние КАК Состояние,
	|	СостояниеРаботников.Регистратор КАК КадровыйДокумент,
	|	ОтпускаРаботниковОрганизации.ВидДополнительногоОтпуска,
	|	ОтпускаРаботниковОрганизации.ДатаНачалаДоп,
	|	ОтпускаРаботниковОрганизации.РабочийГодС,
	|	ОтпускаРаботниковОрганизации.РабочийГодПо
	|ПОМЕСТИТЬ ВТСостояниеРаботников
	|ИЗ
	|	РегистрСведений.СостояниеРаботниковОрганизаций КАК СостояниеРаботников
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОтпускаОрганизаций.РаботникиОрганизации КАК ОтпускаРаботниковОрганизации
	|		ПО СостояниеРаботников.Регистратор = ОтпускаРаботниковОрганизации.Ссылка
	|			И СостояниеРаботников.Период = ОтпускаРаботниковОрганизации.ДатаНачала
	|			И СостояниеРаботников.Сотрудник = ОтпускаРаботниковОрганизации.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			СостояниеРаботников.Сотрудник КАК Сотрудник,
	|			СостояниеРаботников.Период КАК Период,
	|			СостояниеРаботников.Период КАК ДатаНачала
	|		ИЗ
	|			РегистрСведений.СостояниеРаботниковОрганизаций КАК СостояниеРаботников
	|		ГДЕ
	|			СостояниеРаботников.Организация = &ГоловнаяОрганизация
	|		
	|		ОБЪЕДИНИТЬ ВСЕ
	|		
	|		ВЫБРАТЬ
	|			СостояниеРаботников.Сотрудник,
	|			СостояниеРаботников.ПериодЗавершения,
	|			СостояниеРаботников.Период
	|		ИЗ
	|			РегистрСведений.СостояниеРаботниковОрганизаций КАК СостояниеРаботников
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СостояниеРаботниковОрганизаций КАК СостояниеРаботниковПроверка
	|				ПО СостояниеРаботниковПроверка.Период > СостояниеРаботников.Период
	|					И СостояниеРаботниковПроверка.Период <= СостояниеРаботников.ПериодЗавершения
	|					И СостояниеРаботников.Сотрудник = СостояниеРаботниковПроверка.Сотрудник
	|		ГДЕ
	|			СостояниеРаботников.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			И СостояниеРаботниковПроверка.Сотрудник ЕСТЬ NULL 
	|			И СостояниеРаботников.Организация = &ГоловнаяОрганизация) КАК СостояниеБудущее
	|		ПО СостояниеРаботников.Период < СостояниеБудущее.Период
	|			И СостояниеРаботников.Сотрудник = СостояниеБудущее.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			МИНИМУМ(ДОБАВИТЬКДАТЕ(НамеченныеСобытия.ДатаИзменения, ДЕНЬ, -1)) КАК Период,
	|			СостояниеРаботников.Регистратор КАК Регистратор,
	|			СостояниеРаботников.НомерСтроки КАК НомерСтроки
	|		ИЗ
	|			РегистрСведений.СостояниеРаботниковОрганизаций КАК СостояниеРаботников
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.НамеченныеСобытияПоПерсоналу КАК НамеченныеСобытия
	|				ПО СостояниеРаботников.Регистратор = НамеченныеСобытия.Регистратор
	|					И СостояниеРаботников.Период <= НамеченныеСобытия.ДатаИзменения
	|					И (ВЫБОР
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодный)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускЕжегодный)
	|							ТОГДА ИСТИНА
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодныйЧасть)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускЕжегодныйЧасть)
	|							ТОГДА ИСТИНА	
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебный)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускУчебный)
	|							ТОГДА ИСТИНА
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебныйНеоплачиваемый)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускУчебныйНеоплачиваемый)
	|							ТОГДА ИСТИНА
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускБезСохраненияЗарплатыСемейноБытовыеПричины)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускБезСохраненияЗарплатыСемейноБытовыеПричины)
	|							ТОГДА ИСТИНА
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускБезСохраненияЗарплатыУчебныеСборы)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.ОтпускБезСохраненияЗарплатыУчебныеСборы)
	|							ТОГДА ИСТИНА
	|						КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка)
	|								И НамеченныеСобытия.ПланируемоеСобытие = ЗНАЧЕНИЕ(Перечисление.НамеченныеСобытияПоПерсоналу.Командировка)
	|							ТОГДА ИСТИНА
	|						ИНАЧЕ ЛОЖЬ
	|					КОНЕЦ)
	|					И СостояниеРаботников.Сотрудник = НамеченныеСобытия.Сотрудник
	|		ГДЕ
	|			СостояниеРаботников.Организация = &ГоловнаяОрганизация";
	Если ОтбиратьСобытияПоДокументу Тогда
		СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
	|			И СостояниеРаботников.Регистратор = &Регистратор";
	Иначе
		СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
		
	//Аверсон ЕАЕ 09.10.2024 СВФР-013879
	//|			И СостояниеРаботников.Регистратор.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания";
	|И ВЫБОР
	|  КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка)
	|  ТОГДА СостояниеРаботников.Период <= &ДатаОкончания И СостояниеРаботников.ПериодЗавершения >= &ДатаНачала
	|  ИНАЧЕ СостояниеРаботников.Регистратор.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|  КОНЕЦ";
	//Аверсон СВФР-013879
	
	КонецЕсли;	
	СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
	|		
	|		СГРУППИРОВАТЬ ПО
	|			СостояниеРаботников.Регистратор,
	|			СостояниеРаботников.НомерСтроки) КАК БудущиеНамеченныеСобытия
	|		ПО СостояниеРаботников.Регистратор = БудущиеНамеченныеСобытия.Регистратор
	|			И СостояниеРаботников.НомерСтроки = БудущиеНамеченныеСобытия.НомерСтроки
	|ГДЕ
	|	(НЕ СостояниеРаботников.Состояние В (ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Работает), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.НеРаботает), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоУходуЗаРебенком)))
	|	И СостояниеРаботников.Организация = &ГоловнаяОрганизация";
	Если ОтбиратьСобытияПоДокументу Тогда
		СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
	|	И СостояниеРаботников.Регистратор = &Регистратор";
	Иначе
		СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
		
	//Аверсон ЕАЕ 09.10.2024 СВФР-013879
	//|	И СостояниеРаботников.Регистратор.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания";
	|И ВЫБОР
	|  КОГДА СостояниеРаботников.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка)
	|  ТОГДА СостояниеРаботников.Период <= &ДатаОкончания И СостояниеРаботников.ПериодЗавершения >= &ДатаНачала
	|  ИНАЧЕ СостояниеРаботников.Регистратор.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|  КОНЕЦ";
	//Аверсон СВФР-013879
	
	КонецЕсли;	
	СостояниеРаботниковТекст = СостояниеРаботниковТекст + "
	|
	|СГРУППИРОВАТЬ ПО
	|	СостояниеРаботников.ПериодЗавершения, //СВЭЙ 31.10.2023 КВВ СВФР-011738
	|	СостояниеРаботников.Организация,
	|	СостояниеРаботников.Регистратор,
	|	СостояниеРаботников.Состояние,
	|	СостояниеРаботников.Период,
	|	БудущиеНамеченныеСобытия.Период,
	|	ОтпускаРаботниковОрганизации.ВидДополнительногоОтпуска,
	|	ОтпускаРаботниковОрганизации.ДатаНачалаДоп,
	|	ОтпускаРаботниковОрганизации.РабочийГодС,
	|	ОтпускаРаботниковОрганизации.РабочийГодПо,
	|	СостояниеРаботников.Сотрудник";
	Запрос.Текст = СостояниеРаботниковТекст;
	Запрос.Выполнить();
	
	// Составим список возможных расчетных документов за соответствующий период регистрации
	СписокРасчетныхДокументовТекст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	БольничныйЛист.Сотрудник,
	|	БольничныйЛист.Сотрудник.Физлицо КАК Физлицо,
	|	БольничныйЛист.ДатаНачала,
	|	БольничныйЛист.ДатаОкончания,
	|	ВЫБОР
	|		КОГДА БольничныйЛист.ПричинаНетрудоспособности = ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ПоБеременностиИРодам)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоБеременностиИРодам)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Заболевание)
	|	КОНЕЦ КАК Состояние,
	|	БольничныйЛист.Ссылка КАК РасчетныйДокумент,
	|	NULL КАК ВидРасчета,
	|	NULL КАК ПорядокРасчетаОтпуска,
	|	NULL КАК ВидДополнительногоОтпуска,
	|	NULL КАК ДатаНачалаДоп,
	|	NULL КАК РабочийГодС,
	|	NULL КАК РабочийГодПо,
	|	БольничныйЛист.ПричинаНетрудоспособности,
	|	БольничныйЛист.ПроцентОплаты,
	|	БольничныйЛист.ПервичныйБольничныйЛист,
	|	БольничныйЛист.ОграничениеПособия,
	|	БольничныйЛист.НомерВходящегоДокумента,
	|	БольничныйЛист.СерияВходящегоДокумента,
	|	NULL КАК ВидПростоя
	|ПОМЕСТИТЬ ВТСписокРасчетныхДокументов
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту КАК БольничныйЛист
	|ГДЕ";
	
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если ВыборкаРасчетных = 2 Тогда
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		|	(НЕ БольничныйЛист.ДатаОкончания < &ДатаНачала
		|	И НЕ БольничныйЛист.ДатаНачала > &ДатаОкончания)";
	Иначе
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		|	БольничныйЛист.ПериодРегистрации МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаОкончания, МЕСЯЦ)";
	КонецЕсли;
	СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
	|	И ВЫБОР
	|			КОГДА БольничныйЛист.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				ТОГДА БольничныйЛист.Организация
	|			ИНАЧЕ БольничныйЛист.Организация.ГоловнаяОрганизация
	|		КОНЕЦ = &ГоловнаяОрганизация
	|	И (НЕ БольничныйЛист.ПометкаУдаления)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НевыходыНачисления.Сотрудник,
	|	НевыходыНачисления.Сотрудник.Физлицо,
	|	НевыходыНачисления.ДатаНачала,
	|	НевыходыНачисления.ДатаОкончания,
	|	ВЫБОР
	|		КОГДА НевыходыНачисления.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени В (&УчетВремениНеоплачиваемыеОтпуска)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускБезСохраненияЗарплатыСемейноБытовыеПричины)
	|		КОГДА НевыходыНачисления.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ОтпускНаОбучениеНеоплачиваемый)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебныйНеоплачиваемый)
	|		КОГДА НевыходыНачисления.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.Прогулы)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Прогулы)
	|		КОГДА НевыходыНачисления.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ПростойПоВинеРаботника)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Простой)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтсутствуетПоНевыясненнойПричине)
	|	КОНЕЦ,
	|	НевыходыНачисления.Ссылка,
	|	НевыходыНачисления.ВидРасчета,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL
	|ИЗ
	|	Документ.НевыходыВОрганизациях.Начисления КАК НевыходыНачисления
	|ГДЕ";
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если ВыборкаРасчетных = 2 Тогда
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		|	(НЕ НевыходыНачисления.ДатаОкончания < &ДатаНачала
		|	И НЕ НевыходыНачисления.ДатаНачала > &ДатаОкончания)";
	Иначе
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		|	НевыходыНачисления.Ссылка.ПериодРегистрации МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаОкончания, МЕСЯЦ)";
	КонецЕсли;
	СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "

	|	И ВЫБОР
	|			КОГДА НевыходыНачисления.Ссылка.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				ТОГДА НевыходыНачисления.Ссылка.Организация
	|			ИНАЧЕ НевыходыНачисления.Ссылка.Организация.ГоловнаяОрганизация
	|		КОНЕЦ = &ГоловнаяОрганизация
	|	И (НЕ НевыходыНачисления.Ссылка.ПометкаУдаления)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НачислениеОтпуска.Сотрудник,
	|	НачислениеОтпуска.Сотрудник.Физлицо,
	|	ВЫБОР
	|		КОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска
	|		ИНАЧЕ НачислениеОтпуска.ДатаНачалаДополнительногоОтпуска
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НачислениеОтпуска.ДатаОкончанияОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА НачислениеОтпуска.ДатаОкончанияОсновногоОтпуска
	|		ИНАЧЕ НачислениеОтпуска.ДатаОкончанияДополнительногоОтпуска
	|	КОНЕЦ,
	
	//Аверсон ЕАЕ 15.05.2025 СВФР-015667
	//|	NULL,
	|	Значение(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодный),
	//Аверсон СВФР-015667
	
	//|	ВЫБОР
	//|		КОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодный)
	//|		КОГДА НачислениеОтпуска.ВидРасчетаДополнительногоОтпуска.ОбозначениеВТабелеУчетаРабочегоВремени В (&УчетВремениОплачиваемыеУчебныеОтпуска)
	//|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебный)
	//|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодныйЧасть)
	//|	КОНЕЦ,
	|	НачислениеОтпуска.Ссылка,
	|	ВЫБОР
	|		КОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ВЫБОР
	|					КОГДА НачислениеОтпуска.ПорядокРасчетаОсновногоОтпуска = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетаОтпуска.ПоКалендарнымДням)
	|						ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпКалендарныеДни)
	|					ИНАЧЕ ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпШестидневка)
	|				КОНЕЦ
	|		ИНАЧЕ НачислениеОтпуска.ВидРасчетаДополнительногоОтпуска
	|	КОНЕЦ,
	|	НачислениеОтпуска.ПорядокРасчетаОсновногоОтпуска,
	|	НачислениеОтпуска.ВидРасчетаДополнительногоОтпуска,
	|	НачислениеОтпуска.ДатаНачалаДополнительногоОтпуска,
	|	НачислениеОтпуска.РабочийГодС,
	|	НачислениеОтпуска.РабочийГодПо,
	|	NULL,
	|	НачислениеОтпуска.ПроцентОплатыДополнительногоОтпуска,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL
	|ИЗ
	|	Документ.НачислениеОтпускаРаботникамОрганизаций КАК НачислениеОтпуска
	|ГДЕ";
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если ВыборкаРасчетных = 2 Тогда
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		|(НЕ //НачислениеОтпуска.ДатаОкончания 
		|(ВЫБОР
		|КОГДА НачислениеОтпуска.ДатаОкончанияОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|ТОГДА НачислениеОтпуска.ДатаОкончанияОсновногоОтпуска
		|ИНАЧЕ НачислениеОтпуска.ДатаОкончанияДополнительногоОтпуска
		|КОНЕЦ
		|< &ДатаНачала)
		|И НЕ //НачислениеОтпуска.ДатаНачала 
		|(ВЫБОР
		|КОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|ТОГДА НачислениеОтпуска.ДатаНачалаОсновногоОтпуска
		|ИНАЧЕ НачислениеОтпуска.ДатаНачалаДополнительногоОтпуска
		|КОНЕЦ
		|> &ДатаОкончания))";
	Иначе
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		|	НачислениеОтпуска.ПериодРегистрации МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаОкончания, МЕСЯЦ)";
	КонецЕсли;
	СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "

	|	И ВЫБОР
	|			КОГДА НачислениеОтпуска.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				ТОГДА НачислениеОтпуска.Организация
	|			ИНАЧЕ НачислениеОтпуска.Организация.ГоловнаяОрганизация
	|		КОНЕЦ = &ГоловнаяОрганизация
	|	И (НЕ НачислениеОтпуска.ПометкаУдаления)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОплатаПоСреднему.Сотрудник,
	|	ОплатаПоСреднему.Сотрудник.Физлицо,
	|	ОплатаПоСреднему.ДатаНачала,
	|	ОплатаПоСреднему.ДатаОкончания,
	|	ВЫБОР
	|		КОГДА ОплатаПоСреднему.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.Командировка)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка)
	|		КОГДА ОплатаПоСреднему.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ВынужденныйПрогул)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ВынужденныйПрогул)
	|		КОГДА ОплатаПоСреднему.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ГосударственныеОбязанности)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ГосударственныеОбязанности)
	|		КОГДА ОплатаПоСреднему.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ДополнительныеВыходныеДниОплачиваемые)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ДополнительныеВыходныеДниОплачиваемые)
	|		ИНАЧЕ NULL
	|	КОНЕЦ,
	|	ОплатаПоСреднему.Ссылка,
	|	ОплатаПоСреднему.ВидРасчета,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	ОплатаПоСреднему.ПроцентОплаты,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL
	|ИЗ
	|	Документ.ОплатаПоСреднемуЗаработку КАК ОплатаПоСреднему
	|ГДЕ";
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если ВыборкаРасчетных = 2 Тогда
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		|	(НЕ ОплатаПоСреднему.ДатаОкончания < &ДатаНачала
		|	И НЕ ОплатаПоСреднему.ДатаНачала > &ДатаОкончания)";
	Иначе
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		|	ОплатаПоСреднему.ПериодРегистрации МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаОкончания, МЕСЯЦ)";
	КонецЕсли;
	СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
	
	|	И ВЫБОР
	|			КОГДА ОплатаПоСреднему.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				ТОГДА ОплатаПоСреднему.Организация
	|			ИНАЧЕ ОплатаПоСреднему.Организация.ГоловнаяОрганизация
	|		КОНЕЦ = &ГоловнаяОрганизация
	|	И (НЕ ОплатаПоСреднему.ПометкаУдаления)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	РегистрацияПростоев.Сотрудник,
	|	РегистрацияПростоев.Сотрудник.Физлицо,
	|	РегистрацияПростоев.ДатаНачала,
	|	РегистрацияПростоев.ДатаОкончания,
	|	ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Простой),
	|	РегистрацияПростоев.Ссылка,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	РегистрацияПростоев.ВидПростоя
	|ИЗ
	|	Документ.РегистрацияПростоевРаботниковОрганизаций КАК РегистрацияПростоев
	|ГДЕ";
	//Аверсон 23.03.2023 КВВ СВФР-010563 (
	Если ВыборкаРасчетных = 2 Тогда
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		|	(НЕ РегистрацияПростоев.ДатаОкончания < &ДатаНачала
		|	И НЕ РегистрацияПростоев.ДатаНачала > &ДатаОкончания)";
	Иначе
		СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		|	РегистрацияПростоев.ПериодРегистрации МЕЖДУ НАЧАЛОПЕРИОДА(&ДатаНачала, МЕСЯЦ) И КОНЕЦПЕРИОДА(&ДатаОкончания, МЕСЯЦ)";
	КонецЕсли;
	СписокРасчетныхДокументовТекст = СписокРасчетныхДокументовТекст + "
	
	|	И ВЫБОР
	|			КОГДА РегистрацияПростоев.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|				ТОГДА РегистрацияПростоев.Организация
	|			ИНАЧЕ РегистрацияПростоев.Организация.ГоловнаяОрганизация
	|		КОНЕЦ = &ГоловнаяОрганизация
	|	И (НЕ РегистрацияПростоев.ПометкаУдаления)
	|	И (НЕ РегистрацияПростоев.НеЦелодневныйПростой)";
	
	Запрос.Текст = СписокРасчетныхДокументовТекст;
	Запрос.Выполнить();
	
	// Шаблон запроса для выбора подходящего вида расчета
	ТекстЗапросаВидРасчета = "
	|(ВЫБРАТЬ
	|	МИНИМУМ(ОсновныеНачисления.Ссылка) КАК ВидРасчета
	|ИЗ
	|	ПланВидовРасчета.ОсновныеНачисленияОрганизаций КАК ОсновныеНачисления
	|ГДЕ
	|	ОсновныеНачисления.СпособРасчета <<СпособРасчета>> И
	|	ОсновныеНачисления.ВидВремени = ЗНАЧЕНИЕ(Перечисление.ВидыВремени.ЦелодневноеНеотработанное) И
	|	ОсновныеНачисления.ОбозначениеВТабелеУчетаРабочегоВремени <<Обозначение>>)
	|";
	
	// Соединяем кадровые и расчетные документы
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	РасчетныеИКадровыеДанные.Отметка,
	|	РасчетныеИКадровыеДанные.Сотрудник,
	|	РасчетныеИКадровыеДанные.Физлицо,
	|	РасчетныеИКадровыеДанные.ДатаНачала,
	|	РасчетныеИКадровыеДанные.ДатаОкончания,
	|	РасчетныеИКадровыеДанные.Неявка,
	|	РасчетныеИКадровыеДанные.КадровыйДокумент,
	|	ВЫБОР 
	|		КОГДА НЕ (РасчетныйДокумент ЕСТЬ NULL) ТОГДА РасчетныйДокумент
	|		КОГДА Неявка В (ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Заболевание),ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоБеременностиИРодам)) ТОГДА ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛисту.ПустаяСсылка)
	|		КОГДА Неявка В (ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодный), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодныйЧасть), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебный)) ТОГДА ЗНАЧЕНИЕ(Документ.НачислениеОтпускаРаботникамОрганизаций.ПустаяСсылка)
	|		КОГДА Неявка В (ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ВынужденныйПрогул), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ГосударственныеОбязанности), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ДополнительныеВыходныеДниОплачиваемые)) ТОГДА ЗНАЧЕНИЕ(Документ.ОплатаПоСреднемуЗаработку.ПустаяСсылка)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Простой) ТОГДА ЗНАЧЕНИЕ(Документ.РегистрацияПростоевРаботниковОрганизаций.ПустаяСсылка)
	
	//Аверсон ЕАЕ 02.09.2024 СВФР-013691
	|       КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОплатаПоСреднемуЗаработку) ТОГДА ЗНАЧЕНИЕ(Документ.ОплатаПоСреднемуЗаработку.ПустаяСсылка)
	//Аверсон СВФР-013691
	
	|		ИНАЧЕ ЗНАЧЕНИЕ(Документ.НевыходыВОрганизациях.ПустаяСсылка)
	|	КОНЕЦ КАК РасчетныйДокумент,
	|	ВЫБОР 
	|		КОГДА НЕ (РасчетныйДокумент ЕСТЬ NULL) ТОГДА РасчетныеИКадровыеДанные.ВидРасчета
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Заболевание) ТОГДА NULL
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоБеременностиИРодам) ТОГДА NULL
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Командировка) ТОГДА ПВРКомандировка.ВидРасчета
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодный) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпКалендарныеДни)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускЕжегодныйЧасть) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпКалендарныеДни)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебный) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпКалендарныеДни)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускУчебныйНеоплачиваемый) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОтпускБезОплатыУчебный)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускБезСохраненияЗарплатыСемейноБытовыеПричины) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОтпускЗаСвойСчет)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускБезСохраненияЗарплатыУчебныеСборы) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОтпускЗаСвойСчет)	
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоУходуЗаРебенком) ТОГДА NULL
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтсутствуетПоНевыясненнойПричине) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Невыход)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ВынужденныйПрогул) ТОГДА ПВРВынужденныйПрогул.ВидРасчета
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ГосударственныеОбязанности) ТОГДА ПВРГосударственныеОбязанности.ВидРасчета
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Прогулы) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.Прогул)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ДополнительныеВыходныеДниОплачиваемые) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаВыходныхДнейПоУходуЗаДетьмиИнвалидами)
	|		КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Простой) ТОГДА NULL
	
	//Аверсон ЕАЕ 02.09.2024 СВФР-013691
	|       КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОплатаПоСреднемуЗаработку) ТОГДА ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднему)
	//Аверсон СВФР-013691
	
	|	КОНЕЦ КАК ВидРасчета,
	|	РасчетныеИКадровыеДанные.ПорядокРасчетаОтпуска,
	|	РасчетныеИКадровыеДанные.ВидДополнительногоОтпуска,
	|	РасчетныеИКадровыеДанные.ДатаНачалаДоп,
	|	РасчетныеИКадровыеДанные.РабочийГодС,
	|	РасчетныеИКадровыеДанные.РабочийГодПо,
	|	РасчетныеИКадровыеДанные.ПричинаНетрудоспособности,
	|	РасчетныеИКадровыеДанные.ПроцентОплаты,
	|	РасчетныеИКадровыеДанные.ПервичныйБольничныйЛист,
	|	РасчетныеИКадровыеДанные.ОграничениеПособия,
	|	РасчетныеИКадровыеДанные.НомерВходящегоДокумента,
	|	РасчетныеИКадровыеДанные.СерияВходящегоДокумента,
	|	РасчетныеИКадровыеДанные.ВидПростоя
	|ИЗ
	|(
	|ВЫБРАТЬ
	|	ВЫБОР КОГДА МАКСИМУМ(РасчетныйДокумент.Ссылка) ЕСТЬ НЕ NULL И МАКСИМУМ(РасчетныйДокумент.Проведен) = Истина ТОГДА ЛОЖЬ КОГДА МАКСИМУМ(КадровыйДокумент.Ссылка) ЕСТЬ НЕ NULL ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК Отметка,
	|	Сотрудник,
	|	ЕСТЬNULL(МАКСИМУМ(КадровыеДанныеФизлицо), МАКСИМУМ(РасчетныеДанныеФизлицо)) КАК Физлицо,
	|	ДатаНачала,
	|	ЕСТЬNULL(МАКСИМУМ(КадровыеДанныеДатаОкончания), МАКСИМУМ(РасчетныеДанныеДатаОкончания)) КАК ДатаОкончания,
	|	Неявка,
	|	МАКСИМУМ(КадровыйДокумент) КАК КадровыйДокумент,
	|	МАКСИМУМ(РасчетныйДокумент) КАК РасчетныйДокумент,
	|	МАКСИМУМ(ВидРасчета) КАК ВидРасчета,
	|	ВЫБОР КОГДА НЕ (МАКСИМУМ(ПорядокРасчетаОтпуска) ЕСТЬ NULL) ТОГДА МАКСИМУМ(ПорядокРасчетаОтпуска) КОГДА Неявка = &ОтпускЕжегодный ТОГДА ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетаОтпуска.ПоКалендарнымДням) ИНАЧЕ NULL КОНЕЦ КАК ПорядокРасчетаОтпуска,
	|	ЕСТЬNULL(МАКСИМУМ(РасчетныеДанныеВидДополнительногоОтпуска), МАКСИМУМ(КадровыеДанныеВидДополнительногоОтпуска)) КАК ВидДополнительногоОтпуска,
	|	ЕСТЬNULL(МАКСИМУМ(РасчетныеДанныеДатаНачалаДоп), МАКСИМУМ(КадровыеДанныеДатаНачалаДоп)) КАК ДатаНачалаДоп,
	|	ЕСТЬNULL(МАКСИМУМ(РасчетныеДанныеРабочийГодС), МАКСИМУМ(КадровыеДанныеРабочийГодС)) КАК РабочийГодС,
	|	ЕСТЬNULL(МАКСИМУМ(РасчетныеДанныеРабочийГодПо), МАКСИМУМ(КадровыеДанныеРабочийГодПо)) КАК РабочийГодПо,
	|	ЕСТЬNULL(МАКСИМУМ(ПричинаНетрудоспособности),ВЫБОР КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоБеременностиИРодам) ТОГДА ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ПоБеременностиИРодам) КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Заболевание) ТОГДА ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ОбщееЗаболевание) ИНАЧЕ NULL КОНЕЦ) КАК ПричинаНетрудоспособности,
	|	ЕСТЬNULL(МАКСИМУМ(ПроцентОплаты), 100) КАК ПроцентОплаты,
	|	МАКСИМУМ(ПервичныйБольничныйЛист) КАК ПервичныйБольничныйЛист,
	|	ЕСТЬNULL(МАКСИМУМ(ОграничениеПособия), ВЫБОР КОГДА Неявка В (ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Заболевание), ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.ОтпускПоБеременностиИРодам)) ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыОграниченияПособия.ОбщееОграничение) ИНАЧЕ NULL КОНЕЦ) КАК ОграничениеПособия,
	|	МАКСИМУМ(НомерВходящегоДокумента) КАК НомерВходящегоДокумента,
	|	МАКСИМУМ(СерияВходящегоДокумента) КАК СерияВходящегоДокумента,
	|	ЕСТЬNULL(МАКСИМУМ(ВидПростоя), ВЫБОР КОГДА Неявка = ЗНАЧЕНИЕ(Перечисление.СостоянияРаботникаОрганизации.Простой) ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыПростояРаботника.ПоНезависящимПричинам) ИНАЧЕ NULL КОНЕЦ) КАК ВидПростоя
	|ИЗ
	|(
	|ВЫБРАТЬ
	|	КадровыеДанные.Сотрудник КАК Сотрудник,
	|	КадровыеДанные.Состояние КАК Неявка,
	|	КадровыеДанные.ДатаНачала КАК ДатаНачала,
	|	КадровыеДанные.ФизЛицо КАК КадровыеДанныеФизЛицо,
	|	КадровыеДанные.ДатаОкончания КАК КадровыеДанныеДатаОкончания,
	|	КадровыеДанные.КадровыйДокумент КАК КадровыйДокумент,
	|	КадровыеДанные.ВидДополнительногоОтпуска КАК КадровыеДанныеВидДополнительногоОтпуска,
	|	КадровыеДанные.ДатаНачалаДоп КАК КадровыеДанныеДатаНачалаДоп,
	|	КадровыеДанные.РабочийГодС КАК КадровыеДанныеРабочийГодС,
	|	КадровыеДанные.РабочийГодПо КАК КадровыеДанныеРабочийГодПо,
	|	NULL КАК РасчетныеДанныеФизЛицо,
	|	NULL КАК РасчетныеДанныеДатаОкончания,
	|	NULL КАК РасчетныйДокумент,
	|	NULL КАК ВидРасчета,
	|	NULL КАК ПорядокРасчетаОтпуска,
	|	NULL КАК РасчетныеДанныеВидДополнительногоОтпуска,
	|	NULL КАК РасчетныеДанныеДатаНачалаДоп,
	|	NULL КАК РасчетныеДанныеРабочийГодС,
	|	NULL КАК РасчетныеДанныеРабочийГодПо,
	|	NULL КАК ПричинаНетрудоспособности,
	|	NULL КАК ПроцентОплаты,
	|	NULL КАК ПервичныйБольничныйЛист,
	|	NULL КАК ОграничениеПособия,
	|	NULL КАК НомерВходящегоДокумента,
	|	NULL КАК СерияВходящегоДокумента,
	|	NULL КАК ВидПростоя
	|ИЗ ВТСостояниеРаботников КАК КадровыеДанные
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ 
	|	РасчетныеДанные.Сотрудник,
	|	РасчетныеДанные.Состояние,
	|	РасчетныеДанные.ДатаНачала,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	РасчетныеДанные.ФизЛицо КАК РасчетныеДанныеФизЛицо,
	|	РасчетныеДанные.ДатаОкончания КАК РасчетныеДанныеДатаОкончания,
	|	РасчетныеДанные.РасчетныйДокумент,
	|	РасчетныеДанные.ВидРасчета,
	|	РасчетныеДанные.ПорядокРасчетаОтпуска,
	|	РасчетныеДанные.ВидДополнительногоОтпуска КАК РасчетныеДанныеВидДополнительногоОтпуска,
	|	РасчетныеДанные.ДатаНачалаДоп КАК РасчетныеДанныеДатаНачалаДоп,
	|	РасчетныеДанные.РабочийГодС КАК РасчетныеДанныеРабочийГодС,
	|	РасчетныеДанные.РабочийГодПо КАК РасчетныеДанныеРабочийГодПо,
	|	РасчетныеДанные.ПричинаНетрудоспособности,
	|	РасчетныеДанные.ПроцентОплаты,
	|	РасчетныеДанные.ПервичныйБольничныйЛист,
	|	РасчетныеДанные.ОграничениеПособия,
	|	РасчетныеДанные.НомерВходящегоДокумента,
	|	РасчетныеДанные.СерияВходящегоДокумента,
	|	РасчетныеДанные.ВидПростоя
	|ИЗ ВТСписокРасчетныхДокументов КАК РасчетныеДанные
	|) КАК РасчетныеИКадровыеДанные
	|СГРУППИРОВАТЬ ПО Сотрудник,
	|			Неявка,
	|			ДатаНачала
	|) КАК РасчетныеИКадровыеДанные
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ " + СтрЗаменить(СтрЗаменить(ТекстЗапросаВидРасчета, "<<СпособРасчета>>", "= ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку)"), "<<Обозначение>>", " = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.Командировка)") + " КАК ПВРКомандировка
	|		ПО ИСТИНА
	|	ЛЕВОЕ СОЕДИНЕНИЕ " + СтрЗаменить(СтрЗаменить(ТекстЗапросаВидРасчета, "<<СпособРасчета>>", "В (&РасчетыОтпуска)"), "<<Обозначение>>", "В (&УчетВремениОплачиваемыеУчебныеОтпуска)") + " КАК ПВРОтпускУчебный
	|		ПО ИСТИНА
	|	ЛЕВОЕ СОЕДИНЕНИЕ " + СтрЗаменить(СтрЗаменить(ТекстЗапросаВидРасчета, "<<СпособРасчета>>", "= ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку)"), "<<Обозначение>>", " = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ВынужденныйПрогул)") + " КАК ПВРВынужденныйПрогул
	|		ПО ИСТИНА
	|	ЛЕВОЕ СОЕДИНЕНИЕ " + СтрЗаменить(СтрЗаменить(ТекстЗапросаВидРасчета, "<<СпособРасчета>>", "= ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку)"), "<<Обозначение>>", " = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ГосударственныеОбязанности)") + " КАК ПВРГосударственныеОбязанности
	|		ПО ИСТИНА
	|";
	
	// Условие на подразделение 
	Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
		ТекстЗапроса = ТекстЗапроса + "
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаОкончания, Организация = &ГоловнаяОрганизация) КАК РаботникиОрганизации
		|		ПО РасчетныеИКадровыеДанные.Сотрудник = РаботникиОрганизации.Сотрудник
		|";
	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
		|ГДЕ
		|	(НЕ (РасчетныеИКадровыеДанные.Неявка ЕСТЬ NULL))
		|";
		
		//Аверсон 23.03.2023 КВВ СВФР-010563 (
		Если НЕ ПоТабелям И ВидНеявкиПеречисление.Количество() > 0 Тогда
			ТекстЗапроса = ТекстЗапроса + "
		|	И РасчетныеИКадровыеДанные.Неявка В (&СписокВидНеявкиПеречисление)
		|";
		КонецЕсли;
		//Аверсон 23.03.2023 КВВ СВФР-010563 )
		
	// Условие на подразделение 
	Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
		ТекстЗапроса = ТекстЗапроса + " И
		|	ВЫБОР
		|		КОГДА  РаботникиОрганизации.ПериодЗавершения <= &ДатаОкончания
		|				И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|		ТОГДА РаботникиОрганизации.ПодразделениеОрганизацииЗавершения
		|		ИНАЧЕ РаботникиОрганизации.ПодразделениеОрганизации
		|	КОНЕЦ В ИЕРАРХИИ (&ПодразделениеОрганизации)
		|";
	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
	|УПОРЯДОЧИТЬ ПО
	|	РасчетныеИКадровыеДанные.Сотрудник.Наименование,
	|	РасчетныеИКадровыеДанные.Неявка,
	|	РасчетныеИКадровыеДанные.ДатаНачала,
	|	РасчетныеИКадровыеДанные.КадровыйДокумент,
	|	РасчетныеИКадровыеДанные.РасчетныйДокумент.Проведен УБЫВ // сначала проведенные документы
	|";
	
	Запрос.Текст = ТекстЗапроса;
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапрос()	

Функция СформироватьЗапросПоТабелям()
	Запрос = Новый Запрос;
	
	СписокВидовНеявок = Новый СписокЗначений;
	Если ЗначениеЗаполнено(ВидНеявки) Тогда
		СписокВидовНеявок.Добавить(ВидНеявки);
	Иначе
		СписокВидовНеявок = СформируемСпискоВидовНеявок();
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РабочееВремяРаботниковОрганизаций.ВидИспользованияРабочегоВремени КАК ВидВремени,
	|	РабочееВремяРаботниковОрганизаций.Сотрудник КАК Сотрудник,
	|	РабочееВремяРаботниковОрганизаций.Сотрудник.Наименование КАК СотрудникНаименование
	|ИЗ
	|	РегистрНакопления.РабочееВремяРаботниковОрганизаций КАК РабочееВремяРаботниковОрганизаций
	|";
	
	//заявка №1977 (база заявок Кристалла) Дмитрук. О.Г.
	Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
		ТекстЗапроса = ТекстЗапроса + "
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(&КонДата, Организация = &ГоловнаяОрганизация) КАК РаботникиОрганизации
		|		ПО РабочееВремяРаботниковОрганизаций.Сотрудник = РаботникиОрганизации.Сотрудник
		|";
	КонецЕсли;
	//заявка №1977
	
    ТекстЗапроса = ТекстЗапроса + "
	|ГДЕ
	|	(НЕ РабочееВремяРаботниковОрганизаций.ВЦеломЗаПериод)
	|	И РабочееВремяРаботниковОрганизаций.Период МЕЖДУ &НачДата И &КонДата
	|	И РабочееВремяРаботниковОрганизаций.ВидИспользованияРабочегоВремени В(&ВидНеявки)
	|	И РабочееВремяРаботниковОрганизаций.Часов <> 0
	|";
	
	//заявка №1977 (база заявок Кристалла) Дмитрук. О.Г.
	Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
		ТекстЗапроса = ТекстЗапроса + " И
		|	ВЫБОР
		|		КОГДА  РаботникиОрганизации.ПериодЗавершения <= &КонДата
		|				И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|		ТОГДА РаботникиОрганизации.ПодразделениеОрганизацииЗавершения
		|		ИНАЧЕ РаботникиОрганизации.ПодразделениеОрганизации
		|	КОНЕЦ В ИЕРАРХИИ (&ПодразделениеОрганизации)
		|";
	КонецЕсли;
	//заявка №1977
	
	ТекстЗапроса = ТекстЗапроса + "
	|СГРУППИРОВАТЬ ПО
	|	РабочееВремяРаботниковОрганизаций.ВидИспользованияРабочегоВремени,
	|	РабочееВремяРаботниковОрганизаций.Сотрудник
	
	|УПОРЯДОЧИТЬ ПО
	|	ВидВремени,
	|	СотрудникНаименование ВОЗР";
	


	Запрос.УстановитьПараметр("НачДата", НачалоМесяца(ДатаНачала));
	Запрос.УстановитьПараметр("КонДата", КонецМесяца(ДатаОкончания));
	Запрос.УстановитьПараметр("ВидНеявки", СписокВидовНеявок);
	//заявка №1977 (база заявок Кристалла) Дмитрук. О.Г.
	Запрос.УстановитьПараметр("ПодразделениеОрганизации", ПодразделениеОрганизации);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация", ОбщегоНазначения.ГоловнаяОрганизация(Организация));
	//заявка №1977
		
	Запрос.Текст = ТекстЗапроса;
	Результат = Запрос.Выполнить();
	
	Возврат Результат;
КонецФункции
	
////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ОБРАБОТКИ

// Заполняет т.ч. обработки кадровыми и расчетными документами
//
// Параметры:
//	Нет
//
// Возвращаемое значение:
//	Булево - Истина, если успешно выполнено заполнение, иначе Ложь
//
Функция Автозаполнение() Экспорт

	Неявки.Очистить();
	
	Если НЕ ЗначениеЗаполнено(Организация) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Необходимо указать организацию!");
		Возврат Ложь;
	КонецЕсли;
	
	Если Не ПоТабелям Тогда
		РезультатЗапроса = СформироватьЗапрос();
		
		Неявки.Загрузить(РезультатЗапроса.Выгрузить());
		
		// обработаем табличную часть, проверяя на дублирование документов
		ПредыдущийКадровыйДокумент	= Неопределено;
		ПредыдущийСотрудник			= Неопределено;
		ПредыдущаяНеявка			= Неопределено;
		ПредыдущаяДатаНачала		= Неопределено;
		
		Для Каждого СтрокаТаблицы Из Неявки Цикл
			Если ПредыдущийКадровыйДокумент = СтрокаТаблицы.КадровыйДокумент
				И ПредыдущийСотрудник = СтрокаТаблицы.Сотрудник
				И ПредыдущаяНеявка = СтрокаТаблицы.Неявка
				И ПредыдущаяДатаНачала = СтрокаТаблицы.ДатаНачала Тогда
				
				// полностью повторились ключевые реквизиты - отметим как дубль
				СтрокаТаблицы.ДублирующаясяСтрока = Истина;
				СтрокаТаблицы.Отметка = Ложь;
			КонецЕсли;
			
			// Запоминаем текущие значения ключевых реквизитов
			ПредыдущийКадровыйДокумент	= СтрокаТаблицы.КадровыйДокумент;
			ПредыдущийСотрудник			= СтрокаТаблицы.Сотрудник;
			ПредыдущаяНеявка			= СтрокаТаблицы.Неявка;
			ПредыдущаяДатаНачала		= СтрокаТаблицы.ДатаНачала;
		КонецЦикла;
		
		Возврат Истина;
	Иначе
		
		РезультатЗапроса = СформироватьЗапросПоТабелям().Выбрать();
		
		ТекСотрудник = ""; ТекВидНеявки = ""; ТекДатаОкончания = ""; ТекСтрока = "";
		Пока РезультатЗапроса.Следующий() Цикл
			Если ТекСтрока <> "" Тогда
				//ТекСтрока.ДатаОкончания = ТекДатаОкончания;
				ТекСтрока.Отметка = Истина;
				ТекСтрока.РасчетныйДокумент = ПолучитьРасчетныйДокумент(ТекСтрока.Сотрудник,ТекСтрока.ФизЛицо, ТекСтрока.ДатаНачала, ТекСтрока.ДатаОкончания, ТекСтрока.ВидРасчета, ТекСтрока.ПроцентОплаты, НачалоМесяца(ТекСтрока.ДатаНачала));
				Если ЗначениеЗаполнено(ТекСтрока.РасчетныйДокумент) Тогда
					Если ТекСтрока.РасчетныйДокумент.Проведен Тогда
						ТекСтрока.Отметка = Ложь;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			НоваяСтрока = Неявки.Добавить();
			НоваяСтрока.Сотрудник = РезультатЗапроса.Сотрудник;
			НоваяСтрока.ФизЛицо = РезультатЗапроса.Сотрудник.ФизЛицо;
			НоваяСтрока.ДатаНачала = НачалоМесяца(ДатаНачала);
			НоваяСтрока.ДатаОкончания = КонецМесяца(ДатаОкончания);
			НоваяСтрока.ВидНеявки = РезультатЗапроса.ВидВремени;
			ПоискВО = ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.НайтиПоРеквизиту("ОбозначениеВТабелеУчетаРабочегоВремени", РезультатЗапроса.ВидВремени);
			Если ПоискВО.Пустая() Тогда
				НоваяСтрока.ВидРасчета = ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднему;
			Иначе
				ОбъектВО = ПоискВО.ПолучитьОбъект();
				НоваяСтрока.ВидРасчета = ОбъектВО.Ссылка;
			КонецЕсли;
			НоваяСтрока.РасчетныйДокумент = Документы.ОплатаПоСреднемуЗаработку.ПустаяСсылка();
			НоваяСтрока.ПроцентОплаты = 100;
			
			ТекВидНеявки = РезультатЗапроса.ВидВремени;
			ТекСтрока = НоваяСтрока;
		КонецЦикла;
		Если ТекСтрока <> "" Тогда
			ТекСтрока.Отметка = Истина;
			ТекСтрока.РасчетныйДокумент = ПолучитьРасчетныйДокумент(ТекСтрока.Сотрудник,ТекСтрока.ФизЛицо, ТекСтрока.ДатаНачала, ТекСтрока.ДатаОкончания, ТекСтрока.ВидРасчета, ТекСтрока.ПроцентОплаты, НачалоМесяца(ТекСтрока.ДатаНачала));
			Если ЗначениеЗаполнено(ТекСтрока.РасчетныйДокумент) Тогда
				Если ТекСтрока.РасчетныйДокумент.Проведен Тогда
					ТекСтрока.Отметка = Ложь;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецФункции

// Процедура создает документы по пустым строкам табличной части
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Нет
//
Процедура СоздатьДокументы() Экспорт

	ГоловнаяОрганизация = ОбщегоНазначения.ГоловнаяОрганизация(Организация);
	РазмерПособияПоУходуДо1_5Лет = РегистрыСведений.ГосударственныеПособия.ПолучитьПоследнее(ДатаОкончания, Новый Структура("ВидПособия", Перечисления.ВидыГосударственныхПособий.ПособиеНаРебенкаСтарше3Лет)).Размер;
	РазмерПособияПоУходуДо3Лет = РегистрыСведений.ГосударственныеПособия.ПолучитьПоследнее(ДатаОкончания, Новый Структура("ВидПособия", Перечисления.ВидыГосударственныхПособий.ПособиеНаРебенкаДо3Лет)).Размер;
	
	СписокРасчетовОтпуска = Новый СписокЗначений;
	СписокРасчетовОтпуска.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоКалендарнымДням);
	СписокРасчетовОтпуска.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоШестидневке);
	
	Для Каждого СтрокаТаблицы Из Неявки Цикл
		
		Если Не ПоТабелям Тогда
			Если СтрокаТаблицы.Отметка 
				И ЗначениеЗаполнено(СтрокаТаблицы.КадровыйДокумент) 
				И НЕ ЗначениеЗаполнено(СтрокаТаблицы.РасчетныйДокумент) Тогда
				
				ТипРасчетногоДокумента 	= ТипЗнч(СтрокаТаблицы.РасчетныйДокумент);
				ВидНеявки 		= СтрокаТаблицы.Неявка;
				СтрокаСообщенияОбОшибке = СтрокаТаблицы.Сотрудник.Наименование + " " + СтрокаТаблицы.Неявка + " от " + Формат(СтрокаТаблицы.ДатаНачала,"ДФ=дд.ММ.гггг")+": ";
				
				Если ТипРасчетногоДокумента = Тип("ДокументСсылка.НачислениеПоБольничномуЛисту") Тогда
					
					РасчетныйДокумент = Документы.НачислениеПоБольничномуЛисту.СоздатьДокумент();
					
					//Аверсон 23.03.2023 КВВ СВФР-010563 (
					Если Организация.ИНН = "100194961" И ЗначениеЗаполнено(ТекМесяцРасчетаЗП) Тогда 
						РасчетныйДокумент.ПериодРегистрации = Макс(НачалоМесяца(ТекМесяцРасчетаЗП),НачалоМесяца(СтрокаТаблицы.ДатаНачала));
					Иначе
						//Аверсон 23.03.2023 КВВ СВФР-010563 )
						РасчетныйДокумент.ПериодРегистрации 		= НачалоМесяца(ДатаНачала);
					КонецЕсли;
					
					РасчетныйДокумент.Сотрудник					= СтрокаТаблицы.Сотрудник;
					РасчетныйДокумент.Физлицо					= СтрокаТаблицы.Физлицо;
					РасчетныйДокумент.ПричинаНетрудоспособности	= СтрокаТаблицы.ПричинаНетрудоспособности;
					РасчетныйДокумент.ПроцентОплаты 			= СтрокаТаблицы.ПроцентОплаты;
					РасчетныйДокумент.ПервичныйБольничныйЛист 	= СтрокаТаблицы.ПервичныйБольничныйЛист;
					РасчетныйДокумент.ДатаНачала 				= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаОкончания 			= СтрокаТаблицы.ДатаОкончания;
					РасчетныйДокумент.ОграничениеПособия 		= СтрокаТаблицы.ОграничениеПособия;
					РасчетныйДокумент.НомерВходящегоДокумента 	= СтрокаТаблицы.НомерВходящегоДокумента;
					РасчетныйДокумент.СерияВходящегоДокумента 	= СтрокаТаблицы.СерияВходящегоДокумента;
					Если СтрокаТаблицы.ДатаНачала  >= Дата(2024,07,01) Тогда      // истина проставлять по новым условиям
						РасчетныйДокумент.РучнойРасчетСреднегоЗаработка = Истина;
					КонецЕсли;
					//Аверсон 23.03.2023 КВВ СВФР-010563 (
					РасчетныйДокумент.СпособРасчетаВДнях = Истина;
					РасчетныйДокумент.КалендарныеДни = Истина;
					
					ЗапросЛьгота = Новый Запрос;
					ЗапросЛьгота.Текст = 
					"ВЫБРАТЬ
					|СоциальныеЛьготыСотрудниковСрезПоследних.Сотрудник
					|ИЗ РегистрСведений.СоциальныеЛьготыСотрудников.СрезПоследних(, Сотрудник = &Сотрудник) КАК СоциальныеЛьготыСотрудниковСрезПоследних";
					ЗапросЛьгота.УстановитьПараметр("Сотрудник",СтрокаТаблицы.Сотрудник);
					РезЛьгота = ЗапросЛьгота.Выполнить().Выгрузить();
					
					Если СтрокаТаблицы.ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве 
						ИЛИ СтрокаТаблицы.ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам 
						ИЛИ СтрокаТаблицы.ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоУходу Тогда
						РасчетныйДокумент.ПроцентОплаты = 100;
					ИначеЕсли РезЛьгота.Количество()>0 Тогда 
						РасчетныйДокумент.ПроцентОплаты = 100;
					Иначе
						РасчетныйДокумент.ПроцентОплаты = 80;
					КонецЕсли;
					//Аверсон 23.03.2023 КВВ СВФР-010563 )
					
				ИначеЕсли ТипРасчетногоДокумента = Тип("ДокументСсылка.ОплатаПоСреднемуЗаработку") Тогда
					
					Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.ВидРасчета) 	
						Или СтрокаТаблицы.ВидРасчета.СпособРасчета <> Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку Тогда
						ОбщегоНазначения.СообщитьОбОшибке(СтрокаСообщенияОбОшибке+"необходимо указать вид расчета по среднему заработку");
						Продолжить;
					КонецЕсли;
					
					РасчетныйДокумент = Документы.ОплатаПоСреднемуЗаработку.СоздатьДокумент();
					РасчетныйДокумент.ПериодРегистрации 		= НачалоМесяца(ДатаНачала);
					РасчетныйДокумент.Сотрудник					= СтрокаТаблицы.Сотрудник;
					РасчетныйДокумент.Физлицо					= СтрокаТаблицы.Физлицо;
					РасчетныйДокумент.ВидРасчета 				= СтрокаТаблицы.ВидРасчета;
					РасчетныйДокумент.ПроцентОплаты 			= СтрокаТаблицы.ПроцентОплаты;
					РасчетныйДокумент.СпособРегистрацииВремени 	= Перечисления.СпособыРегистрацииВремени.РегистрацияДляЦелойСмены;
					РасчетныйДокумент.ДатаНачала				= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаОкончания				= СтрокаТаблицы.ДатаОкончания;
					РасчетныйДокумент.ФлагОплатаПоЧасам = ВосстановитьЗначение("ОплатаПоСреднемуЗаработкуФлагОплатаПоЧасам");
					РасчетныйДокумент.ПремияПоЧасам     = ВосстановитьЗначение("ОплатаПоСреднемуЗаработкуПремияПоЧасам");
					РасчетныйДокумент.ВклПремииПропорциональноОтрабВр = ВосстановитьЗначение("ВклПремииПропорциональноОтрабВр");
					РасчетныйДокумент.КвПремияВсеВыплаты = ВосстановитьЗначение("КвПремияВсеВыплаты"); 
				ИначеЕсли ТипРасчетногоДокумента = Тип("ДокументСсылка.НачислениеОтпускаРаботникамОрганизаций") Тогда
					
					//Если СтрокаТаблицы.Неявка = Перечисления.СостоянияРаботникаОрганизации.ОтпускУчебный Тогда
					//	
					//	Если ЗначениеЗаполнено(СтрокаТаблицы.ВидРасчета) 
					//		И СписокРасчетовОтпуска.НайтиПоЗначению(СтрокаТаблицы.ВидРасчета.СпособРасчета) = Неопределено Тогда
					//		ОбщегоНазначения.СообщитьОбОшибке(СтрокаСообщенияОбОшибке+"для учебного отпуска необходимо указать вид расчета по среднему заработку для отпуска");
					//		Продолжить;
					//	КонецЕсли;
					//	
					//	РасчетныйДокумент = Документы.НачислениеОтпускаРаботникамОрганизаций.СоздатьДокумент();
					//	РасчетныйДокумент.ПериодРегистрации						= НачалоМесяца(ДатаНачала);
					//	РасчетныйДокумент.Физлицо								= СтрокаТаблицы.Физлицо;
					//	РасчетныйДокумент.Сотрудник								= СтрокаТаблицы.Сотрудник;
					//	РасчетныйДокумент.ДатаНачалаДополнительногоОтпуска		= СтрокаТаблицы.ДатаНачала;
					//	РасчетныйДокумент.ДатаОкончанияДополнительногоОтпуска	= СтрокаТаблицы.ДатаОкончания;
					//	РасчетныйДокумент.ВидРасчетаДополнительногоОтпуска		= СтрокаТаблицы.ВидРасчета;
					//	РасчетныйДокумент.ПроцентОплатыДополнительногоОтпуска	= СтрокаТаблицы.ПроцентОплаты;
					//	
					//Иначе
						
						Если ЗначениеЗаполнено(СтрокаТаблицы.ВидДополнительногоОтпуска) 
							И СписокРасчетовОтпуска.НайтиПоЗначению(СтрокаТаблицы.ВидДополнительногоОтпуска.СпособРасчета) = Неопределено Тогда
							ОбщегоНазначения.СообщитьОбОшибке(СтрокаСообщенияОбОшибке+"для дополнительного отпуска необходимо указать вид расчета по среднему заработку для отпуска");
							Продолжить;
						КонецЕсли;
						
						РасчетныйДокумент = Документы.НачислениеОтпускаРаботникамОрганизаций.СоздатьДокумент();
						РасчетныйДокумент.ПериодРегистрации					= НачалоМесяца(ДатаНачала);
						РасчетныйДокумент.Сотрудник							= СтрокаТаблицы.Сотрудник;
						РасчетныйДокумент.Физлицо							= СтрокаТаблицы.Физлицо;
						РасчетныйДокумент.ПорядокРасчетаОсновногоОтпуска	= ?(ЗначениеЗаполнено(СтрокаТаблицы.ПорядокРасчетаОтпуска), СтрокаТаблицы.ПорядокРасчетаОтпуска, Перечисления.ПорядокРасчетаОтпуска.ПоКалендарнымДням);
						РасчетныйДокумент.ПорядокРасчетаКомпенсацииОтпуска	= ?(ЗначениеЗаполнено(СтрокаТаблицы.ПорядокРасчетаОтпуска), СтрокаТаблицы.ПорядокРасчетаОтпуска, Перечисления.ПорядокРасчетаОтпуска.ПоКалендарнымДням);
						РасчетныйДокумент.РабочийГодС						= СтрокаТаблицы.РабочийГодС;
						РасчетныйДокумент.РабочийГодПо						= СтрокаТаблицы.РабочийГодПо;
						РасчетныйДокумент.ВидРасчетаОсновногоОтпуска		= СтрокаТаблицы.ВидРасчета;
						
						Если СтрокаТаблицы.ДатаНачала <> СтрокаТаблицы.ДатаНачалаДоп Тогда
							РасчетныйДокумент.ДатаНачалаОсновногоОтпуска = СтрокаТаблицы.ДатаНачала;
						КонецЕсли;
						
						Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.ДатаНачалаДоп) Тогда
							РасчетныйДокумент.ДатаОкончанияОсновногоОтпуска 		= СтрокаТаблицы.ДатаОкончания;
						Иначе
							Если СтрокаТаблицы.ДатаНачала <> СтрокаТаблицы.ДатаНачалаДоп Тогда
								РасчетныйДокумент.ДатаОкончанияОсновногоОтпуска 		= СтрокаТаблицы.ДатаНачалаДоп - мДлинаСуток;
							КонецЕсли;
							РасчетныйДокумент.ДатаНачалаДополнительногоОтпуска 		= СтрокаТаблицы.ДатаНачалаДоп;
							РасчетныйДокумент.ДатаОкончанияДополнительногоОтпуска 	= СтрокаТаблицы.ДатаОкончания;
							РасчетныйДокумент.ВидРасчетаДополнительногоОтпуска 		= СтрокаТаблицы.ВидДополнительногоОтпуска;
							РасчетныйДокумент.ПроцентОплатыДополнительногоОтпуска 	= СтрокаТаблицы.ПроцентОплаты;
						КонецЕсли;
						
						//заявка №1651 (база заяавок Кристалла) Дмитрук О.Г.
						Если ЗначениеЗаполнено(СтрокаТаблицы.ДатаНачала) и ЗначениеЗаполнено(СтрокаТаблицы.ДатаОкончания) Тогда
							Запрос = Новый Запрос;
							Запрос.УстановитьПараметр("ДатаНачалаОтпуска",		СтрокаТаблицы.ДатаНачала);
							Запрос.УстановитьПараметр("ДатаОкончанияОтпуска",	СтрокаТаблицы.ДатаОкончания);
							Запрос.Текст =
							"ВЫБРАТЬ
							|	СУММА(РегламентированныйПроизводственныйКалендарь.КалендарныеДни) КАК КоличествоДнейОтпуска
							|ИЗ
							|	РегистрСведений.РегламентированныйПроизводственныйКалендарь КАК РегламентированныйПроизводственныйКалендарь
							|ГДЕ
							|	РегламентированныйПроизводственныйКалендарь.ДатаКалендаря МЕЖДУ &ДатаНачалаОтпуска И &ДатаОкончанияОтпуска";	
							Выборка = Запрос.Выполнить().Выбрать();
							Если Выборка.Следующий() Тогда
								Если Выборка.КоличествоДнейОтпуска <> 0 Тогда
									РасчетныйДокумент.КоличествоДнейОсновногоОтпуска = Выборка.КоличествоДнейОтпуска;
								КонецЕсли;
							Иначе
								// не удалось получить количество дней отпуска запросом
								Сообщить("Проверьте заполнение производственного календаря!");
							КонецЕсли;
						КонецЕсли;
						//заявка №1651
						
					//КонецЕсли;
					
				ИначеЕсли ТипРасчетногоДокумента = Тип("ДокументСсылка.ОтпускПоУходуЗаРебенком") Тогда
					РасчетныйДокумент = Документы.ОтпускПоУходуЗаРебенком.СоздатьДокумент();
					РасчетныйДокумент.Сотрудник		= СтрокаТаблицы.Сотрудник;
					РасчетныйДокумент.Физлицо		= СтрокаТаблицы.Физлицо;
					РасчетныйДокумент.ДатаДействия	= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаНачала	= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаОкончания	= СтрокаТаблицы.ДатаОкончания;
					
				//Аверсон ЕАЕ 16.04.2025 СВФР-015474
				//ИначеЕсли ВидНеявки = Перечисления.СостоянияРаботникаОрганизации.Простой 
				ИначеЕсли ВидНеявкиПеречисление.НайтиПоЗначению(Перечисления.СостоянияРаботникаОрганизации.Простой) <> Неопределено
				//Аверсон СВФР-015474
				
					И ЗначениеЗаполнено(СтрокаТаблицы.ВидПростоя) Тогда
					// оплачиваемый простой
					РасчетныйДокумент = Документы.РегистрацияПростоевРаботниковОрганизаций.СоздатьДокумент();
					РасчетныйДокумент.ПериодРегистрации		= НачалоМесяца(ДатаНачала);
					РасчетныйДокумент.Сотрудник				= СтрокаТаблицы.Сотрудник;
					РасчетныйДокумент.Физлицо				= СтрокаТаблицы.Физлицо;
					РасчетныйДокумент.ВидПростоя			= СтрокаТаблицы.ВидПростоя;
					РасчетныйДокумент.ДатаНачала			= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаОкончания			= СтрокаТаблицы.ДатаОкончания;
					РасчетныйДокумент.СпособРегистрацииВремени = Перечисления.СпособыРегистрацииВремени.РегистрацияДляЦелойСмены;
					
				Иначе // прочие невыходы
					
					Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.ВидРасчета)
						И ВидНеявки = Перечисления.СостоянияРаботникаОрганизации.Простой Тогда
						// попробуем найти подходящий вид расчета для простоя
						Запрос = Новый Запрос;
						Запрос.УстановитьПараметр("РасчетНулеваяСумма", Перечисления.СпособыРасчетаОплатыТруда.НулеваяСумма);
						
						Запрос.Текст = "
						|ВЫБРАТЬ
						|	ОсновныеНачисления.Ссылка КАК ВидРасчета
						|ИЗ
						|	ПланВидовРасчета.ОсновныеНачисленияОрганизаций КАК ОсновныеНачисления
						|ГДЕ
						|	ОсновныеНачисления.СпособРасчета = &РасчетНулеваяСумма И
						|	ОсновныеНачисления.ОбозначениеВТабелеУчетаРабочегоВремени = ЗНАЧЕНИЕ(Справочник.КлассификаторИспользованияРабочегоВремени.ПростойПоВинеРаботника)
						|";
						
						Выборка = Запрос.Выполнить().Выбрать();
						Если Выборка.Следующий() Тогда
							СтрокаТаблицы.ВидРасчета = Выборка.ВидРасчета;
						КонецЕсли;
					КонецЕсли;
					
					Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.ВидРасчета) 
						Или СтрокаТаблицы.ВидРасчета.СпособРасчета <> Перечисления.СпособыРасчетаОплатыТруда.НулеваяСумма Тогда
						ОбщегоНазначения.СообщитьОбОшибке(СтрокаСообщенияОбОшибке+"необходимо выбрать вид расчета по нулевой сумме");
						Продолжить;
					КонецЕсли;
					
					РасчетныйДокумент = Документы.НевыходыВОрганизациях.СоздатьДокумент();
					РасчетныйДокумент.ПериодРегистрации = НачалоМесяца(ДатаНачала);
					РасчетныйДокумент.СпособРегистрацииВремени = Перечисления.СпособыРегистрацииВремени.РегистрацияДляЦелойСмены;
					
					СтрокаНачисления = РасчетныйДокумент.Начисления.Добавить();
					СтрокаНачисления.Авторасчет			= Истина;
					СтрокаНачисления.Сотрудник			= СтрокаТаблицы.Сотрудник;
					СтрокаНачисления.Физлицо			= СтрокаТаблицы.Физлицо;
					СтрокаНачисления.ДатаНачала 		= СтрокаТаблицы.ДатаНачала;
					СтрокаНачисления.ДатаОкончания 		= СтрокаТаблицы.ДатаОкончания;
					СтрокаНачисления.ДатаНачалаСобытия 	= СтрокаТаблицы.ДатаНачала;
					
					// Определим подразделение работника на дату события
					Запрос = Новый Запрос;
					Запрос.УстановитьПараметр("Сотрудник",			СтрокаТаблицы.Сотрудник);
					Запрос.УстановитьПараметр("Организация",		ГоловнаяОрганизация);
					Запрос.УстановитьПараметр("ДатаАктуальности",	СтрокаТаблицы.ДатаНачала);
					
					Запрос.Текст = "
					|ВЫБРАТЬ
					|	ВЫБОР
					|		КОГДА  РаботникиОрганизации.ПериодЗавершения <= &ДатаАктуальности
					|				И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
					|		ТОГДА РаботникиОрганизации.ПодразделениеОрганизацииЗавершения
					|		ИНАЧЕ РаботникиОрганизации.ПодразделениеОрганизации
					|	КОНЕЦ КАК ПодразделениеОрганизации
					|ИЗ
					|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаАктуальности, Сотрудник = &Сотрудник) КАК РаботникиОрганизации
					|";
					
					Выборка = Запрос.Выполнить().Выбрать();
					Если Выборка.Следующий() Тогда
						СтрокаНачисления.ПодразделениеОрганизации = Выборка.ПодразделениеОрганизации;
					КонецЕсли;
					
					СтрокаНачисления.ВидРасчета = СтрокаТаблицы.ВидРасчета;
					
					РазницаВМесяцах = (Год(СтрокаНачисления.ДатаОкончания)*12 + Месяц(СтрокаНачисления.ДатаОкончания)) - (Год(СтрокаНачисления.ДатаНачала)*12 + Месяц(СтрокаНачисления.ДатаНачала));
					Если РазницаВМесяцах > 0 Тогда
						ПроведениеРасчетов.РазбитьСтрокуНачисленийНаПомесячныеЗаписи(СтрокаНачисления, РасчетныйДокумент.Начисления);
					КонецЕсли;
				КонецЕсли;
				
				РасчетныйДокумент.Организация	= Организация;
				РасчетныйДокумент.Ответственный	= глЗначениеПеременной("глТекущийПользователь");
				Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
					РасчетныйДокумент.ПодразделениеОрганизации =  ПодразделениеОрганизации;
				КонецЕсли;
				РасчетныйДокумент.Дата = ОбщегоНазначения.ПолучитьРабочуюДату();
				РасчетныйДокумент.УстановитьНовыйНомер();
				РасчетныйДокумент.Записать();
				
				Если ТипЗнч(РасчетныйДокумент) = Тип("ДокументОбъект.ОтпускПоУходуЗаРебенком") Тогда
					РасчетныйДокумент.ЗаполнитьПлановыйНачисленияУдержания(РазмерПособияПоУходуДо1_5Лет,РазмерПособияПоУходуДо3Лет);
					РасчетныйДокумент.Записать();
				КонецЕсли;
				
				СтрокаТаблицы.РасчетныйДокумент	= РасчетныйДокумент.Ссылка;
			КонецЕсли;
		Иначе
			Если СтрокаТаблицы.Отметка
				и Не ЗначениеЗаполнено(СтрокаТаблицы.РасчетныйДокумент) Тогда 
				
				ТипРасчетногоДокумента 	= ТипЗнч(СтрокаТаблицы.РасчетныйДокумент);
				СтрокаСообщенияОбОшибке = СтрокаТаблицы.Сотрудник.Наименование + " " + СтрокаТаблицы.ВидНеявки + " от " + Формат(СтрокаТаблицы.ДатаНачала,"ДФ=дд.ММ.гггг")+": ";
				
				Если ТипРасчетногоДокумента = Тип("ДокументСсылка.ОплатаПоСреднемуЗаработку") Тогда
					
					Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.ВидРасчета) 	
						Или СтрокаТаблицы.ВидРасчета.СпособРасчета <> Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку Тогда
						ОбщегоНазначения.СообщитьОбОшибке(СтрокаСообщенияОбОшибке+"необходимо указать вид расчета по среднему заработку");
						Продолжить;
					КонецЕсли;
					
					РасчетныйДокумент = Документы.ОплатаПоСреднемуЗаработку.СоздатьДокумент();
					РасчетныйДокумент.ПериодРегистрации 		= НачалоМесяца(ДатаНачала);
					РасчетныйДокумент.Сотрудник					= СтрокаТаблицы.Сотрудник;
					РасчетныйДокумент.Физлицо					= СтрокаТаблицы.Физлицо;
					РасчетныйДокумент.ВидРасчета 				= СтрокаТаблицы.ВидРасчета;
					РасчетныйДокумент.ПроцентОплаты 			= СтрокаТаблицы.ПроцентОплаты;
					РасчетныйДокумент.СпособРегистрацииВремени 	= Перечисления.СпособыРегистрацииВремени.РегистрацияДляЦелойСмены;
					РасчетныйДокумент.ДатаНачала				= СтрокаТаблицы.ДатаНачала;
					РасчетныйДокумент.ДатаОкончания				= СтрокаТаблицы.ДатаОкончания;
					
					РасчетныйДокумент.Организация	= Организация;
					РасчетныйДокумент.Ответственный	= глЗначениеПеременной("глТекущийПользователь");
					Если ЗначениеЗаполнено(ПодразделениеОрганизации) Тогда
						РасчетныйДокумент.ПодразделениеОрганизации =  ПодразделениеОрганизации;
					КонецЕсли;
					РасчетныйДокумент.Дата = КонецМесяца(ДатаОкончания);
					РасчетныйДокумент.УстановитьНовыйНомер();
					РасчетныйДокумент.Записать();
					
					СтрокаТаблицы.РасчетныйДокумент	= РасчетныйДокумент.Ссылка;
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры // СоздатьДокументы()

// Процедура рассчитывает отмеченные документы
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Нет
//
Процедура РассчитатьДокументы() Экспорт
	
	КоличествоСтрок =  Неявки.Количество();
	Если КоличествоСтрок = 0 Тогда
		Возврат;
	КонецЕсли;

	РассчитываемыеТаблицы = Новый Структура("Начисления,РасчетСреднего",Истина,Истина);
	НомерТекущейСтроки = 0;

	Для Каждого СтрокаТаблицы Из Неявки Цикл
		НомерТекущейСтроки = НомерТекущейСтроки + 1;
		Если СтрокаТаблицы.Отметка И ЗначениеЗаполнено(СтрокаТаблицы.РасчетныйДокумент) Тогда
			Если ТипЗнч(СтрокаТаблицы.РасчетныйДокумент) = Тип("ДокументСсылка.ОтпускПоУходуЗаРебенком") Тогда
				Продолжить
			КонецЕсли;
			
			РасчетныйДокумент = СтрокаТаблицы.РасчетныйДокумент.ПолучитьОбъект();			
			Если РасчетныйДокумент.ПометкаУдаления Тогда
				РасчетныйДокумент.УстановитьПометкуУдаления(Ложь);
			ИначеЕсли РасчетныйДокумент.Проведен Тогда
				РасчетныйДокумент.Записать(РежимЗаписиДокумента.ОтменаПроведения)
			КонецЕсли;
			// авторасчет документа
			Попытка
				Если ТипЗнч(РасчетныйДокумент) = Тип("ДокументОбъект.НевыходыВОрганизациях") Тогда
					РасчетныйДокумент.Рассчитать();
				Иначе
					РасчетныйДокумент.Рассчитать(РассчитываемыеТаблицы);
				КонецЕсли;
				РасчетныйДокумент.Записать(РежимЗаписиДокумента.Запись);
			Исключение
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;

КонецПроцедуры // РассчитатьДокументы()

// Процедура проводит отмеченные документы
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Нет
//
Процедура ПровестиДокументы() Экспорт

	НомерТекущейСтроки = 0;
	Для Каждого СтрокаТаблицы Из Неявки Цикл
		НомерТекущейСтроки = НомерТекущейСтроки + 1;
		
		Если СтрокаТаблицы.Отметка и ЗначениеЗаполнено(СтрокаТаблицы.РасчетныйДокумент) Тогда
			РасчетныйДокумент = СтрокаТаблицы.РасчетныйДокумент.ПолучитьОбъект();
			Если РасчетныйДокумент.ПометкаУдаления Тогда
				РасчетныйДокумент.УстановитьПометкуУдаления(Ложь);
			КонецЕсли;
			Попытка
				РасчетныйДокумент.Записать(РежимЗаписиДокумента.Проведение);
			Исключение
				Продолжить;
			КонецПопытки;
			СтрокаТаблицы.Отметка = Не СтрокаТаблицы.Отметка;
		КонецЕсли;
	КонецЦикла;

КонецПроцедуры // ПровестиДокументы()

////////////////////////////////////////////////////////////////////////////////
// ИНИЦИАЛИЗАЦИЯ ОБЪЕКТА 

мДлинаСуток = 86400; // в секундах
