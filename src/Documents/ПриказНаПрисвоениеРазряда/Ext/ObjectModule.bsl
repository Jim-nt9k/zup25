///////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

Перем мДлинаСуток;
Перем СоответствиеВалютныеСпособыРасчета;

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ДОКУМЕНТА

#Если Клиент Тогда

// Процедура осуществляет печать документа. Можно направить печать на 
//// экран или принтер, а также распечатать необходмое количество копий.
////
////  Название макета печати передается в качестве параметра,
//// по переданному названию находим имя макета в соответствии.
////
//// Параметры:
////  НазваниеМакета - строка, название макета.
////
Функция Печать(ИмяМакета, КоличествоЭкземпляров = 1, НаПринтер = Ложь) Экспорт
	
	// Получить экземпляр документа на печать
	Если ИмяМакета = "ЦЭМ" тогда
		Документы.ПриказНаПрисвоениеРазряда.ПолучитьФорму("ФормаПриказа", ЭтотОбъект, Ссылка).Открыть();
	КонецЕсли;
	
	//Возврат РаботаСДиалогами.НапечататьДокумент(ТабДокумент, КоличествоЭкземпляров, НаПринтер, РаботаСДиалогами.СформироватьЗаголовокДокумента(ЭтотОбъект,"Приказ о присвоении разряда "));
	
КонецФункции // Печать()

// Возвращает доступные варианты печати документа
////
//// Вовращаемое значение:
////  Струткура, каждая строка которой соответствует одному из вариантов печати
////  
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	
	СтруктураМакетов = Новый Структура;
	
	СтруктураМакетов.Вставить("ЦЭМ",	            "Приказ о присвоении разряда");
	
	Возврат СтруктураМакетов;

КонецФункции // ПолучитьСтруктуруПечатныхФорм()

#КонецЕсли
//////////////////////////////////////////////////////////////////////////////////
//// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

//// Формирует запрос по документу
////
//// Параметры: 
////  Режим - режим проведения
////
//// Возвращаемое значение:
////  Результат запроса
////
//Функция СформироватьЗапросДляПечати(Режим)

//	Запрос = Новый Запрос;

//	// Установим параметры запроса
//	Запрос.УстановитьПараметр("ДокументСсылка",	Ссылка);
//	Запрос.УстановитьПараметр("Руководитель",	Перечисления.ОтветственныеЛицаОрганизаций.Руководитель);
//	Запрос.УстановитьПараметр("ДатаДокумента",	Дата);

//	Если Режим = "ПоРеквизитамДокумента" Тогда
//		
//		Запрос.Текст =
//		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
//		|	ОтветственныеЛицаОрганизацийСрезПоследних.Должность КАК ДолжностьРуководителя,
//		|	КадровоеПеремещениеОрганизаций.Номер КАК НомерДок,
//		|	КадровоеПеремещениеОрганизаций.Дата КАК ДатаДок,
//		|	ВЫРАЗИТЬ(КадровоеПеремещениеОрганизаций.Организация.НаименованиеПолное КАК СТРОКА(300)) КАК НазваниеОрганизации,
//		|	КадровоеПеремещениеОрганизаций.Организация.КодПоОКПО КАК КодПоОКПО,
//		|	ЕСТЬNULL(ФИОФизЛицСрезПоследних.Фамилия + ВЫБОР
//		|			КОГДА ПОДСТРОКА(ФИОФизЛицСрезПоследних.Имя, 1, 1) <> """"
//		|				ТОГДА "" "" + ПОДСТРОКА(ФИОФизЛицСрезПоследних.Имя, 1, 1) + "".""
//		|			ИНАЧЕ """"
//		|		КОНЕЦ + ВЫБОР
//		|			КОГДА ПОДСТРОКА(ФИОФизЛицСрезПоследних.Отчество, 1, 1) <> """"
//		|				ТОГДА "" "" + ПОДСТРОКА(ФИОФизЛицСрезПоследних.Отчество, 1, 1) + "".""
//		|			ИНАЧЕ """"
//		|		КОНЕЦ, ОтветственныеЛицаОрганизацийСрезПоследних.ФизическоеЛицо.Наименование) КАК ФИОРуководителя,
//		|	КадровоеПеремещениеОрганизаций.Организация.Префикс
//		|ИЗ
//		|	Документ.КадровоеПеремещениеОрганизаций КАК КадровоеПеремещениеОрганизаций
//		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ОтветственныеЛицаОрганизаций.СрезПоследних(&ДатаДокумента, ) КАК ОтветственныеЛицаОрганизацийСрезПоследних
//		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФИОФизЛиц.СрезПоследних(&ДатаДокумента, ) КАК ФИОФизЛицСрезПоследних
//		|			ПО ОтветственныеЛицаОрганизацийСрезПоследних.ФизическоеЛицо = ФИОФизЛицСрезПоследних.ФизЛицо
//		|		ПО (ОтветственныеЛицаОрганизацийСрезПоследних.ОтветственноеЛицо = &Руководитель)
//		|			И КадровоеПеремещениеОрганизаций.Организация = ОтветственныеЛицаОрганизацийСрезПоследних.СтруктурнаяЕдиница
//		|ГДЕ
//		|	КадровоеПеремещениеОрганизаций.Ссылка = &ДокументСсылка";

//	ИначеЕсли Режим = "ПоТабличнойЧастиДокумента" Тогда

//		Запрос.УстановитьПараметр("РеглВалюта",	Константы.ВалютаРегламентированногоУчета.Получить());
//		Запрос.УстановитьПараметр("ПустаяДата",	'00010101');
//		Запрос.УстановитьПараметр("Прием",		Перечисления.ПричиныИзмененияСостояния.ПриемНаРаботу);
//		
//		Запрос.Текст =
//		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
//		|	Док.ДатаНачала,
//		|	Док.ДатаОкончания,
//		|	ЕСТЬNULL(ФИОФизЛицСрезПоследних.Фамилия + "" "" + ФИОФизЛицСрезПоследних.Имя + "" "" + ФИОФизЛицСрезПоследних.Отчество, Док.Сотрудник.Наименование) КАК Работник,
//		|	ЕСТЬNULL(Док.Сотрудник.ДатаДоговора, &ПустаяДата) КАК ТрудовойДоговорДата,
//		|	ЕСТЬNULL(Док.Сотрудник.НомерДоговора, """") КАК ТрудовойДоговорНомер,
//		|	ВЫБОР
//		|		КОГДА Док.Сотрудник.НомерДоговора ЕСТЬ NULL 
//		|			ТОГДА Док.ОснованиеПеремещения
//		|		ИНАЧЕ """"
//		|	КОНЕЦ КАК ОснованиеПеремещения,
//		|	Док.НомерСтроки КАК НомерСтроки,
//		|	Док.ПодразделениеОрганизации.Наименование КАК НовоеПодразделение,
//		|	Док.Должность.Наименование КАК НоваяДолжность,
//		|	ВЫБОР
//		|		КОГДА  Работники.ПериодЗавершения <= Док.ДатаНачала
//		|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА Работники.ПодразделениеОрганизацииЗавершенияНаименование
//		|		ИНАЧЕ Работники.ПодразделениеОрганизацииНаименование
//		|	КОНЕЦ КАК ПрежнееПодразделение,
//		|	ВЫБОР
//		|		КОГДА Работники.ПериодЗавершения <= Док.ДатаНачала
//		|				И Работники.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА Работники.ДолжностьЗавершенияНаименование
//		|		ИНАЧЕ Работники.ДолжностьНаименование 
//		|	КОНЕЦ КАК ПрежняяДолжность,
//		|	ВЫБОР
//		|		КОГДА ЕСТЬNULL(Начисления.Валюта1, &РеглВалюта) = &РеглВалюта
//		|			ТОГДА """"
//		|		ИНАЧЕ Начисления.Валюта1.Наименование
//		|	КОНЕЦ КАК ВалютаТарифнойСтавки,
//		|	ЕСТЬNULL(Начисления.Показатель1, 0) КАК ОкладТарифнаяСтавка,
//		|	Работники.Сотрудник.Код КАК ТабельныйНомер
//		|ИЗ
//		|	Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Док
//		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|			СписокДат.Сотрудник КАК Сотрудник,
//		|			РаботникиОрганизации.ПодразделениеОрганизации.Наименование КАК ПодразделениеОрганизацииНаименование,
//		|			РаботникиОрганизации.Должность.Наименование КАК ДолжностьНаименование,
//		|			РаботникиОрганизации.ПодразделениеОрганизацииЗавершения.Наименование КАК ПодразделениеОрганизацииЗавершенияНаименование,
//		|			РаботникиОрганизации.ДолжностьЗавершения.Наименование КАК ДолжностьЗавершенияНаименование,
//		|			РаботникиОрганизации.ПериодЗавершения
//		|		ИЗ
//		|			(ВЫБРАТЬ
//		|				РаботникиВнутри.Сотрудник КАК Сотрудник,
//		|				МАКСИМУМ(РаботникиВнутри.Период) КАК ДатаПоследнегоИзменения
//		|			ИЗ
//		|				РегистрСведений.РаботникиОрганизаций КАК РаботникиВнутри
//		|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Док
//		|					ПО РаботникиВнутри.Период < Док.ДатаНачала
//		|						И РаботникиВнутри.Сотрудник = Док.Сотрудник
//		|			ГДЕ
//		|				Док.Ссылка = &ДокументСсылка
//		|			
//		|			СГРУППИРОВАТЬ ПО
//		|				РаботникиВнутри.Сотрудник) КАК СписокДат
//		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
//		|				ПО СписокДат.ДатаПоследнегоИзменения = РаботникиОрганизации.Период
//		|					И СписокДат.Сотрудник = РаботникиОрганизации.Сотрудник) КАК Работники
//		|		ПО Док.Сотрудник = Работники.Сотрудник
//		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.КадровоеПеремещениеОрганизаций.ОсновныеНачисления КАК Начисления
//		|		ПО Док.Ссылка = Начисления.Ссылка
//		|			И (Начисления.ВидРасчета.ЗачетОтработанногоВремени)
//		|			И (Начисления.ВидРасчета.ЗачетНормыВремени)
//		|			И Док.Сотрудник = Начисления.Сотрудник
//		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФИОФизЛиц.СрезПоследних(
//		|		&ДатаДокумента,
//		|		ФизЛицо В
//		|			(ВЫБРАТЬ РАЗЛИЧНЫЕ
//		|				КадровоеПеремещениеОрганизацииРаботники.Сотрудник.Физлицо
//		|			ИЗ
//		|				Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК КадровоеПеремещениеОрганизацииРаботники
//		|			ГДЕ
//		|				КадровоеПеремещениеОрганизацииРаботники.Ссылка = &ДокументСсылка)) КАК ФИОФизЛицСрезПоследних
//		|		ПО Док.Сотрудник.Физлицо = ФИОФизЛицСрезПоследних.ФизЛицо
//		|ГДЕ
//		|	Док.Ссылка = &ДокументСсылка
//		|
//		|УПОРЯДОЧИТЬ ПО
//		|	НомерСтроки";

//	Иначе
//		Возврат Неопределено;
//		
//	КонецЕсли;
//	
//	Возврат Запрос.Выполнить();

//КонецФункции // СформироватьЗапросДляПечати()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Формирует запрос по шапке документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//  Результат запроса
//
Функция СформироватьЗапросПоШапке(Режим)

	Запрос = Новый Запрос;

	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",		Ссылка);
	Запрос.УстановитьПараметр("ПустаяОрганизация",	Справочники.Организации.ПустаяСсылка());

	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ПриказНаПрисвоениеРазряда.Дата,
	|	ПриказНаПрисвоениеРазряда.Организация,
	|	ВЫБОР КОГДА ПриказНаПрисвоениеРазряда.Организация.ГоловнаяОрганизация = &ПустаяОрганизация ТОГДА ПриказНаПрисвоениеРазряда.Организация ИНАЧЕ ПриказНаПрисвоениеРазряда.Организация.ГоловнаяОрганизация КОНЕЦ КАК ГоловнаяОрганизация,
	|	ПриказНаПрисвоениеРазряда.Ссылка
	|ИЗ
	|	Документ.ПриказНаПрисвоениеРазряда КАК ПриказНаПрисвоениеРазряда
	|
	|ГДЕ
	|	ПриказНаПрисвоениеРазряда.Ссылка = &ДокументСсылка";

	Возврат Запрос.Выполнить();

КонецФункции // СформироватьЗапросПоШапке()

// Формирует запрос по таблице "РаботникиОрганизации" документа
//
// Параметры: 
//  Режим        - режим проведения.
//
// Возвращаемое значение:
//  Результат запроса.
//
Функция СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента, Режим, ПроверкаШтатногоРасписания)
//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) (
	//Запрос = Новый Запрос;

	//СписокСтруктурныхПодразделений = ПроцедурыУправленияПерсоналом.ПолучитьСписокОбособленныхПодразделенийОрганизации(Организация);
	//СписокСтруктурныхПодразделений.Добавить(Организация);
	//Запрос.УстановитьПараметр("СписокСтруктурныхПодразделений",	СписокСтруктурныхПодразделений);
	//
	//// Установим параметры запроса
	//Запрос.УстановитьПараметр("ДокументСсылка",					Ссылка);
	//Запрос.УстановитьПараметр("ГоловнаяОрганизация",			ВыборкаПоШапкеДокумента.ГоловнаяОрганизация);
	//Запрос.УстановитьПараметр("ПустаяДата",						Дата('00010101'));
	//Запрос.УстановитьПараметр("Прием",							Перечисления.ПричиныИзмененияСостояния.ПриемНаРаботу);
	//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) )
	
	// Описание текста запроса:
	// Первая часть запроса  - вид строки запроса "ДанныеДляДвиженийКадров": 
	// 1. Выборка "ТЧРаботникиОрганизации": 
	//		Выбираются строки документа.  
	// 2. Выборка "ДанныеПоРаботникиДоНазначения": 
	//		Для каждой строки ТЧРаботникиОрганизации выполняем срез по регистру РаботникиОрганизации на дату ДатаНачала
	//		для выполнения движений и проверки "Работает ли работник на дату перемещения"
	//		(Использует данные выборки "ДатыПоследнихДвиженийРаботников")
	// 3. Выборка "ПересекающиесяСтроки": 
	//		Среди остальных строк документа ищем строки, имеющие пересекающийся период действия
	//
	// Вторая часть запроса - вид строки запроса "КонфликтныйДокумент" - поиск конфликтных документов: 
	// 1. Выборка "ТЧРаботникиОрганизации":
	//		Выбираются строки документа 
	// 2. Выборка "РаботникиОрганизации":
	//		Для каждой строки ТЧРаботникиОрганизации ищем движения по регистру РаботникиОрганизации за период [ДатаНачала, ДатаОкончания]
	
//	Если ПроверкаШтатногоРасписания Тогда  //Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано)
//		
//		// определим самую раннюю дату перемещения, чтобы с нее начать расчет остатков штатных единиц
//		
//		Запрос.Текст =
//		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
//		|	МИНИМУМ(КадровоеПеремещениеОрганизацииРаботникиОрганизации.ДатаНачала) КАК ДатаНачала
//		|ИЗ
//		|	Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК КадровоеПеремещениеОрганизацииРаботникиОрганизации
//		|ГДЕ
//		|	КадровоеПеремещениеОрганизацииРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|	И КадровоеПеремещениеОрганизацииРаботникиОрганизации.ДатаНачала <> &ПустаяДата";
//		
//		Выборка = Запрос.Выполнить().Выбрать();
//		Если Выборка.Следующий() Тогда
//			ДатаС = ?(ЗначениеЗаполнено(Выборка.ДатаНачала),Выборка.ДатаНачала,Дата)
//		КонецЕсли;
//		
//		Запрос.УстановитьПараметр("ДатаНачала",	ДатаС);
//		Запрос.УстановитьПараметр("Приход",		ВидДвиженияНакопления.Приход);

//		//  Дополнительно используем выборки: 
//		// 1. ШтатноеРасписаниеОрганизаций
//		//		Для каждой строки ТЧРаботникиОрганизации выполняем срез по регистру ШтатноеРасписаниеОрганизаций на дату ДатаНачала
//		//		для проверки наличия ставок в штатном расписании
//		//		(Использует данные выборки "ДатыШтатногоРасписания")
//		// 2. ЗанятоСтавок
//		//		Для каждой строки ТЧРаботникиОрганизации на дату ДатаНачала
//		//		подсчитываем количество занятых ставок (с учетом "предшествующих" данных текущего документа)
//		//
//		
//		ТекстЗапроса =
//		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
//		|	""ДанныеДляДвиженийКадров"" КАК ВидСтрокиЗапроса,
//		|	ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
//		|	ТЧРаботникиОрганизации.Сотрудник КАК Сотрудник,
//		|	ТЧРаботникиОрганизации.Сотрудник.Наименование КАК СотрудникНаименование,
//		|	ТЧРаботникиОрганизации.ДатаНачала КАК ДатаНачала,
//		|	ТЧРаботникиОрганизации.ДатаОкончания КАК ДатаОкончания,
//		|	ТЧРаботникиОрганизации.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|	ТЧРаботникиОрганизации.Должность КАК Должность,
//		//РБ н
//		|	ТЧРаботникиОрганизации.РазрядЕТС КАК РазрядЕТС,
//		|	ТЧРаботникиОрганизации.КоэффициентЕТС КАК КоэффициентЕТС,
//		|	ТЧРаботникиОрганизации.Категория КАК Категория,
//		|	ТЧРаботникиОрганизации.МесячнаяТарифнаяСтавка КАК МесячнаяТарифнаяСтавка,
//		|	ТЧРаботникиОрганизации.ПроцентПоКонтракту КАК ПроцентПоКонтракту,
//		|	ТЧРаботникиОрганизации.НапомнитьПоЗавершении КАК НапомнитьПоЗавершении,
//		//РБ к
//		|	ТЧРаботникиОрганизации.ГрафикРаботы КАК ГрафикРаботы,
//		|	ТЧРаботникиОрганизации.ЗанимаемыхСтавок КАК ЗанимаемыхСтавок,
//		|	ТЧРаботникиОрганизации.ПодразделениеОрганизации.Владелец КАК ОрганизацияПодразделения,
//		|	ВЫБОР
//		|		КОГДА (НЕ ТЧРаботникиОрганизации.ПодразделениеОрганизации.Владелец В (&СписокСтруктурныхПодразделений))
//		|			ТОГДА ИСТИНА
//		|		ИНАЧЕ ЛОЖЬ
//		|	КОНЕЦ КАК ОшибкаПодразделениеНеПринадлежитОрганизации,
//		|	ВЫБОР
//		|		КОГДА ТЧРаботникиОрганизации.Сотрудник.Организация = &ГоловнаяОрганизация
//		|			ТОГДА ЛОЖЬ
//		|		ИНАЧЕ ИСТИНА
//		|	КОНЕЦ КАК ОшибкаНеСоответствиеСотрудникаИОрганизации,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизацииЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизации
//		|	КОНЕЦ КАК ПрежнееПодразделение,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделениеЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделение
//		|	КОНЕЦ КАК ПрежняяОрганизация,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ДолжностьЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.Должность
//		|	КОНЕЦ КАК ПрежняяДолжность,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавокЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавок
//		|	КОНЕЦ КАК ПрежняяСтавка,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ГрафикРаботыЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ГрафикРаботы
//		|	КОНЕЦ КАК ПрежнийГрафикРаботы,
//		|	ВЫБОР
//		|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
//		|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|		ТОГДА ДанныеПоРаботникуДоНазначения.ПериодЗавершения
//		|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.Период
//		|	КОНЕЦ КАК ДатаПоследнегоДвиженияПоРаботнику,
//		|	ПересекающиесяСтроки.КонфликтнаяСтрокаНомер,
//		|	NULL КАК КонфликтныйДокумент,
//		|	ВЫБОР
//		|		КОГДА ТЧРаботникиОрганизации.Сотрудник.НомерДоговора ЕСТЬ НЕ NULL 
//		|			ТОГДА ИСТИНА
//		|		ИНАЧЕ ЛОЖЬ
//		|	КОНЕЦ КАК ТрудовойДоговорПрисутствует,
//		|	СвободноСтавокНаДатуПриема.ОстатокСтавок КАК ОстатокСтавок
//		|ИЗ
//		|	Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации
//		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|			ДатыПоследнихДвиженийРаботников.НомерСтроки КАК НомерСтроки,
//		|			ДатыПоследнихДвиженийРаботников.Период КАК Период,
//		|			ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавок КАК ЗанимаемыхСтавок,
//		|			ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
//		|			ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|			ДанныеПоРаботникуДоНазначения.Должность КАК Должность,
//		|			ДанныеПоРаботникуДоНазначения.ГрафикРаботы КАК ГрафикРаботы,
//		|			ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавокЗавершения КАК ЗанимаемыхСтавокЗавершения,
//		|			ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделениеЗавершения КАК ОбособленноеПодразделениеЗавершения,
//		|			ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизацииЗавершения КАК ПодразделениеОрганизацииЗавершения,
//		|			ДанныеПоРаботникуДоНазначения.ДолжностьЗавершения КАК ДолжностьЗавершения,
//		|			ДанныеПоРаботникуДоНазначения.ГрафикРаботыЗавершения КАК ГрафикРаботыЗавершения,
//		|			ДанныеПоРаботникуДоНазначения.ПериодЗавершения КАК ПериодЗавершения
//		|
//		|		ИЗ
//		|			(ВЫБРАТЬ
//		|				ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
//		|				МАКСИМУМ(Работники.Период) КАК Период,
//		|				ТЧРаботникиОрганизации.Сотрудник КАК Сотрудник
//		|			ИЗ
//		|				Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации
//		|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК Работники
//		|					ПО Работники.Период <= ТЧРаботникиОрганизации.ДатаНачала
//		|						И ТЧРаботникиОрганизации.Сотрудник = Работники.Сотрудник
//		|			ГДЕ
//		|				ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|			
//		|			СГРУППИРОВАТЬ ПО
//		|				ТЧРаботникиОрганизации.НомерСтроки,
//		|				ТЧРаботникиОрганизации.Сотрудник) КАК ДатыПоследнихДвиженийРаботников
//		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК ДанныеПоРаботникуДоНазначения
//		|				ПО ДанныеПоРаботникуДоНазначения.Период = ДатыПоследнихДвиженийРаботников.Период
//		|					И ДатыПоследнихДвиженийРаботников.Сотрудник = ДанныеПоРаботникуДоНазначения.Сотрудник) КАК ДанныеПоРаботникуДоНазначения
//		|		ПО ТЧРаботникиОрганизации.НомерСтроки = ДанныеПоРаботникуДоНазначения.НомерСтроки
//		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|			ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
//		|			МИНИМУМ(ТЧРаботникиОрганизации2.НомерСтроки) КАК КонфликтнаяСтрокаНомер
//		|		ИЗ
//		|			Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации
//		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации2
//		|				ПО ТЧРаботникиОрганизации2.Ссылка = ТЧРаботникиОрганизации.Ссылка
//		|					И ТЧРаботникиОрганизации.НомерСтроки < ТЧРаботникиОрганизации2.НомерСтроки
//		|					И ТЧРаботникиОрганизации.Сотрудник = ТЧРаботникиОрганизации2.Сотрудник
//		|		ГДЕ
//		|			ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|		
//		|		СГРУППИРОВАТЬ ПО
//		|			ТЧРаботникиОрганизации.НомерСтроки) КАК ПересекающиесяСтроки
//		|		ПО ТЧРаботникиОрганизации.НомерСтроки = ПересекающиесяСтроки.НомерСтроки
//		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|			МаксимальныеПериодыШР.НомерСтроки КАК НомерСтроки,
//		|			ЕСТЬNULL(ШтатноеРасписание.КоличествоСтавок, 0) - ЕСТЬNULL(Вакансии.КоличествоСтавок, 0) - ЕСТЬNULL(РанееЗанятоСтавок.КоличествоСтавок, 0) + ЕСТЬNULL(ОсвобождаетсяСтавок.КоличествоСтавок, 0) КАК ОстатокСтавок
//		|		ИЗ
//		|			(ВЫБРАТЬ
//		|				Работники.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|				Работники.Должность КАК Должность,
//		|				Работники.НомерСтроки КАК НомерСтроки,
//		|				МАКСИМУМ(ШтатноеРасписание.Период) КАК МаксПериод
//		|			ИЗ
//		|				Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Работники
//		|					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|						ЕСТЬNULL(ШтатноеРасписание.Период, &ДатаНачала) КАК Период,
//		|						Работники.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|						Работники.Должность КАК Должность
//		|					ИЗ
//		|						Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Работники
//		|							ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтатноеРасписаниеОрганизаций КАК ШтатноеРасписание
//		|							ПО Работники.ПодразделениеОрганизации = ШтатноеРасписание.ПодразделениеОрганизации
//		|								И Работники.Должность = ШтатноеРасписание.Должность
//		|					ГДЕ
//		|						Работники.Ссылка = &ДокументСсылка) КАК ШтатноеРасписание
//		|					ПО Работники.ПодразделениеОрганизации = ШтатноеРасписание.ПодразделениеОрганизации
//		|						И Работники.Должность = ШтатноеРасписание.Должность
//		|						И Работники.ДатаНачала >= ШтатноеРасписание.Период
//		|			ГДЕ
//		|				Работники.Ссылка = &ДокументСсылка
//		|			
//		|			СГРУППИРОВАТЬ ПО
//		|				Работники.ПодразделениеОрганизации,
//		|				Работники.НомерСтроки,
//		|				Работники.Должность) КАК МаксимальныеПериодыШР
//		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтатноеРасписаниеОрганизаций КАК ШтатноеРасписание
//		|				ПО МаксимальныеПериодыШР.ПодразделениеОрганизации = ШтатноеРасписание.ПодразделениеОрганизации
//		|					И МаксимальныеПериодыШР.Должность = ШтатноеРасписание.Должность
//		|					И МаксимальныеПериодыШР.МаксПериод = ШтатноеРасписание.Период
//		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|					Работники.НомерСтроки КАК НомерСтроки,
//		|					Работники.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|					Работники.Должность КАК Должность,
//		|					СУММА(ВЫБОР
//		|							КОГДА Вакансии.ВидДвижения = &Приход
//		|								ТОГДА Вакансии.КоличествоСтавок
//		|							ИНАЧЕ -Вакансии.КоличествоСтавок
//		|						КОНЕЦ) КАК КоличествоСтавок
//		|				ИЗ
//		|					Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Работники
//		|						ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗанятыеШтатныеЕдиницыОрганизаций КАК Вакансии
//		|						ПО Работники.ПодразделениеОрганизации = Вакансии.ПодразделениеОрганизации
//		|							И Работники.Должность = Вакансии.Должность
//		|							И Работники.ДатаНачала >= Вакансии.Период
//		|							И (Вакансии.Регистратор <> &ДокументСсылка)
//		|				ГДЕ
//		|					Работники.Ссылка = &ДокументСсылка
//		|				
//		|				СГРУППИРОВАТЬ ПО
//		|					Работники.ПодразделениеОрганизации,
//		|					Работники.Должность,
//		|					Работники.НомерСтроки) КАК Вакансии
//		|				ПО МаксимальныеПериодыШР.НомерСтроки = Вакансии.НомерСтроки
//		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|					СтрокиДокумента.НомерСтроки КАК НомерСтроки,
//		|					СУММА(ВЫБОР
//		|							КОГДА КадровоеПеремещениеОрганизацийРаботникиОрганизации.ДатаНачала <= СтрокиДокумента.ДатаНачала
//		|								ТОГДА КадровоеПеремещениеОрганизацийРаботникиОрганизации.ЗанимаемыхСтавок
//		|							ИНАЧЕ 0
//		|						КОНЕЦ - ВЫБОР
//		|							КОГДА КадровоеПеремещениеОрганизацийРаботникиОрганизации.ДатаОкончания < СтрокиДокумента.ДатаНачала
//		|									И КадровоеПеремещениеОрганизацийРаботникиОрганизации.ДатаОкончания <> &ПустаяДата
//		|									И НЕ КадровоеПеремещениеОрганизацийРаботникиОрганизации.НапомнитьПоЗавершении
//		|								ТОГДА КадровоеПеремещениеОрганизацийРаботникиОрганизации.ЗанимаемыхСтавок
//		|							ИНАЧЕ 0
//		|						КОНЕЦ) КАК КоличествоСтавок
//		|				ИЗ
//		|					Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК СтрокиДокумента
//		|						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК КадровоеПеремещениеОрганизацийРаботникиОрганизации
//		|						ПО СтрокиДокумента.Ссылка = КадровоеПеремещениеОрганизацийРаботникиОрганизации.Ссылка
//		|							И СтрокиДокумента.НомерСтроки <> КадровоеПеремещениеОрганизацийРаботникиОрганизации.НомерСтроки
//		|							И СтрокиДокумента.ПодразделениеОрганизации = КадровоеПеремещениеОрганизацийРаботникиОрганизации.ПодразделениеОрганизации
//		|							И СтрокиДокумента.Должность = КадровоеПеремещениеОрганизацийРаботникиОрганизации.Должность
//		|				ГДЕ
//		|					СтрокиДокумента.Ссылка = &ДокументСсылка
//		|				
//		|				СГРУППИРОВАТЬ ПО
//		|					СтрокиДокумента.НомерСтроки) КАК РанееЗанятоСтавок
//		|				ПО МаксимальныеПериодыШР.НомерСтроки = РанееЗанятоСтавок.НомерСтроки
//		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|					Работники.НомерСтроки КАК НомерСтроки,
//		|					Работники.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
//		|					Работники.Должность КАК Должность,
//		|					ИтогоЗанятоПоДолжности.КоличествоСтавок КАК КоличествоСтавок
//		|				ИЗ
//		|					Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК Работники
//		|						ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//		|							СУММА(	ВЫБОР
//		|										КОГДА РаботникиОрганизаций.ПериодЗавершения <= ПоследниеСтавки.ДатаНачала
//		|											И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|										ТОГДА РаботникиОрганизаций.ЗанимаемыхСтавокЗавершения
//		|										ИНАЧЕ РаботникиОрганизаций.ЗанимаемыхСтавок
//		|									КОНЕЦ ) КАК КоличествоСтавок,
//		|									ВЫБОР
//		|										КОГДА РаботникиОрганизаций.ПериодЗавершения <= ПоследниеСтавки.ДатаНачала
//		|											И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|										ТОГДА РаботникиОрганизаций.ДолжностьЗавершения
//		|										ИНАЧЕ РаботникиОрганизаций.Должность 
//		|									КОНЕЦ КАК Должность,
//		|									ВЫБОР
//		|										КОГДА РаботникиОрганизаций.ПериодЗавершения <= ПоследниеСтавки.ДатаНачала
//		|											И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|										ТОГДА РаботникиОрганизаций.ПодразделениеОрганизацииЗавершения
//		|										ИНАЧЕ РаботникиОрганизаций.ПодразделениеОрганизации 
//		|									КОНЕЦ КАК ПодразделениеОрганизации
//		|						ИЗ
//		|							(ВЫБРАТЬ
//		|								МАКСИМУМ(Работники.Период) КАК Период,
//		|								Работники.Сотрудник КАК Сотрудник,
//		|                               ТЧРаботникиОрганизации.ДатаНачала КАК ДатаНачала
//		|							ИЗ
//		|								Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации
//		|									ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК Работники
//		|									ПО Работники.Период <= ТЧРаботникиОрганизации.ДатаНачала
//		|										И (Работники.Регистратор.Проведен)
//		|										И ТЧРаботникиОрганизации.Сотрудник = Работники.Сотрудник
//		|							ГДЕ
//		|								ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|							
//		|							СГРУППИРОВАТЬ ПО
//		|								Работники.Сотрудник,ТЧРаботникиОрганизации.ДатаНачала) КАК ПоследниеСтавки
//		|								ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
//		|								ПО ПоследниеСтавки.Период = РаботникиОрганизаций.Период
//		|									И ПоследниеСтавки.Сотрудник = РаботникиОрганизаций.Сотрудник
//		|						
//		|						СГРУППИРОВАТЬ ПО
//		|									ВЫБОР
//		|										КОГДА РаботникиОрганизаций.ПериодЗавершения <= ПоследниеСтавки.ДатаНачала
//		|											И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|										ТОГДА РаботникиОрганизаций.ДолжностьЗавершения
//		|										ИНАЧЕ РаботникиОрганизаций.Должность 
//		|									КОНЕЦ,
//		|									ВЫБОР
//		|										КОГДА РаботникиОрганизаций.ПериодЗавершения <= ПоследниеСтавки.ДатаНачала
//		|											И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
//		|										ТОГДА РаботникиОрганизаций.ПодразделениеОрганизацииЗавершения
//		|										ИНАЧЕ РаботникиОрганизаций.ПодразделениеОрганизации 
//		|									КОНЕЦ) КАК ИтогоЗанятоПоДолжности
//		|						ПО ИтогоЗанятоПоДолжности.Должность = Работники.Должность
//		|							И ИтогоЗанятоПоДолжности.ПодразделениеОрганизации = Работники.ПодразделениеОрганизации
//		|				ГДЕ
//		|					Работники.Ссылка = &ДокументСсылка) КАК ОсвобождаетсяСтавок
//		|				ПО МаксимальныеПериодыШР.НомерСтроки = ОсвобождаетсяСтавок.НомерСтроки) КАК СвободноСтавокНаДатуПриема
//		|		ПО ТЧРаботникиОрганизации.НомерСтроки = СвободноСтавокНаДатуПриема.НомерСтроки
//		|ГДЕ
//		|	ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|
//		|ОБЪЕДИНИТЬ ВСЕ
//		|
//		|ВЫБРАТЬ РАЗЛИЧНЫЕ
//		|	""КонфликтныйДокумент"",
//		|	ТЧРаботникиОрганизации.НомерСтроки,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	Работники.Регистратор,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL,
//		|	NULL
//		|ИЗ
//		|	Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации
//		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК Работники
//		|		ПО (НЕ ТЧРаботникиОрганизации.НапомнитьПоЗавершении
//		|					И (Работники.Период МЕЖДУ ТЧРаботникиОрганизации.ДатаНачала И ВЫБОР
//		|						КОГДА ТЧРаботникиОрганизации.ДатаОкончания = &ПустаяДата
//		|							ТОГДА &ПустаяДата
//		|						ИНАЧЕ ДОБАВИТЬКДАТЕ(ТЧРаботникиОрганизации.ДатаОкончания, ДЕНЬ, 1)
//		|					КОНЕЦ)
//		|				ИЛИ Работники.Период = ТЧРаботникиОрганизации.ДатаНачала)
//		|			И ТЧРаботникиОрганизации.Сотрудник = Работники.Сотрудник
//		|ГДЕ
//		|	ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
//		|
//		|УПОРЯДОЧИТЬ ПО
//		|	НомерСтроки";
//		

//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) (
	//Иначе
	//	ТекстЗапроса =
	//	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//	|	""ДанныеДляДвиженийКадров"" КАК ВидСтрокиЗапроса,
	//	|	ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
	//	|	ТЧРаботникиОрганизации.Сотрудник КАК Сотрудник,
	//	|	ТЧРаботникиОрганизации.Сотрудник.Наименование КАК СотрудникНаименование,
	//	|	ТЧРаботникиОрганизации.ДатаНачала КАК ДатаНачала,
	//	|	ТЧРаботникиОрганизации.ДатаОкончания КАК ДатаОкончания,
	//	|	ТЧРаботникиОрганизации.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	//	|	ТЧРаботникиОрганизации.Должность КАК Должность,
	//	//РБ
	//	|	ТЧРаботникиОрганизации.РазрядЕТС КАК РазрядЕТС,
	//	|	ТЧРаботникиОрганизации.КоэффициентЕТС КАК КоэффициентЕТС,
	//	|	ТЧРаботникиОрганизации.Категория КАК Категория,
	//	|	ТЧРаботникиОрганизации.МесячнаяТарифнаяСтавка КАК МесячнаяТарифнаяСтавка,
	//	|	ТЧРаботникиОрганизации.ПроцентПоКонтракту КАК ПроцентПоКонтракту,
	//	//РБ
	//	|	ТЧРаботникиОрганизации.НапомнитьПоЗавершении КАК НапомнитьПоЗавершении,
	//	|	NULL,
	//	|	ТЧРаботникиОрганизации.ЗанимаемыхСтавок КАК ЗанимаемыхСтавок,
	//	|	ТЧРаботникиОрганизации.ПодразделениеОрганизации.Владелец КАК ОрганизацияПодразделения,
	//	|	ВЫБОР
	//	|		КОГДА (НЕ ТЧРаботникиОрганизации.ПодразделениеОрганизации.Владелец В (&СписокСтруктурныхПодразделений))
	//	|			ТОГДА ИСТИНА
	//	|		ИНАЧЕ ЛОЖЬ
	//	|	КОНЕЦ КАК ОшибкаПодразделениеНеПринадлежитОрганизации,
	//	|	ВЫБОР
	//	|		КОГДА ТЧРаботникиОрганизации.Сотрудник.Организация = &ГоловнаяОрганизация
	//	|			ТОГДА ЛОЖЬ
	//	|		ИНАЧЕ ИСТИНА
	//	|	КОНЕЦ КАК ОшибкаНеСоответствиеСотрудникаИОрганизации,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизацииЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизации
	//	|	КОНЕЦ КАК ПрежнееПодразделение,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделениеЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделение
	//	|	КОНЕЦ КАК ПрежняяОрганизация,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ДолжностьЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.Должность
	//	|	КОНЕЦ КАК ПрежняяДолжность,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавокЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавок
	//	|	КОНЕЦ КАК ПрежняяСтавка,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ГрафикРаботыЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.ГрафикРаботы
	//	|	КОНЕЦ КАК ПрежнийГрафикРаботы,
	//	|	ВЫБОР
	//	|		КОГДА  ДанныеПоРаботникуДоНазначения.ПериодЗавершения <= ТЧРаботникиОрганизации.ДатаНачала 
	//	|				И ДанныеПоРаботникуДоНазначения.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	//	|		ТОГДА ДанныеПоРаботникуДоНазначения.ПериодЗавершения
	//	|		ИНАЧЕ ДанныеПоРаботникуДоНазначения.Период
	//	|	КОНЕЦ КАК ДатаПоследнегоДвиженияПоРаботнику,
	//	|	ПересекающиесяСтроки.КонфликтнаяСтрокаНомер,
	//	|	NULL КАК КонфликтныйДокумент,
	//	|	ВЫБОР
	//	|		КОГДА ТЧРаботникиОрганизации.Сотрудник.НомерДоговора ЕСТЬ НЕ NULL 
	//	|			ТОГДА ИСТИНА
	//	|		ИНАЧЕ ЛОЖЬ
	//	|	КОНЕЦ КАК ТрудовойДоговорПрисутствует
	//	|ИЗ
	//	|	Документ.ПриказНаПрисвоениеРазряда.РаботникиОрганизации КАК ТЧРаботникиОрганизации
	//	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	//	|			ДатыПоследнихДвиженийРаботников.НомерСтроки КАК НомерСтроки,
	//	|			ДатыПоследнихДвиженийРаботников.Период КАК Период,
	//	|			ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавок КАК ЗанимаемыхСтавок,
	//	|			ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделение КАК ОбособленноеПодразделение,
	//	|			ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	//	|			ДанныеПоРаботникуДоНазначения.Должность КАК Должность,
	//	|			ДанныеПоРаботникуДоНазначения.ГрафикРаботы КАК ГрафикРаботы,
	//	|			ДанныеПоРаботникуДоНазначения.ЗанимаемыхСтавокЗавершения КАК ЗанимаемыхСтавокЗавершения,
	//	|			ДанныеПоРаботникуДоНазначения.ОбособленноеПодразделениеЗавершения КАК ОбособленноеПодразделениеЗавершения,
	//	|			ДанныеПоРаботникуДоНазначения.ПодразделениеОрганизацииЗавершения КАК ПодразделениеОрганизацииЗавершения,
	//	|			ДанныеПоРаботникуДоНазначения.ДолжностьЗавершения КАК ДолжностьЗавершения,
	//	|			ДанныеПоРаботникуДоНазначения.ГрафикРаботыЗавершения КАК ГрафикРаботыЗавершения,
	//	|			ДанныеПоРаботникуДоНазначения.ПериодЗавершения КАК ПериодЗавершения
	//	|		ИЗ
	//	|			(ВЫБРАТЬ
	//	|				ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
	//	|				МАКСИМУМ(Работники.Период) КАК Период,
	//	|				ТЧРаботникиОрганизации.Сотрудник КАК Сотрудник
	//	|			ИЗ
	//	|				Документ.ПриказНаПрисвоениеРазряда.РаботникиОрганизации КАК ТЧРаботникиОрганизации
	//	|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК Работники
	//	|					ПО Работники.Период <= ТЧРаботникиОрганизации.ДатаНачала
	//	|						И ТЧРаботникиОрганизации.Сотрудник = Работники.Сотрудник
	//	|			ГДЕ
	//	|				ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
	//	|			
	//	|			СГРУППИРОВАТЬ ПО
	//	|				ТЧРаботникиОрганизации.НомерСтроки,
	//	|				ТЧРаботникиОрганизации.Сотрудник) КАК ДатыПоследнихДвиженийРаботников
	//	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК ДанныеПоРаботникуДоНазначения
	//	|				ПО ДанныеПоРаботникуДоНазначения.Период = ДатыПоследнихДвиженийРаботников.Период
	//	|					И ДатыПоследнихДвиженийРаботников.Сотрудник = ДанныеПоРаботникуДоНазначения.Сотрудник) КАК ДанныеПоРаботникуДоНазначения
	//	|		ПО ТЧРаботникиОрганизации.НомерСтроки = ДанныеПоРаботникуДоНазначения.НомерСтроки
	//	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	//	|			ТЧРаботникиОрганизации.НомерСтроки КАК НомерСтроки,
	//	|			МИНИМУМ(ТЧРаботникиОрганизации2.НомерСтроки) КАК КонфликтнаяСтрокаНомер
	//	|		ИЗ
	//	|			Документ.ПриказНаПрисвоениеРазряда.РаботникиОрганизации КАК ТЧРаботникиОрганизации
	//	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КадровоеПеремещениеОрганизаций.РаботникиОрганизации КАК ТЧРаботникиОрганизации2
	//	|				ПО ТЧРаботникиОрганизации2.Ссылка = ТЧРаботникиОрганизации.Ссылка
	//	|					И ТЧРаботникиОрганизации.НомерСтроки < ТЧРаботникиОрганизации2.НомерСтроки
	//	|					И ТЧРаботникиОрганизации.Сотрудник = ТЧРаботникиОрганизации2.Сотрудник
	//	|		ГДЕ
	//	|			ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
	//	|		
	//	|		СГРУППИРОВАТЬ ПО
	//	|			ТЧРаботникиОрганизации.НомерСтроки) КАК ПересекающиесяСтроки
	//	|		ПО ТЧРаботникиОрганизации.НомерСтроки = ПересекающиесяСтроки.НомерСтроки
	//	|ГДЕ
	//	|	ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
	//	|
	//	|ОБЪЕДИНИТЬ ВСЕ
	//	|
	//	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	//	|	""КонфликтныйДокумент"",
	//	|	ТЧРаботникиОрганизации.НомерСтроки,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	NULL,
	//	|	Работники.Регистратор,
	//	|	NULL
	//	|ИЗ
	//	|	Документ.ПриказНаПрисвоениеРазряда.РаботникиОрганизации КАК ТЧРаботникиОрганизации
	//	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК Работники
	//	|		ПО (НЕ ТЧРаботникиОрганизации.НапомнитьПоЗавершении
	//	|					И (Работники.Период МЕЖДУ ТЧРаботникиОрганизации.ДатаНачала И ВЫБОР
	//	|						КОГДА ТЧРаботникиОрганизации.ДатаОкончания = &ПустаяДата
	//	|							ТОГДА &ПустаяДата
	//	|						ИНАЧЕ ДОБАВИТЬКДАТЕ(ТЧРаботникиОрганизации.ДатаОкончания, ДЕНЬ, 1)
	//	|					КОНЕЦ)
	//	|				ИЛИ Работники.Период = ТЧРаботникиОрганизации.ДатаНачала)
	//	|			И ТЧРаботникиОрганизации.Сотрудник = Работники.Сотрудник
	//	|ГДЕ
	//	|	ТЧРаботникиОрганизации.Ссылка = &ДокументСсылка
	//	|
	//	|УПОРЯДОЧИТЬ ПО
	//	|	НомерСтроки";
	//
	//КонецЕсли;

	//Запрос.Текст = ТекстЗапроса;
	//	
	//Возврат Запрос.Выполнить();
	//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) )

КонецФункции // СформироватьЗапросПоРаботникиОрганизации()

// Проверяет правильность заполнения шапки документа.
// Если какой-то из реквизтов шапки, влияющий на проведение не заполнен или
// заполнен не корректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по шапке,
// все проверяемые реквизиты должны быть включены в выборку по шапке.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента	- выборка из результата запроса по шапке документа,
//  Отказ 					- флаг отказа в проведении.
//	Заголовок				- Заголовок для сообщений об ошибках проведения
//
Процедура ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок)

	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Организация) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана организация!", Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеШапки()

//// Проверяет правильность заполнения реквизитов в строке ТЧ "РаботникиОрганизации" документа.
//// Если какой-то из реквизтов, влияющий на проведение не заполнен или
//// заполнен не корректно, то выставляется флаг отказа в проведении.
//// Проверка выполняется по выборке из результата запроса по строке ТЧ документа,
//// все проверяемые реквизиты должны быть включены в выборку.
////
//// Параметры: 
////  ВыборкаПоШапкеДокумента		- выборка из результата запроса по шапке документа,
////  ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
////  							  из результата запроса по товарам документа, 
////  Отказ 						- флаг отказа в проведении.
////	Заголовок					- Заголовок для сообщений об ошибках проведения
////
//Процедура ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоСтрокамДокумента, Отказ, Заголовок, ПроверкаШтатногоРасписания)
//	
//	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки) +
//	""" табл. части ""Работники"": ";

//	Если ВыборкаПоСтрокамДокумента.ВидСтрокиЗапроса = "ДанныеДляДвиженийКадров" Тогда

//		// Сотрудник
//		НетСотрудника = НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Сотрудник);
//		Если НетСотрудника Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не выбран работник!", Отказ, Заголовок);
//		КонецЕсли;

//		// ДатаНачала
//		НетДатыНачала = Не ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаНачала);
//		Если НетДатыНачала Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указазана дата перемещения!", Отказ, Заголовок);
//		КонецЕсли;

//		// Организация сотрудника должна совпадать с организацией в документе
//		Если ВыборкаПоСтрокамДокумента.ОшибкаНеСоответствиеСотрудникаИОрганизации Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указанный работник оформлен на другую организацию!", Отказ, Заголовок);
//		КонецЕсли;

//		// Подразделение
//		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ПодразделениеОрганизации) Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указано подразделение, куда переводится работник!", Отказ, Заголовок);
//		ИначеЕсли ВыборкаПоСтрокамДокумента.ОшибкаПодразделениеНеПринадлежитОрганизации Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указано подразделение, принадлежащее другой организации!", Отказ, Заголовок);
//		КонецЕсли;

//		// Должность
//		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Должность) Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана должность, на которую переводится работник!", Отказ, Заголовок);
//		КонецЕсли;

//		// Количество ставок
//		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ЗанимаемыхСтавок) Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указано количество занимаемых работником ставок!", Отказ, Заголовок);
//		ИначеЕсли Не НетДатыНачала И ПроверкаШтатногоРасписания Тогда
//			Если ВыборкаПоСтрокамДокумента.ОстатокСтавок < ВыборкаПоСтрокамДокумента.ЗанимаемыхСтавок Тогда
//				ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "в штатном расписании не предусмотрены ставки для перевода работника!", Отказ, Заголовок);
//			КонецЕсли;
//		КонецЕсли;

//		Если НетСотрудника ИЛИ НетДатыНачала Тогда
//			Возврат; // Дальше не проверяем
//		КонецЕсли;

//		// ГрафикРаботы
//		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ГрафикРаботы)  Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан рабочий график!", Отказ, Заголовок);
//		КонецЕсли;
//		
//		// ДатаОкончания
//		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаОкончания) и ВыборкаПоСтрокамДокумента.ДатаНачала > ВыборкаПоСтрокамДокумента.ДатаОкончания Тогда
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата начала перемещения не может превышать дату окончания!", Отказ, Заголовок);
//		КонецЕсли;

//		// Проверка: ранее работник должен быть принят на работу
//		Если ВыборкаПоСтрокамДокумента.ПрежняяСтавка = NULL Тогда
//			СтрокаПродолжениеСообщенияОбОшибке = "на " + Формат(ВыборкаПоСтрокамДокумента.ДатаНачала, "ДЛФ=DD") + " работник " + ВыборкаПоСтрокамДокумента.СотрудникНаименование + " еще не принят на работу!";
//			Сообщить(СтрокаНачалаСообщенияОбОшибке + СтрокаПродолжениеСообщенияОбОшибке);
//		ИначеЕсли ВыборкаПоСтрокамДокумента.ПрежняяСтавка = 0 Тогда	
//			СтрокаПродолжениеСообщенияОбОшибке = "на " + Формат(ВыборкаПоСтрокамДокумента.ДатаНачала, "ДЛФ=DD") + " работник " + ВыборкаПоСтрокамДокумента.СотрудникНаименование + " уже уволен (с " + Формат(ВыборкаПоСтрокамДокумента.ДатаПоследнегоДвиженияПоРаботнику, "ДЛФ=DD") + ")!";
//			Сообщить(СтрокаНачалаСообщенияОбОшибке + СтрокаПродолжениеСообщенияОбОшибке);
//		КонецЕсли;

//		// Проверка: противоречие другой строке документа
//		Если ВыборкаПоСтрокамДокумента.КонфликтнаяСтрокаНомер <> NULL Тогда
//			СтрокаСообщениеОбОшибке = "одним документом допускается регистрировать только одно перемещение работника - см. строку " + ВыборкаПоСтрокамДокумента.КонфликтнаяСтрокаНомер + "!"; 
//			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + СтрокаСообщениеОбОшибке, Отказ, Заголовок);
//		КонецЕсли;
//		
//		//Если ВыборкаПоСтрокамДокумента.ТрудовойДоговорПрисутствует И НЕ(ПустаяСтрока(РаботникиОрганизации.Найти(ВыборкаПоСтрокамДокумента.НомерСтроки,"НомерСтроки").ОснованиеПеремещения)) Тогда
//		//	СтрокаСообщениеОбОшибке = " ""Основание перемещения"" указывается только тогда, когда с работником не был заключен трудовой договор!"; 
//		//	ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + СтрокаСообщениеОбОшибке, Отказ, Заголовок);			
//		//КонецЕсли;

//	ИначеЕсли ВыборкаПоСтрокамДокумента.ВидСтрокиЗапроса = "КонфликтныйДокумент" Тогда	

//		// противоречие другим кадровым приказам
//		СтрокаСообщениеОбОшибке = "период действия приказа противоречит кадровому приказу " + Символы.ПС + Символы.Таб + ВыборкаПоСтрокамДокумента.КонфликтныйДокумент + "!"; 
//		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + СтрокаСообщениеОбОшибке, Отказ, Заголовок);
//	КонецЕсли;

//КонецПроцедуры // ПроверитьЗаполнениеСтрокиРаботникаОрганизации()

// По строке выборки результата запроса по документу формируем движения по регистрам
//
// Параметры: 
//  ВыборкаПоШапкеДокумента                - выборка из результата запроса по шапке документа,
//  СтруктураПроведенияПоРегистрамСведений - структура, содержащая имена регистров 
//                                           сведений по которым надо проводить документ,
//  СтруктураПараметров                    - структура параметров проведения,
//
// Возвращаемое значение:
//  Нет.
//

Процедура ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоШапкеДокумента,    ВыборкаПоСтрокамДокумента, СтруктураПараметров = "",НаборЗаписейРаботникиОрганизаций,НаборЗаписейРаботникиОрганизаций1)
	

	
	//Если ВыборкаПоСтрокамДокумента.ВидСтрокиЗапроса = "ДанныеДляДвиженийКадров" Тогда
	//	
	//	// отразим новое место работы
	//	
	//	Движение = НаборЗаписейРаботникиОрганизаций.Добавить();//Движения.РаботникиОрганизаций.Добавить();
	//	
	//	Запрос = Новый Запрос;
	//	Запрос.Текст = 
	//	"ВЫБРАТЬ
	//	|	РаботникиОрганизаций.Сотрудник
	//	|ИЗ
	//	|	РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
	//	|ГДЕ
	//	|	РаботникиОрганизаций.Сотрудник = &Сотрудник
	//	|	И РаботникиОрганизаций.Период = &Период";
	//	
	//	Запрос.УстановитьПараметр("Период", ДатаНачала);
	//	Запрос.УстановитьПараметр("Сотрудник", ВыборкаПоСтрокамДокумента.Сотрудник);
	//	
	//	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	//	Если РезультатЗапроса.Количество()>0 Тогда 
	//		// Свойства
	//		Движение.Период						= ДатаНачала+86400;
	//	иначе
	//		// Свойства
	//		Движение.Период						= ДатаНачала+60;
	//	КонецЕсли;
	//	
	//	
	//	
	//	// Измерения
	//	Движение.Сотрудник					= ВыборкаПоСтрокамДокумента.Сотрудник;
	//	Движение.Организация				= ВыборкаПоШапкеДокумента.ГоловнаяОрганизация;
	//	
	//	// Ресурсы
	//	Движение.ПодразделениеОрганизации	= ВыборкаПоСтрокамДокумента.ПодразделениеОрганизации;
	//	Движение.Должность					= ВыборкаПоСтрокамДокумента.Должность;
	//	Движение.ЗанимаемыхСтавок			= ВыборкаПоСтрокамДокумента.ЗанимаемыхСтавок;
	//	Движение.РазрядЕТС                  = РазрядЕТС; //РБ
	//	
	//	
	//	ВыбраннаяДолжность 	= ВыборкаПоСтрокамДокумента.Должность.СтрокаЕТС;
	//	ВыбранныйРазряд = РазрядЕТС;
	//	Для каждого СтрокаРазряда из ВыбраннаяДолжность.Коэффициенты цикл
	//		Если СтрокаРазряда.Разряд = ВыбранныйРазряд тогда
	//			КоэффициентЕТС = СтрокаРазряда.Коэффициент;
	//			Прервать;
	//		КонецЕсли;
	//	КонецЦикла;
	//	
	//	Движение.КоэффициентЕТС             = КоэффициентЕТС; //РБ
	//	Движение.Категория                  = ВыборкаПоСтрокамДокумента.Категория; //РБ
	//	
	//	
	//	// Реквизиты
	//	Движение.ПричинаИзмененияСостояния	= Перечисления.ПричиныИзмененияСостояния.Перемещение;
	//	Движение.ОбособленноеПодразделение	= ВыборкаПоСтрокамДокумента.ОрганизацияПодразделения;
	//	Попытка
	//	  НаборЗаписейРаботникиОрганизаций.Записать();
	//	 Исключение
	//	КонецПопытки;
	//	
	////	Движение.Регистратор = Ссылка;
	//	//Движения.РаботникиОрганизаций.Прочитать();
	//	
	//	
	//	//РБ
	//	// Движения по регистру "ТарифныеСтавкиработниковОрганизации"
	//		
	//	Движение = НаборЗаписейРаботникиОрганизаций1.Добавить();
	//	//Движение = Движения.ТарифныеСтавкиработниковОрганизации.Добавить();
	//	
	//	Запрос = Новый Запрос;
	//	Запрос.Текст = 
	//	"ВЫБРАТЬ
	//	|	РаботникиОрганизаций.Сотрудник
	//	|ИЗ
	//	|	РегистрСведений.ТарифныеСтавкиработниковОрганизации КАК РаботникиОрганизаций
	//	|ГДЕ
	//	|	РаботникиОрганизаций.Сотрудник = &Сотрудник
	//	|	И РаботникиОрганизаций.Период = &Период";
	//	
	//	Запрос.УстановитьПараметр("Период", ДатаНачала);
	//	Запрос.УстановитьПараметр("Сотрудник", ВыборкаПоСтрокамДокумента.Сотрудник);
	//	
	//	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	//	Если РезультатЗапроса.Количество()>0 Тогда 
	//		// Свойства
	//		Движение.Период						= ДатаНачала+86400;
	//	иначе
	//		// Свойства
	//		Движение.Период						= ДатаНачала+60;
	//	КонецЕсли;

	//	// Измерения
	//	Движение.Сотрудник                  = ВыборкаПоСтрокамДокумента.Сотрудник;
	//	Движение.Организация                = Организация;
	//	
	//	// Ресурсы
	//	//Движение.КФЗаУсловия                 = КФЗаУсловия;
	//	//Движение.ПовышениеПоЕТС              = ПовышениеПоЕТС;
	//	Движение.Ставка              = МесячнаяТарифнаяСтавка;
	//	
	//	
	//	////
	//	ТекКатегория = Справочники.КатегорииРаботников.ПустаяСсылка();
	//	ПараметрыСтавки = РегистрыСведений.ТарифныеСтавкиПервогоРазрядаОрганизаций.ПолучитьПоследнее(Дата,
	//					Новый Структура("Организация,ТарифнаяСтавка",Организация,Справочники.ТарифныеСтавкиПервогоРазряда.НайтиПоНаименованию(ВыборкаПоСтрокамДокумента.Должность.Категория.Наименование)));
	//					
	//	РазмерСтавки1Разряда = ПараметрыСтавки.Размер; 
	//						// округление в конце 
	//	//КФИзДолжности  = ?(ВыборкаПоСтрокамДокумента.Должность.КоэффициентКОкладу<>0,ВыборкаПоСтрокамДокумента.Должность.КоэффициентКОкладу,1);				
	//	Тариф = (КоэффициентЕТС*РазмерСтавки1Разряда);
	//	ТарифнаяСтавка = (Тариф*?(ТехнологическийКФ = 0,1,ТехнологическийКФ));
	//
	//	
	//	Движение.ТарифнаяСтавка              = ТарифнаяСтавка;
	//	//Движение.ТарифнаяСтавкаПоЕТС = Тариф;
	//	//Движение.ТарифныйКФ = КоэффициентЕТС;
	//	//ТарифныйСКоэффициентомЗаУсловия = ТарифнаяСтавка + Тариф*0;
	//	//Движение.ТарифныйСКФЗаУсловия = ТарифныйСКоэффициентомЗаУсловия;
	//	//Движение.ТехнологическийКФ    = ТехнологическийКФ; 
	//	Движение.ПроцентПоКонтракту   = ПроцентПоКонтракту;
	//	//РБ
	//	Попытка
	//		НаборЗаписейРаботникиОрганизаций1.Записать();
	//		
	//	Исключение
	//	КонецПопытки;
	//	
	//	
	//	
	//КонецЕсли;
	
КонецПроцедуры // ДобавитьСтрокуВДвиженияПоРегистрамСведений()


//// По строке выборки результата запроса по документу формируем движения по регистрам
////
//// Параметры: 
////  ВыборкаПоШапкеДокумента                  - выборка из результата запроса по шапке документа
////  СтруктураПроведенияПоРегистрамНакопления - структура, содержащая имена регистров 
////                                             накопления по которым надо проводить документ
////  СтруктураПараметров                      - структура параметров проведения.
////
//// Возвращаемое значение:
////  Нет.
////
//Процедура ДобавитьСтрокуВДвиженияПоРегистрамНакопления(ВыборкаПоШапкеДокумента,ВыборкаПоСтрокамДокумента, СтруктураПараметров = "")
//	
//	Если ВыборкаПоСтрокамДокумента.ВидСтрокиЗапроса = "ДанныеДляДвиженийКадров" Тогда
//		
//		ПрежняяСтавка			= ВыборкаПоСтрокамДокумента.ПрежняяСтавка;
//		ПрежнееПодразделение	= ВыборкаПоСтрокамДокумента.ПрежнееПодразделение; 
//		ПрежняяДолжность		= ВыборкаПоСтрокамДокумента.ПрежняяДолжность;
//		
//		// по прежнему месту работы освободим занимаемые ранее ставки
//		Движение = Движения.ЗанятыеШтатныеЕдиницыОрганизаций.Добавить();
//		
//		// Свойства
//		Движение.Период							= ВыборкаПоСтрокамДокумента.ДатаНачала;
//		Движение.ВидДвижения					= ВидДвиженияНакопления.Расход;
//		
//		// Измерения
//		Движение.ПодразделениеОрганизации		= ПрежнееПодразделение;
//		Движение.Должность						= ПрежняяДолжность;
//		
//		// Ресурсы
//		Движение.КоличествоСтавок				= ПрежняяСтавка; 
//		
//		// по новому месту работы займем указанные ставки
//		Движение = Движения.ЗанятыеШтатныеЕдиницыОрганизаций.Добавить();
//		
//		// Свойства
//		Движение.Период							= ВыборкаПоСтрокамДокумента.ДатаНачала;
//		Движение.ВидДвижения					= ВидДвиженияНакопления.Приход;
//			
//		// Измерения
//		Движение.ПодразделениеОрганизации		= ВыборкаПоСтрокамДокумента.ПодразделениеОрганизации;
//		Движение.Должность						= ВыборкаПоСтрокамДокумента.Должность;
//		
//		// Ресурсы
//		Движение.КоличествоСтавок				= ВыборкаПоСтрокамДокумента.ЗанимаемыхСтавок; 
//		
//		Если ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаОкончания)
//			и НЕ ВыборкаПоСтрокамДокумента.НапомнитьПоЗавершении Тогда
//			
//			// по прежнему месту работы займем временно освобожденные ставки
//			Движение = Движения.ЗанятыеШтатныеЕдиницыОрганизаций.Добавить();
//			
//			// Свойства
//			Движение.Период						= ВыборкаПоСтрокамДокумента.ДатаОкончания + мДлинаСуток;
//			Движение.ВидДвижения				= ВидДвиженияНакопления.Приход;
//			
//			// Измерения
//			Движение.ПодразделениеОрганизации	= ПрежнееПодразделение;
//			Движение.Должность					= ПрежняяДолжность;
//			
//			// Ресурсы
//			Движение.КоличествоСтавок			= ПрежняяСтавка; 
//			
//			// по новому месту работы освободим временно занимавшиеся ставки
//			Движение = Движения.ЗанятыеШтатныеЕдиницыОрганизаций.Добавить();
//			
//			// Свойства
//			Движение.Период						= ВыборкаПоСтрокамДокумента.ДатаОкончания + мДлинаСуток;
//			Движение.ВидДвижения				= ВидДвиженияНакопления.Расход;
//			
//			// Измерения
//			Движение.ПодразделениеОрганизации	= ВыборкаПоСтрокамДокумента.ПодразделениеОрганизации;
//			Движение.Должность					= ВыборкаПоСтрокамДокумента.Должность;
//			
//			// Ресурсы
//			Движение.КоличествоСтавок			= ВыборкаПоСтрокамДокумента.ЗанимаемыхСтавок; 
//			
//		КонецЕсли;
//	КонецЕсли;
//	
//КонецПроцедуры // ДобавитьСтрокуВДвиженияПоРегистрамНакопления()

//Процедура ДобавитьСтрокуВДвиженияПоКоэффициентам(ВыборкаПоКоэфициентам)
//	
//	Движение = Движения.КоэфПовышенияТО.Добавить();
//	
//	Движение.Период = ВыборкаПоКоэфициентам.ДатаНачала;
//	Движение.Сотрудник = ВыборкаПоКоэфициентам.Сотрудник;
//	Движение.Коэффициент = ВыборкаПоКоэфициентам.Коэффициент; 
//	
//	Движение.Размер = ВыборкаПоКоэфициентам.Размер;
//	Движение.Действие = ВыборкаПоКоэфициентам.Действие;
//КонецПроцедуры

//Процедура ДобавитьСтрокуВДвиженияПоПовышениям(ВыборкаПоПовышениям)
//	
//	Движение = Движения.ПовышенияПоИнструкции.Добавить();
//	
//	Движение.Период = ВыборкаПоПовышениям.ДатаНачала;
//	Движение.Сотрудник = ВыборкаПоПовышениям.Сотрудник;
//	Движение.Коэффициент = ВыборкаПоПовышениям.Коэффициент; 
//	
//	Движение.Размер = ВыборкаПоПовышениям.Размер;
//	Движение.Действие = ВыборкаПоПовышениям.Действие;

//КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаПроведения(Отказ, Режим)
//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) (
	//// Заголовок для сообщений об ошибках проведения.
	//Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);

	//РезультатЗапросаПоШапке = СформироватьЗапросПоШапке(Режим);

	//// Получим реквизиты шапки из запроса
	//ВыборкаПоШапкеДокумента = РезультатЗапросаПоШапке.Выбрать();

	//Если ВыборкаПоШапкеДокумента.Следующий() Тогда

	//	//Надо позвать проверку заполнения реквизитов шапки
	//	ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);

	//	// Движения стоит добавлять, если в проведении еще не отказано (отказ = ложь)
	//	Если НЕ Отказ Тогда

	//		// Получение учетной политики по персоналу организации
	//		УчетнаяПолитикаПоПерсоналуОрганизации	= глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации");
	//		ПроверкаШтатногоРасписания				= ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(УчетнаяПолитикаПоПерсоналуОрганизации, Организация, "ПроверкаШтатногоРасписания");

	//		// получим реквизиты табличной части
	//		РезультатЗапросаПоРаботники	= СформироватьЗапросПоРаботникиОрганизации(ВыборкаПоШапкеДокумента, Режим, ПроверкаШтатногоРасписания);
	//		ВыборкаПоСтрокамДокумента	= РезультатЗапросаПоРаботники.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	//		
	//		НаборЗаписейРаботникиОрганизаций = РегистрыСведений.РаботникиОрганизаций.СоздатьНаборЗаписей();
	//		НаборЗаписейРаботникиОрганизаций.Отбор.Регистратор.Установить(Ссылка);	
	//		
	//		НаборЗаписейРаботникиОрганизаций1 = РегистрыСведений.ТарифныеСтавкиработниковОрганизации.СоздатьНаборЗаписей();
	//		НаборЗаписейРаботникиОрганизаций1.Отбор.Регистратор.Установить(Ссылка);
	//		
	//		Пока ВыборкаПоСтрокамДокумента.Следующий() Цикл

	//		//	// проверим очередную строку табличной части
	//		//	ПроверитьЗаполнениеСтрокиРаботникаОрганизации(ВыборкаПоСтрокамДокумента, Отказ, Заголовок, ПроверкаШтатногоРасписания);

	//			Если НЕ Отказ Тогда

	//		//		// Заполним записи в наборах записей регистров
	//		//		ДобавитьСтрокуВДвиженияПоРегистрамНакопления(ВыборкаПоШапкеДокумента,ВыборкаПоСтрокамДокумента);
	//				ДобавитьСтрокуВДвиженияПоРегистрамСведений(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента,,НаборЗаписейРаботникиОрганизаций,НаборЗаписейРаботникиОрганизаций1);
	//			КонецЕсли;
	//		КонецЦикла;
	//	КонецЕсли;
	//КонецЕсли;
	
	//Аверсон 22.12.2021 КВВ СВФР-008513 (закомментировано) )
	
	
	//Аверсон 25.12.2021 КВВ СВФР-008513 (
	Для Каждого СтрРО ИЗ РаботникиОрганизации Цикл
		Если ЗначениеЗаполнено(СтрРО.ДатаНачала) Тогда
			Движение = Движения.ПрисвоениеРазряда.Добавить();
			Движение.Период	= СтрРО.ДатаНачала;
			Движение.Сотрудник = СтрРО.Сотрудник;
			Движение.Организация = Организация;
			Движение.Разряд = СтрРО.РазрядЕТСНовый;
			Движение.Регистратор = Ссылка;
		Иначе
			Сообщить("В строке " + СокрЛП(СтрРО.НомерСтроки) + " не заполнен реквизит ""Присвоить с"". В регистр внесено не будет." );
		КонецЕсли;
	КонецЦикла;
	//Аверсон 25.12.2021 КВВ СВФР-008513 )
	
	
	
 	// и в конце выгружаем увольнение в файл
	//т = ложь;
	//Если т Тогда
	//РабочаяДата = Дата;
	
	////Если Дата >= НачалоМесяца(ДобавитьМесяц(РабочаяДата,-1)) Тогда 
	//БД = Новый XBase;
	//ФайлНаДиске = Новый Файл("D:\\book1.dbf");//("\\RX100\bases\fail\book1.dbf");
	//Если ФайлНаДиске.Существует() Тогда
	//	БД.ОткрытьФайл("D:\\book1.dbf");//("\\RX100\bases\fail\book1.dbf");
	//Иначе
	//	БД.поля.Добавить("FLAG","N",5);
	//	БД.поля.Добавить("FLAG1","N",5);
	//	БД.поля.Добавить("TABNUMBER","N",20);
	//	БД.поля.Добавить("FULLNAME","S",100);
	//	БД.поля.Добавить("NUMBER1","S",15);
	//	БД.поля.Добавить("DATE1","D",10);
	//	БД.поля.Добавить("DATESTART","D",10);
	//	БД.поля.Добавить("DATEEND","D",10);
	//	БД.поля.Добавить("TYPE1","N",5);
	//	БД.поля.Добавить("CodeOtd","N",10);
	//	БД.поля.Добавить("Otdele","S",100);
	//	БД.поля.Добавить("CODEOTD2","N",10);
	//	БД.поля.Добавить("OTDELE2","S",100);
	//	БД.поля.Добавить("CODEOTD3","N",10);
	//	БД.поля.Добавить("OTDELE3","S",100);
	//	БД.поля.Добавить("CatCode","S",20);
	//	БД.поля.Добавить("Category","S",55);
	//	БД.поля.Добавить("JobCode","S",55);
	//	БД.поля.Добавить("JobTitle","S",55);
	//	БД.поля.Добавить("Razrad","N",2);
	//	БД.поля.Добавить("Tariff","N",15,2);
	//	БД.поля.Добавить("FullSalary","N",15,2);
	//	БД.поля.Добавить("Birthday","D",10);
	//	БД.поля.Добавить("PassSerie","S",15);
	//	БД.поля.Добавить("PassNumber","S",20);
	//	БД.поля.Добавить("PassWhen","D",10);
	//	БД.поля.Добавить("PassWho","S",100);
	//	БД.поля.Добавить("PersNumber","S",30);
	//	БД.поля.Добавить("InsNumber","S",30);
	//	БД.поля.Добавить("Address","S",100);
	//	БД.поля.Добавить("SizeCl","N",3);
	//	БД.поля.Добавить("SizeFoot","N",2);
	//	БД.поля.Добавить("Height","N",3);
	//	БД.поля.Добавить("Sex","S",1);
	//	БД.поля.Добавить("Children","S",100);
	//	БД.поля.Добавить("StagYY","N",3);
	//	БД.поля.Добавить("StagMM","N",3);
	//	БД.поля.Добавить("StagDD","N",3);
	//	БД.поля.Добавить("PU","N",3);
	//	БД.поля.Добавить("COMPENS","N",3);
	//	БД.поля.Добавить("Type1","N",3);
	//	БД.поля.Добавить("CodeOtdPR","N",10);
	//	БД.поля.Добавить("OtdPR","S",100);
	//	БД.поля.Добавить("CodeOtdPR2","N",10);
	//	БД.поля.Добавить("OtdPR2","S",100);
	//	БД.поля.Добавить("CodeOtdPR3","N",10);
	//	БД.поля.Добавить("OtdPR3","S",100);
	//	БД.поля.Добавить("TagsStag","N",10);
	//	БД.поля.Добавить("TagsVred","N",10);
	//	БД.поля.Добавить("TagsPoPrib","N",10);
	//	БД.поля.Добавить("CompType","N",10);
	//	БД.поля.Добавить("CompTags","N",10);
	//	БД.поля.Добавить("Date12","S",100);
	//	БД.поля.Добавить("Catgroup","S",100);
	//	БД.поля.Добавить("PRYV","S",100);
	//	
	//	БД.СоздатьФайл("D:\\book1.dbf");
	//	//БД.СоздатьФайл("\\RX100\bases\fail\book1.dbf")
	//КонецЕсли;
	//
	//Если Не Выгружен Тогда 
	//	
	//	Для Каждого ТекСотр Из РаботникиОрганизации Цикл 
	//		БД.Добавить();
	//		БД.FLAG  = 8;
	//		БД.FLAG1 = 1;
	//		БД.TABNUMBER = ТекСотр.Сотрудник.Код;
	//		БД.FULLNAME  = ТекСотр.Сотрудник.Наименование;
	//		БД.NUMBER1 = Номер;
	//		БД.DATE1   = Дата;
	//		БД.DATESTART = ДатаНачала;
	//		БД.Razrad    = Число(РазрядЕТС);
	//		БД.Записать();
	//		
	//	КонецЦикла;
	//	
	//	БД.ЗакрытьФайл();
	//	Выгружен = Истина;
	//	Записать(РежимЗаписиДокумента.Запись);
	//Иначе 
	//	Для Каждого ТекСотр Из РаботникиОрганизации Цикл 
	//		БД.Добавить();
	//		БД.FLAG  = 8;
	//		БД.FLAG1 = 2;
	//		БД.TABNUMBER = ТекСотр.Сотрудник.Код;
	//		БД.FULLNAME  = ТекСотр.Сотрудник.Наименование;
	//		БД.NUMBER1 = Номер;
	//		БД.DATE1   = Дата;
	//		БД.DATESTART = ДатаНачала;
	//		БД.Razrad    = Число(РазрядЕТС);
	//		БД.Записать();
	//		
	//	КонецЦикла;
	//	
	//	БД.ЗакрытьФайл();
	//	Выгружен = Истина;
	//	Записать(РежимЗаписиДокумента.Запись);
	//КонецЕсли;
//КонецЕсли;
//КонецЕсли;

КонецПроцедуры // ОбработкаПроведения()

Процедура ПриУстановкеНовогоНомера(СтандартнаяОбработка, Префикс)
	
	ОбщегоНазначения.ДобавитьПрефиксОрганизации(ЭтотОбъект, Префикс);
	ОбщегоНазначения.ДобавитьПрефиксУзла(Префикс);
	
	// получить новый номер документа по совокупности кадровых документов
	ПроцедурыУправленияПерсоналом.ПриУстановкеНовогоНомераКадровогоДокумента(СтандартнаяОбработка, ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "ЕдиныйНумераторКадровыхДокументов"), Номер, Префикс, Дата);
	
КонецПроцедуры // ПриУстановкеНовогоНомера()

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	КраткийСоставДокумента = ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(РаботникиОрганизации);
	
	Если ПланыОбмена.ГлавныйУзел() = Неопределено Тогда
		ЗаписьРегистрации = ПринадлежностьПоследовательностям.КадровыеПриказыОрганизации.Добавить();
		ЗаписьРегистрации.Период      = Дата;
		ЗаписьРегистрации.Регистратор = Ссылка;
	КонецЕсли;
	
КонецПроцедуры // ПередЗаписью()

Процедура ПриЗаписи(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	// проверим уникальность номера с точки зрения кадровой нумерации
	ПроцедурыУправленияПерсоналом.ПроверкаУникальностиНомераКадровогоДокумента(ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "ЕдиныйНумераторКадровыхДокументов"), Номер, Дата, Ссылка);

КонецПроцедуры // ПриЗаписи()

Процедура ОбработкаЗаполнения(Основание)
	
	ТипОснования = ТипЗнч(Основание);
	
	Если ТипОснования = Тип("СправочникСсылка.СотрудникиОрганизаций") Тогда
		
		Если Основание.ВидДоговора <> Перечисления.ВидыДоговоровСФизЛицами.ТрудовойДоговор Тогда
			Возврат;
		КонецЕсли;
		
		НоваяСтрока = РаботникиОрганизации.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, Основание);
		НоваяСтрока.Сотрудник = Основание;
		
		//на основании последнего трудового договора
	КонецЕсли;
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

мДлинаСуток = 86400;

