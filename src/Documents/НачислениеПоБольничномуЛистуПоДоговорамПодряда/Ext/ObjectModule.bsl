////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

Перем мДлинаСуток;
Перем мДатаЗакона180ФЗ Экспорт;
Перем мДатаЗакона255ФЗ Экспорт;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

Процедура ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачала, ВидРасчета, ПроцентОплаты)
	
	СтрокаИнтервала					= ТаблицаИнтерваловОплаты.Добавить();
	СтрокаИнтервала.Начало			= ДатаНачала;
	СтрокаИнтервала.Расчет			= ВидРасчета;
	СтрокаИнтервала.ПроцентОплаты	= ПроцентОплаты;
	
КонецПроцедуры // ДобавитьСтрокуВТаблицуИнтервалов()

// Выполняет проверку непрерывности интервалов начислений
Процедура ПроверитьНепрерывностьЗаписейНачислений(Отказ, Заголовок)
	
	Если Начисления.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	// создадим массив начислений, по которым будем проверять непрерывность записей
	МассивНачислений = Новый Массив;
	МассивНачислений.Добавить(ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОтсутствиеПоБолезниДоговора);	
	МассивНачислений.Добавить(ВидРасчета);
	
	ТНачислений = Начисления.Выгрузить();
	ТНачислений.Сортировать("Сотрудник, ДатаНачала");
	
	ПредыдущийСотрудник = Справочники.СотрудникиОрганизаций.ПустаяСсылка();
	ПредыдущаяДатаОкончания = '00010101';
	СтрокаНеПервая = Ложь;
	Для Каждого Строка ИЗ ТНачислений Цикл
		
		// Пропустим сторно записи и записи не из массива начислений
		Если Строка.Сторно ИЛИ МассивНачислений.Найти(Строка.ВидРасчета) = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		Если ПредыдущийСотрудник <> Строка.Сотрудник Тогда
			ПредыдущийСотрудник = Строка.Сотрудник;
			СтрокаНеПервая = Ложь;
		КонецЕсли;
		
		// если встретили не первую строку начислений
		Если СтрокаНеПервая Тогда
			// строка не первая
			Если Строка.ДатаНачала <> ПредыдущаяДатаОкончания + мДлинаСуток Тогда
				СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(Строка.НомерСтроки) +
				""" табл. части ""Начисления"": ";
				ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "нарушено требование непрерывности записей начислений!", Отказ, Заголовок);
			КонецЕсли;
		Иначе
			СтрокаНеПервая = Истина;
		КонецЕсли;
		ПредыдущаяДатаОкончания = Строка.ДатаОкончания;
		
	КонецЦикла;
	
КонецПроцедуры // ПроверитьНепрерывностьЗаписейНачислений()

Функция КорректноеСочетаниеСчетовНУ(СчетДт,НаименованиеСчетДт, СчетКт, СчетДтНУ, СчетКтНУ, ЭтоЕНВД, Сообщение)
	
	Сообщение = "";
	
	Если СчетДтНУ.Пустая() Тогда
		Если (СчетКт = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда или СчетКт = ПланыСчетов.Хозрасчетный.РасчетыПоВыплатеДоходов)
			и Не ЭтоЕНВД Тогда
			Сообщение = "Не указан счет налогового учета!";
		КонецЕсли;
		Если НЕ СчетКтНУ.Пустая() Тогда
			Сообщение = Сообщение + ?(Сообщение = "","",Символы.ПС) + "Указан счет кредита налогового учета, но не указан счет дебета налогового учета!";
		КонецЕсли;
	Иначе
		Если (СчетДт = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда или СчетДт = ПланыСчетов.Хозрасчетный.РасчетыПоВыплатеДоходов) Тогда
			Сообщение = "Проводки в дебет "+НаименованиеСчетДт +" не должны отражаться в налоговом учете!";
		ИначеЕсли ЭтоЕНВД Тогда
			Сообщение = "Проводки по видам деятельности, облагаемым ЕНВД не должны отражаться в налоговом учете!";
		КонецЕсли;
		
		Если СчетКтНУ.Пустая() Тогда
			Сообщение = Сообщение + ?(Сообщение = "","",Символы.ПС) + "Указан счет дебета налогового учета, но не указан счет кредита налогового учета!";
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ПустаяСтрока(Сообщение)
	
КонецФункции // КорректноеСочетаниеСчетовНУ()

Функция ПолучитьВариантАлгоритмаРасчета(ЭтоПереходныйПериодПоЗакону255ФЗ)
	
	Если ЭтоПереходныйПериодПоЗакону255ФЗ Тогда
		Если ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение Тогда
			Если ОграничениеПособияПереходногоПериода = Перечисления.ВидыОграниченияПособия.ОграничениеВРазмереММОТ Тогда
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОбщимОграничениемИВРазмереММОТ;
			ИначеЕсли ОграничениеПособияПереходногоПериода = Перечисления.ВидыОграниченияПособия.ОбщееОграничение Тогда
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОбщимОграничением;
			Иначе
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОбщимОграничениемИБезОграничений;
			КонецЕсли;
		ИначеЕсли ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеВРазмереММОТ Тогда
			Если ОграничениеПособияПереходногоПериода = Перечисления.ВидыОграниченияПособия.ОграничениеВРазмереММОТ Тогда
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениемВРазмереММОТ;
			ИначеЕсли ОграничениеПособияПереходногоПериода = Перечисления.ВидыОграниченияПособия.ОбщееОграничение Тогда
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениямиВРазмереММОТиОбщим;
			Иначе
				ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениемВРазмереММОТиБезОграничений;
			КонецЕсли;
		Иначе
			ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаБезОграничений;
		КонецЕсли;
	ИначеЕсли ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам И ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение Тогда
		ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОграничениемПоБеременности;
	ИначеЕсли ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение Тогда
		ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОбщимОграничением;
	ИначеЕсли ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеВРазмереММОТ Тогда
		ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОграничениемВРазмереММОТ;
	Иначе
		ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйБезОграничений;
	КонецЕсли;
	
	Возврат ВариантАлгоритмаРасчета
	
КонецФункции // ПолучитьВариантАлгоритмаРасчета()

// получение первичных данных для бухучета
// первичные в данном случае, это те, для которых определено конкретное отражение
// в бухучете (не требуетяс предварительная обработка правила отражения в бухучете)
// или те которые определяют свой бухучет по базовым начисленияи и 
// при этом базируются на прошлом периоде
// 
// Параметры:
//  Основные - булево, если Истина, то получаем данные по основным начислениям иначе - по доп.
//
// Возвращаемое значение:
//  Результат запроса
// 
Функция ПолучитьДанныеУчета(ВыборкаПоШапкеДокумента, ЧитатьРасчетнуюБазу)
	
	Запрос = Новый Запрос;
	
	Запрос.УстановитьПараметр("Регистратор", Ссылка);
	Запрос.УстановитьПараметр("Организация", ВыборкаПоШапкеДокумента.Организация);
	Запрос.УстановитьПараметр("ОбособленноеПодразделение", ВыборкаПоШапкеДокумента.ОбособленноеПодразделение);
	Запрос.УстановитьПараметр("ПериодРегистрации", ВыборкаПоШапкеДокумента.ПериодРегистрации);
	Запрос.УстановитьПараметр("ДатаЗакона202ФЗ", '20050101');
	Запрос.УстановитьПараметр("ДатаЗакона255ФЗ", мДатаЗакона255ФЗ);
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	//получим отражение в учете сторно записей
	ОсновныеНачисленияСторноТекст =
	"ВЫБРАТЬ
	|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
	|	ОсновныеНачисления.Сотрудник,
	|	ОсновныеНачисления.ФизЛицо,
	|	ОсновныеНачисления.Организация,
	|	ОсновныеНачисления.ПериодДействияНачало,
	|	ОсновныеНачисления.ПериодДействияКонец,
	|	ОсновныеНачисления.ВидРасчета,
	|	ОсновныеНачисления.СторнируемыйДокумент
	|ПОМЕСТИТЬ ВТ_ОсновныеНачисленияСторно
	|ИЗ
	|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
	|ГДЕ
	|	ОсновныеНачисления.Регистратор = &Регистратор
	|	И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
	|	И ОсновныеНачисления.Результат <> 0
	|	И ОсновныеНачисления.Сторно
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	НомерСтроки";
	
	Запрос.Текст = ОсновныеНачисленияСторноТекст;
	//временная таблица - ВТ_ОсновныеНачисленияСторно
	Результат = Запрос.Выполнить().Выгрузить();
	КоличествоСторноЗаписей = Результат[0].Количество;
	
	Если КоличествоСторноЗаписей <> 0 Тогда
		
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ОсновныеНачисления.СторнируемыйДокумент.ПериодРегистрации КАК ПериодРегистрации,
		|	ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|	ОсновныеНачисления.ВидРасчета КАК ВидРасчета
		|ПОМЕСТИТЬ ВТ_СторноСотрудники
		|ИЗ
		|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ПериодРегистрации,
		|	Сотрудник,
		|	ВидРасчета";
		
		//временная таблица - ВТ_СторноСотрудники
		Запрос.Выполнить();
		
		
		ОтражениеВУчетеСторноТекст = 
		"ВЫБРАТЬ
		|	ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|	БУОсновныеНачисления.СчетДт,
		|	БУОсновныеНачисления.СубконтоДт1,
		|	БУОсновныеНачисления.СубконтоДт2,
		|	БУОсновныеНачисления.СубконтоДт3,
		|	БУОсновныеНачисления.СчетКт,
		|	БУОсновныеНачисления.СубконтоКт1,
		|	БУОсновныеНачисления.СубконтоКт2,
		|	БУОсновныеНачисления.СубконтоКт3,
		|	БУОсновныеНачисления.СчетДтНУ,
		|	БУОсновныеНачисления.СубконтоДтНУ1,
		|	БУОсновныеНачисления.СубконтоДтНУ2,
		|	БУОсновныеНачисления.СубконтоДтНУ3,
		|	БУОсновныеНачисления.СчетКтНУ,
		|	БУОсновныеНачисления.СубконтоКтНУ1,
		|	БУОсновныеНачисления.СубконтоКтНУ2,
		|	БУОсновныеНачисления.СубконтоКтНУ3,
		|	БУОсновныеНачисления.СчетКтУСН,
		|	БУОсновныеНачисления.ОтражениеВУСН,
		|	БУОсновныеНачисления.Результат,
		|	ВЫБОР
		|		КОГДА БУОсновныеНачисления.СчетДт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД), ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ЕНВД))
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ОблагаетсяЕНВД,
		|	ВЫБОР
		|		КОГДА БУОсновныеНачисления.СчетДт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ФСС_СПЕЦ_УСН), ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД), ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ФСС))
		|			ТОГДА ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ПособияЗаСчетФСС)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.НеОблагаетсяЦеликом)
		|	КОНЕЦ КАК КодДоходаЕСН,
		|	БУОсновныеНачисления.ПериодДействияНачало,
		|	БУОсновныеНачисления.ПериодДействияКонец
		|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно
		|ИЗ
		|	ВТ_ОсновныеНачисленияСторно КАК ОсновныеНачисления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			БУОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|			БУОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|			БУОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|			БУОсновныеНачисления.Сотрудник КАК Сотрудник,
		|			БУОсновныеНачисления.ФизЛицо КАК ФизЛицо,
		|			БУОсновныеНачисления.Организация КАК Организация,
		|			БУОсновныеНачисления.Результат КАК Результат,
		|			БУОсновныеНачисления.СчетДт КАК СчетДт,
		|			БУОсновныеНачисления.СубконтоДт1 КАК СубконтоДт1,
		|			БУОсновныеНачисления.СубконтоДт2 КАК СубконтоДт2,
		|			БУОсновныеНачисления.СубконтоДт3 КАК СубконтоДт3,
		|			БУОсновныеНачисления.СчетКт КАК СчетКт,
		|			БУОсновныеНачисления.СубконтоКт1 КАК СубконтоКт1,
		|			БУОсновныеНачисления.СубконтоКт2 КАК СубконтоКт2,
		|			БУОсновныеНачисления.СубконтоКт3 КАК СубконтоКт3,
		|			БУОсновныеНачисления.СчетДтНУ КАК СчетДтНУ,
		|			БУОсновныеНачисления.СубконтоДтНУ1 КАК СубконтоДтНУ1,
		|			БУОсновныеНачисления.СубконтоДтНУ2 КАК СубконтоДтНУ2,
		|			БУОсновныеНачисления.СубконтоДтНУ3 КАК СубконтоДтНУ3,
		|			БУОсновныеНачисления.СчетКтНУ КАК СчетКтНУ,
		|			БУОсновныеНачисления.СубконтоКтНУ1 КАК СубконтоКтНУ1,
		|			БУОсновныеНачисления.СубконтоКтНУ2 КАК СубконтоКтНУ2,
		|			БУОсновныеНачисления.СубконтоКтНУ3 КАК СубконтоКтНУ3,
		|			БУОсновныеНачисления.СчетКтУСН КАК СчетКтУСН,
		|			БУОсновныеНачисления.ОтражениеВУСН КАК ОтражениеВУСН,
		|			БУОсновныеНачисления.ДокументОснование КАК ДокументОснование,
		|			БУОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало1,
		|			БУОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец1
		|		ИЗ
		|			РегистрРасчета.БУОсновныеНачисления КАК БУОсновныеНачисления
		|		ГДЕ
		|			(БУОсновныеНачисления.ПериодРегистрации, БУОсновныеНачисления.Сотрудник, БУОсновныеНачисления.ВидРасчета) В
		|					(ВЫБРАТЬ
		|						ОсновныеНачисления.ПериодРегистрации,
		|						ОсновныеНачисления.Сотрудник,
		|						ОсновныеНачисления.ВидРасчета
		|					ИЗ
		|						ВТ_СторноСотрудники КАК ОсновныеНачисления)) КАК БУОсновныеНачисления
		|		ПО ОсновныеНачисления.ВидРасчета = БУОсновныеНачисления.ВидРасчета
		|			И ОсновныеНачисления.Сотрудник = БУОсновныеНачисления.Сотрудник
		|			И ОсновныеНачисления.Организация = БУОсновныеНачисления.Организация
		|			И ОсновныеНачисления.ФизЛицо = БУОсновныеНачисления.ФизЛицо
		|			И ОсновныеНачисления.СторнируемыйДокумент = БУОсновныеНачисления.ДокументОснование
		|			И (БУОсновныеНачисления.ПериодДействияНачало >= ОсновныеНачисления.ПериодДействияНачало)
		|			И (БУОсновныеНачисления.ПериодДействияКонец <= ОсновныеНачисления.ПериодДействияКонец)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	НомерСтроки";
		
	Иначе
		
		ОтражениеВУчетеСторноТекст = 
		"ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО КАК НомерСтроки,
		|	НЕОПРЕДЕЛЕНО КАК СчетДт,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДт1,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
		|	НЕОПРЕДЕЛЕНО КАК СчетКт,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКт1,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
		|	НЕОПРЕДЕЛЕНО КАК СчетДтНУ,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДтНУ1,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДтНУ2,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоДтНУ3,
		|	НЕОПРЕДЕЛЕНО КАК СчетКтНУ,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКтНУ1,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКтНУ2,
		|	НЕОПРЕДЕЛЕНО КАК СубконтоКтНУ3,
		|	НЕОПРЕДЕЛЕНО КАК СчетКтУСН,
		|	НЕОПРЕДЕЛЕНО КАК ОтражениеВУСН,
		|	НЕОПРЕДЕЛЕНО КАК ОблагаетсяЕНВД,
		|	НЕОПРЕДЕЛЕНО КАК ПериодДействияНачало,
		|	НЕОПРЕДЕЛЕНО КАК ПериодДействияКонец,
		|	НЕОПРЕДЕЛЕНО КАК КодДоходаЕСН,
		|	0 КАК Результат
		|ПОМЕСТИТЬ ВТ_ОтражениеВУчетеСторно";
		
	КонецЕсли;
	
	Запрос.Текст = ОтражениеВУчетеСторноТекст;
	//временная таблица - ВТ_ОтражениеВУчетеСторно
	Запрос.Выполнить();
	
	Если ЧитатьРасчетнуюБазу Тогда
		
		Измерения = Новый Массив(1);
		Измерения[0] = "Сотрудник";
		
		Запрос.УстановитьПараметр("парамИзмерения", Измерения);
		
		Разрезы = Новый Массив(17);
		Разрезы[0] = "СчетДт";
		Разрезы[1] = "СубконтоДт1";
		Разрезы[2] = "СубконтоДт2";
		Разрезы[3] = "СубконтоДт3";
		Разрезы[4] = "СчетКт";
		Разрезы[5] = "СубконтоКт1";
		Разрезы[6] = "СубконтоКт2";
		Разрезы[7] = "СубконтоКт3";
		Разрезы[8] = "СчетДтНУ";
		Разрезы[9] = "СчетКтНУ";
		Разрезы[10] = "СубконтоДтНУ1";
		Разрезы[11] = "СубконтоДтНУ2";
		Разрезы[12] = "СубконтоДтНУ3";
		Разрезы[13] = "СубконтоКтНУ1";
		Разрезы[14] = "СубконтоКтНУ2";
		Разрезы[15] = "СубконтоКтНУ3";
		Разрезы[16] = "ОтражениеВУСН";	
		
		Запрос.УстановитьПараметр("парамРазрезыБУ", Разрезы);
		
		// для учета особенностей расчета среднего заработка
		СписокСоставляющихСреднегоЗаработка = Новый Массив(10); 
		СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
		СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямБЛ;
		СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииБЛ;
		СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямБЛ;
		СписокСоставляющихСреднегоЗаработка[4] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремииБЛ;
		СписокСоставляющихСреднегоЗаработка[5] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработку;
		СписокСоставляющихСреднегоЗаработка[6] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
		СписокСоставляющихСреднегоЗаработка[7] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремии;
		СписокСоставляющихСреднегоЗаработка[8] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
		СписокСоставляющихСреднегоЗаработка[9] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
		Запрос.УстановитьПараметр("парамСписокСоставляющихСреднегоЗаработка", СписокСоставляющихСреднегоЗаработка);
		
		ОсновнойЗаработок = Новый Массив(3);
		ОсновнойЗаработок[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработку;
		ОсновнойЗаработок[1] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
		ОсновнойЗаработок[2] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуПособий;
		ПоФиксПремиям = Новый Массив(3);
		ПоФиксПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
		ПоФиксПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямБЛ;
		ПоФиксПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиямПособий;
		ПоПремиям = Новый Массив(3);
		ПоПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
		ПоПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямБЛ;
		ПоПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиямПособий;
		ФиксГодовыеПремии = Новый Массив(3);
		ФиксГодовыеПремии[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремии;
		ФиксГодовыеПремии[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииБЛ;
		ФиксГодовыеПремии[2] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксГодовойПремииПособий;
		
		Запрос.УстановитьПараметр("ОсновнойЗаработок", ОсновнойЗаработок);
		Запрос.УстановитьПараметр("ПоПремиям", ПоПремиям);
		Запрос.УстановитьПараметр("ПоФиксПремиям", ПоФиксПремиям);
		Запрос.УстановитьПараметр("ФиксГодовыеПремии", ФиксГодовыеПремии);
		
		БазаСреднегоЗаработкаТекст =
		"ВЫБРАТЬ
		|	БазаСреднегоЗаработка.Регистратор,
		|	БазаСреднегоЗаработка.НомерСтроки,
		|	БазаСреднегоЗаработка.СчетДтРазрез,
		|	БазаСреднегоЗаработка.СчетКтРазрез,
		|	БазаСреднегоЗаработка.СубконтоДт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт3Разрез,
		|	БазаСреднегоЗаработка.СчетДтНУРазрез,
		|	БазаСреднегоЗаработка.СчетКтНУРазрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ3Разрез,
		|	БазаСреднегоЗаработка.ОтражениеВУСНРазрез,
		|	СУММА(БазаСреднегоЗаработка.РезультатБаза) КАК РезультатБаза
		|ПОМЕСТИТЬ БазаСреднегоЗаработка
		|ИЗ
		|	(ВЫБРАТЬ
		|		ОсновныеНачисления.Регистратор КАК Регистратор,
		|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|		БазаСреднегоЗаработка.СчетДтРазрез КАК СчетДтРазрез,
		|		БазаСреднегоЗаработка.СчетКтРазрез КАК СчетКтРазрез,
		|		БазаСреднегоЗаработка.СубконтоДт1Разрез КАК СубконтоДт1Разрез,
		|		БазаСреднегоЗаработка.СубконтоДт2Разрез КАК СубконтоДт2Разрез,
		|		БазаСреднегоЗаработка.СубконтоДт3Разрез КАК СубконтоДт3Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт1Разрез КАК СубконтоКт1Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт2Разрез КАК СубконтоКт2Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт3Разрез КАК СубконтоКт3Разрез,
		|		БазаСреднегоЗаработка.СчетДтНУРазрез КАК СчетДтНУРазрез,
		|		БазаСреднегоЗаработка.СчетКтНУРазрез КАК СчетКтНУРазрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ1Разрез КАК СубконтоДтНУ1Разрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ2Разрез КАК СубконтоДтНУ2Разрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ3Разрез КАК СубконтоДтНУ3Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ1Разрез КАК СубконтоКтНУ1Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ2Разрез КАК СубконтоКтНУ2Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ3Разрез КАК СубконтоКтНУ3Разрез,
		|		БазаСреднегоЗаработка.ОтражениеВУСНРазрез КАК ОтражениеВУСНРазрез,
		|		ВЫБОР
		|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ОсновнойЗаработок)
		|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации
		|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
		|				ТОГДА 0
		|			ИНАЧЕ ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ПоФиксПремиям)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации * ВЫБОР
		|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
		|									ТОГДА 0
		|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
		|							КОНЕЦ
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ПоПремиям)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ФиксГодовыеПремии)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
		|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
		|									ТОГДА 0
		|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
		|							КОНЕЦ
		|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|				КОНЕЦ * ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
		|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОНЕЦ КАК РезультатБаза
		|	ИЗ
		|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаБУОсновныеНачисления(
		|					&парамИзмерения,
		|					&парамИзмерения,
		|					&парамРазрезыБУ,
		|					Регистратор = &Регистратор
		|						И (НЕ Сторно)
		|						И (ВидРасчета В (&парамСписокСоставляющихСреднегоЗаработка)
		|							ИЛИ ДатаНачалаСобытия >= &ДатаЗакона255ФЗ)) КАК БазаСреднегоЗаработка
		|			ПО (БазаСреднегоЗаработка.СпособРасчета = ОсновныеНачисления.ВидРасчета.СпособРасчета)
		|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
		|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
		|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
		|				И (ОсновныеНачисления.Сотрудник = ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)
		|							И БазаСреднегоЗаработка.СпособРасчета В (ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС), ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет))
		|						ТОГДА ЕСТЬNULL(БазаСреднегоЗаработка.Регистратор.Сотрудник, БазаСреднегоЗаработка.Сотрудник)
		|					ИНАЧЕ БазаСреднегоЗаработка.Сотрудник
		|				КОНЕЦ)
		|	ГДЕ
		|		ОсновныеНачисления.Регистратор = &Регистратор
		|		И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|		И (НЕ ОсновныеНачисления.Сторно)
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ОсновныеНачисления.Регистратор,
		|		ОсновныеНачисления.НомерСтроки,
		|		БазаСреднегоЗаработка.СчетДтРазрез,
		|		БазаСреднегоЗаработка.СчетКтРазрез,
		|		БазаСреднегоЗаработка.СубконтоДт1Разрез,
		|		БазаСреднегоЗаработка.СубконтоДт2Разрез,
		|		БазаСреднегоЗаработка.СубконтоДт3Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт1Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт2Разрез,
		|		БазаСреднегоЗаработка.СубконтоКт3Разрез,
		|		БазаСреднегоЗаработка.СчетДтНУРазрез,
		|		БазаСреднегоЗаработка.СчетКтНУРазрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ1Разрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ2Разрез,
		|		БазаСреднегоЗаработка.СубконтоДтНУ3Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ1Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ2Разрез,
		|		БазаСреднегоЗаработка.СубконтоКтНУ3Разрез,
		|		БазаСреднегоЗаработка.ОтражениеВУСНРазрез,
		|		ВЫБОР
		|			КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ОсновнойЗаработок)
		|				ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации
		|			КОГДА БазаСреднегоЗаработка.ЧислоМесяцев = 0
		|				ТОГДА 0
		|			ИНАЧЕ ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ПоФиксПремиям)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации * ВЫБОР
		|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
		|									ТОГДА 0
		|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
		|							КОНЕЦ
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ПоПремиям)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * БазаСреднегоЗаработка.КоэффициентИндексации
		|					КОГДА БазаСреднегоЗаработка.ВидРасчета В (&ФиксГодовыеПремии)
		|						ТОГДА БазаСреднегоЗаработка.РезультатБаза * ВЫБОР
		|								КОГДА БазаСреднегоЗаработка.НормаПоПятидневке = 0
		|									ТОГДА 0
		|								ИНАЧЕ БазаСреднегоЗаработка.ОтработаноПоПятидневке / БазаСреднегоЗаработка.НормаПоПятидневке
		|							КОНЕЦ
		|					ИНАЧЕ БазаСреднегоЗаработка.РезультатБаза
		|				КОНЕЦ * ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.ЧислоМесяцев > БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка
		|						ТОГДА БазаСреднегоЗаработка.ПериодРасчетаСреднегоЗаработка / БазаСреднегоЗаработка.ЧислоМесяцев
		|					ИНАЧЕ 1
		|				КОНЕЦ
		|		КОНЕЦ
		|	ИЗ
		|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрРасчета.РасчетСреднегоЗаработка.БазаБУДополнительныеНачисления(
		|					&парамИзмерения,
		|					&парамИзмерения,
		|					&парамРазрезыБУ,
		|					Регистратор = &Регистратор
		|						И (НЕ Сторно)
		|						И (ВидРасчета В (&парамСписокСоставляющихСреднегоЗаработка)
		|							ИЛИ ДатаНачалаСобытия >= &ДатаЗакона255ФЗ)) КАК БазаСреднегоЗаработка
		|			ПО (ОсновныеНачисления.Сотрудник = ВЫБОР
		|					КОГДА БазаСреднегоЗаработка.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)
		|							И БазаСреднегоЗаработка.СпособРасчета В (ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС), ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПособиеПоУходуЗаРебенкомДо1_5Лет))
		|						ТОГДА ЕСТЬNULL(БазаСреднегоЗаработка.Регистратор.Сотрудник, БазаСреднегоЗаработка.Сотрудник)
		|					ИНАЧЕ БазаСреднегоЗаработка.Сотрудник
		|				КОНЕЦ)
		|				И (БазаСреднегоЗаработка.СпособРасчета = ОсновныеНачисления.ВидРасчета.СпособРасчета)
		|				И ОсновныеНачисления.ДатаНачалаСобытия = БазаСреднегоЗаработка.ДатаНачалаСобытия
		|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаНачало = БазаСреднегоЗаработка.ДатаНачалаРасчетногоПериода
		|				И ОсновныеНачисления.ПериодРасчетаСреднегоЗаработкаОкончание = БазаСреднегоЗаработка.ДатаОкончанияРасчетногоПериода
		|	ГДЕ
		|		ОсновныеНачисления.Регистратор = &Регистратор
		|		И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|		И (НЕ ОсновныеНачисления.Сторно)) КАК БазаСреднегоЗаработка
		|
		|СГРУППИРОВАТЬ ПО
		|	БазаСреднегоЗаработка.Регистратор,
		|	БазаСреднегоЗаработка.НомерСтроки,
		|	БазаСреднегоЗаработка.СчетДтРазрез,
		|	БазаСреднегоЗаработка.СчетКтРазрез,
		|	БазаСреднегоЗаработка.СубконтоДт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт3Разрез,
		|	БазаСреднегоЗаработка.СчетДтНУРазрез,
		|	БазаСреднегоЗаработка.СчетКтНУРазрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ3Разрез,
		|	БазаСреднегоЗаработка.ОтражениеВУСНРазрез";
		
		Запрос.Текст = БазаСреднегоЗаработкаТекст;
		//временная таблица - БазаСреднегоЗаработка
		Запрос.Выполнить();
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	&Организация КАК Организация,
		|	&ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|	&ПериодРегистрации КАК ПериодРегистрации,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.ФизЛицо,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Сторно,
		|	ДанныеУчета.Результат,
		|	ЕСТЬNULL(ОтражениеВУчетеСторно.ПериодДействияНачало, ДанныеУчета.ПериодДействияНачало) КАК ПериодДействияНачало,
		|	ЕСТЬNULL(ОтражениеВУчетеСторно.ПериодДействияКонец, ДанныеУчета.ПериодДействияКонец) КАК ПериодДействияКонец,
		|	ДанныеУчета.ГрафикРаботы,
		|	ДанныеУчета.ВидУчетаВремени,
		|	ДанныеУчета.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|	БазаСреднегоЗаработка.СчетДтРазрез КАК СчетДтРазрез,
		|	БазаСреднегоЗаработка.СчетКтРазрез КАК СчетКтРазрез,
		|	ВЫБОР
		|		КОГДА ВЫБОР
		|				КОГДА БазаСреднегоЗаработка.СубконтоДт1Разрез ССЫЛКА Справочник.СтатьиЗатрат
		|					ТОГДА БазаСреднегоЗаработка.СубконтоДт1Разрез.ОтнесениеРасходовКДеятельностиЕНВД
		|				КОГДА БазаСреднегоЗаработка.СубконтоДт2Разрез ССЫЛКА Справочник.СтатьиЗатрат
		|					ТОГДА БазаСреднегоЗаработка.СубконтоДт2Разрез.ОтнесениеРасходовКДеятельностиЕНВД
		|				КОГДА БазаСреднегоЗаработка.СубконтоДт3Разрез ССЫЛКА Справочник.СтатьиЗатрат
		|					ТОГДА БазаСреднегоЗаработка.СубконтоДт3Разрез.ОтнесениеРасходовКДеятельностиЕНВД
		|				ИНАЧЕ NULL
		|			КОНЕЦ = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЭтоЕНВД,
		|	БазаСреднегоЗаработка.СубконтоДт1Разрез КАК СубконтоДт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт2Разрез КАК СубконтоДт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДт3Разрез КАК СубконтоДт3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт1Разрез КАК СубконтоКт1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт2Разрез КАК СубконтоКт2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКт3Разрез КАК СубконтоКт3Разрез,
		|	БазаСреднегоЗаработка.СчетДтНУРазрез КАК СчетДтНУРазрез,
		|	БазаСреднегоЗаработка.СчетКтНУРазрез КАК СчетКтНУРазрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ1Разрез КАК СубконтоДтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ2Разрез КАК СубконтоДтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоДтНУ3Разрез КАК СубконтоДтНУ3Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ1Разрез КАК СубконтоКтНУ1Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ2Разрез КАК СубконтоКтНУ2Разрез,
		|	БазаСреднегоЗаработка.СубконтоКтНУ3Разрез КАК СубконтоКтНУ3Разрез,
		|	БазаСреднегоЗаработка.ОтражениеВУСНРазрез КАК ОтражениеВУСНРазрез,
		|	БазаСреднегоЗаработка.РезультатБаза КАК РезультатБаза,
		|	ЕСТЬNULL(ВЫБОР
		|			КОГДА ДанныеУчета.ПериодДействия >= &ДатаЗакона255ФЗ
		|				ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(РазмерыММОТ.Размер, 0) * (ЕСТЬNULL(ДанныеФПД.КалендарныхДней, 0) / ДЕНЬ(КОНЕЦПЕРИОДА(ДанныеУчета.ПериодДействия, МЕСЯЦ))) КАК ЧИСЛО(10, 2))
		|			КОГДА ЕСТЬNULL(ДанныеГрафика.ОсновноеЗначениеПериодДействия, 0) = 0
		|				ТОГДА 0
		|			ИНАЧЕ ВЫРАЗИТЬ(ЕСТЬNULL(РазмерыММОТ.Размер, 0) / ДанныеГрафика.ОсновноеЗначениеПериодДействия * ЕСТЬNULL(ДанныеГрафика.ОсновноеЗначениеФактическийПериодДействия, 0) КАК ЧИСЛО(10, 2))
		|		КОНЕЦ, 0) КАК ВПределахММОТ,
		|	ЕСТЬNULL(ДанныеУчетаБЛ.ДоляБЛЗаСчетРаботодателя, 0) КАК ДоляБЛЗаСчетРаботодателя,
		|	ДанныеУчета.ВидРасчета.Наименование,
		|	ОтражениеВУчетеСторно.КодДоходаЕСН КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ОтражениеВУчетеСторно.СчетДт КАК СчетДт,
		|	ОтражениеВУчетеСторно.СубконтоДт1,
		|	ОтражениеВУчетеСторно.СубконтоДт2,
		|	ОтражениеВУчетеСторно.СубконтоДт3,
		|	ОтражениеВУчетеСторно.СчетКт,
		|	ОтражениеВУчетеСторно.СубконтоКт1,
		|	ОтражениеВУчетеСторно.СубконтоКт2,
		|	ОтражениеВУчетеСторно.СубконтоКт3,
		|	ОтражениеВУчетеСторно.СчетДтНУ,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ1,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ2,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ3,
		|	ОтражениеВУчетеСторно.СчетКтНУ,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ1,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ2,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ3,
		|	ОтражениеВУчетеСторно.СчетКтУСН,
		|	ОтражениеВУчетеСторно.ОтражениеВУСН,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно
		|ИЗ
		|	(ВЫБРАТЬ
		|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|		ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|		ОсновныеНачисления.ФизЛицо КАК ФизЛицо,
		|		ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|		ОсновныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|		ОсновныеНачисления.Результат КАК Результат,
		|		ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|		ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|		ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|		ОсновныеНачисления.Сторно КАК Сторно,
		|		ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|		ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|		ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|	ИЗ
		|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|	ГДЕ
		|		ОсновныеНачисления.Регистратор = &Регистратор
		|		И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)) КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ БазаСреднегоЗаработка КАК БазаСреднегоЗаработка
		|		ПО ДанныеУчета.НомерСтроки = БазаСреднегоЗаработка.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ДатыАктуальностиММОТ.Регистратор КАК Регистратор,
		|			ДатыАктуальностиММОТ.НомерСтроки КАК ОсновнойНомерСтроки,
		|			МинимальнаяОплатаТрудаРФ.Размер КАК Размер
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ОсновныеНачисления.Регистратор КАК Регистратор,
		|				ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|				МАКСИМУМ(МинимальнаяОплатаТрудаРФ.Период) КАК ДатаАктуальности
		|			ИЗ
		|				РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
		|					ПО (МинимальнаяОплатаТрудаРФ.Период <= ОсновныеНачисления.ПериодДействияНачало)
		|			ГДЕ
		|				ОсновныеНачисления.Регистратор = &Регистратор
		|				И (НЕ ОсновныеНачисления.Сторно)
		|				И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ОсновныеНачисления.НомерСтроки,
		|				ОсновныеНачисления.Регистратор) КАК ДатыАктуальностиММОТ
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
		|				ПО (МинимальнаяОплатаТрудаРФ.Период = ДатыАктуальностиММОТ.ДатаАктуальности)) КАК РазмерыММОТ
		|		ПО ДанныеУчета.НомерСтроки = РазмерыММОТ.ОсновнойНомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ДанныеГрафика(
		|				ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|					И (НЕ Сторно)
		|					И Регистратор = &Регистратор) КАК ДанныеГрафика
		|		ПО ДанныеУчета.НомерСтроки = ДанныеГрафика.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|			СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|		ИЗ
		|			РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|					ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|						И (НЕ Сторно)
		|						И Регистратор = &Регистратор) КАК ФактическийПериодДействияЗаписей
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ФактическийПериодДействияЗаписей.НомерСтроки) КАК ДанныеФПД
		|		ПО ДанныеУчета.НомерСтроки = ДанныеФПД.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ОсновныеНачисления.Регистратор КАК Регистратор,
		|			ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|			ЕСТЬNULL(ВЫБОР
		|					КОГДА ОсновныеНачисления.ДатаНачалаСобытия >= &ДатаЗакона255ФЗ
		|						ТОГДА ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя / ФактическийПериодДействияЗаписей.КалендарныхДней
		|					КОГДА ВЫБОР
		|							КОГДА ОсновныеНачисления.ВидУчетаВремени = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
		|								ТОГДА ОсновныеНачисления.НормаДней
		|							ИНАЧЕ ОсновныеНачисления.НормаЧасов
		|						КОНЕЦ = 0
		|						ТОГДА 0
		|					ИНАЧЕ СУММА(ГрафикиРаботыПоВидамВремени.ОсновноеЗначение) / ВЫБОР
		|							КОГДА ОсновныеНачисления.ВидУчетаВремени = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
		|								ТОГДА ОсновныеНачисления.НормаДней
		|							ИНАЧЕ ОсновныеНачисления.НормаЧасов
		|						КОНЕЦ
		|				КОНЕЦ, 0) КАК ДоляБЛЗаСчетРаботодателя
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ОсновныеНачисления.Регистратор КАК Регистратор,
		|				ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|				ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|				ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|				ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|				ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|				ОсновныеНачисления.НормаДней КАК НормаДней,
		|				ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|				ОсновныеНачисления.НормаЧасов КАК НормаЧасов
		|			ИЗ
		|				РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|			ГДЕ
		|				ОсновныеНачисления.Регистратор = &Регистратор
		|				И (НЕ ОсновныеНачисления.Сторно)
		|				И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|				И РАЗНОСТЬДАТ(ОсновныеНачисления.ДатаНачалаСобытия, ОсновныеНачисления.ПериодДействияНачало, ДЕНЬ) < 2
		|				И ОсновныеНачисления.ДатаНачалаСобытия >= &ДатаЗакона202ФЗ) КАК ОсновныеНачисления
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикиРаботыПоВидамВремени КАК ГрафикиРаботыПоВидамВремени
		|				ПО ОсновныеНачисления.ГрафикРаботы = ГрафикиРаботыПоВидамВремени.ГрафикРаботы
		|					И ОсновныеНачисления.ВидУчетаВремени = ГрафикиРаботыПоВидамВремени.ВидУчетаВремени
		|					И (ОсновныеНачисления.ПериодДействия < &ДатаЗакона255ФЗ)
		|					И ОсновныеНачисления.ПериодДействияНачало <= ГрафикиРаботыПоВидамВремени.Дата
		|					И (ДОБАВИТЬКДАТЕ(ОсновныеНачисления.ДатаНачалаСобытия, ДЕНЬ, 1) >= ГрафикиРаботыПоВидамВремени.Дата)
		|					И ОсновныеНачисления.ПериодДействияКонец >= ГрафикиРаботыПоВидамВремени.Дата
		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|					СУММА(ВЫБОР
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало = ФактическийПериодДействияЗаписей.ДатаНачалаСобытия
		|								ТОГДА ВЫБОР
		|										КОГДА ФактическийПериодДействияЗаписей.ПериодДействияКонец >= ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|											ТОГДА 2
		|										ИНАЧЕ 1
		|									КОНЕЦ
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало > ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|								ТОГДА 0
		|							ИНАЧЕ 1
		|						КОНЕЦ) КАК ДнейЗаСчетРаботодателя,
		|					СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|				ИЗ
		|					РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|							ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|								И Регистратор = &Регистратор
		|								И (НЕ Сторно)
		|								И ДатаНачалаСобытия >= &ДатаЗакона255ФЗ) КАК ФактическийПериодДействияЗаписей
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ФактическийПериодДействияЗаписей.НомерСтроки) КАК ФактическийПериодДействияЗаписей
		|				ПО ОсновныеНачисления.НомерСтроки = ФактическийПериодДействияЗаписей.НомерСтроки
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ОсновныеНачисления.Регистратор,
		|			ОсновныеНачисления.ВидУчетаВремени,
		|			ОсновныеНачисления.ДатаНачалаСобытия,
		|			ОсновныеНачисления.ПериодДействияНачало,
		|			ОсновныеНачисления.ПериодДействияКонец,
		|			ОсновныеНачисления.НормаЧасов,
		|			ОсновныеНачисления.НормаДней,
		|			ОсновныеНачисления.НомерСтроки,
		|			ФактическийПериодДействияЗаписей.КалендарныхДней,
		|			ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя) КАК ДанныеУчетаБЛ
		|		ПО ДанныеУчета.НомерСтроки = ДанныеУчетаБЛ.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ДанныеУчета.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	СчетДтРазрез,
		|	СчетДт
		|АВТОУПОРЯДОЧИВАНИЕ";
		
		Запрос.Текст = ТекстЗапроса;
		РезультатЗапроса = Запрос.Выполнить();
		
		Возврат РезультатЗапроса;
		
	Иначе
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	&Организация КАК Организация,
		|	&ОбособленноеПодразделение КАК ОбособленноеПодразделение,
		|	&ПериодРегистрации КАК ПериодРегистрации,
		|	ДанныеУчета.НомерСтроки КАК НомерСтроки,
		|	ДанныеУчета.Сотрудник,
		|	ДанныеУчета.ФизЛицо,
		|	ДанныеУчета.ВидРасчета,
		|	ДанныеУчета.Сторно,
		|	ДанныеУчета.Результат,
		|	ЕСТЬNULL(ОтражениеВУчетеСторно.ПериодДействияНачало, ДанныеУчета.ПериодДействияНачало) КАК ПериодДействияНачало,
		|	ЕСТЬNULL(ОтражениеВУчетеСторно.ПериодДействияКонец, ДанныеУчета.ПериодДействияКонец) КАК ПериодДействияКонец,
		|	ДанныеУчета.ГрафикРаботы,
		|	ДанныеУчета.ВидУчетаВремени,
		|	ДанныеУчета.ДатаНачалаСобытия,
		|	ЕСТЬNULL(ВЫБОР
		|			КОГДА ДанныеУчета.ПериодДействия >= &ДатаЗакона255ФЗ
		|				ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(РазмерыММОТ.Размер, 0) * (ЕСТЬNULL(ДанныеФПД.КалендарныхДней, 0) / ДЕНЬ(КОНЕЦПЕРИОДА(ДанныеУчета.ПериодДействия, МЕСЯЦ))) КАК ЧИСЛО(10, 2))
		|			КОГДА ЕСТЬNULL(ДанныеГрафика.ОсновноеЗначениеПериодДействия, 0) = 0
		|				ТОГДА 0
		|			ИНАЧЕ ВЫРАЗИТЬ(ЕСТЬNULL(РазмерыММОТ.Размер, 0) / ДанныеГрафика.ОсновноеЗначениеПериодДействия * ЕСТЬNULL(ДанныеГрафика.ОсновноеЗначениеФактическийПериодДействия, 0) КАК ЧИСЛО(10, 2))
		|		КОНЕЦ, 0) КАК ВПределахММОТ,
		|	ЕСТЬNULL(ДанныеУчетаБЛ.ДоляБЛЗаСчетРаботодателя, 0) КАК ДоляБЛЗаСчетРаботодателя,
		|	ДанныеУчета.ВидРасчета.Наименование,
		|	ЛОЖЬ КАК ЭтоЕНВД,
		|	ОтражениеВУчетеСторно.КодДоходаЕСН КАК КодДоходаЕСН,
		|	ОтражениеВУчетеСторно.ОблагаетсяЕНВД КАК ОблагаетсяЕНВД,
		|	ОтражениеВУчетеСторно.СчетДт,
		|	ОтражениеВУчетеСторно.СубконтоДт1,
		|	ОтражениеВУчетеСторно.СубконтоДт2,
		|	ОтражениеВУчетеСторно.СубконтоДт3,
		|	ОтражениеВУчетеСторно.СчетКт,
		|	ОтражениеВУчетеСторно.СубконтоКт1,
		|	ОтражениеВУчетеСторно.СубконтоКт2,
		|	ОтражениеВУчетеСторно.СубконтоКт3,
		|	ОтражениеВУчетеСторно.СчетДтНУ,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ1,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ2,
		|	ОтражениеВУчетеСторно.СубконтоДтНУ3,
		|	ОтражениеВУчетеСторно.СчетКтНУ,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ1,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ2,
		|	ОтражениеВУчетеСторно.СубконтоКтНУ3,
		|	ОтражениеВУчетеСторно.СчетКтУСН,
		|	ОтражениеВУчетеСторно.ОтражениеВУСН,
		|	ОтражениеВУчетеСторно.Результат КАК РезультатСторно
		|ИЗ
		|	(ВЫБРАТЬ
		|		ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|		ОсновныеНачисления.Сотрудник КАК Сотрудник,
		|		ОсновныеНачисления.ФизЛицо КАК ФизЛицо,
		|		ОсновныеНачисления.ВидРасчета КАК ВидРасчета,
		|		ОсновныеНачисления.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
		|		ОсновныеНачисления.Результат КАК Результат,
		|		ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|		ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|		ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|		ОсновныеНачисления.Сторно КАК Сторно,
		|		ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|		ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|		ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия
		|	ИЗ
		|		РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|	ГДЕ
		|		ОсновныеНачисления.Регистратор = &Регистратор
		|		И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)) КАК ДанныеУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ДатыАктуальностиММОТ.Регистратор КАК Регистратор,
		|			ДатыАктуальностиММОТ.НомерСтроки КАК ОсновнойНомерСтроки,
		|			МинимальнаяОплатаТрудаРФ.Размер КАК Размер
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ОсновныеНачисления.Регистратор КАК Регистратор,
		|				ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|				МАКСИМУМ(МинимальнаяОплатаТрудаРФ.Период) КАК ДатаАктуальности
		|			ИЗ
		|				РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
		|					ПО (МинимальнаяОплатаТрудаРФ.Период <= ОсновныеНачисления.ПериодДействияНачало)
		|			ГДЕ
		|				ОсновныеНачисления.Регистратор = &Регистратор
		|				И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|				И (НЕ ОсновныеНачисления.Сторно)
		|			
		|			СГРУППИРОВАТЬ ПО
		|				ОсновныеНачисления.НомерСтроки,
		|				ОсновныеНачисления.Регистратор) КАК ДатыАктуальностиММОТ
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
		|				ПО (МинимальнаяОплатаТрудаРФ.Период = ДатыАктуальностиММОТ.ДатаАктуальности)) КАК РазмерыММОТ
		|		ПО ДанныеУчета.НомерСтроки = РазмерыММОТ.ОсновнойНомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ДанныеГрафика(
		|				ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|					И (НЕ Сторно)
		|					И Регистратор = &Регистратор) КАК ДанныеГрафика
		|		ПО ДанныеУчета.НомерСтроки = ДанныеГрафика.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|			СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|		ИЗ
		|			РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|					ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|						И (НЕ Сторно)
		|						И Регистратор = &Регистратор) КАК ФактическийПериодДействияЗаписей
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ФактическийПериодДействияЗаписей.НомерСтроки) КАК ДанныеФПД
		|		ПО ДанныеУчета.НомерСтроки = ДанныеФПД.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			ОсновныеНачисления.Регистратор КАК Регистратор,
		|			ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|			ЕСТЬNULL(ВЫБОР
		|					КОГДА ОсновныеНачисления.ДатаНачалаСобытия >= &ДатаЗакона255ФЗ
		|						ТОГДА ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя / ФактическийПериодДействияЗаписей.КалендарныхДней
		|					КОГДА ВЫБОР
		|							КОГДА ОсновныеНачисления.ВидУчетаВремени = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
		|								ТОГДА ОсновныеНачисления.НормаДней
		|							ИНАЧЕ ОсновныеНачисления.НормаЧасов
		|						КОНЕЦ = 0
		|						ТОГДА 0
		|					ИНАЧЕ СУММА(ГрафикиРаботыПоВидамВремени.ОсновноеЗначение) / ВЫБОР
		|							КОГДА ОсновныеНачисления.ВидУчетаВремени = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
		|								ТОГДА ОсновныеНачисления.НормаДней
		|							ИНАЧЕ ОсновныеНачисления.НормаЧасов
		|						КОНЕЦ
		|				КОНЕЦ, 0) КАК ДоляБЛЗаСчетРаботодателя
		|		ИЗ
		|			(ВЫБРАТЬ
		|				ОсновныеНачисления.Регистратор КАК Регистратор,
		|				ОсновныеНачисления.НомерСтроки КАК НомерСтроки,
		|				ОсновныеНачисления.ПериодДействия КАК ПериодДействия,
		|				ОсновныеНачисления.ПериодДействияНачало КАК ПериодДействияНачало,
		|				ОсновныеНачисления.ПериодДействияКонец КАК ПериодДействияКонец,
		|				ОсновныеНачисления.ГрафикРаботы КАК ГрафикРаботы,
		|				ОсновныеНачисления.ВидУчетаВремени КАК ВидУчетаВремени,
		|				ОсновныеНачисления.НормаДней КАК НормаДней,
		|				ОсновныеНачисления.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
		|				ОсновныеНачисления.НормаЧасов КАК НормаЧасов
		|			ИЗ
		|				РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисления
		|			ГДЕ
		|				ОсновныеНачисления.Регистратор = &Регистратор
		|				И ОсновныеНачисления.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|				И РАЗНОСТЬДАТ(ОсновныеНачисления.ДатаНачалаСобытия, ОсновныеНачисления.ПериодДействияНачало, ДЕНЬ) < 2
		|				И ОсновныеНачисления.ДатаНачалаСобытия >= &ДатаЗакона202ФЗ
		|				И (НЕ ОсновныеНачисления.Сторно)) КАК ОсновныеНачисления
		|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикиРаботыПоВидамВремени КАК ГрафикиРаботыПоВидамВремени
		|				ПО ОсновныеНачисления.ГрафикРаботы = ГрафикиРаботыПоВидамВремени.ГрафикРаботы
		|					И ОсновныеНачисления.ВидУчетаВремени = ГрафикиРаботыПоВидамВремени.ВидУчетаВремени
		|					И (ОсновныеНачисления.ПериодДействия < &ДатаЗакона255ФЗ)
		|					И ОсновныеНачисления.ПериодДействияНачало <= ГрафикиРаботыПоВидамВремени.Дата
		|					И (ДОБАВИТЬКДАТЕ(ОсновныеНачисления.ДатаНачалаСобытия, ДЕНЬ, 1) >= ГрафикиРаботыПоВидамВремени.Дата)
		|					И ОсновныеНачисления.ПериодДействияКонец >= ГрафикиРаботыПоВидамВремени.Дата
		|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|					ФактическийПериодДействияЗаписей.НомерСтроки КАК НомерСтроки,
		|					СУММА(ВЫБОР
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало = ФактическийПериодДействияЗаписей.ДатаНачалаСобытия
		|								ТОГДА ВЫБОР
		|										КОГДА ФактическийПериодДействияЗаписей.ПериодДействияКонец >= ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|											ТОГДА 2
		|										ИНАЧЕ 1
		|									КОНЕЦ
		|							КОГДА ФактическийПериодДействияЗаписей.ПериодДействияНачало > ДОБАВИТЬКДАТЕ(ФактическийПериодДействияЗаписей.ДатаНачалаСобытия, ДЕНЬ, 1)
		|								ТОГДА 0
		|							ИНАЧЕ 1
		|						КОНЕЦ) КАК ДнейЗаСчетРаботодателя,
		|					СУММА(РАЗНОСТЬДАТ(ФактическийПериодДействияЗаписей.ПериодДействияНачало, НАЧАЛОПЕРИОДА(ФактическийПериодДействияЗаписей.ПериодДействияКонец, ДЕНЬ), ДЕНЬ) + 1) КАК КалендарныхДней
		|				ИЗ
		|					РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций.ФактическийПериодДействия(
		|							ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС)
		|								И (НЕ Сторно)
		|								И Регистратор = &Регистратор
		|								И ДатаНачалаСобытия >= &ДатаЗакона255ФЗ) КАК ФактическийПериодДействияЗаписей
		|				
		|				СГРУППИРОВАТЬ ПО
		|					ФактическийПериодДействияЗаписей.НомерСтроки) КАК ФактическийПериодДействияЗаписей
		|				ПО ОсновныеНачисления.НомерСтроки = ФактическийПериодДействияЗаписей.НомерСтроки
		|		
		|		СГРУППИРОВАТЬ ПО
		|			ОсновныеНачисления.Регистратор,
		|			ОсновныеНачисления.ВидУчетаВремени,
		|			ОсновныеНачисления.ДатаНачалаСобытия,
		|			ОсновныеНачисления.ПериодДействияНачало,
		|			ОсновныеНачисления.ПериодДействияКонец,
		|			ОсновныеНачисления.НормаЧасов,
		|			ОсновныеНачисления.НормаДней,
		|			ОсновныеНачисления.НомерСтроки,
		|			ФактическийПериодДействияЗаписей.КалендарныхДней,
		|			ФактическийПериодДействияЗаписей.ДнейЗаСчетРаботодателя) КАК ДанныеУчетаБЛ
		|		ПО ДанныеУчета.НомерСтроки = ДанныеУчетаБЛ.НомерСтроки
		|			И ((НЕ ДанныеУчета.Сторно))
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОтражениеВУчетеСторно КАК ОтражениеВУчетеСторно
		|		ПО ДанныеУчета.НомерСтроки = ОтражениеВУчетеСторно.НомерСтроки
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ОтражениеВУчетеСторно.СчетДт
		|АВТОУПОРЯДОЧИВАНИЕ";
		
		Запрос.Текст = ТекстЗапроса;
		
		Возврат Запрос.Выполнить();
		
	КонецЕсли;	
	
КонецФункции  // ПолучитьДанныеУчета

// создает строку таблицы данных учета
// 
// Параметры:
//	ДанныеУчета - спозиционированная выборка по результату запроса
//	НаборЗаписей
//
Функция СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей)
	
	СтрокаДанных = НаборЗаписей.Добавить();
	
	ЗаполнитьЗначенияСвойств(СтрокаДанных,ДанныеУчета,"Результат,ПериодДействияНачало, ПериодДействияКонец, Сторно");
	
	Возврат СтрокаДанных;
	
КонецФункции // СоздатьСтрокуДвижений()

// Формирует соответствие в котором находятся действующие графики сотрудника 
// на указанные даты
Функция ПолучитьГрафикРаботыСотрудника(ВыборкаПоШапкеДокумента)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	//толик	Запрос.УстановитьПараметр("Физлицо",			ВыборкаПоШапкеДокумента.Физлицо);
	Запрос.УстановитьПараметр("КонецПериода",			ДатаОкончания);
	Запрос.УстановитьПараметр("Сотрудник",			ВыборкаПоШапкеДокумента.Сотрудник);
	Запрос.УстановитьПараметр("Дата",				ВыборкаПоШапкеДокумента.ДатаНачалаСобытия);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",ВыборкаПоШапкеДокумента.Организация);
	Запрос.УстановитьПараметр("ПоВсемМестамРаботы",	ВыборкаПоШапкеДокумента.ДатаНачалаСобытия >= мДатаЗакона180ФЗ);
	Запрос.УстановитьПараметр("ВидРасчета",			ВыборкаПоШапкеДокумента.ВидРасчета);
	Запрос.УстановитьПараметр("РасчетПоКалендарнымДням",ВыборкаПоШапкеДокумента.ДатаНачалаСобытия >= мДатаЗакона255ФЗ);
	Запрос.УстановитьПараметр("СпособРасчетаВДнях",			ВыборкаПоШапкеДокумента.СпособРасчетаВДнях);
	
	НачМесяца = НачалоМесяца(ДатаНачала);
	ДатыПоМесяцамТекст = "ВЫБРАТЬ ДАТАВРЕМЯ(" + Формат(НачМесяца,"ДФ=гггг,М,д,Ч,м,с") + ") КАК Период
	|ПОМЕСТИТЬ ВТДатыПоМесяцам";
	Пока НачМесяца < НачалоМесяца(ДатаОкончания) Цикл
		НачМесяца = НачалоМесяца(КонецМесяца(НачМесяца) + 1);
		ДатыПоМесяцамТекст = ДатыПоМесяцамТекст +"
		|ОБЪЕДИНИТЬ ВСЕ ВЫБРАТЬ ДАТАВРЕМЯ(" + Формат(НачМесяца,"ДФ=гггг,М,д,Ч,м,с") + ")";
	КонецЦикла;
	ДатыПоМесяцамТекст = ДатыПоМесяцамТекст + "
	|ИНДЕКСИРОВАТЬ ПО Период";
	
	Запрос.Текст = ДатыПоМесяцамТекст;
	Запрос.Выполнить();
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДатыПоследнихДоговоров.ПериодРегистрации КАК Период,
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник КАК Сотрудник,
	|	ДоговорНаВыполнениеРаботСФизЛицом.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	|	ВЫБОР
	|		КОГДА &СпособРасчетаВДнях
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоЧасам)
	|	КОНЕЦ КАК ВидУчетаВремени
	|ПОМЕСТИТЬ ВТСотрудникиДаты
	|ИЗ
	|	(ВЫБРАТЬ
	|		Договора.Физлицо КАК Физлицо,
	|		Договора.Организация КАК Организация,
	|		МАКСИМУМ(Договора.ДатаНачала) КАК ДатаНачала,
	|		Периоды.Период КАК ПериодРегистрации,
	|		МАКСИМУМ(РаботникиОрганизаций.Период) КАК Период
	|	ИЗ
	|		ВТДатыПоМесяцам КАК Периоды
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|				ДоговорНаВыполнениеРаботСФизЛицом.ФизЛицо КАК Физлицо,
	|				ДоговорНаВыполнениеРаботСФизЛицом.Организация КАК Организация,
	|				ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала КАК ДатаНачала,
	|				ДоговорНаВыполнениеРаботСФизЛицом.ДатаОкончания КАК ДатаОкончания
	|			ИЗ
	|				Документ.ДоговорНаВыполнениеРаботСФизЛицом КАК ДоговорНаВыполнениеРаботСФизЛицом
	|			ГДЕ
	|				ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала <= &КонецПериода
	|				И ДоговорНаВыполнениеРаботСФизЛицом.Проведен
	|			{ГДЕ
	|				ДоговорНаВыполнениеРаботСФизЛицом.ФизЛицо.*,
	|				ДоговорНаВыполнениеРаботСФизЛицом.Организация.*,
	|				ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.*}) КАК Договора
	|			ПО (Договора.ДатаНачала <= КОНЕЦПЕРИОДА(Периоды.Период, МЕСЯЦ))
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
	|			ПО (Договора.Физлицо = РаботникиОрганизаций.Сотрудник.Физлицо)
	|				И (ВЫБОР
	|					КОГДА Договора.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|						ТОГДА Договора.Организация
	|					ИНАЧЕ Договора.Организация.ГоловнаяОрганизация
	|				КОНЕЦ = РаботникиОрганизаций.Организация)
	|				И (КОНЕЦПЕРИОДА(Периоды.Период, МЕСЯЦ) >= РаботникиОрганизаций.Период)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Договора.Физлицо,
	|		Договора.Организация,
	|		Периоды.Период) КАК ДатыПоследнихДоговоров
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ДоговорНаВыполнениеРаботСФизЛицом КАК ДоговорНаВыполнениеРаботСФизЛицом
	|		ПО ДатыПоследнихДоговоров.Физлицо = ДоговорНаВыполнениеРаботСФизЛицом.ФизЛицо
	|			И ДатыПоследнихДоговоров.Организация = ДоговорНаВыполнениеРаботСФизЛицом.Организация
	|			И ДатыПоследнихДоговоров.ДатаНачала = ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала
	|			И (ДоговорНаВыполнениеРаботСФизЛицом.Проведен)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
	|		ПО ДатыПоследнихДоговоров.Физлицо = РаботникиОрганизаций.Сотрудник.Физлицо
	|			И (ВЫБОР
	|				КОГДА ДатыПоследнихДоговоров.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|					ТОГДА ДатыПоследнихДоговоров.Организация
	|				ИНАЧЕ ДатыПоследнихДоговоров.Организация.ГоловнаяОрганизация
	|			КОНЕЦ = РаботникиОрганизаций.Организация)
	|ГДЕ
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник = &Сотрудник
	|{ГДЕ
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.*,
	|	ДоговорНаВыполнениеРаботСФизЛицом.Организация.*,
	|	ДоговорНаВыполнениеРаботСФизЛицом.ФизЛицо.*,
	|	ДоговорНаВыполнениеРаботСФизЛицом.ПодразделениеОрганизации.*,
	|	(ЗНАЧЕНИЕ(Справочник.ДолжностиОрганизаций.ПустаяСсылка)).* КАК Должность,
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.Код КАК ТабельныйНомерНачало,
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.Код КАК ТабельныйНомерКонец}
	|
	|СГРУППИРОВАТЬ ПО
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник.ВидДоговора,
	|	ДоговорНаВыполнениеРаботСФизЛицом.Сотрудник,
	|	ДоговорНаВыполнениеРаботСФизЛицом.ПодразделениеОрганизации,
	|	ДатыПоследнихДоговоров.ПериодРегистрации
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Период,
	|	Сотрудник";
	Запрос.Выполнить();
	
	//заявка №1744 (база заявок Кристалла) Дмитрук О.Г.
	
	//Запрос.Текст = 
	//"ВЫБРАТЬ РАЗЛИЧНЫЕ
	//|	ПериодыДействия.Период КАК Период,
	//|	ГрафикиРаботыПоВидамВремени.План,
	//|	ПериодыДействия.Сотрудник КАК Сотрудник
	//|ПОМЕСТИТЬ ВТДанныеИндивидуальныхГрафиковИТабелей
	//|ИЗ
	//|	ВТСотрудникиДаты КАК ПериодыДействия
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикиРаботыПоВидамВремени КАК ГрафикиРаботыПоВидамВремени
	//|		ПО ПериодыДействия.Сотрудник = ГрафикиРаботыПоВидамВремени.ГрафикРаботы
	//|			И ПериодыДействия.Период = ГрафикиРаботыПоВидамВремени.Месяц
	//|ГДЕ
	//|	ГрафикиРаботыПоВидамВремени.План ЕСТЬ НЕ NULL 
	//|
	//|ИНДЕКСИРОВАТЬ ПО
	//|	Период,
	//|	Сотрудник";
	//Запрос.Выполнить();
	
	//Запрос.Текст =
	//"ВЫБРАТЬ РАЗЛИЧНЫЕ
	//|	ПериодыДействия.Период КАК Период,
	//|	ПериодыДействия.Сотрудник КАК Сотрудник
	//|ПОМЕСТИТЬ ВТСводныеИндивидуальныеГрафикиРаботы
	//|ИЗ
	//|	ВТСотрудникиДаты КАК ПериодыДействия
	//|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СводныеИндивидуальныеГрафики КАК СводныеИндивидуальныеГрафики
	//|		ПО ПериодыДействия.Сотрудник = СводныеИндивидуальныеГрафики.Сотрудник
	//|			И ПериодыДействия.Период = СводныеИндивидуальныеГрафики.Месяц
	//|ГДЕ
	//|	СводныеИндивидуальныеГрафики.Сотрудник ЕСТЬ НЕ NULL 
	//|
	//|ИНДЕКСИРОВАТЬ ПО
	//|	Период,
	//|	Сотрудник";
	//Запрос.Выполнить();
	
	//заявка №1744
	
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПериодыДействия.Сотрудник КАК Сотрудник,
	|	ПериодыДействия.Сотрудник.ВидЗанятости КАК ВидЗанятостиСотрудника,
	|	ПериодыДействия.Период КАК Месяц,
	|	ПериодыДействия.ВидУчетаВремени,
	|	ПериодыДействия.ПодразделениеОрганизации,
	|	Значение(Справочник.ГрафикиРаботы.ПустаяСсылка) как ГрафикРаботы
	
	//заявка №1744 (база заявок Кристалла) Дмитрук О.Г.
	
	//|	ВЫБОР
	//|		КОГДА ТабелиУчетаВремениПоСотруднику.Период ЕСТЬ NULL 
	//|			ТОГДА ПериодыДействия.ГрафикРаботы
	//|		ИНАЧЕ ПериодыДействия.Сотрудник
	//|	КОНЕЦ КАК ГрафикРаботы
	//|	ВЫБОР
	//|		КОГДА ИндивидуальныеГрафикиРаботы.Период ЕСТЬ NULL 
	//|				И СводныеИндивидуальныеГрафикиРаботы.Период ЕСТЬ NULL 
	//|				И ТабелиУчетаВремениПоСотруднику.Период ЕСТЬ НЕ NULL 
	//|			ТОГДА ПериодыДействия.ГрафикРаботы
	//|		КОГДА ПериодыДействия.ГрафикПолногоРабочегоВремени <> ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	//|				И (ИндивидуальныеГрафикиРаботы.Период ЕСТЬ НЕ NULL 
	//|					ИЛИ СводныеИндивидуальныеГрафикиРаботы.Период ЕСТЬ НЕ NULL )
	//|			ТОГДА ПериодыДействия.ГрафикПолногоРабочегоВремени
	//|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	//|	КОНЕЦ КАК ГрафикРаботыНорма
	
	//заявка №1744 
	
	|ИЗ
	|	ВТСотрудникиДаты КАК ПериодыДействия
	
	//заявка №1744 (база заявок Кристалла) Дмитрук О.Г.
	
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСводныеИндивидуальныеГрафикиРаботы КАК СводныеИндивидуальныеГрафикиРаботы
	//|		ПО ПериодыДействия.Период = СводныеИндивидуальныеГрафикиРаботы.Период
	//|			И ПериодыДействия.Сотрудник = СводныеИндивидуальныеГрафикиРаботы.Сотрудник
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИндивидуальныхГрафиковИТабелей КАК ИндивидуальныеГрафикиРаботы
	//|		ПО ПериодыДействия.Период = ИндивидуальныеГрафикиРаботы.Период
	//|			И ПериодыДействия.Сотрудник = ИндивидуальныеГрафикиРаботы.Сотрудник
	//|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеИндивидуальныхГрафиковИТабелей КАК ТабелиУчетаВремениПоСотруднику
	//|		ПО ПериодыДействия.Период = ТабелиУчетаВремениПоСотруднику.Период
	//|			И ((НЕ ТабелиУчетаВремениПоСотруднику.План))
	//|			И ПериодыДействия.Сотрудник = ТабелиУчетаВремениПоСотруднику.Сотрудник
	
	//заявка №1744
	
	|
	|УПОРЯДОЧИТЬ ПО
	|	Месяц,
	|	Сотрудник";
	
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции // ПолучитьГрафикРаботыСотрудника()

#Если Клиент Тогда
	
	Функция РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ДатаСобытия, ИспользоватьСреднеЧасовойЗаработок)
		
		Запрос = Новый Запрос;
		
		// определим использование среднечасового заработка
		Если ИспользоватьСреднеЧасовойЗаработок = Неопределено Тогда
			
			Запрос.УстановитьПараметр("ДатаНачалаСобытия",		ДатаСобытия);
			Запрос.УстановитьПараметр("Сотрудник",				Сотрудник);
			
			ТекстЗапроса = 
			"ВЫБРАТЬ
			|	ВЫБОР
			|		КОГДА РаботникиОрганизацииСрезПоследних.ПериодЗавершения <= &ДатаНачалаСобытия
			|				И РаботникиОрганизацииСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
			|			ТОГДА ЕСТЬNULL(РаботникиОрганизацииСрезПоследних.ГрафикРаботыЗавершения.СуммированныйУчетРабочегоВремени, ЛОЖЬ)
			|		ИНАЧЕ ЕСТЬNULL(РаботникиОрганизацииСрезПоследних.ГрафикРаботы.СуммированныйУчетРабочегоВремени, ЛОЖЬ)
			|	КОНЕЦ КАК ИспользоватьСреднеЧасовойЗаработок
			|ИЗ
			|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаНачалаСобытия, Сотрудник = &Сотрудник) КАК РаботникиОрганизацииСрезПоследних";
			
			Запрос.Текст = ТекстЗапроса;
			
			Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
			
			Результат = Запрос.Выполнить();
			ИспользоватьСреднеЧасовойЗаработок = Ложь;
			Если Не Результат.Пустой() Тогда
				Выборка = Результат.Выбрать();
				Выборка.Следующий();
				ИспользоватьСреднеЧасовойЗаработок = Выборка.ИспользоватьСреднеЧасовойЗаработок;
			КонецЕсли;
			
			
		КонецЕсли;	
		
		Если РучнойРасчетСреднегоЗаработка тогда 
			Возврат РазмерСреднегоЗаработка; 
		Иначе 
			ОсновнойЗаработок = Новый Массив(2);
			ОсновнойЗаработок[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
			
			
			ФиксированныеПремии = Новый Массив(2);
			ФиксированныеПремии[0] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
			
			ПоПремиям = Новый Массив(5);
			ПоПремиям[0] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
			ПоПремиям[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
			ПоПремиям[2] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
			
			
			Запрос.УстановитьПараметр("ИспользоватьСреднеЧасовойЗаработок", ИспользоватьСреднеЧасовойЗаработок);
			Запрос.УстановитьПараметр("СписокСоставляющихСреднегоЗаработка",СписокСоставляющихСреднегоЗаработка);
			Запрос.УстановитьПараметр("ОсновнойЗаработок",					ОсновнойЗаработок);
			
			Запрос.УстановитьПараметр("ПоПремиям",							ПоПремиям);
			Запрос.УстановитьПараметр("ВсеФиксированныеПремии",				ФиксированныеПремии);
			//Запрос.УстановитьПараметр("РасчетныйПериодНачало",				ДобавитьМесяц(НачалоМесяца(ДатаСобытия), - ПродолжительностьРасчетногоПериода));
			//Запрос.УстановитьПараметр("РасчетныйПериодОкончание",			НачалоДня(НачалоМесяца(ДатаСобытия) - 1));
			//Запрос.УстановитьПараметр("ПродолжительностьРасчетногоПериода",	ПродолжительностьРасчетногоПериода);
			Запрос.УстановитьПараметр("Сотрудник", 							Сотрудник);
			
			МенеджерВТ = Новый МенеджерВременныхТаблиц;
			Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
			
			ТекстЗапроса = 
			"ВЫБРАТЬ
			|	РасчетСреднегоЗаработка.ВидРасчета,
			|	РасчетСреднегоЗаработка.Результат,
			|	РасчетСреднегоЗаработка.КоэффициентИндексации,
			|	РасчетСреднегоЗаработка.Сотрудник,
			|	РасчетСреднегоЗаработка.ОтработаноДней,
			|	РасчетСреднегоЗаработка.ОтработаноЧасов,
			|	РасчетСреднегоЗаработка.НормаПоПятидневке,
			|	РасчетСреднегоЗаработка.ОтработаноПоПятидневке,
			|	РасчетСреднегоЗаработка.ЧислоМесяцев,
			|	РасчетСреднегоЗаработка.БазовыйПериодНачало,
			|	РасчетСреднегоЗаработка.БазовыйПериодКонец
			|ПОМЕСТИТЬ ВТ_РасчетСреднегоЗаработка
			|ИЗ
			|	&ТаблицаСреднего КАК РасчетСреднегоЗаработка";
			
			Запрос.УстановитьПараметр("ТаблицаСреднего",РасчетСреднего);
			Запрос.Текст = ТекстЗапроса;
			Результат = Запрос.Выполнить().Выгрузить(); 
			КоличествоСтрок = Результат[0].Количество;
			
			Если КоличествоСтрок = 0 Тогда
				Возврат 0;
			КонецЕсли;	
			
			Запрос.Текст =
			"ВЫБРАТЬ
			|	СУММА(РасчетСреднегоЗаработка.Результат * ВЫБОР
			|						КОГДА РасчетСреднегоЗаработка.КоэффициентИндексации < 1
			|							ТОГДА 1
			|						ИНАЧЕ РасчетСреднегоЗаработка.КоэффициентИндексации
			|					КОНЕЦ) КАК ВсегоЗаработка,
			|	СУММА(ВЫБОР
			|			КОГДА РасчетСреднегоЗаработка.ВидРасчета В (&ОсновнойЗаработок)
			|					И РасчетСреднегоЗаработка.Сотрудник = &Сотрудник
			|				ТОГДА ВЫБОР
			|						КОГДА &ИспользоватьСреднеЧасовойЗаработок
			|							ТОГДА РасчетСреднегоЗаработка.ОтработаноЧасов
			|						ИНАЧЕ РасчетСреднегоЗаработка.ОтработаноДней
			|					КОНЕЦ
			|			ИНАЧЕ 0
			|		КОНЕЦ) КАК ВсегоДнейРасчетногоПериода
			|ИЗ
			|	ВТ_РасчетСреднегоЗаработка КАК РасчетСреднегоЗаработка
			|ГДЕ
			|	(РасчетСреднегоЗаработка.Результат <> 0
			|			ИЛИ РасчетСреднегоЗаработка.ОтработаноДней <> 0
			|			ИЛИ РасчетСреднегоЗаработка.ОтработаноЧасов <> 0)
			|	И РасчетСреднегоЗаработка.ВидРасчета В(&СписокСоставляющихСреднегоЗаработка)";
			
			Результат = Запрос.Выполнить();
			
			Если Не Результат.Пустой() Тогда
				
				Выборка = Результат.Выбрать();
				Выборка.Следующий();
				//Островская Татьяна 17.04.2014 № 17287
				ТочностьСреднего = Константы.ТочностьСреднегоЗаработка.Получить();
				Если ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр0 Тогда 
					ЗначениеТочностьСреднего = 0;
				ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр1 Тогда 
					ЗначениеТочностьСреднего = 1;
				ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр2 Тогда 
					ЗначениеТочностьСреднего = 2;
				ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр3 Тогда 
					ЗначениеТочностьСреднего = 3;
				ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр4 Тогда 
					ЗначениеТочностьСреднего = 4;
				иначе
					ЗначениеТочностьСреднего = 0;
				КонецЕсли;
				Возврат ?(ЗначениеЗаполнено(ЗначениеТочностьСреднего), Окр(?(Выборка.ВсегоДнейРасчетногоПериода = NULL ИЛИ Выборка.ВсегоДнейРасчетногоПериода = 0,0, (Выборка.ВсегоЗаработка) / Выборка.ВсегоДнейРасчетногоПериода),ЗначениеТочностьСреднего),
				Окр(?(Выборка.ВсегоДнейРасчетногоПериода = NULL ИЛИ Выборка.ВсегоДнейРасчетногоПериода = 0,0, (Выборка.ВсегоЗаработка) / Выборка.ВсегоДнейРасчетногоПериода)));
				//Островская Татьяна 17.04.2014 № 17287
			КонецЕсли;
			
			Возврат 0;
		КонецЕсли;
		
	КонецФункции // РасчетСреднедневногоЗаработка()
	
#КонецЕсли

// Формирует записи регистра "ОсновныеНачисленияРаботниковОрганизаций" по данным шапки документа
//
Процедура СформироватьДвиженияПоНачислениям(ВыборкаПоШапкеДокумента, НаборОсновныеНачисления,ДобавлятьИзменения = Ложь,ЗапросПеребор = Неопределено,ТаблизаЗаписейДоп = Неопределено,ДатаНачДоговора = Неопределено,СписокДокументов = Неопределено) Экспорт
	
	СтрокаСвойствИзДокумента = "ПериодРегистрации,Сотрудник,ФизЛицо,Организация,ОбособленноеПодразделение,ДатаНачалаСобытия,ПериодРасчетаСреднегоЗаработкаНачало,ПериодРасчетаСреднегоЗаработкаОкончание,РучнойРасчетСреднегоЗаработка";
	
	ДатаНачалаСобытия = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия;
	ДатаОкончанияОплаты = ВыборкаПоШапкеДокумента.ДатаНачала + (ВыборкаПоШапкеДокумента.ДнейОплаты - 1) * мДлинаСуток;
	//ЭтоПереходныйПериодПоЗакону255ФЗ = ДатаНачалаСобытия < мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ДатаОкончания >= мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве;
	//ВариантАлгоритмаРасчета = ПолучитьВариантАлгоритмаРасчета(ЭтоПереходныйПериодПоЗакону255ФЗ);	
	БЛБезОплаты = ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОтсутствиеПоБолезниДоговора;
	
	// в зависимости от причины нетрудоспособности оплачивается разное количество дней; процент оплаты также меняется
	ТаблицаИнтерваловОплаты = ЗаполнитьТаблицуИнтервалов(ДатаНачалаСобытия, ВыборкаПоШапкеДокумента.ВидРасчета);
	// таблица значений с колонками:  Месяц, ГрафикРаботы, ГрафикРаботыНорма
	ГрафикиСотрудникаПоМесяцам = ПолучитьГрафикРаботыСотрудника(ВыборкаПоШапкеДокумента);
	ГрафикиСотрудникаПоМесяцам.Индексы.Добавить("Месяц");
	ЕстьДанныеОСотруднике = ГрафикиСотрудникаПоМесяцам.Количество() > 0;
	СтруктураПоиска = Новый Структура("Месяц");
	//О.Т. Аверсон 05.07.2018 № 
	
	Для Каждого ИнтервалОплаты Из ТаблицаИнтерваловОплаты Цикл
		
		НомерИнтервалаОплаты = ТаблицаИнтерваловОплаты.Индекс(ИнтервалОплаты);
		
		Если ИнтервалОплаты.Начало > ДатаОкончания Тогда
			Продолжить;
		КонецЕсли;
		Если НомерИнтервалаОплаты < 2 и ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало < ДатаНачала Тогда
			Продолжить;
		КонецЕсли;
		
		ОкончаниеИнтервалаОплаты = ?(НомерИнтервалаОплаты = 2, ДатаОкончания, Мин(ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток,ДатаОкончания));
		ОкончаниеИнтервалаОплатыНарушения = ?(НомерИнтервалаОплаты = 2, ДатаОкончания, Мин(ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток,ДатаОкончания));
		
		ТекущаяДатаНачала = Макс(ИнтервалОплаты.Начало, ДатаНачала);
		
		Если Не ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) Или ВыборкаПоШапкеДокумента.ДатаНарушенияРежима <= ТекущаяДатаНачала Тогда
			//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
			//если не ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.БольничныйЛистАлкоголь и КалендарныеДни Тогда //Островская Татьяна 02.10.2013 № 16645
			Если ДатаОкончанияОплаты < ТекущаяДатаНачала Тогда
				ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты, ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
			Иначе
				ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты, ДатаОкончанияОплаты, ОкончаниеИнтервалаОплаты, ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
			КонецЕсли;
			//иначе
			//	Если ДатаОкончанияОплаты < ТекущаяДатаНачала Тогда
			//		ТекущаяДатаОкончания = Мин(ОкончаниеИнтервалаОплаты, ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
			//	Иначе
			//		ТекущаяДатаОкончания = Мин(ОкончаниеИнтервалаОплаты, ДатаОкончанияОплаты, ОкончаниеИнтервалаОплаты, ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
			//	КонецЕсли;
			//КонецЕсли;
			//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
		Иначе 
			Если ДатаОкончанияОплаты < ТекущаяДатаНачала Тогда
				ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты, ВыборкаПоШапкеДокумента.ДатаНарушенияРежима - 1);
			Иначе
				//Островская Татьяна 22.07.2013 № 16645
				ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты, ДатаОкончанияОплаты, ОкончаниеИнтервалаОплаты, ?(КалендарныеДни и 
				(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима - 1) < ОкончаниеИнтервалаОплаты,ОкончаниеИнтервалаОплаты, ВыборкаПоШапкеДокумента.ДатаНарушенияРежима - 1));
			КонецЕсли;
		КонецЕсли;
		
		
		Пока ТекущаяДатаНачала <= ТекущаяДатаОкончания Цикл
			
			Если ЕстьДанныеОСотруднике Тогда
				СтруктураПоиска.Месяц = НачалоМесяца(ТекущаяДатаНачала);
				Для каждого ДанныеОГрафиках Из ГрафикиСотрудникаПоМесяцам.НайтиСтроки(СтруктураПоиска) Цикл
					
					// строка движений
					Движение = НаборОсновныеНачисления.Добавить();
					
					ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоШапкеДокумента,СтрокаСвойствИзДокумента);
					//ПСА 30-12-2020 СВФР-007006 +++
					Если Движение.ПериодРегистрации > Движение.ДатаНачалаСобытия Тогда
						МесяцНачала = Месяц(Движение.ДатаНачалаСобытия);
						МесяцКонца = Месяц(Движение.ПериодРегистрации);
						ЛетМеждуДатами = Год(Движение.ПериодРегистрации) - Год(Движение.ДатаНачалаСобытия);
						КоличествоМесяцев = ЛетМеждуДатами * 12 - МесяцНачала + МесяцКонца;
						Движение.ПериодРасчетаСреднегоЗаработкаНачало = ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаНачало,КоличествоМесяцев);
						//17.11.2021 Аверсон ПНА (
						//Движение.ПериодРасчетаСреднегоЗаработкаОкончание = ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаОкончание,КоличествоМесяцев);
						Если КонецМесяца(Движение.ПериодРасчетаСреднегоЗаработкаОкончание) = КонецДня(Движение.ПериодРасчетаСреднегоЗаработкаОкончание) Тогда
							Движение.ПериодРасчетаСреднегоЗаработкаОкончание = КонецМесяца(ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаОкончание,КоличествоМесяцев));
						Иначе
							Движение.ПериодРасчетаСреднегоЗаработкаОкончание = ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаОкончание,КоличествоМесяцев);
						КонецЕсли;
						//17.11.2021 Аверсон ПНА )
					КонецЕсли;	
					//+++ ПСА 30-12-2020 СВФР-007006
					//О.Т. Аверсон 04.07.2018 № 2119
					Если не ДатаНачДоговора = Неопределено Тогда 
						Движение.ПериодРасчетаСреднегоЗаработкаНачало = ДатаНачДоговора;
						
						
						Запрос = Новый Запрос;
						Запрос.Текст = 
						//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
						//"ВЫБРАТЬ
						//- СВЭЙ КДЯ 01.10.19 СВФР-004756
						//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
						"ВЫБРАТЬ РАЗЛИЧНЫЕ
						//- СВЭЙ КДЯ 01.10.19 СВФР-004756
						|	ДополнительныеНачисленияРаботниковОрганизаций.Регистратор
						|ИЗ
						|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисленияРаботниковОрганизаций
						|ГДЕ
						//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
						//|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой)
						//- СВЭЙ КДЯ 01.10.19 СВФР-004756
						//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
						|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета В
						|	( ЗНАЧЕНИЕ( Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой ),
						|	  ЗНАЧЕНИЕ( Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС ) ) 
						//- СВЭЙ КДЯ 01.10.19 СВФР-004756
						|	И ДополнительныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
						|	И ДополнительныеНачисленияРаботниковОрганизаций.ДокументОснование В ( &ссылка )
						|	И ДополнительныеНачисленияРаботниковОрганизаций.ПериодРегистрации МЕЖДУ &ДатаН И &ДатаК
						|	И ДополнительныеНачисленияРаботниковОрганизаций.Результат <> 0
						|";
						
						Запрос.УстановитьПараметр("ДатаК", Движение.ПериодРасчетаСреднегоЗаработкаОкончание);
						Запрос.УстановитьПараметр("ДатаН", ДатаНачДоговора);
						Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
						Запрос.УстановитьПараметр("ссылка", СписокДокументов);
						
						РезПроверкаНаличия = Запрос.Выполнить().Выгрузить();
						Если РезПроверкаНаличия.Количество()=0 Тогда 
							Движение.ПериодРасчетаСреднегоЗаработкаОкончание = КонецМесяца(ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаОкончание,1));
						КонецЕсли;
						
					КонецЕсли;
					Если Движение.ПериодРасчетаСреднегоЗаработкаНачало > Движение.ПериодРасчетаСреднегоЗаработкаОкончание Тогда 
						Движение.ПериодРасчетаСреднегоЗаработкаОкончание = КонецМесяца(Движение.ПериодРасчетаСреднегоЗаработкаНачало);
					КонецЕсли;					
					//О.Т. Аверсон 04.07.2018 № 2119
					
					// заполнение графиков работы
					ЗаполнитьЗначенияСвойств(Движение,ДанныеОГрафиках); // ГрафикРаботы, ГрафикРаботыНорма, ВидУчетаВремени, ПодразделениеОрганизации 
					
					// Свойства
					Движение.БазовыйПериодНачало		= НачалоДня(ТекущаяДатаНачала);
					Движение.БазовыйПериодКонец		= КонецДня(ТекущаяДатаОкончания);
					//толик на внутреннего совм можно					Если ДанныеОГрафиках.ВидЗанятостиСотрудника = Перечисления.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство Тогда
					//						Движение.ВидРасчета				= БЛБезОплаты;
					//					Иначе
					Движение.ВидРасчета				= ?(Движение.БазовыйПериодНачало <= ДатаОкончанияОплаты,ИнтервалОплаты.Расчет,БЛБезОплаты);
					//					КонецЕсли;
					
					// Реквизиты
					Движение.Показатель1				= ИнтервалОплаты.ПроцентОплаты;
					//Если ЭтоПереходныйПериодПоЗакону255ФЗ И НачалоДня(ТекущаяДатаНачала) >= мДатаЗакона255ФЗ И ИнтервалОплаты.ПроцентОплаты <> 50 Тогда
					//	Движение.Показатель1 = Макс(ВыборкаПоШапкеДокумента.ПроцентОплатыПереходногоПериода,ИнтервалОплаты.ПроцентОплаты)
					//КонецЕсли;
					Если Движение.БазовыйПериодНачало > ДатаОкончанияОплаты Тогда
						Движение.Показатель1					= 0;
					КонецЕсли;
					Движение.ДатаНачалаСобытия			= ДатаНачалаСобытия;
					//толик нарушение режима
					
					//Аверсон 12.04.2023 КВВ СВФР-010630 (
					//Если ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) И Движение.БазовыйПериодНачало >= ВыборкаПоШапкеДокумента.ДатаНарушенияРежима и Движение.БазовыйПериодНачало <ВыборкаПоШапкеДокумента.ДатаНарушенияРежимаКон Тогда
					Если ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) И Движение.БазовыйПериодНачало >= ВыборкаПоШапкеДокумента.ДатаНарушенияРежима и Движение.БазовыйПериодНачало <= ВыборкаПоШапкеДокумента.ДатаНарушенияРежимаКон Тогда
					//Аверсон 12.04.2023 КВВ СВФР-010630 )
						Если ИнтервалОплаты.ПроцентОплаты = 80 Тогда
							Движение.Показатель1 = 40;
						Иначе
							Движение.Показатель1 = 50;
						КонецЕсли;
					КонецЕсли;
					//	Если ЭтоПереходныйПериодПоЗакону255ФЗ Тогда
					//		Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениемВРазмереММОТ;
					//	Иначе
					//		Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОграничениемВРазмереММОТбезРК;
					//	КонецЕсли;
					Движение.Авторасчет					= Истина;
					Если Движение.РучнойРасчетСреднегоЗаработка тогда
						Движение.РазмерСреднегоЗаработка = ВыборкаПоШапкеДокумента.РазмерСреднегоЗаработка;
					КонецЕсли;
					
				КонецЦикла;
				
			Иначе
				
				// строка движений
				Движение = НаборОсновныеНачисления.Добавить();
				
				ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоШапкеДокумента,СтрокаСвойствИзДокумента);
				//О.Т. Аверсон 04.07.2018 № 2119
				Если не ДатаНачДоговора = Неопределено Тогда 
					Движение.ПериодРасчетаСреднегоЗаработкаНачало = ДатаНачДоговора;
					Запрос = Новый Запрос;
					Запрос.Текст = 
					//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
					//"ВЫБРАТЬ
					//- СВЭЙ КДЯ 01.10.19 СВФР-004756
					//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
					"ВЫБРАТЬ РАЗЛИЧНЫЕ
					//- СВЭЙ КДЯ 01.10.19 СВФР-004756
					|	ДополнительныеНачисленияРаботниковОрганизаций.Регистратор
					|ИЗ
					|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисленияРаботниковОрганизаций
					|ГДЕ
					//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
					//|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой)
					//- СВЭЙ КДЯ 01.10.19 СВФР-004756
					//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
					|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета В
					|	( ЗНАЧЕНИЕ( Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой ),
					|	  ЗНАЧЕНИЕ( Перечисление.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС ) ) 
					//- СВЭЙ КДЯ 01.10.19 СВФР-004756
					|	И ДополнительныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
					|	И ДополнительныеНачисленияРаботниковОрганизаций.ДокументОснование В ( &ссылка )
					|	И ДополнительныеНачисленияРаботниковОрганизаций.ПериодРегистрации МЕЖДУ &ДатаН И &ДатаК
					|	И ДополнительныеНачисленияРаботниковОрганизаций.Результат <> 0
					|";
					
					Запрос.УстановитьПараметр("ДатаК", Движение.ПериодРасчетаСреднегоЗаработкаОкончание);
					Запрос.УстановитьПараметр("ДатаН", ДатаНачДоговора);
					Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
					Запрос.УстановитьПараметр("ссылка", СписокДокументов);
					
					РезПроверкаНаличия = Запрос.Выполнить().Выгрузить();
					Если РезПроверкаНаличия.Количество()=0 Тогда 
						Движение.ПериодРасчетаСреднегоЗаработкаОкончание = КонецМесяца(ДобавитьМесяц(Движение.ПериодРасчетаСреднегоЗаработкаОкончание,1));
					КонецЕсли;
					
				КонецЕсли;  
				Если Движение.ПериодРасчетаСреднегоЗаработкаНачало > Движение.ПериодРасчетаСреднегоЗаработкаОкончание Тогда 
					Движение.ПериодРасчетаСреднегоЗаработкаОкончание = КонецМесяца(Движение.ПериодРасчетаСреднегоЗаработкаНачало);
				КонецЕсли;	
				//О.Т. Аверсон 04.07.2018 № 2119
				// Свойства
				Если ТипЗнч(НаборОсновныеНачисления) = Тип("РегистрРасчетаНаборЗаписей.ДополнительныеНачисленияРаботниковОрганизаций") Тогда 
					Движение.БазовыйПериодНачало		= НачалоДня(ТекущаяДатаНачала);
					Движение.БазовыйПериодКонец	    	= КонецДня(ТекущаяДатаОкончания);
				иначе
					Движение.БазовыйПериодНачало		= НачалоДня(ТекущаяДатаНачала);
					Движение.БазовыйПериодКонец    	= КонецДня(ТекущаяДатаОкончания);
				КонецЕсли;
				Движение.ВидРасчета				    = ?(Движение.БазовыйПериодНачало <= ДатаОкончанияОплаты,ИнтервалОплаты.Расчет,БЛБезОплаты);
				
				// Реквизиты
				Движение.Показатель1				= ИнтервалОплаты.ПроцентОплаты;
				//Если ЭтоПереходныйПериодПоЗакону255ФЗ И НачалоДня(ТекущаяДатаНачала) >= мДатаЗакона255ФЗ И ИнтервалОплаты.ПроцентОплаты <> 50 Тогда
				//	Движение.Показатель1 = Макс(ВыборкаПоШапкеДокумента.ПроцентОплатыПереходногоПериода,ИнтервалОплаты.ПроцентОплаты)
				//КонецЕсли;
				Если Движение.БазовыйПериодНачало > ДатаОкончанияОплаты Тогда
					Движение.Показатель1					= 0;
				КонецЕсли;
				Движение.ДатаНачалаСобытия			= ДатаНачалаСобытия;
				
				//толик нарушение режима
				//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
				Если ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) И Движение.БазовыйПериодНачало >= ВыборкаПоШапкеДокумента.ДатаНарушенияРежима Тогда
					//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598	
					Если ИнтервалОплаты.ПроцентОплаты = 80 Тогда
						Движение.Показатель1 = 40;
					Иначе
						Движение.Показатель1 = 50;
					КонецЕсли;
				КонецЕсли;
				//Движение.ВариантАлгоритмаРасчета	= ВариантАлгоритмаРасчета;
				//Если ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) И Движение.ПериодДействияНачало >= ВыборкаПоШапкеДокумента.ДатаНарушенияРежима Тогда
				//	Если ЭтоПереходныйПериодПоЗакону255ФЗ Тогда
				//		Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениемВРазмереММОТ;
				//	Иначе
				//		Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОграничениемВРазмереММОТбезРК;
				//	КонецЕсли;
				//КонецЕсли;
				Движение.Авторасчет					= Истина;
				Если ЗапросПеребор <> Неопределено Тогда 
					Движение.ДатаДоговора = ЗапросПеребор.ДатаДоговора;
					Движение.НомерДоговора = ЗапросПеребор.НомерДоговора;
				КонецЕсли;
				Если Движение.РучнойРасчетСреднегоЗаработка тогда
					Движение.РазмерСреднегоЗаработка = ВыборкаПоШапкеДокумента.РазмерСреднегоЗаработка;
				КонецЕсли;
				
				
				
			КонецЕсли;
			
			ТекущаяДатаНачала = КонецДня(ТекущаяДатаОкончания) + 1;
			
			Если Не ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) Или ВыборкаПоШапкеДокумента.ДатаНарушенияРежима <= ТекущаяДатаНачала Тогда
				//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
				Если ДатаОкончанияОплаты < ТекущаяДатаНачала Тогда
					ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты,ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
				Иначе
					ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ДатаОкончанияОплаты, ОкончаниеИнтервалаОплаты,ТаблицаИнтерваловОплаты[НомерИнтервалаОплаты + 1].Начало - мДлинаСуток);
				КонецЕсли;
				//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
			Иначе 
				Если ДатаОкончанияОплаты < ТекущаяДатаНачала Тогда
					ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ОкончаниеИнтервалаОплаты, ВыборкаПоШапкеДокумента.ДатаНарушенияРежима - 1);
				Иначе
					ТекущаяДатаОкончания = Мин(КонецМесяца(ТекущаяДатаНачала), ДатаОкончанияОплаты, ОкончаниеИнтервалаОплаты, ВыборкаПоШапкеДокумента.ДатаНарушенияРежима - 1);
				КонецЕсли;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры // СформироватьДвиженияПоНачислениям()

// Процедура рассчитывает начисления по среднему и заполняет реквизит Результат таблицы начислений
// Параметры:
//		РассчитываемыеТаблицы  - структура из элементов, соответствующих табличным частям документа. 
//				Значение Истина для каждого из элементов структуры означает необходимость расчета 
//				соответствующей табличной части документа
//		РежимПерерасчета - булево - признак вызов расчета при перерасчете документа
Процедура Рассчитать(РассчитываемыеТаблицы, РежимПерерасчета = Ложь) Экспорт
	
	//Перед вызовом процедуры документ должнен быть записан, движения должны быть удалены 
	
	Отказ = Ложь;
	
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	// позиционируем выборку
	ВыборкаПоШапкеДокумента.Следующий();
	
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	Если РассчитываемыеТаблицы.РасчетСреднего И ЗначениеЗаполнено(ПервичныйБольничныйЛист) Тогда
		РасчетСреднего.Загрузить(ПервичныйБольничныйЛист.РасчетСреднего.Выгрузить());
		Записать();
		РассчитываемыеТаблицы.РасчетСреднего = Ложь;
	КонецЕсли;
	
	РезультатЗапроса = Неопределено;
	Если НЕ РассчитываемыеТаблицы.РасчетСреднего Тогда
		РезультатЗапроса = СформироватьЗапросПоРасчетСреднего();
	КонецЕсли;
	
	Отказ = Не ПроведениеРасчетов.РассчитатьДокументСреднегоЗаработка(ЭтотОбъект, РассчитываемыеТаблицы, ВыборкаПоШапкеДокумента, РежимПерерасчета, РезультатЗапроса);
	//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
	Начисления.Свернуть("ВидРасчета,ДатаНачала,ДатаОкончания,Показатель1,ПодразделениеОрганизации,НормаДней,НормаЧасов,НормаДнейПоПятидневке,ОтработаноДней,ОтработаноЧасов,ОтработаноДнейПоПятидневке,ПериодРасчетаСреднегоЗаработкаНачало,ПериодРасчетаСреднегоЗаработкаОкончание,ДополнительныеДанные,Сторно,Авторасчет,Сотрудник,ОплаченоДнейЧасов,ОтработаноЧасовПоПятидневке,НормаЧасовПоПятидневке,СторнируемыйДокумент,Показатель2,Показатель3,Показатель4,Показатель5,Показатель6,ЧислоМесяцев,ОплаченоДней,РучнойРасчетСреднегоЗаработка","Результат,РазмерСреднегоЗаработка");
	//- СВЭЙ КДЯ 01.10.19 СВФР-004756
	//О.Т. 30.01.2015 № 17616
	Для каждого СтрНачисления Из Начисления Цикл
		СтрНачисления.ОплаченоДней = СтрНачисления.ОплаченоДнейЧасов;
		СтрНачисленияПоДоговорам = НачисленияПоДоговорам.Добавить();
		ЗаполнитьЗначенияСвойств(СтрНачисленияПоДоговорам,СтрНачисления);
	КонецЦикла;
	//+ СВЭЙ КДЯ 01.10.19 СВФР-004756
	//Начисления.Свернуть("ВидРасчета,ДатаНачала,ДатаОкончания,Показатель1,ПодразделениеОрганизации,НормаДней,НормаЧасов,НормаДнейПоПятидневке,ОтработаноДней,ОтработаноЧасов,ОтработаноДнейПоПятидневке,ПериодРасчетаСреднегоЗаработкаНачало,ПериодРасчетаСреднегоЗаработкаОкончание,ДополнительныеДанные,Сторно,Авторасчет,Сотрудник,ОплаченоДнейЧасов,ОтработаноЧасовПоПятидневке,НормаЧасовПоПятидневке,СторнируемыйДокумент,Показатель2,Показатель3,Показатель4,Показатель5,Показатель6,ЧислоМесяцев,ОплаченоДней,РучнойРасчетСреднегоЗаработка","Результат,РазмерСреднегоЗаработка");
	//- СВЭЙ КДЯ 01.10.19 СВФР-004756
	//О.Т. 30.01.2015 № 17616
	
	Если Не Отказ Тогда
		// Отразим пособие в учете
		Если РассчитываемыеТаблицы.Начисления Тогда
			Записать();
			//АвтозаполнениеПроводок(ВыборкаПоШапкеДокумента, Не РежимПерерасчета);
		КонецЕсли;
	КонецЕсли;
	//Островская Татьяна 06.06.2014 № 17416
	если ЗначениеЗаполнено(ПервичныйБольничныйЛист)Тогда 
		если ПервичныйБольничныйЛист.РучнойРасчетСреднегоЗаработка Тогда 
			РучнойРасчетСреднегоЗаработка = Истина;
			РазмерСреднегоЗаработка = ПервичныйБольничныйЛист.РазмерСреднегоЗаработка;
		КонецЕсли;
		
	КонецЕсли;
	//Островская Татьяна 06.06.2014 № 17416
	
КонецПроцедуры // Рассчитать()

// Выполняет перерасчет по заданному списку физлиц
// Параметры
// 	Физлица - массив - ссылки на физлиц
// Возвращаемое значение
//  Нет
//
Процедура Перерассчитать(Физлица = Неопределено) Экспорт
	
	// проверим можно ли что-то делать с документом
	ОписаниеПричиныОтказа = "";
	Если ПроведениеРасчетов.ДокументНельзяИзменятьЗаднимЧислом(Ссылка, ОписаниеПричиныОтказа) Тогда
		ВызватьИсключение(ОписаниеПричиныОтказа);
	КонецЕсли;
	
	// Выполним полный перерасчет документа
	Рассчитать(Новый Структура("Начисления,РасчетСреднего",Истина,Истина), Истина);
	
	// Зафиксируем данные табличных частей после расчета
	Записать();
	
	Движения.НДФЛСведенияОДоходах.Очистить();
	Движения.ВзаиморасчетыСРаботникамиОрганизаций.Очистить();
	Движения.БУОсновныеНачисления.Очистить();
	Движения.ЕСНОсновныеНачисления.Очистить();
	Движения.ЕСНСведенияОДоходах.Очистить();
	
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	// Получение учетной политики по персоналу организации
	УчетЗадолженностиПоМесяцам	= ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "УчетЗадолженностиПоМесяцам");
	
	ВыборкаПоНачислениям = СформироватьЗапросПоНачислениям(ВыборкаПоШапкеДокумента).Выбрать();
	Пока ВыборкаПоНачислениям.Следующий() Цикл
		// на основе данных табличной части "начисления" полностью перепишем регистры накопления НДФЛСведенияОДоходах и ВзаиморасчетыСРаботникамиОрганизаций
		ДобавитьСтрокуВДвиженияПоРегистрамНакопления(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям, УчетЗадолженностиПоМесяцам);
	КонецЦикла;
	
	Если ПособиеОтражаетсяВРеглУчетеТекущимДокументом Тогда
		АвтозаполнениеПроводок(ВыборкаПоШапкеДокумента,Ложь);
		Записать();
		ВыборкаПоОтражениеВУчете = СформироватьЗапросПоОтражениеВУчете().Выбрать();
		Пока ВыборкаПоОтражениеВУчете.Следующий() Цикл
			ДобавитьСтрокуОтраженияВУчете(ВыборкаПоШапкеДокумента, ВыборкаПоОтражениеВУчете);
		КонецЦикла;
	КонецЕсли;
	
	// записываем обновленные движения
	Для Каждого Набор Из Движения Цикл
		ТипНабораЗаписей = ТипЗнч(Набор);
		Если ТипНабораЗаписей = Тип("РегистрНакопленияНаборЗаписей.НДФЛСведенияОДоходах") 
			Или ТипНабораЗаписей = Тип("РегистрНакопленияНаборЗаписей.ВзаиморасчетыСРаботникамиОрганизаций") 
			Или ТипНабораЗаписей = Тип("РегистрНакопленияНаборЗаписей.ЕСНСведенияОДоходах") 
			Или ТипНабораЗаписей = Тип("РегистрРасчетаНаборЗаписей.БУОсновныеНачисления") 
			Или ТипНабораЗаписей = Тип("РегистрРасчетаНаборЗаписей.ЕСНОсновныеНачисления") Тогда
			Набор.Записать();
		КонецЕсли;
	КонецЦикла;
	
	// Удалим записи перерасчета по которым выполнен перерасчет
	ПроведениеРасчетов.УдалитьСведенияОПерерасчетеДокумента(Ссылка);
	
КонецПроцедуры // Перерассчитать()

// Выполняет отражение сумм пособия во всех учетах
Функция АвтозаполнениеПроводок(ВыборкаПоШапкеДокумента = Неопределено, ФормироватьДвижения = Истина) Экспорт
	
	// Получим реквизиты шапки из запроса
	Если ВыборкаПоШапкеДокумента = Неопределено Тогда
		ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
		ВыборкаПоШапкеДокумента.Следующий();
	КонецЕсли;
	
	// запрос по соответсвиям статей затрат начислений и статей затарт для 
	// отражения б/л за счет работодателя
	// соответствие будет использоваться только при отражении в учете
	//доли за счет работодателя по данным базовых начислений
	ДополнительныеСтатьиЗатратЗапрос = Новый Запрос(
	"ВЫБРАТЬ
	|   СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете.ВидСтатьиЗатрат,
	|   СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете.СтатьяЗатратНачисления,
	|   СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете.СтатьяЗатрат
	|ИЗ
	|   РегистрСведений.СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете КАК СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете
	|ГДЕ
	|   СоответствиеСтатейЗатратОтраженияЗарплатыВРеглУчете.ВидСтатьиЗатрат = &ПособияЗаСчетРаботодателя");
	
	ДополнительныеСтатьиЗатратЗапрос.УстановитьПараметр("ДатаЗапроса", ПериодРегистрации);
	ДополнительныеСтатьиЗатратЗапрос.УстановитьПараметр("ПособияЗаСчетРаботодателя", Перечисления.ВидыДополнительныхСтатейЗатрат.ПособияЗаСчетРаботодателя);
	ДополнительныеСтатьиЗатрат = ДополнительныеСтатьиЗатратЗапрос.Выполнить().Выгрузить();
	
	ПараметрыПолученияСубконто = Новый Соответствие;
	ПараметрыПолученияСубконто[Тип("СправочникСсылка.СтатьиЗатрат")] = Новый Структура("ВидСтатьиЗатрат, ДополнительныеСтатьиЗатрат", 
	Перечисления.ВидыДополнительныхСтатейЗатрат.ПособияЗаСчетРаботодателя, 
	ДополнительныеСтатьиЗатрат);
	
	Если ФормироватьДвижения Тогда
		
		// Заголовок для сообщений об ошибках проведения.
		Заголовок = "Формирование списка проводок документа: " + СокрЛП(Ссылка);
		Отказ = Ложь;
		ПроверятьМестоРаботы = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия >= мДатаЗакона180ФЗ;
		
		// перепишем данные из таблицы начислений в набор записей
		ВыборкаПоНачислениям = СформироватьЗапросПоНачислениям(ВыборкаПоШапкеДокумента).Выбрать();
		Пока ВыборкаПоНачислениям.Следующий() Цикл 
			
			// проверим очередную строку табличной части
			ПроверитьЗаполнениеСтрокиНачисления(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям, Отказ, Заголовок, ПроверятьМестоРаботы);
			
			Если НЕ Отказ Тогда
				Если ВыборкаПоНачислениям.ОсновныеНачисления Тогда
					ДобавитьСтрокуОсновныхНачислений(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям);
				Иначе
					ПроведениеРасчетов.ДобавитьСтрокуДополнительныхНачислений(Движения.ДополнительныеНачисленияРаботниковОрганизаций, ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям);
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		
		// получим реквизиты табличной части
		ВыборкаПоРасчетСреднего = СформироватьЗапросПоРасчетСреднего().Выбрать();
		Пока ВыборкаПоРасчетСреднего.Следующий() Цикл
			
			// проверим очередную строку табличной части
			ПроверитьЗаполнениеСтрокиРасчетСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоРасчетСреднего, Отказ, Заголовок, ПроверятьМестоРаботы);
			
			Если НЕ Отказ Тогда
				ДобавитьСтрокуРасчетаСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоРасчетСреднего, Движения.РасчетСреднегоЗаработка);
			КонецЕсли;
			
		КонецЦикла;
		
		Если Отказ Тогда
			Возврат Ложь
		КонецЕсли;
		
		Для Каждого Набор Из Движения Цикл
			Если ТипЗнч(Набор)=Тип("РегистрРасчетаНаборЗаписей.ОсновныеНачисленияРаботниковОрганизаций") 
				или ТипЗнч(Набор)=Тип("РегистрРасчетаНаборЗаписей.РасчетСреднегоЗаработка") Тогда
				Набор.Записать();
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли; 
	
	мЕНВД = Ложь;
	Если ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
		// определим налоговый режим
		БухгалтерскийИНалоговыйУчет.ОбновитьДанныеУчетнойПолитикиПоНалоговомуУчету(глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете"), КонецМесяца(ПериодРегистрации), Организация);
		УчетнаяПолитика = глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете")[КонецМесяца(ПериодРегистрации)][Организация];
		мУСН = УчетнаяПолитика.УСН;
		мОбъектНалогообложенияУСН = УчетнаяПолитика.ОбъектНалогообложенияУСН;
		мЕНВД = УчетнаяПолитика.ОрганизацияЯвляетсяПлательщикомЕНВД;
		мФСС_БЛ = УчетнаяПолитика.УплачиватьДобровольныеВзносыВФСС;
	КонецЕсли;
	
	УказаноОтражениеВУчетеДляРаботодателя = ВыборкаПоШапкеДокумента.УказаноОтражениеВУчетеДляРаботодателя;
	ВторойКалендарныйДень = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия + мДлинаСуток;
	ТретийКалендарныйДень = ВторойКалендарныйДень + мДлинаСуток;
	
	// для всех болезней, кроме прозводственного травматизма может потребоваться расчетная база
	// расчетная база используется для вычисления доли ЕНВД и для распределения по счетам затрат
	// доли пособия за счет работодателя, когда явно не указан способ отражения пособия за счет работодателя:
	// - два календарных дня при ОСН
	// - при УСН доходы минус расходы, добровольные взносы не уплачиваются
	
	НадоЧитатьРасчетнуюБазу = ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве 
	И ((мЕНВД И ВыборкаПоШапкеДокумента.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления)
	ИЛИ (Не УказаноОтражениеВУчетеДляРаботодателя	
	И НЕ мУСН
	И (ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ОбщееЗаболевание ИЛИ ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаВБыту))
	ИЛИ (Не УказаноОтражениеВУчетеДляРаботодателя
	И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам
	И мУСН и НЕ мФСС_БЛ
	И мОбъектНалогообложенияУСН = Перечисления.ОбъектыНалогообложенияПоУСН.ДоходыМинусРасходы));
	//
	
	// основная выборка - по ней ведем обход и вводим записи движений
	РезультатДанныеУчета = ПолучитьДанныеУчета(ВыборкаПоШапкеДокумента, НадоЧитатьРасчетнуюБазу);
	ДанныеУчета = РезультатДанныеУчета.Выбрать();
	
	ПродолжатьОбработку = ДанныеУчета.Следующий(); 
	Успешно = Истина;
	
	НаборЗаписей = ОтражениеВУчете.ВыгрузитьКолонки();
	
	ПодпадаетПодЕНВД = 0;
	
	Если ПродолжатьОбработку и мЕНВД И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
		
		Если ВыборкаПоШапкеДокумента.СтратегияОтраженияВУчете <> Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления Тогда
			
			ПодпадаетПодЕНВД = ВыборкаПоШапкеДокумента.ПроцентЕНВД;
			
		Иначе
			
			ОбщаяБазаРаспределенияСтроки = 0;
			БазаЕНВД = 0;
			
			// вспомогательная выборка - по ней ведем суммирование базовых результатов
			ДанныеУчетаВспомогательные = РезультатДанныеУчета.Выбрать();
			ДанныеУчетаВспомогательные.Следующий();
			ТекущийНомерСтроки = ДанныеУчетаВспомогательные.НомерСтроки;
			
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если НЕ ДанныеУчетаВспомогательные.Сторно Тогда
					Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						Успешно = Ложь;
					Иначе
						ОбщаяБазаРаспределенияСтроки = ОбщаяБазаРаспределенияСтроки + ДанныеУчетаВспомогательные.РезультатБаза;
						Если ДанныеУчетаВспомогательные.ЭтоЕНВД Тогда
							БазаЕНВД = БазаЕНВД + ДанныеУчетаВспомогательные.РезультатБаза
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;	
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			Если ОбщаяБазаРаспределенияСтроки = 0 Тогда
				ДоляЕНВД = 0
			Иначе
				ДоляЕНВД = БазаЕНВД / ОбщаяБазаРаспределенияСтроки
			КонецЕсли;
			ПодпадаетПодЕНВД = ДоляЕНВД * 100;
		КонецЕсли;
		
	КонецЕсли;
	
	// вспомогательная выборка - по ней ведем суммирование базовых результатов
	ДанныеУчетаВспомогательные = РезультатДанныеУчета.Выбрать();
	
	// структура поиска для позиционирования в ДанныеНалоговогоУчетаВспомогательные
	// при необходимости суммирования "базовых" ресурсов
	СтруктураПоиска = Новый Структура("НомерСтроки");
	
	#Если Клиент Тогда
		КомментарийОшибкаСбораРасчетнойБазы = "";
		ОбработкаКомментариев = глЗначениеПеременной("глОбработкаСообщений");
	#КонецЕсли
	
	Пока ПродолжатьОбработку Цикл
		
		Если ДанныеУчета.Сторно Тогда
			
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			
			// суммируем базовые ресурсы по текущей строке набора записей
			Пока ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
				Если ДанныеУчетаВспомогательные.РезультатСторно = NULL Тогда
					Успешно = Ложь;
				Иначе
					СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатСторно;
				КонецЕсли;
				Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
			// суммарная доля, которую уже "разбросали" на строки с одинаковым номером строки
			СуммарнаяДоля = 0;
			// полный результат
			ПолныйРезультат = ДанныеУчета.Результат;
			
			СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
			
			// обходим строки и вычисляем долю результата по базовым записям
			ПерваяИзГруппыСтрок = Истина;
			Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				// если это не первая из группы "базовых" строк по одной строке основного регистра
				// то создаем очередную строку движений
				
				Если Не ПерваяИзГруппыСтрок Тогда
					СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
				Иначе
					ПерваяИзГруппыСтрок = Ложь;
				КонецЕсли;
				
				Если СуммаПоСтроке = 0 Тогда
					Доля = 0;
				Иначе
					Если ДанныеУчета.РезультатСторно = NULL Тогда
						Успешно = Ложь;
						Доля = 0;
					Иначе
						Доля = ПолныйРезультат * ДанныеУчета.РезультатСторно / СуммаПоСтроке;
					КонецЕсли;
				КонецЕсли;
				
				СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДт;
				СтрокаДанных.СубконтоДт1 = ДанныеУчета.СубконтоДт1;
				СтрокаДанных.СубконтоДт2 = ДанныеУчета.СубконтоДт2;
				СтрокаДанных.СубконтоДт3 = ДанныеУчета.СубконтоДт3;
				СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУ;
				СтрокаДанных.СубконтоДтНУ1 = ДанныеУчета.СубконтоДтНУ1;
				СтрокаДанных.СубконтоДтНУ2 = ДанныеУчета.СубконтоДтНУ2;
				СтрокаДанных.СубконтоДтНУ3 = ДанныеУчета.СубконтоДтНУ3;
				
				СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКт;
				СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1;
				СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2;
				СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3;
				СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУ;
				СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1;
				СтрокаДанных.СубконтоКтНУ2 = ДанныеУчета.СубконтоКтНУ2;
				СтрокаДанных.СубконтоКтНУ3 = ДанныеУчета.СубконтоКтНУ3;
				
				СтрокаДанных.КодДоходаЕСН   = ДанныеУчета.КодДоходаЕСН;
				СтрокаДанных.ОблагаетсяЕНВД = ДанныеУчета.ОблагаетсяЕНВД;
				
				СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля, ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
				СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
				
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			// ошибки округления складываются на последнюю запись из группы базовых записей
			СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
			
			
		ИначеЕсли ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда // отражение в учете не зависит от налогового режима
			
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			
			СуммаПоСтроке = ДанныеУчета.Результат;
			СуммаПоСтрокеЕНВД = 0;
			
			Если СуммаПоСтроке = 0 Тогда
				Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
					Если Не ДанныеУчета.Следующий() Тогда
						ПродолжатьОбработку = Ложь;
						Прервать;
					КонецЕсли;
				КонецЦикла;
				Продолжить;
			КонецЕсли;
			
			СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
			СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_НСиПЗ;
			СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
			СтрокаДанных.СубконтоДт2 = Неопределено;
			СтрокаДанных.СубконтоДт3 = Неопределено;
			СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
			СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
			СтрокаДанных.СубконтоКт2 = Неопределено;
			СтрокаДанных.СубконтоКт3 = Неопределено;
			СтрокаДанных.СчетДтНУ	 = Неопределено;
			СтрокаДанных.СчетКтНУ	 = Неопределено;
			СтрокаДанных.СубконтоДтНУ1 = Неопределено;
			СтрокаДанных.СубконтоДтНУ2 = Неопределено;
			СтрокаДанных.СубконтоДтНУ3 = Неопределено;
			СтрокаДанных.СубконтоКтНУ1 = Неопределено;
			СтрокаДанных.СубконтоКтНУ2 = Неопределено;
			СтрокаДанных.СубконтоКтНУ3 = Неопределено;
			СтрокаДанных.ОтражениеВУСН	 = Неопределено;		
			СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
			
			Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
				Если Не ДанныеУчета.Следующий() Тогда
					ПродолжатьОбработку = Ложь;
					Прервать;
				КонецЕсли;
			КонецЦикла;
			
		Иначе
			
			ТекущийНомерСтроки = ДанныеУчета.НомерСтроки;
			// позиционируемся во вспомогательной выборке по запросу для суммирования "базовых" данных
			СтруктураПоиска.НомерСтроки = ТекущийНомерСтроки;
			Если ДанныеУчетаВспомогательные.НомерСтроки <> ТекущийНомерСтроки Тогда
				// ищем следующую строку во спомогательной выборке если она не является искомой	
				ДанныеУчетаВспомогательные.НайтиСледующий(СтруктураПоиска);
			КонецЕсли;
			
			СуммаПоСтроке = 0;
			СуммаПоСтрокеЕНВД = 0;
			Если НадоЧитатьРасчетнуюБазу и ВыборкаПоШапкеДокумента.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления Тогда
				// суммируем базовые ресурсы по текущей строке набора записей
				Пока ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
					Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						Успешно = Ложь;
					Иначе
						СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
						Если ДанныеУчетаВспомогательные.ЭтоЕНВД Тогда
							СуммаПоСтрокеЕНВД = СуммаПоСтрокеЕНВД + ДанныеУчетаВспомогательные.РезультатБаза;
						КонецЕсли;						
					КонецЕсли;
					Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
			ИначеЕсли НадоЧитатьРасчетнуюБазу и ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
				// суммируем базовые ресурсы по текущей строке набора записей
				// сюда попали когда для БЛ доля ЕНВД определяется по текущему месяцу, а доля за счет работодателя распределяется по базовым начислениям
				Пока ДанныеУчетаВспомогательные.НомерСтроки = ТекущийНомерСтроки Цикл
					Если ДанныеУчетаВспомогательные.РезультатБаза = NULL Тогда
						Успешно = Ложь;
					Иначе 
						СуммаПоСтроке = СуммаПоСтроке + ДанныеУчетаВспомогательные.РезультатБаза;
					КонецЕсли;
					Если Не ДанныеУчетаВспомогательные.Следующий() Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
				СуммаПоСтрокеЕНВД = СуммаПоСтроке * ВыборкаПоШапкеДокумента.ПроцентЕНВД / 100;
			ИначеЕсли ВыборкаПоШапкеДокумента.ПроцентЕНВД = 100 Тогда
				СуммаПоСтроке = ДанныеУчета.Результат;
				СуммаПоСтрокеЕНВД = ДанныеУчета.Результат;
			ИначеЕсли ВыборкаПоШапкеДокумента.ПроцентЕНВД = 0 Тогда
				СуммаПоСтроке = ДанныеУчета.Результат;
			Иначе
				СуммаПоСтроке = ДанныеУчета.Результат;
				СуммаПоСтрокеЕНВД = ДанныеУчета.Результат * ВыборкаПоШапкеДокумента.ПроцентЕНВД / 100;
			КонецЕсли;
			
			Если Не Успешно Тогда
				// не удалось собрать данные отражения в учете, необходимо разобраться зачем мы собирали расчетную базу
				// и сообщить пользователю о проблемах
				
				// ДоляЕНВДПоБазе - необходимо было собирать долю ЕНВД по базовым начислениям
				ДоляЕНВДПоБазе =  мЕНВД и ВыборкаПоШапкеДокумента.СтратегияОтраженияВУчете = Перечисления.СтратегииОтраженияВРеглУчетеНачислений.КакБазовыеНачисления;
				
				// ДоляРаботодателяПоБазе - необходимо было собирать долю пособия за счет работодателя по базе
				// данные по базе нужны для 2-х календарных дней и для доли за счет работодателя при УСН доходы минус расходы
				ДоляРаботодателяПоБазе = Не УказаноОтражениеВУчетеДляРаботодателя 
				и ((НЕ мУСН и (ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ОбщееЗаболевание
				ИЛИ ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаВБыту)
				и ДанныеУчета.ДоляБЛЗаСчетРаботодателя <>0)
				или (ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам
				и мУСН и НЕ мФСС_БЛ и мОбъектНалогообложенияУСН = Перечисления.ОбъектыНалогообложенияПоУСН.ДоходыМинусРасходы));
				
				Если Не ДоляЕНВДПоБазе и Не ДоляРаботодателяПоБазе Тогда
					
					// данные собранные по базе не нужны, можно использовать результат запроса по шапке документа
					Успешно = Истина;
					Если ВыборкаПоШапкеДокумента.ПроцентЕНВД = 100 Тогда
						СуммаПоСтроке = ДанныеУчета.Результат;
						СуммаПоСтрокеЕНВД = ДанныеУчета.Результат;
					ИначеЕсли ВыборкаПоШапкеДокумента.ПроцентЕНВД = 0 Тогда
						СуммаПоСтроке = ДанныеУчета.Результат;
					Иначе
						СуммаПоСтроке = ДанныеУчета.Результат;
						СуммаПоСтрокеЕНВД = ДанныеУчета.Результат * ВыборкаПоШапкеДокумента.ПроцентЕНВД / 100;
					КонецЕсли;
					
				Иначе
					
					Если Не ДоляЕНВДПоБазе Тогда
						// данные по базе нужны только для распределения по счетам затрат доли пособия за счет работодателя
						// соберм суммы и продолжим работу, при этом счет затрат для пособия за счет работодателя будет пустой
						Если ВыборкаПоШапкеДокумента.ПроцентЕНВД = 100 Тогда
							СуммаПоСтроке = ДанныеУчета.Результат;
							СуммаПоСтрокеЕНВД = ДанныеУчета.Результат;
						ИначеЕсли ВыборкаПоШапкеДокумента.ПроцентЕНВД = 0 Тогда
							СуммаПоСтроке = ДанныеУчета.Результат;
						Иначе
							СуммаПоСтроке = ДанныеУчета.Результат;
							СуммаПоСтрокеЕНВД = ДанныеУчета.Результат * ВыборкаПоШапкеДокумента.ПроцентЕНВД / 100;
						КонецЕсли;
					КонецЕсли;
					
					#Если Клиент Тогда
						
						Если ПустаяСтрока(КомментарийОшибкаСбораРасчетнойБазы) Тогда 
							
							//Добавим родительскую сторку
							ТекстСообщения = "Внимание! Нет данных для отражения пособия в учете.
							|Отсутствуют данные по отражению зарплаты в регламентированном учете за расчетный период.";
							КомментарийОшибкаСбораРасчетнойБазы = ОбработкаКомментариев.ДобавитьСообщение(ТекстСообщения, Перечисления.ВидыСообщений.Ошибка);
							
							Если Не ПособиеОтражаетсяВРеглУчетеТекущимДокументом и (ДоляЕНВДПоБазе или ДоляРаботодателяПоБазе) Тогда
								ТекстСообщения = "Рекомендуется зарегистрировать отражение пособия в учете текущим документом.
								|На закладке ""Отражение пособия в учете"" установите ""Отражать в учете по данным текущего документа""
								|и заполните таблицу ""Проводки и данные для ЕСН""";	
								ОбработкаКомментариев.ДобавитьСообщение(ТекстСообщения, Перечисления.ВидыСообщений.ВажнаяИнформация,,КомментарийОшибкаСбораРасчетнойБазы);
							КонецЕсли;
							
							Если ДоляЕНВДПоБазе Тогда
								ТекстСообщения = "Нет данных для определения доли ЕНВД пособия. Стратегия определения доли ЕНВД - ""по базовым начислениям "" задана в ";
								Если Не ПособиеОтражаетсяВРеглУчетеТекущимДокументом Тогда
									ТекстСообщения = ТекстСообщения + "начислении: " + ДанныеУчета.ВидРасчетаНаименование;	
								Иначе
									ТекстСообщения = ТекстСообщения + "документе";
								КонецЕсли;	
								ОбработкаКомментариев.ДобавитьСообщение(ТекстСообщения, Перечисления.ВидыСообщений.ВажнаяИнформация,,КомментарийОшибкаСбораРасчетнойБазы);
							КонецЕсли;	
							
							Если ДоляРаботодателяПоБазе Тогда
								ТекстСообщения = "Нет данных для распределения доли пособия за счет работодателя по счетам затрат.";
								ОбработкаКомментариев.ДобавитьСообщение(ТекстСообщения, Перечисления.ВидыСообщений.ВажнаяИнформация,,КомментарийОшибкаСбораРасчетнойБазы);
							КонецЕсли;
							
						КонецЕсли;
						
					#КонецЕсли
					
				КонецЕсли;
				
			КонецЕсли;	
			
			Если СуммаПоСтроке = 0 Тогда
				Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
					Если Не ДанныеУчета.Следующий() Тогда
						ПродолжатьОбработку = Ложь;
						Прервать;
					КонецЕсли;
				КонецЦикла;
				Продолжить;
			КонецЕсли;
			
			СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
			
			// доля пособия за счет работодателя за первые два календарных дня может быть
			// при этом ДоляБЛЗаСчетРаботодателя может быть равна нулю по причине отсутствия ФПД
			ЕстьДоляБЛЗаСчетРаботодателя = ТретийКалендарныйДень > ДанныеУчета.БазовыйПериодНачало;
			
			Если мУСН и НЕ мФСС_БЛ Тогда  // налоговые режимы: УСН и УСН+ЕНВД, без уплаты добровольных взносов
				
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
					
					Если Не мЕНВД Или СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_УСН;
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;		
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 Тогда
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации); //О.Т. Аверсон 14.03.2016 № 949
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
					
					Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 Тогда
						Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						КонецЕсли;
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
					КонецЕсли;
					
					Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
				Иначе // не травма на производстве и не отпуск по беременности и родам
					
					ВПределахММОТ = ?(ДанныеУчета.Сторно,Макс(ДанныеУчета.Результат,ДанныеУчета.ВПределахММОТ),Мин(ДанныеУчета.Результат,ДанныеУчета.ВПределахММОТ));
					СтрокаДанных.Результат	 = ВПределахММОТ;
					
					Если Не мЕНВД Или СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
						// доля УСН
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_УСН; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;		
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 Тогда
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = ВПределахММОТ - Окр(ВПределахММОТ * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ВПределахММОТ - ОбщегоНазначения.ОкруглитьЗначение2016(ВПределахММОТ * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
					
					Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 Тогда
						Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						КонецЕсли;
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = Окр(ВПределахММОТ * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ВПределахММОТ * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
					КонецЕсли;
					
					// полный результат
					ПолныйРезультат = ДанныеУчета.Результат - ВПределахММОТ;
					
					Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 и ПолныйРезультат <> 0 Тогда
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНВД; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = Окр(ПолныйРезультат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ПолныйРезультат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							ПолныйРезультат = ПолныйРезультат - Окр(ПолныйРезультат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							ПолныйРезультат = ПолныйРезультат - ОбщегоНазначения.ОкруглитьЗначение2016(ПолныйРезультат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						
						
					КонецЕсли;
					
					Если мОбъектНалогообложенияУСН = Перечисления.ОбъектыНалогообложенияПоУСН.Доходы Тогда
						Если ПолныйРезультат <> 0 Тогда
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНприУСН;
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;		
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
							СтрокаДанных.Результат	 = ПолныйРезультат
						КонецЕсли;
						
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
					Иначе 
						Если ПолныйРезультат <> 0 Тогда 
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							Если УказаноОтражениеВУчетеДляРаботодателя Тогда
								ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
								"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
								"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
								СтрокаДанных.Результат	 = ПолныйРезультат;
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
								Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
									Если Не ДанныеУчета.Следующий() Тогда
										ПродолжатьОбработку = Ложь;
										Прервать;
									КонецЕсли;
								КонецЦикла;
							Иначе // обходим строки и вычисляем долю результата по базовым записям
								// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
								СуммарнаяДоля = 0;
								ПерваяИзГруппыСтрок = Истина;
								Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
									Если Не ДанныеУчета.ЭтоЕНВД Тогда
										// если это не первая из группы "базовых" строк по одной строке основного регистра
										// то создаем очередную строку движений
										Если Не ПерваяИзГруппыСтрок Тогда
											СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
										Иначе
											ПерваяИзГруппыСтрок = Ложь;
										КонецЕсли;
										
										Если СуммаПоСтроке = 0 Тогда
											Доля = 0;
										Иначе
											Если ДанныеУчета.РезультатБаза = NULL Тогда
												Успешно = Ложь;
												Доля = 0;
											Иначе
												Доля = ПолныйРезультат * ДанныеУчета.РезультатБаза / (СуммаПоСтроке - СуммаПоСтрокеЕНВД);
											КонецЕсли;
										КонецЕсли;
										
										Если ДанныеУчета.СчетДтРазрез = NULL Тогда
											Успешно = Ложь;
										Иначе
											СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
											СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
											СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
											СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
											СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
											СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
											СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
											СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
										КонецЕсли;
										
										Если ДанныеУчета.СчетКтРазрез = NULL Тогда
											Успешно = Ложь;
										Иначе
											СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
											СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
											СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
											СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
											СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
											СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
											СтрокаДанных.СубконтоКтНУ2 = Неопределено;
											СтрокаДанных.СубконтоКтНУ3 = Неопределено;
											СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.Принимаются;		
										КонецЕсли;
										СтрокаДанных.Результат = ?(ПолныйРезультат > 0,Мин(Доля,ПолныйРезультат - СуммарнаяДоля),Макс(Доля,ПолныйРезультат - СуммарнаяДоля));
										СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
										СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
									КонецЕсли;
									Если Не ДанныеУчета.Следующий() Тогда
										ПродолжатьОбработку = Ложь;
										Прервать;
									КонецЕсли;
								КонецЦикла;
								// ошибки округления складываются на последнюю запись из группы базовых записей
								СтрокаДанных.Результат = СтрокаДанных.Результат + ПолныйРезультат - СуммарнаяДоля;
							КонецЕсли;
						Иначе	
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
						КонецЕсли;
					КонецЕсли;
					
				КонецЕсли;
				
			ИначеЕсли мЕНВД и СуммаПоСтрокеЕНВД <> 0 и НЕ мФСС_БЛ Тогда // налоговые режимы: ОСН+ЕНВД, без уплаты добровольных взносов
				
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
					Если СуммаПоСтрокеЕНВД <> СуммаПоСтроке  Тогда
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
					КонецЕсли;
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
					иначе
						СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
					КонецЕсли;
					
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
					СтрокаДанных.ОблагаетсяЕНВД = Истина;
					Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
				ИначеЕсли  ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ОбщееЗаболевание
					И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаВБыту Тогда
					Если СуммаПоСтрокеЕНВД <> СуммаПоСтроке  Тогда
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
						КонецЕсли;
						
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
					КонецЕсли;		
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						ВПределахММОТ	 = ?(ДанныеУчета.Сторно,Макс(Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2),ДанныеУчета.ВПределахММОТ),Мин(Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2),ДанныеУчета.ВПределахММОТ));
					иначе
						ВПределахММОТ	 = ?(ДанныеУчета.Сторно,Макс(ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации),ДанныеУчета.ВПределахММОТ),Мин(ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации),ДанныеУчета.ВПределахММОТ));//О.Т. Аверсон 14.03.2016 № 949
					КонецЕсли;
					
					СтрокаДанных.Результат	 = ВПределахММОТ;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
					СтрокаДанных.ОблагаетсяЕНВД = Истина;
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						Условие = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
					иначе
						Условие = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);
					КонецЕсли;
					Если Условие - ВПределахММОТ <> 0 Тогда
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНВД; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2) - ВПределахММОТ;
						иначе
							СтрокаДанных.Результат = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации) - ВПределахММОТ;//О.Т. Аверсон 15.03.2016 № 949
						КонецЕсли;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
						СтрокаДанных.ОблагаетсяЕНВД = Истина;
					КонецЕсли;
					
					Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
				Иначе // ОбщееЗаболевание или ТравмаВБыту
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						ДоляПособияЕНВД = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
					иначе
						ДоляПособияЕНВД = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
					КонецЕсли;
					
					
					// это доля возмещаемая ФСС в части ЕНВД в пределах ММОТ
					ВПределахММОТ = ?(ДанныеУчета.Сторно,Макс(ДоляПособияЕНВД, ДанныеУчета.ВПределахММОТ),Мин(ДоляПособияЕНВД, ДанныеУчета.ВПределахММОТ));
					
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					СтрокаДанных.Результат	 = ВПределахММОТ;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
					СтрокаДанных.ОблагаетсяЕНВД = Истина;
					
					// зарегистрируем долю за счет работодателя в части ЕНВД
					СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНВД; 
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					СтрокаДанных.Результат = ДоляПособияЕНВД - ВПределахММОТ;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
					СтрокаДанных.ОблагаетсяЕНВД = Истина;
					
					
					// за счет работодателя в части ОСН, первые два календарных дня
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						РезультатЗаСчетРаботодателя = Окр((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
					Иначе
						РезультатЗаСчетРаботодателя = ОбщегоНазначения.ОкруглитьЗначение2016((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
					КонецЕсли;
					//за счет ФСС
					ЗаСчетФССРезультат = ДанныеУчета.Результат - ДоляПособияЕНВД - РезультатЗаСчетРаботодателя;
					
					Если ЗаСчетФССРезультат <> 0 Тогда
						//доля за счет ФСС
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						СтрокаДанных.Результат	 = ЗаСчетФССРезультат;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						
						Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
							СтрокаДанных.БазовыйПериодНачало = Мин(СтрокаДанных.БазовыйПериодКонец, ТретийКалендарныйДень);
						КонецЕсли;
						
					КонецЕсли;
					
					Если РезультатЗаСчетРаботодателя <> 0 Тогда 
						
						СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
						Если УказаноОтражениеВУчетеДляРаботодателя Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
							"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
							"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
							СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
						Иначе // обходим строки и вычисляем долю результата по базовым записям
							// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
							СуммарнаяДоля = 0;
							ПерваяИзГруппыСтрок = Истина;
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.ЭтоЕНВД Тогда
									// если это не первая из группы "базовых" строк по одной строке основного регистра
									// то создаем очередную строку движений
									Если Не ПерваяИзГруппыСтрок Тогда
										СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
										СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
									Иначе
										ПерваяИзГруппыСтрок = Ложь;
									КонецЕсли;
									
									Если СуммаПоСтроке = 0 Тогда
										Доля = 0;
									Иначе
										Если ДанныеУчета.РезультатБаза = NULL Тогда
											Успешно = Ложь;
											Доля = 0;
										Иначе
											Доля = РезультатЗаСчетРаботодателя * ДанныеУчета.РезультатБаза / (СуммаПоСтроке -  СуммаПоСтрокеЕНВД);
										КонецЕсли;
									КонецЕсли;
									
									Если ДанныеУчета.СчетДтРазрез = NULL Тогда
										Успешно = Ложь;
									Иначе
										СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
										СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
										СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
									КонецЕсли;
									Если ДанныеУчета.СчетКтРазрез = NULL Тогда
										Успешно = Ложь;
									Иначе
										СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
										СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
										СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
										СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
										СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
										СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
										СтрокаДанных.СубконтоКтНУ2 = Неопределено;
										СтрокаДанных.СубконтоКтНУ3 = Неопределено;
									КонецЕсли;
									СтрокаДанных.Результат = ?(РезультатЗаСчетРаботодателя > 0,Мин(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля),Макс(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля));
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
									СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
								КонецЕсли;
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
							// ошибки округления складываются на последнюю запись из группы базовых записей
							СтрокаДанных.Результат = СтрокаДанных.Результат + РезультатЗаСчетРаботодателя - СуммарнаяДоля;
						КонецЕсли;
					Иначе
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
				КонецЕсли;
				
			ИначеЕсли мФСС_БЛ Тогда // налоговые режимы: УСН, ОСН+ЕНВД и УСН+ЕНВД, с уплатой добровольных взносов
				
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
					
					Если мЕНВД и НЕ мУСН Тогда // налоговые режимы: ОСН+ЕНВД, с уплатой добровольных взносов
						
						Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						КонецЕсли;	
						
						Если СуммаПоСтрокеЕНВД <> 0 Тогда
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							КонецЕсли;
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							СтрокаДанных.ОблагаетсяЕНВД = Истина;
						КонецЕсли;
						
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
						
					ИначеЕсли мУСН Тогда  // налоговые режимы: УСН и УСН+ЕНВД, с уплатой добровольных взносов
						
						Если Не мЕНВД Или СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_УСН;
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							Если мЕНВД Тогда
								Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
									СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
								иначе
									СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
								КонецЕсли;
								
							КонецЕсли;
						КонецЕсли;
						
						Если мЕНВД И СуммаПоСтрокеЕНВД <> 0 Тогда
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							КонецЕсли;
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_СПЕЦ_ЕНВД; 
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							СтрокаДанных.ОблагаетсяЕНВД = Истина;
						КонецЕсли;							
						
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
						
					КонецЕсли;
					
				ИначеЕсли  ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ОбщееЗаболевание
					И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаВБыту Тогда
					
					Если мЕНВД и НЕ мУСН Тогда // налоговые режимы: ОСН+ЕНВД, с уплатой добровольных взносов
						
						Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						КонецЕсли;
						
						Если СуммаПоСтрокеЕНВД <> 0 Тогда
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							КонецЕсли;
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							СтрокаДанных.ОблагаетсяЕНВД = Истина;
						КонецЕсли;
						
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
						
					ИначеЕсли мУСН Тогда // налоговые режимы: УСН и УСН+ЕНВД, с уплатой добровольных взносов
						
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
						иначе
							СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
						КонецЕсли;
						
						Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД и мЕНВД Тогда
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							СтрокаДанных.ОтражениеВУСН = Перечисления.ОтражениеВУСН.НеПринимаются;
							СтрокаДанных.КодДоходаЕСН  = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							СтрокаДанных.ОблагаетсяЕНВД = Истина;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
						КонецЕсли;
						
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;							
						
					КонецЕсли;	
					
				Иначе // заболевание работника, налоговые режимы: УСН, ОСН+ЕНВД и УСН+ЕНВД, с уплатой добровольных взносов
					
					Если мЕНВД и НЕ мУСН Тогда // налоговые режимы: ОСН+ЕНВД, с уплатой добровольных взносов
						
						Если ДанныеУчета.ДатаНачалаСобытия < мДатаЗакона180ФЗ Тогда
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								ДоляПособияЕНВД = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								ДоляПособияЕНВД = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							
							// за счет работодателя в части ОСН
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								РезультатЗаСчетРаботодателя = Окр((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
							иначе
								РезультатЗаСчетРаботодателя = ОбщегоНазначения.ОкруглитьЗначение2016((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
							КонецЕсли;
							
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								// за счет ФСС в части ОСН
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - ДоляПособияЕНВД - РезультатЗаСчетРаботодателя;
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
								
								Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
									СтрокаДанных.БазовыйПериодНачало = Мин(СтрокаДанных.БазовыйПериодКонец, ТретийКалендарныйДень);	
								КонецЕсли;	
								
							КонецЕсли;
							
							Если СуммаПоСтрокеЕНВД <> 0 Тогда
								
								// за счет добровольных взносов
								Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								КонецЕсли;
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
									СтрокаДанных.Результат	 = ДоляПособияЕНВД - Окр(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
								иначе
									СтрокаДанных.Результат	 = ДоляПособияЕНВД - ОбщегоНазначения.ОкруглитьЗначение2016(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
								КонецЕсли;
								
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
								СтрокаДанных.ОблагаетсяЕНВД = Истина;
								
								Если ДанныеУчета.ДоляБЛЗаСчетРаботодателя <> 0 Тогда
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
									СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНВД; 
									СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
									СтрокаДанных.СубконтоДт2 = Неопределено;
									СтрокаДанных.СубконтоДт3 = Неопределено;
									СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
									СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
									СтрокаДанных.СубконтоКт2 = Неопределено;
									СтрокаДанных.СубконтоКт3 = Неопределено;
									СтрокаДанных.СчетДтНУ	 = Неопределено;
									СтрокаДанных.СчетКтНУ	 = Неопределено;
									СтрокаДанных.СубконтоДтНУ1 = Неопределено;
									СтрокаДанных.СубконтоДтНУ2 = Неопределено;
									СтрокаДанных.СубконтоДтНУ3 = Неопределено;
									СтрокаДанных.СубконтоКтНУ1 = Неопределено;
									СтрокаДанных.СубконтоКтНУ2 = Неопределено;
									СтрокаДанных.СубконтоКтНУ3 = Неопределено;
									Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
										СтрокаДанных.Результат	 = Окр(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
									иначе
										СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
									КонецЕсли;
									
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
									СтрокаДанных.ОблагаетсяЕНВД = Истина;
								КонецЕсли;
							КонецЕсли;							
							
							Если РезультатЗаСчетРаботодателя <> 0 Тогда 
								
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
								Если УказаноОтражениеВУчетеДляРаботодателя Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
									"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
									"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
									СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
								Иначе  // обходим строки и вычисляем долю результата по базовым записям
									// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
									СуммарнаяДоля = 0;
									ПерваяИзГруппыСтрок = Истина;
									Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
										Если Не ДанныеУчета.ЭтоЕНВД Тогда
											// если это не первая из группы "базовых" строк по одной строке основного регистра
											// то создаем очередную строку движений
											Если Не ПерваяИзГруппыСтрок Тогда
												СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
												СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
											Иначе
												ПерваяИзГруппыСтрок = Ложь;
											КонецЕсли;
											
											Если СуммаПоСтроке = 0 Тогда
												Доля = 0;
											Иначе
												Если ДанныеУчета.РезультатБаза = NULL Тогда
													Успешно = Ложь;
													Доля = 0;
												Иначе
													Доля = РезультатЗаСчетРаботодателя * ДанныеУчета.РезультатБаза / (СуммаПоСтроке - СуммаПоСтрокеЕНВД);
												КонецЕсли;
											КонецЕсли;
											
											Если ДанныеУчета.СчетДтРазрез = NULL Тогда
												Успешно = Ложь;
											Иначе
												СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
												СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
												СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
											КонецЕсли;
											Если ДанныеУчета.СчетКтРазрез = NULL Тогда
												Успешно = Ложь;
											Иначе
												СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
												СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
												СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
												СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
												СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
												СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
												СтрокаДанных.СубконтоКтНУ2 = Неопределено;
												СтрокаДанных.СубконтоКтНУ3 = Неопределено;
											КонецЕсли;
											
											СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
											СтрокаДанных.Результат = ?(РезультатЗаСчетРаботодателя > 0,Мин(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля),Макс(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля));
											СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
										КонецЕсли;
										Если Не ДанныеУчета.Следующий() Тогда
											ПродолжатьОбработку = Ложь;
											Прервать;
										КонецЕсли;
									КонецЦикла;
									// ошибки округления складываются на последнюю запись из группы базовых записей
									СтрокаДанных.Результат = СтрокаДанных.Результат + РезультатЗаСчетРаботодателя - СуммарнаяДоля;
								КонецЕсли;	
								
							КонецЕсли;	
							
							Пока ПродолжатьОбработку И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;							
							
						Иначе // ДанныеУчета.ДатаНачалаСобытия > мДатаЗакона180ФЗ, налоговые режимы: ОСН+ЕНВД, с уплатой добровольных взносов
							
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = Окр(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);
							иначе
								СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							
							
							// за счет работодателя
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								РезультатЗаСчетРаботодателя = Окр((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);//О.Т. Аверсон 14.03.2016 № 949
							Иначе 
								РезультатЗаСчетРаботодателя = ОбщегоНазначения.ОкруглитьЗначение2016((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
							КонецЕсли;
							
							
							//за счет ФСС
							ЗаСчетФССРезультат = 0;
							
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								
								ЗаСчетФССРезультат = ДанныеУчета.Результат - ДоляПособияЕНВД - РезультатЗаСчетРаботодателя;
								
								Если ЗаСчетФССРезультат <> 0 Тогда
									СтрокаДанных.Результат	 = ЗаСчетФССРезультат;
									СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
									СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
									СтрокаДанных.СубконтоДт2 = Неопределено;
									СтрокаДанных.СубконтоДт3 = Неопределено;
									СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
									СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
									СтрокаДанных.СубконтоКт2 = Неопределено;
									СтрокаДанных.СубконтоКт3 = Неопределено;
									СтрокаДанных.СчетДтНУ	 = Неопределено;
									СтрокаДанных.СчетКтНУ	 = Неопределено;
									СтрокаДанных.СубконтоДтНУ1 = Неопределено;
									СтрокаДанных.СубконтоДтНУ2 = Неопределено;
									СтрокаДанных.СубконтоДтНУ3 = Неопределено;
									СтрокаДанных.СубконтоКтНУ1 = Неопределено;
									СтрокаДанных.СубконтоКтНУ2 = Неопределено;
									СтрокаДанных.СубконтоКтНУ3 = Неопределено;
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
									Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
										СтрокаДанных.БазовыйПериодНачало = Мин(СтрокаДанных.БазовыйПериодКонец, ТретийКалендарныйДень);	
									КонецЕсли;
								КонецЕсли;
								
							КонецЕсли;
							
							Если СуммаПоСтрокеЕНВД <> 0 Тогда
								Если ЗаСчетФССРезультат <> 0 Тогда
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								КонецЕсли;
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								СтрокаДанных.Результат	 = ДоляПособияЕНВД;
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
								СтрокаДанных.ОблагаетсяЕНВД = Истина;
							КонецЕсли;							
							
							Если РезультатЗаСчетРаботодателя <> 0 Тогда 
								Если ЗаСчетФССРезультат <> 0 ИЛИ СуммаПоСтрокеЕНВД <> 0 Тогда
									//добавим новую строку движений, т.к. есть доля за счет ФСС
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								КонецЕсли;
								СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
								Если УказаноОтражениеВУчетеДляРаботодателя Тогда
									ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
									"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
									"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
									СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
								Иначе // обходим строки и вычисляем долю результата по базовым записям
									// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
									СуммарнаяДоля = 0;
									ПерваяИзГруппыСтрок = Истина;
									Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
										Если Не ДанныеУчета.ЭтоЕНВД Тогда
											// если это не первая из группы "базовых" строк по одной строке основного регистра
											// то создаем очередную строку движений
											Если Не ПерваяИзГруппыСтрок Тогда
												СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
												СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
											Иначе
												ПерваяИзГруппыСтрок = Ложь;
											КонецЕсли;
											
											Если СуммаПоСтроке = 0 Тогда
												Доля = 0;
											Иначе
												Если ДанныеУчета.РезультатБаза = NULL Тогда
													Успешно = Ложь;
													Доля = 0;
												Иначе
													Доля = РезультатЗаСчетРаботодателя * ДанныеУчета.РезультатБаза / (СуммаПоСтроке - СуммаПоСтрокеЕНВД);
												КонецЕсли;
											КонецЕсли;
											
											Если ДанныеУчета.СчетДтРазрез = NULL Тогда
												Успешно = Ложь;
											Иначе
												СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
												СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
												СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
												СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
											КонецЕсли;
											Если ДанныеУчета.СчетКтРазрез = NULL Тогда
												Успешно = Ложь;
											Иначе
												СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
												СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
												СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
												СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
												СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
												СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
												СтрокаДанных.СубконтоКтНУ2 = Неопределено;
												СтрокаДанных.СубконтоКтНУ3 = Неопределено;
											КонецЕсли;
											
											СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
											СтрокаДанных.Результат = ?(РезультатЗаСчетРаботодателя > 0,Мин(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля),Макс(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля));
											СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
										КонецЕсли;
										Если Не ДанныеУчета.Следующий() Тогда
											ПродолжатьОбработку = Ложь;
											Прервать;
										КонецЕсли;
									КонецЦикла;
									// ошибки округления складываются на последнюю запись из группы базовых записей
									СтрокаДанных.Результат = СтрокаДанных.Результат + РезультатЗаСчетРаботодателя - СуммарнаяДоля;
								КонецЕсли;	
							КонецЕсли;	
							
							Пока ПродолжатьОбработку И ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
							
						КонецЕсли;
						
					ИначеЕсли мУСН Тогда // налоговые режимы: УСН и УСН+ЕНВД, с уплатой добровольных взносов
						
						Если ДанныеУчета.ДатаНачалаСобытия < мДатаЗакона180ФЗ Тогда
							
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								ДоляПособияЕНВД = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);
							иначе
								ДоляПособияЕНВД = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							
							// за счет работодателя
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								РезультатЗаСчетРаботодателя = Окр((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);//О.Т. Аверсон 14.03.2016 № 949
							иначе
								РезультатЗаСчетРаботодателя = ОбщегоНазначения.ОкруглитьЗначение2016((ДанныеУчета.Результат - ДоляПособияЕНВД) * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 14.03.2016 № 949
							КонецЕсли;
							
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - ДоляПособияЕНВД - РезультатЗаСчетРаботодателя;
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы;
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							КонецЕсли;
							
							Если СуммаПоСтрокеЕНВД <> 0 Тогда
								Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД Тогда
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								КонецЕсли;
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
								Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
									СтрокаДанных.Результат	 = ДоляПособияЕНВД - Окр(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);	
								иначе
									СтрокаДанных.Результат	 = ДоляПособияЕНВД - ОбщегоНазначения.ОкруглитьЗначение2016(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);	//О.Т. Аверсон 15.03.2016 № 949
								КонецЕсли;						
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
								СтрокаДанных.ОблагаетсяЕНВД = Истина;
								
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНВД; 
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыРасчетовПоСредствамФСС.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
									СтрокаДанных.Результат	 = Окр(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);	
								иначе
									СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДоляПособияЕНВД * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);	//О.Т. Аверсон 15.03.2016 № 949
								КонецЕсли;
								
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
								СтрокаДанных.ОблагаетсяЕНВД = Истина;
							КонецЕсли;
							
							Если РезультатЗаСчетРаботодателя <> 0 Тогда
								
								Если мОбъектНалогообложенияУСН = Перечисления.ОбъектыНалогообложенияПоУСН.Доходы Тогда
									
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
									СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
									СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ЕНприУСН;
									СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
									СтрокаДанных.СубконтоДт2 = Неопределено;
									СтрокаДанных.СубконтоДт3 = Неопределено;
									СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
									СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
									СтрокаДанных.СубконтоКт2 = Неопределено;
									СтрокаДанных.СубконтоКт3 = Неопределено;
									СтрокаДанных.СчетДтНУ	 = Неопределено;
									СтрокаДанных.СчетКтНУ	 = Неопределено;
									СтрокаДанных.СубконтоДтНУ1 = Неопределено;
									СтрокаДанных.СубконтоДтНУ2 = Неопределено;
									СтрокаДанных.СубконтоДтНУ3 = Неопределено;
									СтрокаДанных.СубконтоКтНУ1 = Неопределено;
									СтрокаДанных.СубконтоКтНУ2 = Неопределено;
									СтрокаДанных.СубконтоКтНУ3 = Неопределено;
									СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
									
								Иначе
									
									СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
									Если УказаноОтражениеВУчетеДляРаботодателя Тогда
										ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
										"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
										"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
										СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
										СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
									Иначе // обходим строки и вычисляем долю результата по базовым записям
										// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
										СуммарнаяДоля = 0;
										ПерваяИзГруппыСтрок = Истина;
										Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
											Если Не ДанныеУчета.ЭтоЕНВД Тогда
												// если это не первая из группы "базовых" строк по одной строке основного регистра
												// то создаем очередную строку движений
												Если Не ПерваяИзГруппыСтрок Тогда
													СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
												Иначе
													ПерваяИзГруппыСтрок = Ложь;
												КонецЕсли;
												
												Если СуммаПоСтроке = 0 Тогда
													Доля = 0;
												Иначе
													Если ДанныеУчета.РезультатБаза = NULL Тогда
														Успешно = Ложь;
														Доля = 0;
													Иначе
														Доля = РезультатЗаСчетРаботодателя * ДанныеУчета.РезультатБаза / (СуммаПоСтроке - СуммаПоСтрокеЕНВД);
													КонецЕсли;
												КонецЕсли;
												
												Если ДанныеУчета.СчетДтРазрез = NULL Тогда
													Успешно = Ложь;
												Иначе
													СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
													СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
													СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
													СтрокаДанных.ОтражениеВУСН = Перечисления.ОтражениеВУСН.Принимаются;
												КонецЕсли;
												Если ДанныеУчета.СчетКтРазрез = NULL Тогда
													Успешно = Ложь;
												Иначе
													СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
													СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
													СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
													СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
													СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
													СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
													СтрокаДанных.СубконтоКтНУ2 = Неопределено;
													СтрокаДанных.СубконтоКтНУ3 = Неопределено;
													СтрокаДанных.ОтражениеВУСН = Перечисления.ОтражениеВУСН.Принимаются;
												КонецЕсли;
												
												СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
												СтрокаДанных.Результат = ?(РезультатЗаСчетРаботодателя > 0,Мин(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля),Макс(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля));
												СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
											КонецЕсли;
											Если Не ДанныеУчета.Следующий() Тогда
												ПродолжатьОбработку = Ложь;
												Прервать;
											КонецЕсли;											
										КонецЦикла;		
										// ошибки округления складываются на последнюю запись из группы базовых записей
										СтрокаДанных.Результат = СтрокаДанных.Результат + РезультатЗаСчетРаботодателя - СуммарнаяДоля;
									КонецЕсли;									
								КонецЕсли;									
								
							КонецЕсли;
							
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
							
						Иначе // ДанныеУчета.ДатаНачалаСобытия > мДатаЗакона180ФЗ, налоговые режимы: УСН и УСН+ЕНВД, с уплатой добровольных взносов
							
							СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
							СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
							СтрокаДанных.СубконтоДт2 = Неопределено;
							СтрокаДанных.СубконтоДт3 = Неопределено;
							СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
							СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
							СтрокаДанных.СубконтоКт2 = Неопределено;
							СтрокаДанных.СубконтоКт3 = Неопределено;
							СтрокаДанных.СчетДтНУ	 = Неопределено;
							СтрокаДанных.СчетКтНУ	 = Неопределено;
							СтрокаДанных.СубконтоДтНУ1 = Неопределено;
							СтрокаДанных.СубконтоДтНУ2 = Неопределено;
							СтрокаДанных.СубконтоДтНУ3 = Неопределено;
							СтрокаДанных.СубконтоКтНУ1 = Неопределено;
							СтрокаДанных.СубконтоКтНУ2 = Неопределено;
							СтрокаДанных.СубконтоКтНУ3 = Неопределено;
							СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
							Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);	
							иначе
								СтрокаДанных.Результат	 = ДанныеУчета.Результат - ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);	//О.Т. Аверсон 15.03.2016 № 949
							КонецЕсли;
							
							// здесь ЕСН отдельно - двумя строками
							Если СуммаПоСтроке <> СуммаПоСтрокеЕНВД и мЕНВД Тогда
								СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
								СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС_ДобровольныеВзносы; 
								СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
								СтрокаДанных.СубконтоДт2 = Неопределено;
								СтрокаДанных.СубконтоДт3 = Неопределено;
								СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
								СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
								СтрокаДанных.СубконтоКт2 = Неопределено;
								СтрокаДанных.СубконтоКт3 = Неопределено;
								СтрокаДанных.СчетДтНУ	 = Неопределено;
								СтрокаДанных.СчетКтНУ	 = Неопределено;
								СтрокаДанных.СубконтоДтНУ1 = Неопределено;
								СтрокаДанных.СубконтоДтНУ2 = Неопределено;
								СтрокаДанных.СубконтоДтНУ3 = Неопределено;
								СтрокаДанных.СубконтоКтНУ1 = Неопределено;
								СтрокаДанных.СубконтоКтНУ2 = Неопределено;
								СтрокаДанных.СубконтоКтНУ3 = Неопределено;
								СтрокаДанных.ОтражениеВУСН	 = Перечисления.ОтражениеВУСН.НеПринимаются;
								СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
								СтрокаДанных.ОблагаетсяЕНВД = Истина;
								Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
									СтрокаДанных.Результат	 = Окр(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,2);	
								иначе
									СтрокаДанных.Результат	 = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * СуммаПоСтрокеЕНВД / СуммаПоСтроке,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
								КонецЕсли;
								
							КонецЕсли;
							
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;							
							
						КонецЕсли;
						
					КонецЕсли;
					
				КонецЕсли;
				
			Иначе // налоговые режимы: ОСН, ОСН+ЕНВД но доли ЕНВД нет
				
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
					
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
					Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
				ИначеЕсли  ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ОбщееЗаболевание
					И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаВБыту Тогда
					
					СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
					СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
					СтрокаДанных.СубконтоДт2 = Неопределено;
					СтрокаДанных.СубконтоДт3 = Неопределено;
					СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
					СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
					СтрокаДанных.СубконтоКт2 = Неопределено;
					СтрокаДанных.СубконтоКт3 = Неопределено;
					СтрокаДанных.СчетДтНУ	 = Неопределено;
					СтрокаДанных.СчетКтНУ	 = Неопределено;
					СтрокаДанных.СубконтоДтНУ1 = Неопределено;
					СтрокаДанных.СубконтоДтНУ2 = Неопределено;
					СтрокаДанных.СубконтоДтНУ3 = Неопределено;
					СтрокаДанных.СубконтоКтНУ1 = Неопределено;
					СтрокаДанных.СубконтоКтНУ2 = Неопределено;
					СтрокаДанных.СубконтоКтНУ3 = Неопределено;
					СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
					Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
						Если Не ДанныеУчета.Следующий() Тогда
							ПродолжатьОбработку = Ложь;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
				Иначе // причина ОбщееЗаболевание или ТравмаВБыту
					
					// результат пособия за счет работодателя
					Если ПериодРегистрации < Дата(2016,07,1) Тогда //О.Т. Аверсон 14.03.2016 № 949
						РезультатЗаСчетРаботодателя = Окр(ДанныеУчета.Результат * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,2);	
					иначе
						РезультатЗаСчетРаботодателя = ОбщегоНазначения.ОкруглитьЗначение2016(ДанныеУчета.Результат * ДанныеУчета.ДоляБЛЗаСчетРаботодателя,ПериодРегистрации);//О.Т. Аверсон 15.03.2016 № 949
					КонецЕсли;
					
					
					Если ДанныеУчета.Результат <> РезультатЗаСчетРаботодателя Тогда
						
						// есть доля пособия за счет ФСС
						СтрокаДанных.Результат	 = ДанныеУчета.Результат - РезультатЗаСчетРаботодателя;
						СтрокаДанных.СчетДт 	 = ПланыСчетов.Хозрасчетный.ФСС;
						СтрокаДанных.СубконтоДт1 = Перечисления.ВидыПлатежейВГосБюджет.РасходыПоСтрахованию;
						СтрокаДанных.СубконтоДт2 = Неопределено;
						СтрокаДанных.СубконтоДт3 = Неопределено;
						СтрокаДанных.СчетКт 	 = ПланыСчетов.Хозрасчетный.РасчетыСПерсоналомПоОплатеТруда;
						СтрокаДанных.СубконтоКт1 = ДанныеУчета.ФизЛицо;
						СтрокаДанных.СубконтоКт2 = Неопределено;
						СтрокаДанных.СубконтоКт3 = Неопределено;
						СтрокаДанных.СчетДтНУ	 = Неопределено;
						СтрокаДанных.СчетКтНУ	 = Неопределено;
						СтрокаДанных.СубконтоДтНУ1 = Неопределено;
						СтрокаДанных.СубконтоДтНУ2 = Неопределено;
						СтрокаДанных.СубконтоДтНУ3 = Неопределено;
						СтрокаДанных.СубконтоКтНУ1 = Неопределено;
						СтрокаДанных.СубконтоКтНУ2 = Неопределено;
						СтрокаДанных.СубконтоКтНУ3 = Неопределено;
						СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.ПособияЗаСчетФСС;
						
						Если ЕстьДоляБЛЗаСчетРаботодателя Тогда
							//доля за счет работодателя есть, скорректируем начало периода действия доли за счет ФСС
							СтрокаДанных.БазовыйПериодНачало = Мин(СтрокаДанных.БазовыйПериодКонец, ТретийКалендарныйДень);	
						КонецЕсли;
						
					КонецЕсли;
					
					Если РезультатЗаСчетРаботодателя <> 0 Тогда
						//доля пособия за счет работодателя не равна нулю, произведем отражение в учете
						Если ДанныеУчета.Результат <> РезультатЗаСчетРаботодателя Тогда
							// доля пособия за счет работодателя не равно единицы, создадим новую строку
							СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
						КонецЕсли;
						СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
						Если УказаноОтражениеВУчетеДляРаботодателя Тогда
							ЗаполнитьЗначенияСвойств(СтрокаДанных,ВыборкаПоШапкеДокумента,
							"СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1," +
							"СчетДтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СчетКтНУ,СубконтоКтНУ1,ОтражениеВУСН");
							СтрокаДанных.Результат	 = РезультатЗаСчетРаботодателя;
							СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
						Иначе // обходим строки и вычисляем долю результата по базовым записям
							// суммарная доля, которую уже "разбросали" на строки с одинаковым регистратором и номером строки
							СуммарнаяДоля = 0;
							ПерваяИзГруппыСтрок = Истина;
							Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
								// если это не первая из группы "базовых" строк по одной строке основного регистра
								// то создаем очередную строку движений
								Если Не ДанныеУчета.ЭтоЕНВД Тогда
									
									Если Не ПерваяИзГруппыСтрок Тогда
										СтрокаДанных = СоздатьСтрокуДвижений(ДанныеУчета, НаборЗаписей);
										СтрокаДанных.БазовыйПериодКонец = Мин(СтрокаДанных.БазовыйПериодКонец, ВторойКалендарныйДень);
									Иначе
										ПерваяИзГруппыСтрок = Ложь;
									КонецЕсли;
									
									Если СуммаПоСтроке = 0 Тогда
										Доля = 0;
									Иначе
										Если ДанныеУчета.РезультатБаза = NULL Тогда
											Успешно = Ложь;
											Доля = 0;
										Иначе
											Доля = РезультатЗаСчетРаботодателя * ДанныеУчета.РезультатБаза / СуммаПоСтроке;
										КонецЕсли;
									КонецЕсли;
									
									Если ДанныеУчета.СчетДтРазрез = NULL Тогда
										Успешно = Ложь;
									Иначе
										СтрокаДанных.СчетДт 	 = ДанныеУчета.СчетДтРазрез;
										СтрокаДанных.СубконтоДт1 = ПолучитьСубконто(ДанныеУчета.СубконтоДт1Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДт2 = ПолучитьСубконто(ДанныеУчета.СубконтоДт2Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДт3 = ПолучитьСубконто(ДанныеУчета.СубконтоДт3Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СчетДтНУ	 = ДанныеУчета.СчетДтНУРазрез;
										СтрокаДанных.СубконтоДтНУ1 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ1Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДтНУ2 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ2Разрез, ПараметрыПолученияСубконто);
										СтрокаДанных.СубконтоДтНУ3 = ПолучитьСубконто(ДанныеУчета.СубконтоДтНУ3Разрез, ПараметрыПолученияСубконто);
									КонецЕсли;
									Если ДанныеУчета.СчетКтРазрез = NULL Тогда
										Успешно = Ложь;
									Иначе
										СтрокаДанных.СчетКт 	 = ДанныеУчета.СчетКтРазрез;
										СтрокаДанных.СубконтоКт1 = ДанныеУчета.СубконтоКт1Разрез;
										СтрокаДанных.СубконтоКт2 = ДанныеУчета.СубконтоКт2Разрез;
										СтрокаДанных.СубконтоКт3 = ДанныеУчета.СубконтоКт3Разрез;
										СтрокаДанных.СчетКтНУ	 = ДанныеУчета.СчетКтНУРазрез;
										СтрокаДанных.СубконтоКтНУ1 = ДанныеУчета.СубконтоКтНУ1Разрез;
										СтрокаДанных.СубконтоКтНУ2 = Неопределено;
										СтрокаДанных.СубконтоКтНУ3 = Неопределено;
									КонецЕсли;
									
									СтрокаДанных.КодДоходаЕСН = Справочники.ДоходыЕСН.НеОблагаетсяЦеликом;
									СтрокаДанных.Результат = ?(РезультатЗаСчетРаботодателя > 0,Мин(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля),Макс(Доля,РезультатЗаСчетРаботодателя - СуммарнаяДоля));
									СуммарнаяДоля = СуммарнаяДоля + СтрокаДанных.Результат;
								КонецЕсли;
								Если Не ДанныеУчета.Следующий() Тогда
									ПродолжатьОбработку = Ложь;
									Прервать;
								КонецЕсли;
							КонецЦикла;
							// ошибки округления складываются на последнюю запись из группы базовых записей
							СтрокаДанных.Результат = СтрокаДанных.Результат + РезультатЗаСчетРаботодателя - СуммарнаяДоля;
						КонецЕсли;
					Иначе
						Пока ДанныеУчета.НомерСтроки = ТекущийНомерСтроки Цикл
							Если Не ДанныеУчета.Следующий() Тогда
								ПродолжатьОбработку = Ложь;
								Прервать;
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;
	
	НаборЗаписей.Свернуть("КодДоходаЕСН,ОблагаетсяЕНВД,СчетДт,СубконтоДт1,СубконтоДт2,СубконтоДт3,СчетКт,СубконтоКт1,СубконтоКт2,СубконтоКт3,СчетДтНУ,СчетКтНУ,СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СубконтоКтНУ1,СубконтоКтНУ2,СубконтоКтНУ3,ОтражениеВУСН,БазовыйПериодНачало, БазовыйПериодКонец, Сторно","Результат");
	
	ОтражениеВУчете.Загрузить(НаборЗаписей);
	
	Если ФормироватьДвижения Тогда
		
		Движения.ОсновныеНачисленияРаботниковОрганизаций.Очистить();
		Движения.РасчетСреднегоЗаработка.Очистить();
		
		Для Каждого Набор Из Движения Цикл
			Если ТипЗнч(Набор)=Тип("РегистрРасчетаНаборЗаписей.ОсновныеНачисленияРаботниковОрганизаций") 
				или ТипЗнч(Набор)=Тип("РегистрРасчетаНаборЗаписей.РасчетСреднегоЗаработка") Тогда
				Набор.Записать();
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли; 
	
	Возврат Успешно
	
КонецФункции

// Получает значение субконто в том случае, если заданы правила его переопределения
//
// Параметры
//  Субконто - начальное значение субконто
//  ПараметрыПолученияСубконто - соответсвие, 
//                              ключ соответсвия - тип, 
//                              значение - параметры, которые помогают преобразовывать 
//                              субконто соотв. типа из одного значения в другое
//
// Возвращаемое значение:
//   Субконто
// Если для субконто некоторого типа не задаы параметры преобразования, то его 
// значение не изменяется
//
Функция ПолучитьСубконто(Субконто, ПараметрыПолученияСубконто)
	
	Параметры = ПараметрыПолученияСубконто[ТипЗнч(Субконто)];
	Если Параметры = НеОпределено Тогда
		// для субконто этого типа не заданы парамтры переопределения
		Возврат Субконто;
	КонецЕсли;
	// для статьи затрат
	Если ТипЗнч(Субконто) = Тип("СправочникСсылка.СтатьиЗатрат") Тогда
		ВидСтатьиЗатрат = Параметры.ВидСтатьиЗатрат;
		ДополнительныеСтатьиЗатрат = Параметры.ДополнительныеСтатьиЗатрат;
		КлючПоиска = Новый Структура("ВидСтатьиЗатрат, СтатьяЗатратНачисления", ВидСтатьиЗатрат, Субконто);
		Строки = ДополнительныеСтатьиЗатрат.НайтиСтроки(КлючПоиска);
		Если Строки.Количество() = 0 Тогда
			КлючПоиска = Новый Структура("ВидСтатьиЗатрат, СтатьяЗатратНачисления", ВидСтатьиЗатрат, Справочники.СтатьиЗатрат.ПустаяСсылка());
			Строки = ДополнительныеСтатьиЗатрат.НайтиСтроки(КлючПоиска);
			Если Строки.Количество() = 0 Тогда
				Возврат Субконто;
			Иначе
				Возврат Строки[0].СтатьяЗатрат;
			КонецЕсли;
		Иначе
			Возврат Строки[0].СтатьяЗатрат;
		КонецЕсли;
		// для получения субконто другого типа - дописываем ИначеЕсли...
	Иначе
		Возврат Субконто;
	КонецЕсли;
	
КонецФункции

// Заполняет документ по перерассчитываемому документу
// ИсходныйДокумент - тип ДокументОбъект.НачислениеПоБольничномуЛисту
//
Процедура ЗаполнитьПоПерерассчитываемомуДокументу(ИсходныйДокумент, Сотрудники = Неопределено) Экспорт
	
	ПерерассчитываемыйДокумент = ИсходныйДокумент.Ссылка;
	ЗаполнитьЗначенияСвойств(ЭтотОбъект,ИсходныйДокумент,,
	"Проведен, Номер, Дата, ПометкаУдаления, ПерерассчитываемыйДокумент, ПериодРегистрации, Комментарий, Ответственный"); // кроме указанных
	
КонецПроцедуры // ЗаполнитьПоПерерассчитываемомуДокументу()

// Формирует таблицу значений, описывающую размеры выплаты пособия по периодам
//
Функция ЗаполнитьТаблицуИнтервалов(ДатаНачалаСобытия, ВидРасчетаОтПричины) Экспорт 
	
	ТаблицаИнтерваловОплаты = Новый ТаблицаЗначений;
	ТаблицаИнтерваловОплаты.Колонки.Добавить("Начало",Новый ОписаниеТипов("Дата",,,Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	ТаблицаИнтерваловОплаты.Колонки.Добавить("Расчет",Новый ОписаниеТипов("ПланВидовРасчетаСсылка.ДополнительныеНачисленияОрганизаций"));
	ТаблицаИнтерваловОплаты.Колонки.Добавить("ПроцентОплаты",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(6,2)));
	
	// в зависимости от причины нетрудоспособности оплачивается разное количество дней; процент оплаты также меняется
	Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.БольничныйЛистАлкоголь тогда
		КоэффициентПроцента = 0.5;
	Иначе
		КоэффициентПроцента = 1;
	КонецЕсли;
	
	ДатаОкончанияОплаты = Датаокончания;
	//Если ЗначениеЗаполнено(ДатаНарушенияРежима) И ДатаОкончания >= ДатаНарушенияРежима Тогда
	//	 ДатаОкончанияОплаты = ДатаНарушенияРежима-мДлинаСуток;
	//КонецЕсли;
	//Островская Татьяна 11.09.2013 № 16778
	если ТипРасчета = Перечисления.ТипРасчетаБЛ.БПМ Тогда 
		ПроцентОплаты = 100;
	КонецЕсли;
	//Островская Татьяна 11.09.2013 № 16778
	
	Если ПроцентОплаты = 80 Тогда
		
		ДниНеПолнойОплаты = 0;
		
		Если ПервичныйбольничныйЛист = Документы.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка() тогда
			//Островская Татьяна 12.07.2013 № 16623
			если КалендарныеДни Тогда
				ДниНеПолнойОплаты = 12;
				Если ДатаНачала >= Дата('20240701') Тогда 
					ДниНеПолнойОплаты = ДнейОплаты;
				КонецЕсли;
			иначе
				ДниНеПолнойОплаты = 6;
			КонецЕсли;
			//Островская Татьяна 22.07.2013 № 16623
		Иначе
			Если ПервичныйБольничныйЛист.ПроцентОплаты = 80 тогда
				НачалоПервичного = ПервичныйБольничныйЛист.ДатаНачала;
				ОкончаниеПервичного = ПервичныйБольничныйЛист.ДатаОкончания;
				//толик не нужно рассчитывать оплаченные дни т.к дата начала берется датой начала первичного б.л.
				//				ДниОплаченныеПоПервичномуБольничномуЛисту = (ОкончаниеПервичного - НачалоПервичного) / мДлинаСуток;
				//				ДниНеПолнойОплаты = МАКС(6 - (ДниОплаченныеПоПервичномуБольничномуЛисту),0);
				//толик добавляем выходные при разрыве больничного листа
				мВыходные = 0;
				Если ДеньНедели(ОкончаниеПервичного)=5 И ДеньНедели(ДатаНачала)=1 Тогда
					мВыходные = 2;
				КонецЕсли; 
				//Островская Татьяна 12.07.2013 № 16623
				если КалендарныеДни Тогда
					ДниНеПолнойОплаты = 12 + мВыходные; 
				иначе
					ДниНеПолнойОплаты = 6 + мВыходные;
				КонецЕсли;
				Если ДатаНачала >= Дата('20240701') Тогда 
					ДниНеПолнойОплаты = 150;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
		//Островская Татьяна 19.07.2013 № 16645
		если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.БольничныйЛистАлкоголь и КалендарныеДни Тогда 		
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия, 				   ВидРасчетаОтПричины, 0);
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия + 6 * мДлинаСуток, ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
		иначе
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия, 				   ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
		КонецЕсли;
		если ЗначениеЗаполнено(ДатаНарушенияРежима) и ЗначениеЗаполнено(ДатаНарушенияРежимаКон) тогда
			если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.БольничныйЛистАлкоголь и КалендарныеДни Тогда
				если ДатаНарушенияРежима < ДатаНачалаСобытия + 6 * мДлинаСуток Тогда 
					ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия + 6 * мДлинаСуток,  ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
				иначе	
					ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНарушенияРежима,  ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
				КонецЕсли;
			иначе	
				ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНарушенияРежима,  ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
			КонецЕсли;
		КонецЕсли; 
		//Островская Татьяна 19.07.2013 № 16645
		если ДатаНарушенияРежимаКон > ДатаНачалаСобытия + дниНеПолнойОплаты * мДлинаСуток тогда 
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия + дниНеПолнойОплаты * мДлинаСуток, ВидРасчетаОтПричины, 100 * КоэффициентПроцента);
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНарушенияРежимаКон+мДлинаСуток,  ВидРасчетаОтПричины, 100 * КоэффициентПроцента);
		иначе
			если  не (ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.БольничныйЛистАлкоголь и КалендарныеДни) Тогда
				ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНарушенияРежимаКон+мДлинаСуток,  ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
			иначе
				если ЗначениеЗаполнено(ДатаНарушенияРежимаКон) Тогда 
					ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНарушенияРежимаКон+мДлинаСуток,  ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
				КонецЕсли;
			КонецЕсли;
			ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия + дниНеПолнойОплаты * мДлинаСуток, ВидРасчетаОтПричины, 100 * КоэффициентПроцента);
		КонецЕсли;
		//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
		
		ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаОкончанияОплаты + мДлинаСуток, 		   ВидРасчетаОтПричины, 0);
		
	Иначе
		
		ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаНачалаСобытия, 		   ВидРасчетаОтПричины, ПроцентОплаты * КоэффициентПроцента);
		ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаОкончанияОплаты + мДлинаСуток, ВидРасчетаОтПричины, 0);
		ДобавитьСтрокуВТаблицуИнтервалов(ТаблицаИнтерваловОплаты, ДатаОкончанияОплаты + мДлинаСуток, ВидРасчетаОтПричины, 0);
		
	КонецЕсли;
	
	Возврат ТаблицаИнтерваловОплаты
	
	
КонецФункции // ЗаполнитьТаблицуИнтервалов()

// Возвращает дату начала события
Функция ПолучитьДатуНачалаСобытия() Экспорт
	
	Если ЗначениеЗаполнено(ПервичныйБольничныйЛист) Тогда
		Возврат ПервичныйБольничныйЛист.ДатаНачала;
	Иначе
		Возврат ДатаНачала;
	КонецЕсли;
	
КонецФункции // ПолучитьДатуНачалаСобытия()

// Возвращает вид расчета, соответствующий причине нетрудоспособности
//
// Параметры
//  Причина  – <ПеречислениеСсылка.ПричиныНетрудочпособности> – причина нетрудоспособности
//
// Возвращаемое значение:
//   ПланыВидовРасчетаСсылка.ОсновныеНачисленияОрганизаций   – вид расчета
//
Функция ПолучитьВидРасчетаОтПричиныНетрудоспособности(Причина) Экспорт
	
	Если Причина = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда
		Возврат ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОплатаБЛПоБеременностиИРодам;
		
	ИначеЕсли Причина = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
		Возврат ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОплатаБЛТравмаНаПроизводстве;
	ИначеЕсли Причина = Перечисления.ПричиныНетрудоспособности.ПоУходу Тогда
		Возврат ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОплатаБЛПоУходу;	
	Иначе
		Возврат ПланыВидовРасчета.ДополнительныеНачисленияОрганизаций.ОплатаБЛОбщееЗаболевание;
		
	КонецЕсли;
	
КонецФункции // ПолучитьВидРасчетаОтПричиныНетрудоспособности()

// Возвращает доступные варианты печати документа
//
// Возвращаемое значение:
//	Структура, каждая строка которой соответствует одному из вариантов печати
//	
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	//Усков Сергей 08.08.2013 № 16699+
	//Возврат Новый Структура("РасчетСреднегоЗаработка","Расчет среднего заработка");  //Аверсон 24.11.2020 КВВ СВФР-006808 закомментировано
	Результат = Новый Структура();
	Результат.Вставить("РасчетСреднегоЗаработка","Расчет среднего заработка");
	Результат.Вставить("Оборот11072013","Форма с 11.07.13"); //Аверсон 24.11.2020 КВВ СВФР-006808
	Возврат Результат;
	//Усков Сергей 08.08.2013 № 16699+
КонецФункции // ПолучитьСтруктуруПечатныхФорм()


// Процедура осуществляет печать документа. Можно направить печать на 
// экран или принтер, а также распечатать необходмое количество копий.
//
//  Название макета печати передается в качестве параметра,
// по переданному названию находим имя макета в соответствии.
//
// Параметры:
//  НазваниеМакета - строка, название макета.
//
Функция Печать(ИмяМакета, КоличествоЭкземпляров = 1, НаПринтер = Ложь) Экспорт
	
	Если Не Проведен Тогда
		//О.Т. Аверсон 24.02.2017 № 346
		ТекстВопроса = "Документ можно распечатать только после расчета и проведения! Провести?";
		Ответ = Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет);
		Если Ответ = КодВозвратаДиалога.Нет Тогда
			Возврат Неопределено;
		иначе
			попытка
				ЭтотОбъект.Записать(РежимЗаписиДокумента.Проведение);
			Исключение
				Возврат Неопределено;
			КонецПопытки;
		КонецЕсли;
		//О.Т. Аверсон 24.02.2017 № 346
		
	КонецЕсли;
	
	//Аверсон 24.11.2020 КВВ СВФР-006808 (
	Если ИмяМакета = "Оборот11072013" Тогда
		ПечатьОборота11072013(ИмяМакета,КоличествоЭкземпляров,НаПринтер);
		Возврат Неопределено;
	КонецЕсли;
	//Аверсон 24.11.2020 КВВ СВФР-006808 )
	
	//Островская Татьяна 17.04.2014 № 17287
	ТочностьСреднего = Константы.ТочностьСреднегоЗаработка.Получить();
	Если ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр0 Тогда 
		ЗначениеТочностьСреднего = 0;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр1 Тогда 
		ЗначениеТочностьСреднего = 1;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр2 Тогда 
		ЗначениеТочностьСреднего = 2;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр3 Тогда 
		ЗначениеТочностьСреднего = 3;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр4 Тогда 
		ЗначениеТочностьСреднего = 4;
	иначе
		ЗначениеТочностьСреднего = 0;
	КонецЕсли;
	//Островская Татьяна 17.04.2014 № 17287
	
	
	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_НачислениеПоБольничномуЛистуПоДоговорамПодряда_Оборот";
	ТабДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
	
	ВыборкаПоШапкеДокументадляПечати = СформироватьЗапросПоШапкеДляПечати().Выбрать();
	ВыборкаПоШапкеДокументадляПечати.Следующий();
	
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	// Определение даты начала и конца оплачиваемого события 
	
	ДатаНачалаСобытия 			= ВыборкаПоШапкеДокумента.ДатаНачала;
	ДатаОкончанияСобытия 		= ВыборкаПоШапкеДокумента.ДатаОкончания;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Регистратор", Ссылка);
	Запрос.УстановитьПараметр("ФизЛицо", ФизЛицо);
	//Запрос.УстановитьПараметр("Приказ", Приказ);
	Запрос.УстановитьПараметр("ДатаНачалаСобытия", ДатаНачалаСобытия);
	
	//Выборка годовой премии
	
	Запрос.Текст = "ВЫБРАТЬ
	|	СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.Результат) КАК Результат,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	|	НачислениеПоБольничнымЛистамРасчетСреднего.Результат <> 0
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.ВидРасчета = &ВидРасчетаПоГодовойПремии
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации";
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоГодовойПремии", ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	Годовая = Запрос.Выполнить().Выбрать();
	годоваяВМесяц = 0;
	Если Годовая.Следующий() тогда
		ГодоваяВМесяц = Годовая.Результат / 12 * Годовая.КоэффициентИндексации;
	КонецЕсли;
	
	// Запрос выборки среднего заработка
	
	Запрос.Текст = "ВЫБРАТЬ
	|	СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.Результат) КАК Результат,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТарифнаяСтавкаПериода,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТекущаяТарифнаяСтавка,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	//|	НачислениеПоБольничнымЛистамРасчетСреднего.Результат <> 0
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	//	               |	И НачислениеПоБольничнымЛистамРасчетСреднего.ВидРасчета <> &ВидРасчетаПоГодовойПремии
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТарифнаяСтавкаПериода,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТекущаяТарифнаяСтавка
	|	УПОРЯДОЧИТЬ ПО
	|	МесяцВыборки";
	
	Измерения = Новый Массив(1);
	Измерения[0] = "Сотрудник";
	
	// основные начисления собираем по периодам действия
	РазрезыОсновных = Новый Массив(1);
	РазрезыОсновных[0] = "ПериодДействия";
	
	// дополнительные начисления собираем по периодам регистрации
	РазрезыДополнительных = Новый Массив(2);
	РазрезыДополнительных[0] = "ПериодРегистрации";
	РазрезыДополнительных[1] = "ЧислоМесяцев";
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("Измерения", Измерения);
	Запрос.УстановитьПараметр("РазрезыОсновных", РазрезыОсновных);
	Запрос.УстановитьПараметр("РазрезыДополнительных", РазрезыДополнительных);
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоГодовойПремии", ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	ТаблицаСреднего = Новый ТаблицаЗначений;        
	ТаблицаСреднего.Колонки.Добавить("Месяц");
	ТаблицаСреднего.Колонки.Добавить("Сумма");
	ТаблицаСреднего.Колонки.Добавить("Описание");
	
	ВыборкаСреднегоЗаработка = Запрос.Выполнить().Выбрать();
	
	// Запрос выборки отработанного времени
	ТекстЗапроса = "ВЫБРАТЬ
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	//|	НачислениеПоБольничнымЛистамРасчетСреднего.Результат <> 0
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.ВидРасчета = &ВидРасчетаПоЗаработку
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки";
	
	Если СпособРасчетаВДнях Тогда //Островская Татьяна 10.06.2014 № 17421
		//если СпособРасчетаВЧасах Тогда 
		//ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке","СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке");
		//иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке","СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноДней) КАК ОтработаноПоПятидневке");
		//КонецЕсли;	
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке","СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке");
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("Измерения", Измерения);
	Запрос.УстановитьПараметр("РазрезыОсновных", РазрезыОсновных);
	Запрос.УстановитьПараметр("РазрезыДополнительных", РазрезыДополнительных);
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоЗаработку", ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	ТаблицаСреднего.Колонки.Добавить("Отработано");
	
	ВыборкаОтработаноПоПятидневке = Запрос.Выполнить().Выгрузить();
	
	Макет = ПолучитьМакет("Оборот");
	
	// вывод лицевой стороны
	СекцияЛицеваяСторона = Макет.ПолучитьОбласть("ЛицеваяСторона");
	//Аверсон-софт, Островская Татьяна 11.06.2012 № 15476
	СекцияЛицеваяСторона.Параметры.ДатаНачала = ВыборкаПоШапкеДокумента.ДатаНачала;
	СекцияЛицеваяСторона.Параметры.ДатаОкончания = ВыборкаПоШапкеДокумента.ДатаОкончания;
	СекцияЛицеваяСторона.Параметры.МесяцНачисления = Формат(ВыборкаПоШапкеДокумента.ПериодРегистрации, "ДФ='MMMM'");
	
	//Аверсон-софт, Островская Татьяна 11.06.2012 № 15476
	СекцияЛицеваяСторона.Параметры.Заполнить(ВыборкаПоШапкеДокументаДляПечати);
	
	Попытка
		СекцияЛицеваяСторона.Параметры.ДатаПриема = ПрочиеПроцедуры.ПолучитьДанныеОСотруднике('18000101000000', ЭтотОбъект.Сотрудник, 0,Организация).Период;//О.Т. Аверсон 16.10.2017 № 1120
		
	Исключение
	КонецПопытки;
	
	ТабДокумент.Вывести(СекцияЛицеваяСторона);
	
	Если ДвоичныеДанныеСообщенияПортала.Получить() = Неопределено Тогда //ПСА 12.08.2024 +++
	// Вывод сведений о порядке расчета среднего заработка
	СекцияРасчетСреднего = Макет.ПолучитьОбласть("РасчетСреднегоИ");
	СекцияРасчетСреднегоИтог = Макет.ПолучитьОбласть("РасчетСреднегоИИтог"); //Островская Татьяна 22.07.2013 № 16645
	СекцияРасчетСреднего1 = Макет.ПолучитьОбласть("РасчетСреднего");
	РасчетСреднего1 = Макет.ПолучитьОбласть("РасчетСреднего1");
	если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда 
		СекцияРасчетСреднего1.Параметры.ДниШапка = "Раб. дни/часы для расчета";
	иначе
		СекцияРасчетСреднего1.Параметры.ДниШапка = "Кал. дни для расчета";
	КонецЕсли;
	ТабДокумент.Вывести(СекцияРасчетСреднего1);
	
	// вывод данных о сумме заработка за расчетный период
	НомерСтроки = 0;
	ИтогоЗаработок = 0;
	ИтогоОтработано = 0;
	СтруктураПоиска = Новый Структура("МесяцВыборки");
	Пока ВыборкаСреднегоЗаработка.Следующий() Цикл
		//Островская Татьяна 06.06.2014 № 17416
		мНорма = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(ВыборкаСреднегоЗаработка.МесяцВыборки), КонецМесяца(ВыборкаСреднегоЗаработка.МесяцВыборки), Сотрудник);
		//Островская Татьяна 11.09.2013 № 16778
		ЗапросВидРасчета = Новый Запрос;
		ЗапросВидРасчета.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ОсновныеНачисленияРаботниковОрганизаций.ВидУчетаВремени
		|ИЗ
		|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисленияРаботниковОрганизаций
		|ГДЕ
		|	ОсновныеНачисленияРаботниковОрганизаций.ПериодРегистрации = &ПериодРегистрации
		|	И ОсновныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
		|	И ОсновныеНачисленияРаботниковОрганизаций.ВидРасчета В(&ВидРасчета)";
		ВидРасчетаСписок = Новый СписокЗначений;
		ВидРасчетаСписок.Добавить(ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ОкладПоДням);
		ВидРасчетаСписок.Добавить(ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ОкладПоЧасам);
		ВидРасчетаСписок.Добавить(ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ТарифЧасовой);
		ВидРасчетаСписок.Добавить(ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ТарифДневной);
		ЗапросВидРасчета.УстановитьПараметр("ВидРасчета",ВидРасчетаСписок);	
		ЗапросВидРасчета.УстановитьПараметр("Сотрудник",Сотрудник);	
		ЗапросВидРасчета.УстановитьПараметр("ПериодРегистрации",ВыборкаСреднегоЗаработка.МесяцВыборки);
		РезультВидУчета = ЗапросВидРасчета.Выполнить().Выгрузить();
		ВидУчетаВремени = Неопределено;
		
		если РезультВидУчета.Количество() > 0 Тогда 
			ВидУчетаВремени = РезультВидУчета[0].ВидУчетаВремени;
		КонецЕсли;
		
		
		ЗаписиДанныхДляСреднего =
		"ВЫБРАТЬ
		|	ЗаписиРасчетаСреднего.НомерСтроки КАК НомерСтроки,
		|	ЗаписиРасчетаСреднего.БазовыйПериодНачало КАК БазовыйПериодНачало,
		|	ЗаписиРасчетаСреднего.БазовыйПериодКонец КАК БазовыйПериодКонец,
		|	ЗаписиРасчетаСреднего.Сотрудник КАК Сотрудник,
		|	ЗаписиРасчетаСреднего.Организация КАК Организация,
		//|	ЗаписиРасчетаСреднего.Приказ КАК Приказ,
		|	ЗаписиРасчетаСреднего.ДатаНачалаРасчетногоПериода КАК ДатаНачалаРасчетногоПериода,
		|	ЗаписиРасчетаСреднего.ДатаОкончанияРасчетногоПериода КАК ДатаОкончанияРасчетногоПериода,
		|	ЗаписиРасчетаСреднего.ВидРасчета КАК ВидРасчета,
		|	ЗаписиРасчетаСреднего.СпособРасчета КАК СпособРасчета,
		|	ЗаписиРасчетаСреднего.МесяцВыборки
		|ИЗ
		|	РегистрРасчета.РасчетСреднегоЗаработка КАК ЗаписиРасчетаСреднего
		|ГДЕ
		|	ЗаписиРасчетаСреднего.Регистратор = &парамРегистратор
		|	И ЗаписиРасчетаСреднего.ВидРасчета В(&Заработок)";
		
		
		НормаПоШестидневкеТекст = 
		"ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ДатаКалендаря, МЕСЯЦ) КАК МесяцПериода,
		|	СУММА(ПроизводственныйКалендарь.Шестидневка) КАК ДнейПоШестидневке
		|ИЗ
		|	РегистрСведений.РегламентированныйПроизводственныйКалендарь КАК ПроизводственныйКалендарь
		|ГДЕ
		|	ПроизводственныйКалендарь.ДатаКалендаря >= &парамДатаС
		|	И ПроизводственныйКалендарь.ДатаКалендаря <= &парамДатаПо
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ДатаКалендаря, МЕСЯЦ)";
		
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ОтработанноеВремя.НомерСтроки КАК НомерСтроки,
		|	ОтработанноеВремя.МесяцВыборки КАК МесяцВыборки,
		|	ОтработанноеВремя.ОтработаноДней КАК ОтработаноДней,
		|	ОтработанноеВремя.ОтработаноЧасов КАК ОтработаноЧасов
		|ИЗ
		|	(ВЫБРАТЬ
		|		ЗаписиРасчетаСреднего.НомерСтроки КАК НомерСтроки,
		|		ОтработанноеВремя.ПериодДействия КАК Месяцвыборки,
		|		СУММА(ВЫБОР
		|			КОГДА ЗаписиРасчетаСреднего.СпособРасчета В (&парамНеОтпуск)
		|				ТОГДА ОтработанноеВремя.ОтработаноДней
		|			ИНАЧЕ ВЫБОР
		|					КОГДА ВЫБОР
		|								КОГДА ОтработанноеВремя.ВидРасчета В (&Прогулы)
		|									ТОГДА ОтработанноеВремя.НормаДнейПоПятидневке
		|								ИНАЧЕ ОтработанноеВремя.ОтработаноДнейПоПятидневке
		|							КОНЕЦ < ОтработанноеВремя.НормаДнейПоПятидневке
		|						ТОГДА ВЫБОР
		|								КОГДА ЗаписиРасчетаСреднего.СпособРасчета = &парамПоШестидневке
		|									ТОГДА ОтработанноеВремя.ОтработаноДнейПоПятидневке * 1.2
		|								КОГДА ОтработанноеВремя.ВидРасчета = &ПарамОтпуск
		|									ТОГДА ОтработанноеВремя.НормаДней
		
		|								ИНАЧЕ ОтработанноеВремя.ОтработаноДней //СУММА(ОтработанноеВремя.ОтработаноДнейПоПятидневке) * 1.4
		|							КОНЕЦ
		|					КОГДА ОтработанноеВремя.ВидРасчета = &ПарамОтпуск
		|							ТОГДА ОтработанноеВремя.НормаДней
		|					ИНАЧЕ ВЫБОР
		|							КОГДА ЗаписиРасчетаСреднего.СпособРасчета = &парамПоШестидневке
		|								ТОГДА НормаПоШестидневке.ДнейПоШестидневке
		|							ИНАЧЕ ОтработанноеВремя.НормаДней //29.7
		|						КОНЕЦ
		|				КОНЕЦ
		|		КОНЕЦ) КАК ОтработаноДней, //Островская Татьяна 27.05.2014 № 17387
		|		СУММА(ВЫБОР
		|			КОГДА ЗаписиРасчетаСреднего.СпособРасчета В (&парамНеОтпуск)
		|				ТОГДА ВЫБОР КОГДА ОтработанноеВремя.ВидРасчета В (&ДетскийДень) ТОГДА 0 ИНАЧЕ ОтработанноеВремя.ОтработаноЧасов КОНЕЦ //толик
		|			ИНАЧЕ ВЫБОР
		|				КОГДА ОтработанноеВремя.ВидРасчета В (&Прогулы)
		|					ТОГДА ОтработанноеВремя.НормаЧасов
		|				КОГДА ОтработанноеВремя.ВидРасчета = &ПарамОтпуск
		|					ТОГДА ОтработанноеВремя.НормаЧасов
		|				ИНАЧЕ ОтработанноеВремя.ОтработаноЧасов
		|			КОНЕЦ 
		|		КОНЕЦ) КАК ОтработаноЧасов //Островская Татьяна 27.05.2014 № 17387
		
		|	ИЗ
		|		(" + ЗаписиДанныхДляСреднего + ") КАК ЗаписиРасчетаСреднего
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОтработанноеВремя
		|			ПО ЗаписиРасчетаСреднего.Сотрудник = ОтработанноеВремя.Сотрудник
		|				И ЗаписиРасчетаСреднего.Организация = ОтработанноеВремя.Организация
		|				И ЗаписиРасчетаСреднего.ДатаНачалаРасчетногоПериода <= ОтработанноеВремя.БазовыйПериодКонец
		|				И ЗаписиРасчетаСреднего.ДатаОкончанияРасчетногоПериода >= ОтработанноеВремя.БазовыйПериодНачало
		|				И ((ЗаписиРасчетаСреднего.ДатаНачалаРасчетногоПериода = ЗаписиРасчетаСреднего.БазовыйПериодНачало
		|							И НАЧАЛОПЕРИОДА(ЗаписиРасчетаСреднего.БазовыйПериодНачало, МЕСЯЦ) <= ОтработанноеВремя.ПериодДействия
		|						ИЛИ ЗаписиРасчетаСреднего.ДатаНачалаРасчетногоПериода < ЗаписиРасчетаСреднего.БазовыйПериодНачало
		|							И ЗаписиРасчетаСреднего.БазовыйПериодНачало <= ОтработанноеВремя.ПериодДействия)
		|						И НАЧАЛОПЕРИОДА(ЗаписиРасчетаСреднего.БазовыйПериодКонец, МЕСЯЦ) >= ОтработанноеВремя.ПериодДействия
		|					ИЛИ ЗаписиРасчетаСреднего.ВидРасчета = &ФиксПремии)
		|			ЛЕВОЕ СОЕДИНЕНИЕ (" + НормаПоШестидневкеТекст + ") КАК НормаПоШестидневке
		|			ПО НормаПоШестидневке.МесяцПериода = ОтработанноеВремя.ПериодДействия
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ЗаписиРасчетаСреднего.НомерСтроки,
		|		ЗаписиРасчетаСреднего.МесяцВыборки,
		|		ОтработанноеВремя.ПериодДействия) КАК ОтработанноеВремя
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки";
		ЗапросПВР = Новый Запрос(
		"ВЫБРАТЬ
		|	ОсновныеНачисленияОрганизаций.Ссылка
		|ИЗ
		|	ПланВидовРасчета.ОсновныеНачисленияОрганизаций КАК ОсновныеНачисленияОрганизаций
		|ГДЕ
		|	ОсновныеНачисленияОрганизаций.ЗачетНормыВремени
		|	И ОсновныеНачисленияОрганизаций.ОбозначениеВТабелеУчетаРабочегоВремени = &Прогул");
		ЗапросПВР.УстановитьПараметр("Прогул", Справочники.КлассификаторИспользованияРабочегоВремени.Прогулы);
		Запрос.УстановитьПараметр("Прогулы", ЗапросПВР.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка"));
		ЗапросПР = Новый Запрос(
		"ВЫБРАТЬ
		|	ОсновныеНачисленияОрганизаций.Ссылка
		|ИЗ
		|	ПланВидовРасчета.ОсновныеНачисленияОрганизаций КАК ОсновныеНачисленияОрганизаций
		|ГДЕ
		|	ОсновныеНачисленияОрганизаций.ЗачетНормыВремени
		|	И ОсновныеНачисленияОрганизаций.ОбозначениеВТабелеУчетаРабочегоВремени В (&Простои)");
		СписокПростоев = Новый Массив();
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.Болезнь);
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.БолезньБезОплаты);
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ВынужденныйПрогул);
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ОтпускНаОбучениеНеоплачиваемый);
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.Простой);
		СписокПростоев.Добавить(Справочники.КлассификаторИспользованияРабочегоВремени.ПростойПоВинеРаботодателя);
		ЗапросПР.УстановитьПараметр("Простои", СписокПростоев);
		//толик
		СписокДД = Новый Массив();
		СписокДД.Добавить(ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.НайтиПоКоду("031"));
		Запрос.УстановитьПараметр("ДетскийДень", СписокДД);
		//
		Запрос.УстановитьПараметр("Простои", ЗапросПР.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка"));
		Заработок = Новый Массив();
		Заработок.Добавить(ПланыВидовРасчета.СреднийЗаработок.ПоЗаработку);
		Заработок.Добавить(ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуОтпуск);
		Заработок.Добавить(ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ);
		//Заработок.Добавить(ПланыВидовРасчета.СреднийЗаработок.ПоПремиям);
		//Заработок.Добавить(ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
		Запрос.УстановитьПараметр("Заработок", Заработок);
		Запрос.УстановитьПараметр("ФиксПремии", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
		Запрос.УстановитьПараметр("парамДатаС", НачалоМесяца(ВыборкаСреднегоЗаработка.МесяцВыборки));
		Запрос.УстановитьПараметр("парамДатаПо", КонецМесяца(ВыборкаСреднегоЗаработка.МесяцВыборки));
		СписокСпособов = Новый Массив();
		СписокСпособов.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработку);
		СписокСпособов.Добавить(Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
		Запрос.УстановитьПараметр("парамНеОтпуск", СписокСпособов);
		Запрос.УстановитьПараметр("парамОтпуск", ПланыВидовРасчета.ОсновныеНачисленияОрганизаций.ОплатаПоСреднемуОтпКалендарныеДни); //Островская Татьяна 27.05.2014 № 17387
		Запрос.УстановитьПараметр("парамПоШестидневке", Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуДляОтпускаПоШестидневке);
		Запрос.УстановитьПараметр("парамРегистратор",Ссылка);
		ЗапросОтработанные = Запрос.Выполнить().Выгрузить();
		СтруктураПоискаДоп = Новый Структура("МесяцВыборки");
		СтруктураПоискаДоп.МесяцВыборки = ВыборкаСреднегоЗаработка.МесяцВыборки;
		ОтработанноеВремя = ЗапросОтработанные.НайтиСтроки(СтруктураПоискаДоп);
		если ОтработанноеВремя.Количество()>0 Тогда 
			ОтработанноеВремя = ОтработанноеВремя[0];
			
			если ВидУчетаВремени = Перечисления.ВидыУчетаВремени.ПоДням  Тогда //и не СпособРасчетаВЧасах
				ОтработаноДнейФакт = ОтработанноеВремя.ОтработаноДней;
				СекцияРасчетСреднего.Параметры["Факт1"] = ОтработанноеВремя.ОтработаноДней;
			иначе
				ОтработаноЧасовФакт = ОтработанноеВремя.ОтработаноЧасов;
				СекцияРасчетСреднего.Параметры["Факт1"] = ОтработанноеВремя.ОтработаноЧасов;
			КонецЕсли;
			Если СпособРасчетаВДнях Тогда 
				ОтработаноДнейФакт = ОтработанноеВремя.ОтработаноДней;
				СекцияРасчетСреднего.Параметры["Факт1"] = ОтработанноеВремя.ОтработаноДней;
			КонецЕсли;
			
		КонецЕсли;
		//Островская Татьяна 06.06.2014 № 17416
		
		НомерСтроки = НомерСтроки  + 1;
		ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
		Если ПериодРегистрации >= Дата(2016,07,1) Тогда //О.Т. Аверсон 22.06.2016 № 949 
			ОписаниеСуммы = "Заработок " +  Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
		иначе
			ОписаниеСуммы = "Заработок " +  Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ=2");
		КонецЕсли;
		СтруктураПоиска.МесяцВыборки =  ВыборкаСреднегоЗаработка.МесяцВыборки;
		
		ОтработаноДней = ВыборкаОтработаноПоПятидневке.НайтиСтроки(СтруктураПоиска);
		Отработано = 0;
		Для каждого Строка из ОтработаноДней цикл
			Отработано = Отработано + Строка.ОтработаноПоПятидневке;
		КонецЦикла;
		Коэфф = Отработано;
		
		ИтогоЗаработок = ИтогоЗаработок + ВыборкаСреднегоЗаработка.Результат;// + ГодоваяВМесяц;
		ИтогоОтработано = ИтогоОтработано + Отработано;
		
		//Если НомерСтроки <= 2 Тогда //мое
		//Островская Татьяна 06.06.2014 № 17416
		если ВидУчетаВремени = Перечисления.ВидыУчетаВремени.ПоДням   Тогда //и не СпособРасчетаВЧасах
			СекцияРасчетСреднего.Параметры["План1"] = мНорма.НормаДней;
		иначе
			СекцияРасчетСреднего.Параметры["План1"] = мНорма.НормаЧасов;
		КонецЕсли;
		Если СпособРасчетаВДнях Тогда 
			СекцияРасчетСреднего.Параметры["План1"] = мНорма.НормаДней;
		КонецЕсли;
		
		
		ЗапросИтогСумма = Новый Запрос;
		ЗапросИтогСумма.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	РасшифровкаРасчетаСреднего.МесяцВыборки,
		|	СУММА(РасшифровкаРасчетаСреднего.НачисленнаяЗП) КАК НачисленнаяЗП
		|ИЗ
		|	РегистрСведений.РасшифровкаРасчетаСреднего КАК РасшифровкаРасчетаСреднего
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка КАК Ссылка,
		|			НачислениеПоБольничномуЛистуРасчетСреднего.МесяцВыборки КАК МесяцВыборки
		|		ИЗ
		|			Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничномуЛистуРасчетСреднего
		|		ГДЕ
		|			НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка = &Документ
		|			И НАЧАЛОПЕРИОДА(НачислениеПоБольничномуЛистуРасчетСреднего.МесяцВыборки,МЕСЯЦ) = &МесяцВыборки  //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		|		
		|		СГРУППИРОВАТЬ ПО
		|			НачислениеПоБольничномуЛистуРасчетСреднего.МесяцВыборки,
		|			НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка) КАК ВложенныйЗапрос
		|		ПО РасшифровкаРасчетаСреднего.Документ = ВложенныйЗапрос.Ссылка
		|			И РасшифровкаРасчетаСреднего.МесяцВыборки = ВложенныйЗапрос.МесяцВыборки
		|ГДЕ
		|	РасшифровкаРасчетаСреднего.Документ = &Документ
		|	И НАЧАЛОПЕРИОДА(РасшифровкаРасчетаСреднего.МесяцВыборки,МЕСЯЦ) = &МесяцВыборки  //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		|
		|СГРУППИРОВАТЬ ПО
		|	РасшифровкаРасчетаСреднего.МесяцВыборки";
		
		ЗапросИтогСумма.УстановитьПараметр("Документ", ЭтотОбъект.Ссылка);
		ЗапросИтогСумма.УстановитьПараметр("МесяцВыборки", НачалоДня(НачалоМесяца(ВыборкаСреднегоЗаработка.Месяцвыборки)));  //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		
		РезультатИтогСумма = ЗапросИтогСумма.Выполнить().Выгрузить();
		ИтогНачсленныйДоход = РезультатИтогСумма.НайтиСтроки(Новый Структура("МесяцВыборки", ВыборкаСреднегоЗаработка.МесяцВыборки));
		СекцияРасчетСреднего.Параметры["НачисленнаяЗП1"]= 0;
		если ИтогНачсленныйДоход.Количество()>0 Тогда 
			СекцияРасчетСреднего.Параметры["НачисленнаяЗП1"]= ИтогНачсленныйДоход[0].НачисленнаяЗП;
		КонецЕсли;			
		//Островская Татьяна 06.06.2014 № 17416
		
		СекцияРасчетСреднего.Параметры["Год1"] 		= Год(ВыборкаСреднегоЗаработка.МесяцВыборки);
		СекцияРасчетСреднего.Параметры["Месяц1"] 		= Месяц(ВыборкаСреднегоЗаработка.Месяцвыборки);
		СекцияРасчетСреднего.Параметры["Сумма1"] 		= ОписаниеСуммы;
		СекцияРасчетСреднего.Параметры["Коэфф1"] 		= Коэфф;
		//Островская Татьяна 22.07.2013 № 16645
		ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
		Если ПериодРегистрации >= Дата(2016,07,1) Тогда //О.Т. Аверсон 22.06.2016 № 949
			СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"] 		= ?(ЗначениеЗаполнено(СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"]),
			СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"],0) + ?(ВыборкаСреднегоЗаработка.Результат = 0,0,Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления)));
		иначе  				
			СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"] 		= ?(ЗначениеЗаполнено(СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"]),
			СекцияРасчетСреднегоИтог.Параметры["ИтогСумма1"],0) + ?(ВыборкаСреднегоЗаработка.Результат = 0,0,Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ=2"));
		КонецЕсли;
		СекцияРасчетСреднегоИтог.Параметры["ИтогКоэфф1"] 		= ?(ЗначениеЗаполнено(СекцияРасчетСреднегоИтог.Параметры["ИтогКоэфф1"]),
		СекцияРасчетСреднегоИтог.Параметры["ИтогКоэфф1"],0)+ Коэфф; 
		//Островская Татьяна 22.07.2013 № 16645
		СекцияРасшифровка = Макет.ПолучитьОбласть("Расшифровка");
		//Островская Татьяна 15.07.2013 № 16620
		ЗапросР = Новый Запрос;
		ТекстЗапроса = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	РасшифровкаРасчетаСреднего.ВидРасчета,
		|	РасшифровкаРасчетаСреднего.МесяцВыборки,
		|	РасшифровкаРасчетаСреднего.ПериодРегистрации КАК Месяц,
		|	РасшифровкаРасчетаСреднего.Результат,
		|	//МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноЧасов) КАК Отработано,
		|	//МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК Отработано1,
		|	РасшифровкаРасчетаСреднего.НачисленнаяЗП
		|ИЗ
		|	РегистрСведений.РасшифровкаРасчетаСреднего КАК РасшифровкаРасчетаСреднего
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничномуЛистуРасчетСреднего
		|		ПО РасшифровкаРасчетаСреднего.Документ = НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка
		|			И РасшифровкаРасчетаСреднего.МесяцВыборки = НачислениеПоБольничномуЛистуРасчетСреднего.МесяцВыборки
		|ГДЕ
		|	РасшифровкаРасчетаСреднего.Документ = &Документ
		|	И НАЧАЛОПЕРИОДА(РасшифровкаРасчетаСреднего.МесяцВыборки,МЕСЯЦ) = &МесяцВыборки  //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		|
		|СГРУППИРОВАТЬ ПО
		|	РасшифровкаРасчетаСреднего.ВидРасчета,
		|	РасшифровкаРасчетаСреднего.МесяцВыборки,
		|	РасшифровкаРасчетаСреднего.ПериодРегистрации,
		|	РасшифровкаРасчетаСреднего.Результат,
		|	РасшифровкаРасчетаСреднего.НачисленнаяЗП";
		//Островская Татьяна 15.07.2013 № 16620
		Если СпособРасчетаВДнях Тогда
			//Островская Татьяна 15.07.2013 № 16620
			если КалендарныеДни Тогда
				//если СпособРасчетаВЧасах Тогда 
				//	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноЧасов) КАК Отработано","МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноДней) КАК Отработано1");
				//	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК Отработано1","МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноЧасов) как Отработано");
				//иначе
				
				ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноЧасов) КАК Отработано","МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноДней) КАК Отработано1");
				ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК Отработано1","МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) как Отработано");
				//КонецЕсли;	
			иначе 
				
				ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноЧасов) КАК Отработано","МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноДней) КАК Отработано");
				ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК Отработано1","МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) как Отработано1");
				
			КонецЕсли;
			//Островская Татьяна 15.07.2013 № 16620
		Иначе
			
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(РасшифровкаРасчетаСреднего.ОтработаноЧасов) КАК Отработано","Сумма(РасшифровкаРасчетаСреднего.ОтработаноДней) КАК Отработано");//О.Т. Аверсон 05.01.2016 № дней поставила
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК Отработано1","МАКСИМУМ(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) как Отработано1");
			
			
		КонецЕсли;              
		
		ЗапросР.Текст = ТекстЗапроса;
		
		Если ЗначениеЗаполнено(ЭтотОбъект.ПервичныйБольничныйЛист) Тогда
			ЗапросР.УстановитьПараметр("Документ", ЭтотОбъект.ПервичныйБольничныйЛист.Ссылка);	
		Иначе	
			ЗапросР.УстановитьПараметр("Документ", ЭтотОбъект.Ссылка);	
		КонецЕсли;
		ЗапросР.УстановитьПараметр("МесяцВыборки", НачалоДня(НачалоМесяца(ВыборкаСреднегоЗаработка.Месяцвыборки)));  //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		ВыборкаР = ЗапросР.Выполнить().Выбрать();
		//Островская Татьяна 17.06.2013 № 16559
		//если не СворачиватьНачисления Тогда 
		Пока ВыборкаР.Следующий() Цикл
			СекцияРасшифровка.Параметры.Заполнить(ВыборкаР);
			
			ВидРасчетаИзПремии = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям.БазовыеВидыРасчета.НайтиСтроки(Новый Структура("ВидРасчета",ВыборкаР.ВидРасчета)).Количество()>0;
			ДопДни = 0;
			ДопЧасы = 0;
			Если ВидРасчетаИзПремии Тогда 
				Запрос = Новый Запрос;
				Запрос.Текст = 
				"ВЫБРАТЬ
				|	СУММА(ОсновныеНачисленияРаботниковОрганизаций.ОплаченоДней) КАК ОплаченоДней,
				|	СУММА(ОсновныеНачисленияРаботниковОрганизаций.ОплаченоДнейЧасов) КАК ОплаченоДнейЧасов
				|ИЗ
				|	РегистрРасчета.ОсновныеНачисленияРаботниковОрганизаций КАК ОсновныеНачисленияРаботниковОрганизаций
				|ГДЕ
				|	ОсновныеНачисленияРаботниковОрганизаций.ПериодДействияНачало МЕЖДУ &ПериодВыборки И &ПериодВыборки1
				|	И ОсновныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
				|	И ОсновныеНачисленияРаботниковОрганизаций.ВидРасчета В(&ВидРасчета)";
				
				СписокВидРасчета = Новый СписокЗначений;
				ГруппаРасчетовБЛПремия = Справочники.ГруппыРасчетов.ВключениеРабочегоВремениДляБЛДляРасчетаПремии;    
				для Каждого СтрДляПремии из ГруппаРасчетовБЛПремия.Основные Цикл 
					СписокВидРасчета.Добавить(СтрДляПремии.ВидРасчета);
				КонецЦикла;
				
				Запрос.УстановитьПараметр("ВидРасчета", СписокВидРасчета);
				Запрос.УстановитьПараметр("ПериодВыборки", НачалоМесяца(ВыборкаСреднегоЗаработка.Месяцвыборки));
				Запрос.УстановитьПараметр("ПериодВыборки1", КонецМесяца(ВыборкаСреднегоЗаработка.Месяцвыборки));
				Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
				
				РезДляПремии = Запрос.Выполнить().Выбрать();
				
				Пока РезДляПремии.Следующий() Цикл
					ДопДни = ДопДни + ?(РезДляПремии.ОплаченоДней = Null,0,РезДляПремии.ОплаченоДней);
					ДопЧасы = ДопЧасы + ?(РезДляПремии.ОплаченоДнейЧасов = Null,0,РезДляПремии.ОплаченоДнейЧасов);
				КонецЦикла;
			КонецЕсли;
			
			
			//Островская Татьяна 06.06.2014 № 17416
			если ВидУчетаВремени = Перечисления.ВидыУчетаВремени.ПоДням  Тогда  //и не СпособРасчетаВЧасах
				СекцияРасшифровка.Параметры["План"] = мНорма.НормаДней;
				СекцияРасшифровка.Параметры["Факт"] = ?(ЗначениеЗаполнено(ОтработаноДнейФакт),ОтработаноДнейФакт,0)+ДопДни;
			иначе
				СекцияРасшифровка.Параметры["План"] = мНорма.НормаЧасов;
				СекцияРасшифровка.Параметры["Факт"] = ?(ЗначениеЗаполнено(ОтработаноЧасовФакт),ОтработаноЧасовФакт,0)+ДопЧасы;
			КонецЕсли;
			Если СпособРасчетаВДнях Тогда 
				СекцияРасшифровка.Параметры["План"] = мНорма.НормаДней;
				СекцияРасшифровка.Параметры["Факт"] =  ?(ЗначениеЗаполнено(ОтработаноДнейФакт),ОтработаноДнейФакт,0)+ДопДни;
			КонецЕсли;
			//Островская Татьяна 06.06.2014 № 17416
			СекцияРасшифровка.Параметры.План = 
			ТабДокумент.Вывести(СекцияРасшифровка);
		КонецЦикла;
		//КонецЕсли;
		//Островская Татьяна 17.06.2013 № 16559
		//Если НомерСтроки = 2  Тогда
		//	Сообщить("Бланк формы не позволяет отразить более 2 записей заработка!");		
		//	
		//	ИтогоОтработано = ?(ИтогоОтработано=0, 1, ИтогоОтработано);
		//	СекцияРасчетСреднего.Параметры["СреднийЗаработок"] = Формат(ИтогоЗаработок / ИтогоОтработано,"ЧЦ=15; ЧДЦ=0");
		//	ТабДокумент.Вывести(СекцияРасчетСреднего);
		//Иначе
		Если ВыборкаСреднегоЗаработка.Количество() = 1 Тогда
			ИтогоОтработано = ?(ИтогоОтработано=0, 1, ИтогоОтработано);
			//СекцияРасчетСреднего.Параметры["СреднийЗаработок"] = Формат(ИтогоЗаработок / ИтогоОтработано,"ЧЦ=15; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"0"));
		КонецЕсли;
		ТабДокумент.Вывести(СекцияРасчетСреднего);
		//КонецЕсли; 
		
		//КонецЕсли;
	КонецЦикла;
	СписокСоставляющихСреднегоЗаработка = Новый Массив(5); 
	СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
	СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
	СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
	СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
	
	//МесяцевРасчетногоПериода = ВидРасчета.ПериодРасчетаСреднегоЗаработка;	
	//ИспользоватьСреднеЧасовойЗаработок = (не СпособРасчетаВДнях и СпособРасчетаВЧасах)или (СпособРасчетаВДнях и СпособРасчетаВЧасах); //Островская Татьяна 10.06.2014 № 17421
	ИспользоватьСреднеЧасовойЗаработок = Ложь;
	СреднедневнойЗаработок = РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок);
	
	Если ЭтотОбъект.РучнойРасчетСреднегоЗаработка Тогда
		СекцияРасчетСреднего.Параметры["Год1"] 		= "Ручной ввод";
		//СекцияРасчетСреднего.Параметры["СреднийЗаработок"] = Формат(ЭтотОбъект.РазмерСреднегоЗаработка,"ЧЦ=15; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"2"));
		СекцияРасчетСреднегоИтог.Параметры["ИтогСреднийЗаработок"] = Формат(ЭтотОбъект.РазмерСреднегоЗаработка,"ЧЦ=15; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"2"));//Островская Татьяна 22.07.2013 № 16645
		ТабДокумент.Вывести(СекцияРасчетСреднего);
		//Островская Татьяна 22.07.2013 № 16645	
	иначе
		СекцияРасчетСреднегоИтог.Параметры["ИтогСреднийЗаработок"] = ?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Окр(СреднедневнойЗаработок,ЗначениеТочностьСреднего),Окр(СреднедневнойЗаработок,0));//Островская Татьяна 17.04.2014 № 17287	
	КонецЕсли;  //Островская Татьяна 22.07.2013 № 16645
	если не РучнойРасчетСреднегоЗаработка Тогда 
		СекцияРасчетСреднегоИтог.Параметры["Равно"] = " = ";
		СекцияРасчетСреднегоИтог.Параметры["Дел"] = "/";
	КонецЕсли;
	ТабДокумент.Вывести(СекцияРасчетСреднегоИтог); 
	//ПСА 12.08.2024 +++
	Иначе
		ДанныеСообщенияПортала = Макет.ПолучитьОбласть("ДанныеСообщенияПортала");
		ТекстСообщенияПортала = ""; 
		ВрФайл = ПолучитьИмяВременногоФайла("txt");
		ДанныеФайла = ДвоичныеДанныеСообщенияПортала.Получить();
		ДанныеФайла.Записать(ВрФайл); 
		ТекстовыйФайл = Новый ТекстовыйДокумент;
		ТекстовыйФайл.Прочитать(ВрФайл,КодировкаТекста.UTF8);
		ТекстСообщенияПортала = ТекстовыйФайл.ПолучитьТекст();
		УдалитьФайлы(ВрФайл);  
		ДанныеСообщенияПортала.Параметры.ТекстСообщенияПортала = ТекстСообщенияПортала;  
		ТабДокумент.Вывести(ДанныеСообщенияПортала);
		РасчетСреднего1 = Макет.ПолучитьОбласть("РасчетСреднего1");
		СреднедневнойЗаработок = ЭтотОбъект.РазмерСреднегоЗаработка;
	КонецЕсли; 

	//+++ПСА 12.08.2024
	
	ТабДокумент.Вывести(РасчетСреднего1);
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	НачислениеПоБольничномуЛистуНачисления.Показатель1,
	|	НачислениеПоБольничномуЛистуНачисления.Результат,
	|	НачислениеПоБольничномуЛистуНачисления.НормаДней,
	|	НачислениеПоБольничномуЛистуНачисления.ВидРасчета,
	|	НачислениеПоБольничномуЛистуНачисления.НомерСтроки,
	|	НачислениеПоБольничномуЛистуНачисления.ДатаНачала,
	|	НачислениеПоБольничномуЛистуНачисления.ДополнительныеДанные КАК ДополнительныеДанные1,
	|	НачислениеПоБольничномуЛистуНачисления.Показатель6,
	|	НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК НачислениеПоБольничномуЛистуНачисления
	|ГДЕ
	|	НачислениеПоБольничномуЛистуНачисления.ВидРасчета.СпособРасчета = &парамПоСреднемуФСЗН
	|	И НачислениеПоБольничномуЛистуНачисления.Ссылка = &парамРегистратор";
	
	Запрос.УстановитьПараметр("парамПоСреднемуФСЗН", Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
	Запрос.УстановитьПараметр("парамРегистратор", Ссылка);
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	ИтогСумма = 0;
	ИтогСуммаОрганичения = 0;
	
	//О.Т. Аверсон 10.07.2016 № 1135 
	ДатаПрошл = Дата(1,1,1);
	Пока Выборка.Следующий() Цикл			
		
		
		Сумма = СреднедневнойЗаработок*Выборка.ОплаченоДнейЧасов*Выборка.Показатель1/100;
		
		ИтогСумма = ИтогСумма + Сумма;
		
		Если ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение или 
			ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда
			
			СредняяПоРБ = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ДатаНачала, -1)), //О.Т. Аверсон 28.04.2016 № 7777 //НачалоМесяца(Выборка.ДатаНачала)
			Новый Структура("ВидПараметра", Перечисления.ВидыПараметровДляРасчетаЗарплаты.СредняяЗПРаботников)).Размер; //Островская Татьяна 22.07.2013 № 16623
			
			Если не СпособРасчетаВДнях Тогда
				НормаВремени = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала), Сотрудник).НормаЧасов;
			Иначе
				НормаВремени = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала), Сотрудник).НормаДней;
			КонецЕсли;
			//Островская Татьяна 22.07.2013 № 16645
			если КалендарныеДни или ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
				НормаВремени = (КонецМесяца(Выборка.ДатаНачала) - НачалоМесяца(Выборка.ДатаНачала)+1)/86400;
			КонецЕсли;
			
			мДатаНачалаСобытияРег = ПолучитьДатуНачалаСобытия();
			Если ЗначениеЗаполнено(ДатаНачала) И ЗначениеЗаполнено(ДатаОкончания) Тогда
				если НачалоМесяца(ДатаНачала) <> НачалоМесяца(ДатаОкончания) Тогда 
					Если НачалоМесяца(Выборка.ДатаНачала) = НачалоМесяца(ДатаНачала) Тогда 
						мДатаНачалаСобытия = ДатаНачала;
					иначе
						мДатаНачалаСобытия = НачалоМесяца(Выборка.ДатаНачала);
					КонецЕсли;
					Если НачалоМесяца(Выборка.ДатаНачала)  = НачалоМесяца(ДатаОкончания) Тогда 
						мДатаКонецСобытия = ДатаОкончания;
					иначе
						мДатаКонецСобытия = НачалоДня(КонецМесяца(Выборка.ДатаНачала));
					КонецЕсли;
				иначе
					мДатаНачалаСобытия = ДатаНачала;
					мДатаКонецСобытия = ДатаОкончания;
					
				КонецЕсли;
				
				Если мДатаНачалаСобытияРег <> мДатаНачалаСобытия Тогда
					ДнейКОплате = (мДатаКонецСобытия - мДатаНачалаСобытияРег) / мДлинаСуток + 1;
					ОплаченоРанее = (мДатаНачалаСобытия - мДатаНачалаСобытияРег) / мДлинаСуток;
				Иначе
					ДнейКОплате = (мДатаКонецСобытия - мДатаНачалаСобытия) / мДлинаСуток + 1;
					ОплаченоРанее = 0;
				КонецЕсли;
				//Островская Татьяна 10.06.2014 № 17421
				//если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
				//	График = РегистрыСведений.РаботникиОрганизаций.ПолучитьПоследнее(мДатаКонецСобытия,Новый Структура("Сотрудник",Сотрудник)).ГрафикРаботы;
				//	ДнейКОплате = ПрочиеПроцедуры.ПолучитьНормуВремениПоГрафикуЗаИнтервалВремени(График, Перечисления.ВидыУчетаВремени.ПоДням, мДатаНачалаСобытия,мДатаКонецСобытия,Организация);//О.Т. Аверсон 16.10.2017 № 1120
				//КонецЕсли;
				//Островская Татьяна 10.06.2014 № 17421
				
				// учтем ограничение периода оплаты по одному страховому случаю
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПособиеПриДолечивании Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 24) - ОплаченоРанее,0) // п.2 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				ИначеЕсли ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоУходуЗаВзрослым Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 7) - ОплаченоРанее,0) // пп. 6 п.5 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				ИначеЕсли СлучайУходаЗаБольнымРебенком = Перечисления.СлучаиУходаЗаБольнымиДетьми.ПоУходуДо15тиЛетАмбулаторно
					Или СлучайУходаЗаБольнымРебенком = Перечисления.СлучаиУходаЗаБольнымиДетьми.ПоУходуДо15тиЛетВСтационаре Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 15) - ОплаченоРанее,0) // пп. 2 п.5 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				Иначе
					ОплаченоДниЧасы = Макс(ДнейКОплате - ОплаченоРанее,0)
				КонецЕсли;
			КонецЕсли;
			
			Если Сотрудник.ВидНалогообложенияОсновной = Справочники.ВидыНалогообложения.ПустаяСсылка() Тогда 
				ВидНалогообложения = Организация.ОсновнаяСтавкаНалогообложения;
			иначе
				ВидНалогообложения = Сотрудник.ВидНалогообложенияОсновной;
			КонецЕсли;
			
			если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда 
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).РазмерПоБеременности; //О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			иначе
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).Размер; //О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			КонецЕсли;
			Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда 
				РазмерОграничения =  0;
			иначе 
				РазмерОграничения =  ОбщегоНазначения.ОкруглитьЗначение2016((РазмерОграничения * СредняяПоРБ) / НормаВремени * ОплаченоДниЧасы, ПериодРегистрации);
			КонецЕсли;
			если НачалоМесяца(Выборка.ДатаНачала) <> ДатаПрошл Тогда 
				ИтогСуммаОрганичения = ИтогСуммаОрганичения + РазмерОграничения;
				
			КонецЕсли;
			
		КонецЕсли;
		ДатаПрошл = НачалоМесяца(Выборка.ДатаНачала);//О.Т. 07.08.2014 № 164
	КонецЦикла;
	Выборка = Результат.Выбрать();
	//О.Т. Аверсон 10.07.2016 № 1135
	
	
	СекцияСтрокаОплаты = Макет.ПолучитьОбласть("СтрокаВыплат");
	ИтогоКВыплате = 0;
	ИтогоКВыплатеОбщая = 0; //О.Т. Аверсон 11.07.2016 № 1135
	ЗапросНормаДней = Новый Запрос;
	
	ЗапросНормаДней.УстановитьПараметр("парамДатаС", НачалоМесяца(ВыборкаПоШапкеДокумента.ДатаНачала));
	ЗапросНормаДней.УстановитьПараметр("парамДатаПо", КонецМесяца(ВыборкаПоШапкеДокумента.ДатаОкончания)); 
	
	// НормаДнейТекст = 
	// "ВЫБРАТЬ
	//|	НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ДатаКалендаря, МЕСЯЦ) КАК МесяцПериода,
	//|	СУММА(ПроизводственныйКалендарь.Пятидневка) КАК ДнейПоПятидневке
	//|ИЗ
	//|	РегистрСведений.РегламентированныйПроизводственныйКалендарь КАК ПроизводственныйКалендарь
	//|ГДЕ
	//|	ПроизводственныйКалендарь.ДатаКалендаря >= &парамДатаС
	//|	И ПроизводственныйКалендарь.ДатаКалендаря <= &парамДатаПо
	//|
	//|СГРУППИРОВАТЬ ПО
	//|	НАЧАЛОПЕРИОДА(ПроизводственныйКалендарь.ДатаКалендаря, МЕСЯЦ)";
	
	//ЗапросНормаДней.Текст = НормаДнейТекст;
	//НормаДней = ЗапросНормаДней.Выполнить().Выгрузить(); 
	//О.Т. 07.08.2014 № 164
	СекцияИтогПоМесяцу = Макет.ПолучитьОбласть("ИтогПоМесяцу");
	ДатаПрошл = Дата(1,1,1);
	ИтогНормаСумма = 0;
	СуммаОбщаяИтог = 0; //О.Т. Аверсон 11.07.2016 № 1135
	//О.Т. 07.08.2014 № 164
	Пока Выборка.Следующий() Цикл
		
		//О.Т. 07.08.2014 № 164
		если НачалоМесяца(Выборка.ДатаНачала) <> ДатаПрошл и ДатаПрошл <> Дата(1,1,1) Тогда 
			СекцияИтогПоМесяцу.Параметры.ИтогНормаСумма = ИтогНормаСумма; 
			Если ИтогСумма > ИтогСуммаОрганичения и ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда //О.Т. Аверсон 10.07.2016 № 1135
				СекцияИтогПоМесяцу.Параметры.КВыплатеОграничение = РазмерОграничения;
			КонецЕсли;  				
			ТабДокумент.Вывести(СекцияИтогПоМесяцу);
			ИтогНормаСумма = 0;
		КонецЕсли;
		//О.Т. 07.08.2014 № 164
		СекцияСтрокаОплаты.Параметры.Год = Год(Выборка.ДатаНачала);
		СекцияСтрокаОплаты.Параметры.Месяц = НачалоДня(НачалоМесяца(Выборка.ДатаНачала)); //Был МЕСЯЦ(  Аверсон 31.05.2019 КВВ СВФР-004395
		//СекцияСтрокаОплаты.Параметры.Оплачено = Выборка.НормаДней;
		СекцияСтрокаОплаты.Параметры.Оплачено = Выборка.ОплаченоДнейЧасов;
		СекцияСтрокаОплаты.Параметры.Коэффициент = ?(ЗначениеЗаполнено(Выборка.Показатель6), Выборка.Показатель6, 1);
		СекцияСтрокаОплаты.Параметры.Процент = Выборка.Показатель1;
		//Островская Татьяна 15.01.2013
		//О.Т. 07.08.2014 № 164
		Сумма = СреднедневнойЗаработок*Выборка.ОплаченоДнейЧасов*Выборка.Показатель1/100;
		ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
		СекцияСтрокаОплаты.Параметры.Сумма = Формат(ОбщегоНазначения.ОкруглитьРезультат(Сумма, Константы.ОкруглениеСуммДляБЛ.Получить()),"ЧДЦ="+Строка(ЗначениеОкругления));
		//СуммаОбщаяИтог = СуммаОбщаяИтог + ОбщегоНазначения.ОкруглитьРезультат(Сумма, Константы.ОкруглениеСуммДляБЛ.Получить());
		СуммаОбщаяИтог = СуммаОбщаяИтог + ОбщегоНазначения.ОкруглитьЗначение2016(ОбщегоНазначения.ОкруглитьРезультат(Сумма, Константы.ОкруглениеСуммДляБЛ.Получить()),ПериодРегистрации); //Аверсон 24.11.2020 КВВ СВФР-006808

		//О.Т. 07.08.2014 № 164
		//Островская Татьяна 15.01.2013
		Если ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение или 
			ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда
			//СтрокаДней = НормаДней.НайтиСтроки(Новый Структура ("МесяцПериода", НачалоМесяца(Выборка.ДатаНачала)));
			СредняяПоРБ = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ДатаНачала, -1)), //О.Т. Аверсон 28.04.2016 № 7777 //НачалоМесяца(Выборка.ДатаНачала)
			Новый Структура("ВидПараметра", Перечисления.ВидыПараметровДляРасчетаЗарплаты.СредняяЗПРаботников)).Размер; //Островская Татьяна 22.07.2013 № 16623
			
			Если не СпособРасчетаВДнях Тогда
				НормаВремени = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала), Сотрудник).НормаЧасов;
			Иначе
				НормаВремени = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала), Сотрудник).НормаДней;
			КонецЕсли;
			//Островская Татьяна 22.07.2013 № 16645
			если КалендарныеДни  или ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
				НормаВремени = (КонецМесяца(Выборка.ДатаНачала) - НачалоМесяца(Выборка.ДатаНачала)+1)/86400;
				//Если СпособРасчетаВДнях Тогда
				//	НормаВремени = ПрочиеПроцедуры.ПолучитьДниПоКалендарю (НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала),Сотрудник,Ссылка);
				//Иначе
				//	НормаВремени = ПрочиеПроцедуры.ПолучитьДниПоКалендарю (НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала),Сотрудник,Ссылка);
				//КонецЕсли;
			КонецЕсли;
			//Островская Татьяна 22.07.2013 № 16645
			//Островская Татьяна 22.07.2013 № 16645
			Если Сотрудник.ВидНалогообложенияОсновной = Справочники.ВидыНалогообложения.ПустаяСсылка() Тогда 
				ВидНалогообложения = Организация.ОсновнаяСтавкаНалогообложения;
			иначе
				ВидНалогообложения = Сотрудник.ВидНалогообложенияОсновной;
			КонецЕсли;
			
			если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда 
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).РазмерПоБеременности; //О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			иначе
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).Размер; //О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			КонецЕсли;
			Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда 
				РазмерОграничения =  0;
			КонецЕсли;
			//О.Т. 11.08.2014 № 164
			мДатаНачалаСобытияРег = ПолучитьДатуНачалаСобытия();
			Если ЗначениеЗаполнено(ДатаНачала) И ЗначениеЗаполнено(ДатаОкончания) Тогда
				если НачалоМесяца(ДатаНачала) <> НачалоМесяца(ДатаОкончания) Тогда 
					Если НачалоМесяца(Выборка.ДатаНачала) = НачалоМесяца(ДатаНачала) Тогда 
						мДатаНачалаСобытия = ДатаНачала;
					иначе
						мДатаНачалаСобытия = НачалоМесяца(Выборка.ДатаНачала);
					КонецЕсли;
					Если НачалоМесяца(Выборка.ДатаНачала) = НачалоМесяца(ДатаОкончания) Тогда 
						мДатаКонецСобытия = ДатаОкончания;
					иначе
						мДатаКонецСобытия = НачалоДня(КонецМесяца(Выборка.ДатаНачала));
					КонецЕсли;
				иначе
					мДатаНачалаСобытия = ДатаНачала;
					мДатаКонецСобытия = ДатаОкончания;
					
				КонецЕсли;
				
				Если мДатаНачалаСобытияРег <> мДатаНачалаСобытия Тогда
					ДнейКОплате = (мДатаКонецСобытия - мДатаНачалаСобытияРег) / мДлинаСуток + 1;
					ОплаченоРанее = (мДатаНачалаСобытия - мДатаНачалаСобытияРег) / мДлинаСуток;
				Иначе
					ДнейКОплате = (мДатаКонецСобытия - мДатаНачалаСобытия) / мДлинаСуток + 1;
					ОплаченоРанее = 0;
				КонецЕсли;
				//Островская Татьяна 10.06.2014 № 17421
				//если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
				//	График = РегистрыСведений.РаботникиОрганизаций.ПолучитьПоследнее(мДатаКонецСобытия,Новый Структура("Сотрудник",Сотрудник)).ГрафикРаботы;
				//	ДнейКОплате = ПрочиеПроцедуры.ПолучитьНормуВремениПоГрафикуЗаИнтервалВремени(График, Перечисления.ВидыУчетаВремени.ПоДням, мДатаНачалаСобытия,мДатаКонецСобытия,Организация);//О.Т. Аверсон 16.10.2017 № 1120
				//КонецЕсли;
				//Островская Татьяна 10.06.2014 № 17421
				
				// учтем ограничение периода оплаты по одному страховому случаю
				Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПособиеПриДолечивании Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 24) - ОплаченоРанее,0) // п.2 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				ИначеЕсли ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоУходуЗаВзрослым Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 7) - ОплаченоРанее,0) // пп. 6 п.5 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				ИначеЕсли СлучайУходаЗаБольнымРебенком = Перечисления.СлучаиУходаЗаБольнымиДетьми.ПоУходуДо15тиЛетАмбулаторно
					Или СлучайУходаЗаБольнымРебенком = Перечисления.СлучаиУходаЗаБольнымиДетьми.ПоУходуДо15тиЛетВСтационаре Тогда
					ОплаченоДниЧасы = Макс(Мин(ДнейКОплате, 15) - ОплаченоРанее,0) // пп. 2 п.5 ст.6 Федерального закона от 29 декабря 2006 г. № 255-ФЗ
				Иначе
					ОплаченоДниЧасы = Макс(ДнейКОплате - ОплаченоРанее,0)
				КонецЕсли;
			КонецЕсли;
			
			//О.Т. 11.08.2014 № 1164
			Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда 
				РазмерОграничения =  0;
			иначе     					
				РазмерОграничения =  ОбщегоНазначения.ОкруглитьЗначение2016((РазмерОграничения * СредняяПоРБ) / НормаВремени * ОплаченоДниЧасы, ПериодРегистрации);
			КонецЕсли;
			//Островская Татьяна 22.07.2013 № 16645
			//СекцияСтрокаОплаты.Параметры.НормаСумма =  ОбщегоНазначения.ОкруглитьРезультат(РазмерОграничения, Константы.ОкруглениеСуммДляБЛ.Получить());
			если ИтогНормаСумма = 0 Тогда 
				ИтогНормаСумма = ИтогНормаСумма + РазмерОграничения;//О.Т. 07.08.2014 № 164
			КонецЕсли;
			//О.Т. 07.08.2014 № 164
		КонецЕсли;
		//Островская Татьяна 15.01.2013	
		ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
		//Островская Татьяна 15.01.2013		
		Если ИтогСумма > ИтогСуммаОрганичения и ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда //О.Т. Аверсон 10.07.2016 № 1135
			Если НачалоМесяца(Выборка.ДатаНачала) <> ДатаПрошл Тогда 
				ИтогоКВыплатеОбщая = ИтогоКВыплатеОбщая + ?(Формат(РазмерОграничения,"ЧДЦ="+Строка(ЗначениеОкругления))="",0,Число(Формат(РазмерОграничения,"ЧДЦ="+Строка(ЗначениеОкругления))));
			КонецЕсли;
		иначе
			СекцияСтрокаОплаты.Параметры.КВыплате =  Формат(Выборка.Результат,"ЧДЦ="+Строка(ЗначениеОкругления));
			ИтогоКВыплатеОбщая = ИтогоКВыплатеОбщая + ?(Формат(Выборка.Результат,"ЧДЦ="+Строка(ЗначениеОкругления))="",0,Число(Формат(Выборка.Результат,"ЧДЦ="+Строка(ЗначениеОкругления))));
		КонецЕсли;
		ИтогоКВыплате = ИтогоКВыплате + ?(Формат(Выборка.Результат,"ЧДЦ="+Строка(ЗначениеОкругления))="",0,Число(Формат(Выборка.Результат,"ЧДЦ="+Строка(ЗначениеОкругления))));
		
		//Островская Татьяна 15.01.2013
		
		//Островская Татьяна 15.01.2013
		ТабДокумент.Вывести(СекцияСтрокаОплаты);
		ДатаПрошл = НачалоМесяца(Выборка.ДатаНачала);//О.Т. 07.08.2014 № 164
	КонецЦикла;
	//О.Т. 07.08.2014 № 164
	СекцияИтогПоМесяцу.Параметры.ИтогНормаСумма = ИтогНормаСумма; 
	Если ИтогСумма > ИтогСуммаОрганичения и ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда //О.Т. Аверсон 10.07.2016 № 1135
		СекцияИтогПоМесяцу.Параметры.КВыплатеОграничение = РазмерОграничения;
	КонецЕсли;
	
	ТабДокумент.Вывести(СекцияИтогПоМесяцу);
	//О.Т. 07.08.2014 № 164
	
	//
	// Вывод подвала
	СекцияПодвал = Макет.ПолучитьОбласть("Подвал");
	//Островская Татьяна 28.12.2012 № 16068
	//если РаботалВПервыйДеньБЛ Тогда 
	//	СекцияПодвал.Параметры.ДопТекст = "Удержано в связи с работой в 1-ый день БЛ(-1дн.)"
	//КонецЕсли;
	//Островская Татьяна 28.12.2012 № 16068
	СекцияПодвал.Параметры.ИтогоКВыплате = ИтогоКВыплате;
	СекцияПодвал.Параметры.ИтогКВыплатеОбщая = ИтогоКВыплатеОбщая;
	СекцияПодвал.Параметры.ИтогМаксРазмерОбщая = ИтогСуммаОрганичения;
	СекцияПодвал.Параметры.ИтогСуммаОбщая = Формат(СуммаОбщаяИтог,"ЧДЦ="+Строка(ЗначениеОкругления));
	
	
	
	СекцияПодвал.Параметры.КВыплатеПрописью = РаботаСДиалогами.СформироватьСуммуПрописью(ИтогоКВыплате, Константы.ВалютаРегламентированногоУчета.Получить());
	//Островская Татьяна 12.02.2013 № 16216
	СтруктураОтветственный = ФормированиеПечатныхФорм.ФамилияИнициалыФизЛица(Ответственный);
	
	СекцияПодвал.Параметры.ДолжностьФИО = СтруктураОтветственный.Должность;
	СекцияПодвал.Параметры.ОтветственныйФИО = СтруктураОтветственный.ФИО;
	//Островская Татьяна 12.02.2013 № 16216
	//
	ТабДокумент.Вывести(СекцияПодвал);
	//
	//
	//Возврат ТабДокумент;
	РаботаСДиалогами.НапечататьДокумент(ТабДокумент, КоличествоЭкземпляров, НаПринтер, РаботаСДиалогами.СформироватьЗаголовокДокумента(ЭтотОбъект,Метаданные().Синоним) + " (оборот листка нетрудоспособности)");
	
	
	
КонецФункции // Печать()



////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА

// Формирует запрос по шапке документа для целей выода документа на печать
//
//
// Возвращаемое значение:
//  Результат запроса
//
Функция СформироватьЗапросПоШапкеДляПечати()
	
	ДатаНачалаСобытия = Датаначала;
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	//Запрос.УстановитьПараметр("ГоловнаяОрганизация" , ГоловнаяОрганизация(Организация));
	Запрос.УстановитьПараметр("ДатаНачалаСобытия" , ДатаНачалаСобытия);
	Запрос.УстановитьПараметр("ФизЛицо" , Сотрудник.Физлицо);	
	Запрос.УстановитьПараметр("Сотрудник" , Сотрудник);	
	//Запрос.УстановитьПараметр("Приказ" , Приказ);
	
	//Толик	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Отпуск.Дата КАК ДатаДокумента,
	|	Отпуск.Номер КАК НомерДокумента1,
	|	Отпуск.Сотрудник.Физлицо КАК ФизЛицо,
	|	Отпуск.Организация.КодПоОКПО КАК КодПоОКПО,
	|	Отпуск.Организация.НаименованиеПолное КАК НазваниеОрганизации,
	|	ВЫБОР
	|		КОГДА ФИОФизлица.ФизЛицо ЕСТЬ NULL 
	|			ТОГДА Отпуск.Физлицо.Наименование
	|		ИНАЧЕ ФИОФизлица.Фамилия + "" "" + ФИОФизлица.Имя + "" "" + ФИОФизлица.Отчество
	|	КОНЕЦ КАК ФИО,
	|	Отпуск.Сотрудник.Код КАК ТабельныйНомер,
	|	РаботникиОрганизацииСрезПоследних.ПодразделениеОрганизации.Наименование КАК Подразделение,
	|	РаботникиОрганизацииСрезПоследних.Должность.Наименование КАК Должность,
	|	Отпуск.СерияВходящегоДокумента + Отпуск.НомерВходящегоДокумента КАК НомерДокумента,
	|	Отпуск.ОграничениеПособия
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда КАК Отпуск
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаНачалаСобытия, Сотрудник = &Сотрудник) КАК РаботникиОрганизацииСрезПоследних
	|		ПО (ИСТИНА)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФИОФизЛиц.СрезПоследних(&ДатаНачалаСобытия, ФизЛицо = &ФизЛицо) КАК ФИОФизлица
	|		ПО (ИСТИНА)
	|ГДЕ
	|	Отпуск.Ссылка = &ДокументСсылка";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоШапкеДляПечати()

//заявка №1640 (база заявок Кристалла) Дмитрук О.Г.
Функция ПроверкаСотрудника() Экспорт
	мСтрока = РегистрыСведений.РаботникиОрганизаций.ПолучитьПоследнее(ДатаНачала,
	Новый Структура("Организация, Сотрудник", Организация, Сотрудник));
	
	Если мСтрока.ЗанимаемыхСтавок = 0 Тогда
		Возврат Ложь
	Иначе
		Возврат Истина
	КонецЕсли;
	
КонецФункции
//заявка №1640

// Формирует запрос по шапке документа
//
//
// Возвращаемое значение:
//  Результат запроса
//
Функция СформироватьЗапросПоШапке(ОтражениеВУчете = Истина)
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",			Ссылка);
	Запрос.УстановитьПараметр("Сотрудник",				Сотрудник);
	Запрос.УстановитьПараметр("ДатаНачалаСобытия",		ПолучитьДатуНачалаСобытия());
	//Запрос.УстановитьПараметр("ДатаЗакона255ФЗ", 		мДатаЗакона255ФЗ);
	//толик - перерасчет 1 01 2009	
	
	мДатаИзмененияЗП = ПрочиеПроцедуры.ОпределитьДатуИзмененияЗП(Организация);
	мМесяц = НачалоМесяца(ПолучитьДатуНачалаСобытия());
	
	Если мМесяц = мДатаИзмененияЗП Тогда
		ПериодРСЗ = ВидРасчета.ПериодРасчетаСреднегоЗаработка-1;
		КоличествоМесяцевРасчета = 0;
		СекундыКонцаПериода = КонецМесяца(мМесяц)-мМесяц;
	ИначеЕсли мМесяц = ДобавитьМесяц(мДатаИзмененияЗП, 1) Тогда
		ПериодРСЗ = ВидРасчета.ПериодРасчетаСреднегоЗаработка;
		КоличествоМесяцевРасчета = -ВидРасчета.ПериодРасчетаСреднегоЗаработка+1;
		СекундыКонцаПериода = КонецМесяца(мМесяц)-мМесяц;
	Иначе
		ПериодРСЗ = ВидРасчета.ЧислоМесяцев;
		КоличествоМесяцевРасчета = -ВидРасчета.ЧислоМесяцев;
		СекундыКонцаПериода = -1;
	КонецЕсли;
	//О.Т. Аверсон 04.07.2018 № 2119
	Если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда 
		ПериодРСЗ = 2;
		КоличествоМесяцевРасчета = -2;
		СекундыКонцаПериода = -1;    
	КонецЕсли;
	//О.Т. Аверсон 04.07.2018 № 2119
	
	
	//проверим был ли принят в расчетном месяце
	
	мСтрока = РегистрыСведений.РаботникиОрганизаций.СрезПервых('19000101000000',
	Новый Структура("Организация, Сотрудник", Организация, Сотрудник));
	Если мСтрока.Количество() <>  0 Тогда
		Если НачалоМесяца(мСтрока[0].Период) = НачалоМесяца(мМесяц) Тогда
			ПериодРСЗ = ВидРасчета.ЧислоМесяцев-1;
			КоличествоМесяцевРасчета = 0;
			СекундыКонцаПериода = КонецМесяца(мМесяц)-мМесяц;
		КонецЕсли;
		Если НачалоМесяца(мСтрока[0].Период) = ДобавитьМесяц(НачалоМесяца(мМесяц), -1) Тогда
			ПериодРСЗ = ВидРасчета.ЧислоМесяцев;
			КоличествоМесяцевРасчета = -ВидРасчета.ЧислоМесяцев+1;
			СекундыКонцаПериода = КонецМесяца(мМесяц)-мМесяц;
		КонецЕсли;
	КонецЕсли;
	
	//проверим были ли начисления в текущем месяце
	мНетДанных = Ложь;
	Если мМесяц = мДатаИзмененияЗП Тогда
		Если ПрочиеПроцедуры.ПолучитьБазу(Сотрудник.Физлицо, мМесяц, ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ, мМесяц+СекундыКонцаПериода) = 0 Тогда
			мНетДанных = Истина;
		КонецЕсли;
		Если (НЕ ЗначениеЗаполнено(ПрочиеПроцедуры.ОтработанноеВремяПоПлановымГраффикамПлан(НачалоМесяца(мМесяц), ПолучитьДатуНачалаСобытия()-86400, Сотрудник, Перечисления.ВидыУчетаВремени.ПоЧасам, Ложь))) Тогда
			мНетДанных = Истина;
		КонецЕсли;
	КонецЕсли;
	Если мНетДанных Тогда
		//расчет по умолчанию
		ПериодРСЗ = ВидРасчета.ЧислоМесяцев;
		КоличествоМесяцевРасчета = -ВидРасчета.ЧислоМесяцев;
		СекундыКонцаПериода = -1;
	КонецЕсли;		
	
	Запрос.УстановитьПараметр("ПериодРСЗ",	ПериодРСЗ);
	Запрос.УстановитьПараметр("КоличествоМесяцевРасчета",	КоличествоМесяцевРасчета);
	Запрос.УстановитьПараметр("СекундыКонцаПериода",	СекундыКонцаПериода);
	
	//енд	
	
	Запрос.Текст =
	"ВЫБРАТЬ              
	|	ВЫБОР
	|		КОГДА РаботникиОрганизацииСрезПоследних.ПериодЗавершения <= &ДатаНачалаСобытия
	|				И РаботникиОрганизацииСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА РаботникиОрганизацииСрезПоследних.ПодразделениеОрганизацииЗавершения
	|		ИНАЧЕ РаботникиОрганизацииСрезПоследних.ПодразделениеОрганизации
	|	КОНЕЦ КАК ПодразделениеОрганизации,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизацииСрезПоследних.ПериодЗавершения <= &ДатаНачалаСобытия
	|				И РаботникиОрганизацииСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА РаботникиОрганизацииСрезПоследних.ГрафикРаботыЗавершения
	|		ИНАЧЕ РаботникиОрганизацииСрезПоследних.ГрафикРаботы
	|	КОНЕЦ КАК ГрафикРаботы,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизацииСрезПоследних.ПериодЗавершения <= &ДатаНачалаСобытия
	|				И РаботникиОрганизацииСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА РаботникиОрганизацииСрезПоследних.ГрафикРаботыЗавершения.СуммированныйУчетРабочегоВремени
	|		ИНАЧЕ РаботникиОрганизацииСрезПоследних.ГрафикРаботы.СуммированныйУчетРабочегоВремени
	|	КОНЕЦ КАК СуммированныйУчетРабочегоВремени,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизацииСрезПоследних.ПериодЗавершения <= &ДатаНачалаСобытия
	|				И РаботникиОрганизацииСрезПоследних.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА РаботникиОрганизацииСрезПоследних.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени
	|		ИНАЧЕ РаботникиОрганизацииСрезПоследних.ГрафикРаботы.ГрафикПолногоРабочегоВремени
	|	КОНЕЦ КАК ГрафикПолногоРабочегоВремени
	|ПОМЕСТИТЬ ВТДанныеОСотруднике
	|ИЗ
	|	РегистрСведений.РаботникиОрганизаций.СрезПоследних(&ДатаНачалаСобытия, Сотрудник = &Сотрудник) КАК РаботникиОрганизацииСрезПоследних";
	Запрос.Выполнить();
	//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
	//Островская Татьяна 28.12.2012 № 16068, 17421
	Запрос.Текст =
	"ВЫБРАТЬ
	|	НачислениеПоБольничномуЛисту.Дата,
	|	НачислениеПоБольничномуЛисту.ПериодРегистрации,
	|	НачислениеПоБольничномуЛисту.Организация,
	|	НачислениеПоБольничномуЛисту.Комментарий,
	|	НачислениеПоБольничномуЛисту.Ответственный,
	|	НачислениеПоБольничномуЛисту.Сотрудник,
	|	НачислениеПоБольничномуЛисту.Физлицо,
	|	НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.ПроцентОплаты,
	|	НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист,
	|	НачислениеПоБольничномуЛисту.ДатаНачала,
	|	НачислениеПоБольничномуЛисту.ДатаОкончания,
	|	НачислениеПоБольничномуЛисту.ОграничениеПособия,
	|	НачислениеПоБольничномуЛисту.ПерерассчитываемыйДокумент,
	|	НачислениеПоБольничномуЛисту.ПособиеОтражаетсяВРеглУчетеТекущимДокументом,
	|	НачислениеПоБольничномуЛисту.ДнейОплаты,
	|	НачислениеПоБольничномуЛисту.ОграничениеПособияПереходногоПериода,
	|	НачислениеПоБольничномуЛисту.ДатаНарушенияРежима,
	|	НачислениеПоБольничномуЛисту.ВидРасчета,
	|	НачислениеПоБольничномуЛисту.Ссылка,
	|	НачислениеПоБольничномуЛисту.РучнойРасчетСреднегоЗаработка,
	|	НачислениеПоБольничномуЛисту.РазмерСреднегоЗаработка,
	|	НачислениеПоБольничномуЛисту.СпособРасчетаВДнях,
	|	НачислениеПоБольничномуЛисту.ДатаНарушенияРежимаКон,
	|	НачислениеПоБольничномуЛисту.ТипРасчета
	|ПОМЕСТИТЬ ВТДанныеДокумента
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда КАК НачислениеПоБольничномуЛисту
	|ГДЕ
	|	НачислениеПоБольничномуЛисту.Ссылка = &ДокументСсылка";
	//Островская Татьяна 28.12.2012 № 16068
	//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598,17421
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	"""" КАК СтратегияОтраженияВУчете,
	|	0 КАК ПроцентЕНВД,
	|	ЛОЖЬ КАК УказаноОтражениеВУчетеДляРаботодателя,
	|	"""" КАК ОтражениеВУСН,
	|	"""" КАК СчетДт,
	|	"""" КАК СубконтоДт1,
	|	"""" КАК СубконтоДт2,
	|	"""" КАК СубконтоДт3,
	|	"""" КАК СчетКт,
	|	"""" КАК СубконтоКт1,
	|	"""" КАК СчетДтНУ,
	|	"""" КАК СубконтоДтНУ1,
	|	"""" КАК СубконтоДтНУ2,
	|	"""" КАК СубконтоДтНУ3,
	|	"""" КАК СчетКтНУ,
	|	"""" КАК СубконтоКтНУ1
	|ПОМЕСТИТЬ ВТОтражениеВУчете";
	
	//КонецЕсли;
	Запрос.Выполнить();
	//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598,17421
	Запрос.Текст =
	"ВЫБРАТЬ
	|	НачислениеПоБольничномуЛисту.Ссылка,
	|	НачислениеПоБольничномуЛисту.Дата,
	|	НачислениеПоБольничномуЛисту.ПериодРегистрации,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА НачислениеПоБольничномуЛисту.Организация
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация
	|	КОНЕЦ КАК Организация,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА НачислениеПоБольничномуЛисту.Организация
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация
	|	КОНЕЦ КАК ГоловнаяОрганизация,
	|	НачислениеПоБольничномуЛисту.Организация КАК ОбособленноеПодразделение,
	|	НачислениеПоБольничномуЛисту.Сотрудник,
	|	НачислениеПоБольничномуЛисту.Сотрудник.Физлицо КАК Физлицо,
	|	НачислениеПоБольничномуЛисту.Сотрудник.ВидЗанятости КАК ВидЗанятости,
	|	НачислениеПоБольничномуЛисту.ПроцентОплаты,
	|	НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.ДатаНачала,
	|	НачислениеПоБольничномуЛисту.ДатаОкончания,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|			ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|	КОНЕЦ КАК ДатаНачалаСобытия,
	|	НачислениеПоБольничномуЛисту.ДатаНарушенияРежима,
	|	НачислениеПоБольничномуЛисту.ДнейОплаты,
	|	НачислениеПоБольничномуЛисту.ВидРасчета КАК ВидРасчета,
	|	ПараметрыВидаРасчета.СпособРасчета КАК СпособРасчета,
	|	&ДокументСсылка КАК ДокументОснование,
	|	&ПериодРСЗ КАК ПериодРасчетаСреднегоЗаработка,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|					ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|				ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|			КОНЕЦ = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВЫБОР
	|						КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|							ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|						ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|					КОНЕЦ, МЕСЯЦ), МЕСЯЦ, &КоличествоМесяцевРасчета)
	|	КОНЕЦ КАК ПериодРасчетаСреднегоЗаработкаНачало,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|					ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|				ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|			КОНЕЦ = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВЫБОР
	|						КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|							ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|						ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|					КОНЕЦ, МЕСЯЦ), МЕСЯЦ, &КоличествоМесяцевРасчета)
	|	КОНЕЦ КАК ДатаНачалаРасчетногоПериода,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|					ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|				ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|			КОНЕЦ = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВЫБОР
	|						КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|							ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|						ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|					КОНЕЦ, МЕСЯЦ), СЕКУНДА, &СекундыКонцаПериода)
	|	КОНЕЦ КАК ПериодРасчетаСреднегоЗаработкаОкончание,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|					ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|				ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|			КОНЕЦ = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ВЫБОР
	|						КОГДА НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист = ЗНАЧЕНИЕ(Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ПустаяСсылка)
	|							ТОГДА НачислениеПоБольничномуЛисту.ДатаНачала
	|						ИНАЧЕ НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.ДатаНачала
	|					КОНЕЦ, МЕСЯЦ), СЕКУНДА, &СекундыКонцаПериода)
	|	КОНЕЦ КАК ДатаОкончанияРасчетногоПериода,
	|	РаботникиОрганизацииСрезПоследних.ГрафикРаботы КАК ГрафикРаботы,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизацииСрезПоследних.СуммированныйУчетРабочегоВремени
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоЧасам)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоЧасам)
	|	КОНЕЦ КАК ВидУчетаВремени,
	|	НачислениеПоБольничномуЛисту.ПерерассчитываемыйДокумент КАК ПерерассчитываемыйДокумент,
	|	НачислениеПоБольничномуЛисту.ПерерассчитываемыйДокумент.ПериодРегистрации КАК ПериодПерерасчета,
	|	НачислениеПоБольничномуЛисту.ПерерассчитываемыйДокумент.Организация КАК ОрганизацияПерерасчета,
	|	НачислениеПоБольничномуЛисту.ПособиеОтражаетсяВРеглУчетеТекущимДокументом КАК ОтражатьВУчетеЭтимДокументом,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.Сотрудник.Организация = ВЫБОР
	|				КОГДА НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|					ТОГДА НачислениеПоБольничномуЛисту.Организация
	|				ИНАЧЕ НачислениеПоБольничномуЛисту.Организация.ГоловнаяОрганизация
	|			КОНЕЦ
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ОшибкаНеСоответствиеСотрудникаИОрганизации,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.Дата < НачислениеПоБольничномуЛисту.ПериодРегистрации
	|			ТОГДА НачислениеПоБольничномуЛисту.ПериодРегистрации
	|		КОГДА НачислениеПоБольничномуЛисту.Дата > КОНЕЦПЕРИОДА(НачислениеПоБольничномуЛисту.ПериодРегистрации, МЕСЯЦ)
	|			ТОГДА КОНЕЦПЕРИОДА(НачислениеПоБольничномуЛисту.ПериодРегистрации, МЕСЯЦ)
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.Дата
	|	КОНЕЦ КАК ПериодРегистрацииДополнительныхНачислений,
	|	НачислениеПоБольничномуЛисту.РучнойРасчетСреднегоЗаработка,
	|	НачислениеПоБольничномуЛисту.РазмерСреднегоЗаработка,
	|	НачислениеПоБольничномуЛисту.СпособРасчетаВДнях,
	|	ДанныеОбОтражении.СтратегияОтраженияВУчете,
	|	ДанныеОбОтражении.ПроцентЕНВД,
	|	ДанныеОбОтражении.УказаноОтражениеВУчетеДляРаботодателя,
	|	ДанныеОбОтражении.ОтражениеВУСН,
	|	ДанныеОбОтражении.СчетДт,
	|	ДанныеОбОтражении.СубконтоДт1,
	|	ДанныеОбОтражении.СубконтоДт2,
	|	ДанныеОбОтражении.СубконтоДт3,
	|	ДанныеОбОтражении.СчетКт,
	|	ДанныеОбОтражении.СубконтоКт1,
	|	ДанныеОбОтражении.СчетДтНУ,
	|	ДанныеОбОтражении.СубконтоДтНУ1,
	|	ДанныеОбОтражении.СубконтоДтНУ2,
	|	ДанныеОбОтражении.СубконтоДтНУ3,
	|	ДанныеОбОтражении.СчетКтНУ,
	|	ДанныеОбОтражении.СубконтоКтНУ1,
	|	НачислениеПоБольничномуЛисту.ДатаНарушенияРежимаКон,
	|	НачислениеПоБольничномуЛисту.ТипРасчета
	|ИЗ
	|	ВТДанныеДокумента КАК НачислениеПоБольничномуЛисту
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеОСотруднике КАК РаботникиОрганизацииСрезПоследних
	|		ПО (ИСТИНА)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОтражениеВУчете КАК ДанныеОбОтражении
	|		ПО (ИСТИНА)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовРасчета.ДополнительныеНачисленияОрганизаций КАК ПараметрыВидаРасчета
	|		ПО НачислениеПоБольничномуЛисту.ВидРасчета = ПараметрыВидаРасчета.Ссылка";
	//Островская Татьяна 28.12.2012 № 16068,17421
	//Аверсон-софт, Островская Татьяна 17.07.2012 № 15598
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоШапке()

// Формирует запрос по табличной части Начисления
//
//
// Возвращаемое значение:
//	Результат запроса
//
Функция СформироватьЗапросПоНачислениям(ВыборкаПоШапкеДокумента)
	
	Запрос = Новый Запрос;
	
	ГоловнаяОрганизация = ВыборкаПоШапкеДокумента.Организация;
	СписокСтруктурныхПодразделений = ПроцедурыУправленияПерсоналом.ПолучитьСписокОбособленныхПодразделенийОрганизации(ГоловнаяОрганизация);
	СписокСтруктурныхПодразделений.Добавить(ГоловнаяОрганизация);
	Запрос.УстановитьПараметр("СписокСтруктурныхПодразделений",	СписокСтруктурныхПодразделений);
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",					Ссылка);
	Запрос.УстановитьПараметр("ДатаНачалаСобытия" , 			ВыборкаПоШапкеДокумента.ДатаНачалаСобытия);
	//Запрос.УстановитьПараметр("ДатаЗакона255ФЗ",				мДатаЗакона255ФЗ);
	Запрос.УстановитьПараметр("ГоловнаяОрганизация",			ГоловнаяОрганизация);
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СтрокиНачисления.НомерСтроки,
	|	СтрокиНачисления.Сотрудник,
	|	ЕСТЬNULL(ГрафикРаботыПоСотруднику.Сотрудник, ВЫБОР
	|			КОГДА РаботникиОрганизации.ПериодЗавершения <= СтрокиНачисления.ДатаНачалаСобытия
	|					И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|				ТОГДА РаботникиОрганизации.ГрафикРаботыЗавершения
	|			ИНАЧЕ РаботникиОрганизации.ГрафикРаботы
	|		КОНЕЦ) КАК ГрафикРаботы,
	|	ВЫБОР
	|		КОГДА НЕ ГрафикРаботыНормаПоСотруднику.НомерСтроки ЕСТЬ NULL 
	|				ИЛИ (РаботникиОрганизации.ПериодЗавершения <= СтрокиНачисления.ДатаНачалаСобытия
	|						И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|						И РаботникиОрганизации.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени <> ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	|						И НЕ РаботникиОрганизации.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени ЕСТЬ NULL 
	|					ИЛИ НЕ(РаботникиОрганизации.ПериодЗавершения <= СтрокиНачисления.ДатаНачалаСобытия
	|								И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0))
	|						И РаботникиОрганизации.ГрафикРаботы.ГрафикПолногоРабочегоВремени <> ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	|						И НЕ РаботникиОрганизации.ГрафикРаботы.ГрафикПолногоРабочегоВремени ЕСТЬ NULL )
	|			ТОГДА ВЫБОР
	|					КОГДА РаботникиОрганизации.ПериодЗавершения <= СтрокиНачисления.ДатаНачалаСобытия
	|							И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|						ТОГДА РаботникиОрганизации.ГрафикРаботыЗавершения
	|					ИНАЧЕ РаботникиОрганизации.ГрафикРаботы
	|				КОНЕЦ
	|	КОНЕЦ КАК ГрафикРаботыНорма,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА РаботникиОрганизации.ПериодЗавершения <= СтрокиНачисления.ДатаНачалаСобытия
	|						И РаботникиОрганизации.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|					ТОГДА РаботникиОрганизации.ГрафикРаботыЗавершения.СуммированныйУчетРабочегоВремени
	|				ИНАЧЕ РаботникиОрганизации.ГрафикРаботы.СуммированныйУчетРабочегоВремени
	|			КОНЕЦ
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоЧасам)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
	|	КОНЕЦ КАК ВидУчетаВремени,
	|	СтрокиНачисления.ВидРасчета,
	|	СтрокиНачисления.ВидРасчета.ЗачетОтработанногоВремени КАК ЗачетОтработанногоВремени,
	|	ЛОЖЬ КАК ЗачетНормыВремени,
	|	СтрокиНачисления.ВидРасчета.КодДоходаНДФЛ КАК КодДоходаНДФЛ,
	|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбработкиЗаписиПриОтраженииВРеглУчете.НеОбрабатывать) КАК ВариантОбработкиЗаписиПриОтраженииВРеглУчете,
	|	СтрокиНачисления.ДатаНачала КАК МесяцНалоговогоПериода,
	|	СтрокиНачисления.ДатаНачала КАК ПериодДействияНачало,
	|	ВЫБОР
	|		КОГДА СтрокиНачисления.ДатаОкончания <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА КОНЕЦПЕРИОДА(СтрокиНачисления.ДатаОкончания, ДЕНЬ)
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК ПериодДействияКонец,
	|	СтрокиНачисления.ДатаНачала КАК БазовыйПериодНачало,
	|	ВЫБОР
	|		КОГДА СтрокиНачисления.ДатаОкончания <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА КОНЕЦПЕРИОДА(СтрокиНачисления.ДатаОкончания, ДЕНЬ)
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК БазовыйПериодКонец,
	|	СтрокиНачисления.Показатель1,
	|	СтрокиНачисления.Показатель2,
	|	СтрокиНачисления.Показатель3,
	|	СтрокиНачисления.Показатель4,
	|	СтрокиНачисления.Показатель5,
	|	СтрокиНачисления.Показатель6,
	|	СтрокиНачисления.Результат,
	|	СтрокиНачисления.ДополнительныеДанные,
	|	СтрокиНачисления.ПодразделениеОрганизации,
	|	СтрокиНачисления.ОплаченоДнейЧасов,
	|	СтрокиНачисления.ОплаченоДней,
	|	СтрокиНачисления.ОтработаноДней,
	|	СтрокиНачисления.ОтработаноЧасов,
	|	СтрокиНачисления.ОтработаноДнейПоПятидневке,
	|	СтрокиНачисления.ОтработаноЧасовПоПятидневке,
	|	СтрокиНачисления.НормаДней,
	|	СтрокиНачисления.НормаЧасов,
	|	СтрокиНачисления.НормаДнейПоПятидневке,
	|	СтрокиНачисления.НормаЧасовПоПятидневке,
	|	СтрокиНачисления.ПериодРасчетаСреднегоЗаработкаНачало,
	|	СтрокиНачисления.ПериодРасчетаСреднегоЗаработкаОкончание,
	|	СтрокиНачисления.ДатаНачалаСобытия,
	|	СтрокиНачисления.Сторно,
	|	СтрокиНачисления.Авторасчет,
	|	ВЫБОР
	|		КОГДА СтрокиНачисления.Сотрудник.Организация = &ГоловнаяОрганизация
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ОшибкаНеСоответствиеСотрудникаИОрганизации,
	|	ВЫБОР
	|		КОГДА НЕ СтрокиНачисления.ПодразделениеОрганизации.Владелец В (&СписокСтруктурныхПодразделений)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ОшибкаПодразделениеНеПринадлежитОрганизации,
	|	ВЫБОР
	|		КОГДА СтрокиНачисления.Сторно
	|			ТОГДА СтрокиНачисления.СторнируемыйДокумент
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК СторнируемыйДокумент,
	|	СтрокиНачисления.ВидРасчета ССЫЛКА ПланВидовРасчета.ОсновныеНачисленияОрганизаций КАК ОсновныеНачисления,
	|	СтрокиНачисления.ЧислоМесяцев
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК СтрокиНачисления
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			МАКСИМУМ(РаботникиОрганизации.Период) КАК МаксПериод,
	|			СтрокиНачисления.НомерСтроки КАК НомерСтроки
	|		ИЗ
	|			Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК СтрокиНачисления
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
	|				ПО (РаботникиОрганизации.Период <= СтрокиНачисления.ДатаНачалаСобытия)
	|					И СтрокиНачисления.Сотрудник = РаботникиОрганизации.Сотрудник
	|		ГДЕ
	|			СтрокиНачисления.Ссылка = &ДокументСсылка
	|		
	|		СГРУППИРОВАТЬ ПО
	|			СтрокиНачисления.НомерСтроки) КАК ПоследниеДаты
	|		ПО СтрокиНачисления.НомерСтроки = ПоследниеДаты.НомерСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
	|		ПО (РаботникиОрганизации.Период = ПоследниеДаты.МаксПериод)
	|			И СтрокиНачисления.Сотрудник = РаботникиОрганизации.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	|			СтрокиНачисления.НомерСтроки КАК НомерСтроки,
	|			СтрокиНачисления.Сотрудник КАК Сотрудник
	|		ИЗ
	|			Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК СтрокиНачисления
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикиРаботыПоВидамВремени КАК ГрафикиРаботыПоВидамВремени
	|				ПО (ГрафикиРаботыПоВидамВремени.ГрафикРаботы = СтрокиНачисления.Сотрудник)
	|					И (ГрафикиРаботыПоВидамВремени.Месяц = НАЧАЛОПЕРИОДА(СтрокиНачисления.ДатаНачала, МЕСЯЦ))
	|		ГДЕ
	|			СтрокиНачисления.Ссылка = &ДокументСсылка) КАК ГрафикРаботыПоСотруднику
	|		ПО СтрокиНачисления.НомерСтроки = ГрафикРаботыПоСотруднику.НомерСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	|			СтрокиНачисления.НомерСтроки КАК НомерСтроки,
	|			СтрокиНачисления.Сотрудник КАК Сотрудник
	|		ИЗ
	|			Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК СтрокиНачисления
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикиРаботыПоВидамВремени КАК ГрафикиРаботыПоВидамВремени
	|				ПО (ГрафикиРаботыПоВидамВремени.ГрафикРаботы = СтрокиНачисления.Сотрудник)
	|					И (ГрафикиРаботыПоВидамВремени.Месяц = НАЧАЛОПЕРИОДА(СтрокиНачисления.ДатаНачала, МЕСЯЦ))
	|					И (НЕ ГрафикиРаботыПоВидамВремени.План)
	|		ГДЕ
	|			СтрокиНачисления.Ссылка = &ДокументСсылка) КАК ГрафикРаботыНормаПоСотруднику
	|		ПО СтрокиНачисления.НомерСтроки = ГрафикРаботыНормаПоСотруднику.НомерСтроки
	|ГДЕ
	|	СтрокиНачисления.Ссылка = &ДокументСсылка";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоНачислениям()

// Формирует запрос по таблице "РасчетСреднего" документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//	Результат запроса.
//
Функция СформироватьЗапросПоРасчетСреднего()
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",		Ссылка);
	Запрос.УстановитьПараметр("ДатаЗакона180ФЗ",	мДатаЗакона180ФЗ);
	
	// реализация Федерального закона № 180-ФЗ от 22.12.2005 г.:
	// поле "Сотрудник" с 1 января 2006 года может идентифицировать несколько мест работы,
	// включая работу по внутреннему совместительству
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА СтрокаРасчетСреднего.Ссылка.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА СтрокаРасчетСреднего.Ссылка.Организация
	|		ИНАЧЕ СтрокаРасчетСреднего.Ссылка.Организация.ГоловнаяОрганизация
	|	КОНЕЦ КАК Организация,
	|	СтрокаРасчетСреднего.Ссылка.Сотрудник.Физлицо КАК Физлицо,
	|	СтрокаРасчетСреднего.НомерСтроки,
	|	СтрокаРасчетСреднего.Сотрудник,
	|	СтрокаРасчетСреднего.ВидРасчета,
	|	СтрокаРасчетСреднего.БазовыйПериодНачало КАК БазовыйПериодНачало,
	|	ВЫБОР
	|		КОГДА СтрокаРасчетСреднего.БазовыйПериодКонец <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА КОНЕЦПЕРИОДА(СтрокаРасчетСреднего.БазовыйПериодКонец, ДЕНЬ)
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК БазовыйПериодКонец,
	|	СтрокаРасчетСреднего.КоэффициентИндексации,
	|	СтрокаРасчетСреднего.Результат,
	|	СтрокаРасчетСреднего.ОтработаноПоПятидневке,
	|	СтрокаРасчетСреднего.НормаПоПятидневке,
	|	СтрокаРасчетСреднего.ОтработаноДней,
	|	СтрокаРасчетСреднего.ОтработаноЧасов,
	|	СтрокаРасчетСреднего.МесяцВыборки,
	|	СтрокаРасчетСреднего.ЧислоМесяцев,
	|	СтрокаРасчетСреднего.ТарифнаяСтавкаПериода,
	|	СтрокаРасчетСреднего.ТекущаяТарифнаяСтавка,
	|	СтрокаРасчетСреднего.ДатаДоговора,
	|	СтрокаРасчетСреднего.НомерДоговора
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК СтрокаРасчетСреднего
	|ГДЕ
	|	СтрокаРасчетСреднего.Ссылка = &ДокументСсылка";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоРасчетСреднего()

// Формирует запрос по таблице "ОтражениеВУчете" документа
//
// Параметры: 
//  Режим - режим проведения
//
// Возвращаемое значение:
//	Результат запроса.
//
Функция СформироватьЗапросПоОтражениеВУчете()
	
	// готовим список счетов
	СчетаИсключения = Новый Массив();
	СчетаИсключения.Добавить(ПланыСчетов.Хозрасчетный.РасчетыПоСоциальномуСтрахованию);
	СчетаИсключения.Добавить(ПланыСчетов.Хозрасчетный.РасчетыПоНалогам);
	СчетаИсключения.Добавить(ПланыСчетов.Хозрасчетный.РасходыБудущихПериодов);
	СчетаИсключения.Добавить(ПланыСчетов.Хозрасчетный.НераспределеннаяПрибыль);
	СчетаИсключения.Добавить(ПланыСчетов.Хозрасчетный.ПрочиеДоходыИРасходы);
	
	ТекстСчетаИсключения = 
	"ВЫБРАТЬ
	|	Хозрасчетный.Ссылка
	|ИЗ
	|	ПланСчетов.Хозрасчетный КАК Хозрасчетный
	|ГДЕ
	|	Хозрасчетный.Ссылка В ИЕРАРХИИ(&СчетаИсключения)";
	
	Запрос = Новый Запрос(ТекстСчетаИсключения);
	Запрос.УстановитьПараметр("СчетаИсключения", СчетаИсключения);
	СчетаИсключения = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка",	Ссылка);
	Запрос.УстановитьПараметр("СчетаИсключения", СчетаИсключения);
	Запрос.УстановитьПараметр("ДатаНачалаСобытия", ПолучитьДатуНачалаСобытия());
	
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СтрокаОтраженияВУчете.НомерСтроки,
	|	СтрокаОтраженияВУчете.Ссылка.Сотрудник,
	|	СтрокаОтраженияВУчете.Ссылка.Сотрудник.Физлицо КАК Физлицо,
	|	&ДатаНачалаСобытия КАК ДатаНачалаСобытия,
	|	ВЫБОР
	|		КОГДА СтрокаОтраженияВУчете.СчетДт В (&СчетаИсключения)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ОтражаетсяНУ,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА СтрокаОтраженияВУчете.СубконтоДт1 ССЫЛКА Справочник.СтатьиЗатрат
	|					ТОГДА СтрокаОтраженияВУчете.СубконтоДт1.ОтнесениеРасходовКДеятельностиЕНВД
	|				КОГДА СтрокаОтраженияВУчете.СубконтоДт2 ССЫЛКА Справочник.СтатьиЗатрат
	|					ТОГДА СтрокаОтраженияВУчете.СубконтоДт2.ОтнесениеРасходовКДеятельностиЕНВД
	|				КОГДА СтрокаОтраженияВУчете.СубконтоДт3 ССЫЛКА Справочник.СтатьиЗатрат
	|					ТОГДА СтрокаОтраженияВУчете.СубконтоДт3.ОтнесениеРасходовКДеятельностиЕНВД
	|				ИНАЧЕ NULL
	|			КОНЕЦ = ЗНАЧЕНИЕ(Перечисление.ОтнесениеРасходовКДеятельностиЕНВД.РасходыОтносятсяКЕНВД)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоЕНВД,
	|	СтрокаОтраженияВУчете.Результат,
	|	СтрокаОтраженияВУчете.СчетДт,
	|	СтрокаОтраженияВУчете.СчетДт.Наименование КАК НаименованиеСчетДт,
	|	СтрокаОтраженияВУчете.СубконтоДт1,
	|	СтрокаОтраженияВУчете.СубконтоДт2,
	|	СтрокаОтраженияВУчете.СубконтоДт3,
	|	СтрокаОтраженияВУчете.СчетКт,
	|	СтрокаОтраженияВУчете.СубконтоКт1,
	|	СтрокаОтраженияВУчете.СубконтоКт2,
	|	СтрокаОтраженияВУчете.СубконтоКт3,
	|	СтрокаОтраженияВУчете.СчетДтНУ,
	|	СтрокаОтраженияВУчете.СубконтоДтНУ1,
	|	СтрокаОтраженияВУчете.СубконтоДтНУ2,
	|	СтрокаОтраженияВУчете.СубконтоДтНУ3,
	|	СтрокаОтраженияВУчете.СчетКтНУ,
	|	СтрокаОтраженияВУчете.СубконтоКтНУ1,
	|	СтрокаОтраженияВУчете.СубконтоКтНУ2,
	|	СтрокаОтраженияВУчете.СубконтоКтНУ3,
	|	СтрокаОтраженияВУчете.ОтражениеВУСН,
	|	СтрокаОтраженияВУчете.ПериодДействияНачало,
	|	ВЫБОР
	|		КОГДА СтрокаОтраженияВУчете.ПериодДействияКонец <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА КОНЕЦПЕРИОДА(СтрокаОтраженияВУчете.ПериодДействияКонец, ДЕНЬ)
	|		ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|	КОНЕЦ КАК ПериодДействияКонец,
	|	СтрокаОтраженияВУчете.КодДоходаЕСН,
	|	СтрокаОтраженияВУчете.ОблагаетсяЕНВД,
	|	СтрокаОтраженияВУчете.Сторно
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.ОтражениеВУчете КАК СтрокаОтраженияВУчете
	|ГДЕ
	|	СтрокаОтраженияВУчете.Ссылка = &ДокументСсылка
	|	И СтрокаОтраженияВУчете.Результат <> 0";
	
	Возврат Запрос.Выполнить();
	
КонецФункции // СформироватьЗапросПоОтражениеВУчете()

// Формирует запрос по табличным частям документам
//
// Параметры: 
//  Режим        - режим проведения.
//
// Возвращаемое значение:
//  Результат запроса.
//
Функция СформироватьЗапросПоПособияСоциальномуСтрахованию()
	
	Запрос = Новый Запрос;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("ДокументСсылка" , Ссылка);
	Запрос.УстановитьПараметр("ДатаЗакона255ФЗ" , НачалоМесяца(мДатаЗакона255ФЗ));
	Запрос.УстановитьПараметр("НовыйСтраховойСлучай", ?(ПервичныйБольничныйЛист.Пустая() и ПерерассчитываемыйДокумент.Пустая(),1,0));
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСНОсновныеНачисления.ПериодРегистрации КАК Период,
	|	ЕСНОсновныеНачисления.ОбособленноеПодразделение КАК Организация,
	|	ВЫБОР
	|		КОГДА ЕСНОсновныеНачисления.КодДоходаЕСН = ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ПособияЗаСчетФСС)
	|			ТОГДА ЕСНОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
	|	КОНЕЦ КАК ВидПособияСоциальногоСтрахования,
	|	ЕСНОсновныеНачисления.ОблагаетсяЕНВД,
	|	ВЫБОР
	|		КОГДА ЕСНОсновныеНачисления.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
	|	КОНЕЦ КАК ВидЗанятости,
	|	&НовыйСтраховойСлучай КАК СтраховыеСлучаи,
	|	СУММА(ЕСТЬNULL(ЕСНФактическийПериодДействия.ОплаченныеДни, ВЫБОР
	|				КОГДА ЕСНОсновныеНачисления.ВидУчетаВремени = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаВремени.ПоДням)
	|					ТОГДА ЕСНОсновныеНачисленияДанныеГрафика.ОсновноеЗначениеФактическийПериодДействия
	|				ИНАЧЕ ЕСНОсновныеНачисленияДанныеГрафика.ДополнительноеЗначениеФактическийПериодДействия
	|			КОНЕЦ) * ВЫБОР
	|			КОГДА ЕСНОсновныеНачисления.Сторно
	|				ТОГДА -1
	|			ИНАЧЕ 1
	|		КОНЕЦ) КАК ОплаченныеДни,
	|	СУММА(ЕСНОсновныеНачисления.Результат) КАК СуммаВсего,
	|	ЕСНОсновныеНачисления.Сотрудник,
	|	ЕСНОсновныеНачисления.ДокументОснование
	|ИЗ
	|	РегистрРасчета.ЕСНОсновныеНачисления КАК ЕСНОсновныеНачисления
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрРасчета.ЕСНОсновныеНачисления.ДанныеГрафика(
	|				Регистратор = &ДокументСсылка
	|					И (НЕ ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПоУходуЗаРебенкомДоПолутораЛет), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)))) КАК ЕСНОсновныеНачисленияДанныеГрафика
	|		ПО ЕСНОсновныеНачисления.Регистратор = ЕСНОсновныеНачисленияДанныеГрафика.Регистратор
	|			И ЕСНОсновныеНачисления.НомерСтроки = ЕСНОсновныеНачисленияДанныеГрафика.НомерСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ЕСНФактическийПериодДействия.Регистратор КАК Регистратор,
	|			ЕСНФактическийПериодДействия.НомерСтроки КАК НомерСтроки,
	|			СУММА(РАЗНОСТЬДАТ(ЕСНФактическийПериодДействия.ПериодДействияНачало, ЕСНФактическийПериодДействия.ПериодДействияКонец, ДЕНЬ) + 1) КАК ОплаченныеДни
	|		ИЗ
	|			РегистрРасчета.ЕСНОсновныеНачисления.ФактическийПериодДействия(
	|					Регистратор = &ДокументСсылка
	|						И ПериодДействия >= &ДатаЗакона255ФЗ
	|						И ВидРасчета.ВидПособияСоциальногоСтрахования В (ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьПрофзаболевание), ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.НетрудоспособностьНесчастныйСлучай))) КАК ЕСНФактическийПериодДействия
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ЕСНФактическийПериодДействия.Регистратор,
	|			ЕСНФактическийПериодДействия.НомерСтроки) КАК ЕСНФактическийПериодДействия
	|		ПО ЕСНОсновныеНачисления.НомерСтроки = ЕСНФактическийПериодДействия.НомерСтроки
	|			И ЕСНОсновныеНачисления.Регистратор = ЕСНФактическийПериодДействия.Регистратор
	|ГДЕ
	|	ЕСНОсновныеНачисления.Регистратор = &ДокументСсылка
	|	И ЕСНОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования <> ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСНОсновныеНачисления.ПериодРегистрации,
	|	ЕСНОсновныеНачисления.ОбособленноеПодразделение,
	|	ЕСНОсновныеНачисления.ОблагаетсяЕНВД,
	|	ЕСНОсновныеНачисления.Сотрудник,
	|	ЕСНОсновныеНачисления.ДокументОснование,
	|	ВЫБОР
	|		КОГДА ЕСНОсновныеНачисления.КодДоходаЕСН = ЗНАЧЕНИЕ(Справочник.ДоходыЕСН.ПособияЗаСчетФСС)
	|			ТОГДА ЕСНОсновныеНачисления.ВидРасчета.ВидПособияСоциальногоСтрахования
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.ПустаяСсылка)
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ЕСНОсновныеНачисления.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ПустаяСсылка)
	|	КОНЕЦ";
	
	Возврат Запрос.Выполнить();
	
КонецФункции

// Проверяет правильность заполнения шапки документа.
// Если какой-то из реквизтов шапки, влияющий на проведение, не заполнен или
// заполнен некорректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса по шапке,
// все проверяемые реквизиты должны быть включены в выборку по шапке.
//
// Параметры: 
//	ВыборкаПоШапкеДокумента	- выборка из результата запроса по шапке документа,
//	Отказ 					- флаг отказа в проведении.
//	Заголовок				- Заголовок для сообщений об ошибках проведения.
//
Процедура ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок = "")
	
	// ПериодРегистрации
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПериодРегистрации) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указан период регистрации!", Отказ, Заголовок);
	КонецЕсли;
	
	//  Организация
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Организация) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана организация, по которой выполняется начисление!", Отказ, Заголовок);
	КонецЕсли;
	
	// Сотрудник
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.Сотрудник) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не выбран сотрудник!", Отказ, Заголовок);
	КонецЕсли;
	
	// ДатаНачала
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНачала) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана дата начала оплачиваемого события!", Отказ, Заголовок);
	КонецЕсли;
	
	// ДатаОкончания
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаОкончания) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана дата окончания оплачиваемого события!", Отказ, Заголовок);
	КонецЕсли;
	
	// Период нетрудоспособности
	Если ВыборкаПоШапкеДокумента.ДатаОкончания < ВыборкаПоШапкеДокумента.ДатаНачала Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Дата окончания оплачиваемого события не должна быть меньше даты начала!", Отказ, Заголовок);
	КонецЕсли;
	
	// ВидРасчета
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указана причина нетрудоспособности!", Отказ, Заголовок);
		//ИначеЕсли ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоУходуЗаРебенком И НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.СлучайУходаЗаБольнымРебенком) Тогда
		//	ОбщегоНазначения.СообщитьОбОшибке("Не указан случай ухода за ребенком!", Отказ, Заголовок);
	КонецЕсли;
	
	// Процент оплаты
	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПроцентОплаты) Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Не указан процент оплаты!", Отказ, Заголовок);
	КонецЕсли;
	
	// Проверка данных для переходного периода
	//Если ПерерассчитываемыйДокумент.Пустая() 
	//	И ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНачала) 
	//	И ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаОкончания)
	//	И ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности) Тогда
	//	
	//	//мДатаЗакона255ФЗ = ПроведениеРасчетов.ПолучитьДатуВступленияВСилуИзмененийПоСоциальнымПособиям2006();
	//	//Если ВыборкаПоШапкеДокумента.ДатаНачалаСобытия < мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ДатаОкончания >= мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
	//	//	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПричинаНетрудоспособностиПереходногоПериода) Тогда
	//	//		ОбщегоНазначения.СообщитьОбОшибке("Не указана причина нетрудоспособности для переходного периода!", Отказ, Заголовок);
	//	//	ИначеЕсли ВыборкаПоШапкеДокумента.ПричинаНетрудоспособностиПереходногоПериода = Перечисления.ПричиныНетрудоспособности.ПоУходуЗаРебенком И НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.СлучайУходаЗаБольнымРебенкомПереходногоПериода) Тогда
	//	//		ОбщегоНазначения.СообщитьОбОшибке("Не указан случай ухода за ребенком для переходного периода!", Отказ, Заголовок);
	//	//	КонецЕсли;
	//	//	Если НЕ ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ПроцентОплатыПереходногоПериода) Тогда
	//	//		ОбщегоНазначения.СообщитьОбОшибке("Не указан процент оплаты для переходного периода!", Отказ, Заголовок);
	//	//	КонецЕсли;
	//	//КонецЕсли;
	//	
	//КонецЕсли;
	
	// Организация сотрудника должна совпадать с организацией документа
	Если ВыборкаПоШапкеДокумента.ОшибкаНеСоответствиеСотрудникаИОрганизации Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Указанный сотрудник оформлен на другую организацию!", Отказ, Заголовок);
	КонецЕсли;
	
	// ВидЗанятости
	//толик отменил
	//Если ВыборкаПоШапкеДокумента.ВидЗанятости = Перечисления.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство Тогда
	//	ОбщегоНазначения.СообщитьОбОшибке("Документ не может быть оформлен на внутреннего совместителя!", Отказ, Заголовок);
	//КонецЕсли;
	
	// соответствие периодов документа и перерассчитываемого документа
	Если ВыборкаПоШапкеДокумента.ПериодПерерасчета <> null 
		и ВыборкаПоШапкеДокумента.ПериодРегистрации <= ВыборкаПоШапкеДокумента.ПериодПерерасчета Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Период документа должен быть больше периода перерассчитываемого документа!", Отказ, Заголовок);
	КонецЕсли;
	
	// соответствие организаций документа и перерассчитываемого документа
	Если ВыборкаПоШапкеДокумента.ОрганизацияПерерасчета <> null 
		и ВыборкаПоШапкеДокумента.ОбособленноеПодразделение <> ВыборкаПоШапкеДокумента.ОрганизацияПерерасчета Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Организация, заданная для документа, должна совпадать с организацией перерассчитываемого документа!", Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеШапки()

// Проверяет правильность заполнения реквизитов в строке ТЧ "Начисления" документа.
// Если какой-то из реквизтов, влияющий на проведение, не заполнен или
// заполнен некорректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса к ТЧ документа,
// все проверяемые реквизиты должны быть включены в выборку.
//
// Параметры: 
//  ВыборкаПоШапкеДокумента		- выборка из результата запроса по шапке документа,
//  ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
//  							  из результата запроса к ТЧ документа, 
//  Отказ 						- флаг отказа в проведении,
//	Заголовок				- Заголовок для сообщений об ошибках проведения.
//
Процедура ПроверитьЗаполнениеСтрокиНачисления(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента, Отказ, Заголовок, ПроверятьМестоРаботы)
	
	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки) +
	""" табл. части ""Оплата"": ";
	
	// Сотрудник в табличном поле
	Если ПроверятьМестоРаботы И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Сотрудник) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан сотрудник!", Отказ, Заголовок);
	КонецЕсли;
	
	// ВидРасчета
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ВидРасчета) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан вид расчета!", Отказ, Заголовок);
	КонецЕсли;
	
	// Дата начала
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ПериодДействияНачало) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата начала начисления!", Отказ, Заголовок);
	Иначе
		// Дата окончания
		Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ПериодДействияКонец) Тогда
			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата окончания начисления!", Отказ, Заголовок);
		Иначе
			Если ВыборкаПоСтрокамДокумента.ПериодДействияКонец < ВыборкаПоСтрокамДокумента.ПериодДействияНачало Тогда
				ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата окончания начисления не должна быть меньше даты начала!", Отказ, Заголовок);
			ИначеЕсли ВыборкаПоСтрокамДокумента.ОсновныеНачисления Тогда
				Если НачалоМесяца(ВыборкаПоСтрокамДокумента.ПериодДействияКонец) <> НачалоМесяца(ВыборкаПоСтрокамДокумента.ПериодДействияНачало) Тогда
					ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "даты начала и окончания должны принадлежать одному месяцу!", Отказ, Заголовок);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	// Дата начала события
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ДатаНачалаСобытия) И ВыборкаПоСтрокамДокумента.ОсновныеНачисления Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата начала события!", Отказ, Заголовок);
	КонецЕсли;
	
	// Организация сотрудника должна совпадать с организацией документа
	Если ПроверятьМестоРаботы И ВыборкаПоСтрокамДокумента.ОшибкаНеСоответствиеСотрудникаИОрганизации Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указанный сотрудник оформлен на другую организацию!", Отказ, Заголовок);
	КонецЕсли;
	
	// Подразделение
	//Если ПроверятьМестоРаботы И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ПодразделениеОрганизации) Тогда
	//	ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указано подразделение организации!", Отказ, Заголовок);
	//	
	//ИначеЕсли ПроверятьМестоРаботы И ВыборкаПоСтрокамДокумента.ОшибкаПодразделениеНеПринадлежитОрганизации Тогда
	//	ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "указано подразделение, принадлежащее другой организации!", Отказ, Заголовок);
	//	
	//КонецЕсли;
	
	Если НЕ ВыборкаПоСтрокамДокумента.Сторно И ВыборкаПоСтрокамДокумента.ОсновныеНачисления И 
		(ВыборкаПоСтрокамДокумента.ПериодДействияНачало < ВыборкаПоШапкеДокумента.ДатаНачала 
		ИЛИ ВыборкаПоСтрокамДокумента.ПериодДействияНачало > КонецДня(ВыборкаПоШапкеДокумента.ДатаОкончания) 
		ИЛИ ВыборкаПоСтрокамДокумента.ПериодДействияКонец < ВыборкаПоШапкеДокумента.ДатаНачала 
		ИЛИ ВыборкаПоСтрокамДокумента.ПериодДействияКонец > КонецДня(ВыборкаПоШапкеДокумента.ДатаОкончания)) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "период начисления выходит за временные границы оплачиваемого события!", Ложь, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиНачисления()

// Проверяет правильность заполнения реквизитов в строке ТЧ "РасчетСреднего" документа.
// Если какой-то из реквизтов, влияющий на проведение, не заполнен или
// заполнен некорректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса к ТЧ документа,
// все проверяемые реквизиты должны быть включены в выборку.
//
// Параметры: 
//	ВыборкаПоШапкеДокумента		- выборка из результата запроса по шапке документа,
//	ВыборкаПоСтрокамДокумента	- спозиционированная на определеной строке выборка 
//								  из результата запроса к ТЧ документа, 
//	Отказ 						- флаг отказа в проведении,
//	Заголовок				- Заголовок для сообщений об ошибках проведения.
//
Процедура ПроверитьЗаполнениеСтрокиРасчетСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента, Отказ, Заголовок, ПроверятьМестоРаботы)
	
	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоСтрокамДокумента.НомерСтроки) +
	""" табл. части ""Расчет среднего"": ";
	
	// Вид расчета
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ВидРасчета) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан вид расчета среднего заработка!", Отказ, Заголовок);
	КонецЕсли;
	
	// Дата начала базового периода
	Если НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.БазовыйПериодНачало) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата начала базового периода!", Отказ, Заголовок);
		// Дата окончания базового периода
	ИначеЕсли НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.БазовыйПериодКонец) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата окончания базового периода!", Отказ, Заголовок);
	ИначеЕсли ВыборкаПоСтрокамДокумента.БазовыйПериодКонец < ВыборкаПоСтрокамДокумента.БазовыйПериодНачало Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата начала базового периода не может быть больше даты окончания базового периода!", Отказ, Заголовок);
	КонецЕсли;
	
	// Сотрудник
	Если ПроверятьМестоРаботы И НЕ ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.Сотрудник) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указан сотрудник!", Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиРасчетСреднего()

// Проверяет правильность заполнения реквизитов в строке ТЧ "ОтраженияВУчете" документа.
// Если какой-то из реквизтов, влияющий на проведение, не заполнен или
// заполнен некорректно, то выставляется флаг отказа в проведении.
// Проверка выполняется по выборке из результата запроса к ТЧ документа,
// все проверяемые реквизиты должны быть включены в выборку.
//
Процедура ПроверитьЗаполнениеСтрокиОтраженияВУчете(ВыборкаПоДоходам, Отказ, ПроверятьСочетание, Заголовок = "")
	
	СтрокаНачалаСообщенияОбОшибке = "В строке номер """+ СокрЛП(ВыборкаПоДоходам.НомерСтроки) + """ табл. части ""Проводки и данные для ЕСН"": ";
	
	// Дата начала
	Если НЕ ЗначениеЗаполнено(ВыборкаПоДоходам.ПериодДействияНачало) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата начала периода начисления!", Отказ, Заголовок);
	Иначе
		// Дата окончания
		Если НЕ ЗначениеЗаполнено(ВыборкаПоДоходам.ПериодДействияКонец) Тогда
			ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "не указана дата окончания периода начисления!", Отказ, Заголовок);
		Иначе
			Если ВыборкаПоДоходам.ПериодДействияКонец < ВыборкаПоДоходам.ПериодДействияНачало Тогда
				ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "дата окончания периода начисления не должна быть меньше даты начала!", Отказ, Заголовок);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.СчетДт) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "Не указан счет дебета!", Отказ, Заголовок);
		ПроверятьСочетание = Ложь;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(ВыборкаПоДоходам.СчетКт) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + "Не указан счет кредита!", Отказ, Заголовок);
		ПроверятьСочетание = Ложь;
	КонецЕсли;
	
	Сообщение = "";
	Если ПроверятьСочетание И ВыборкаПоДоходам.ОтражаетсяНУ И Не КорректноеСочетаниеСчетовНУ(ВыборкаПоДоходам.СчетДт,ВыборкаПоДоходам.НаименованиеСчетДт,ВыборкаПоДоходам.СчетКт,ВыборкаПоДоходам.СчетДтНУ, ВыборкаПоДоходам.СчетКтНУ, ВыборкаПоДоходам.ЭтоЕНВД, Сообщение) Тогда
		ОбщегоНазначения.СообщитьОбОшибке(СтрокаНачалаСообщенияОбОшибке + Сообщение, Отказ, Заголовок);
	КонецЕсли;
	
КонецПроцедуры

// По строке выборок из результатов запроса по документу формируем движения по регистру
//
// Параметры:
//	Выборка				- спозиционированная на определеной строке выборка
//						  из результата запроса к ТЧ документа
// Возвращаемое значение:
//	Нет.
//
Процедура ДобавитьСтрокуОсновныхНачислений(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента)
	
	Движение = ПроведениеРасчетов.ДобавитьСтрокуОсновныхНачислений(Движения.ОсновныеНачисленияРаботниковОрганизаций, ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента);
	
	//ЭтоПереходныйПериодПоЗакону255ФЗ = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия < мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ДатаОкончания >= мДатаЗакона255ФЗ И ВыборкаПоШапкеДокумента.ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве;
	//Движение.ВариантАлгоритмаРасчета = ПолучитьВариантАлгоритмаРасчета(ЭтоПереходныйПериодПоЗакону255ФЗ);
	//Если ЗначениеЗаполнено(ВыборкаПоШапкеДокумента.ДатаНарушенияРежима) И Движение.ПериодДействияНачало >= ВыборкаПоШапкеДокумента.ДатаНарушенияРежима Тогда
	//Если ЭтоПереходныйПериодПоЗакону255ФЗ Тогда
	//	Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйПереходногоПериодаСОграничениемВРазмереММОТ;
	//Иначе
	//	Движение.ВариантАлгоритмаРасчета = Перечисления.ВариантыАлгоритмовРасчета.БольничныйСОграничениемВРазмереММОТбезРК;
	//КонецЕсли;
	//КонецЕсли;
	//толик оплачено дней
	Движение.ОплаченоДней = ВыборкаПоСтрокамДокумента.ОплаченоДней;
	
КонецПроцедуры // ДобавитьСтрокуОсновныхНачислений()

// По строке выборок из результатов запроса по документу формируем движения по регистру
//
// Параметры:
//	ВыборкаПоСтрокамДокумента				- спозиционированная на определеной строке выборка 
//											  из результата запроса к ТЧ документа, 
// Возвращаемое значение:
//	Нет.
//
Процедура ДобавитьСтрокуРасчетаСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента, НаборОсновныеНачисления)
	
	СуммаРесурсов = ВыборкаПоСтрокамДокумента.Результат + ВыборкаПоСтрокамДокумента.ОтработаноПоПятидневке +
	ВыборкаПоСтрокамДокумента.НормаПоПятидневке + ВыборкаПоСтрокамДокумента.ОтработаноДней + ВыборкаПоСтрокамДокумента.ОтработаноЧасов;
	
	Если СуммаРесурсов <> 0 Тогда
		
		Движение = НаборОсновныеНачисления.Добавить();
		
		СтрокаСвойствИзДокумента = "ПериодРегистрации,ФизЛицо,Организация,ДатаНачалаСобытия,СпособРасчета,"
		+ "ДатаНачалаРасчетногоПериода,ДатаОкончанияРасчетногоПериода,ПериодРасчетаСреднегоЗаработка";
		СтрокаСвойствИзСтрокиДокумента = "БазовыйПериодНачало,БазовыйПериодКонец,Сотрудник,ВидРасчета,Результат," 
		+ "ОтработаноПоПятидневке,НормаПоПятидневке,ОтработаноДней,ОтработаноЧасов,"
		+ "КоэффициентИндексации,ЧислоМесяцев"
		//+ СВЭЙ КДЯ 16.11.19 СВФР-004756
		+ ", МесяцВыборки"
		//- СВЭЙ КДЯ 16.11.19 СВФР-004756
		;
		
		ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоШапкеДокумента,СтрокаСвойствИзДокумента);
		ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоСтрокамДокумента,СтрокаСвойствИзСтрокиДокумента);
		
		
		Если не ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве Тогда
			ЗапросДоговор = Новый Запрос;
			ЗапросДоговор.Текст = 
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	ДоговорНаВыполнениеРаботСФизЛицом.ПервичныйДоговор КАК ПервичныйДоговор,
			|	ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала КАК ДатаНачала,
			|	ДоговорНаВыполнениеРаботСФизЛицом.ДатаОкончания КАК ДатаОкончания,
			|	ДоговорНаВыполнениеРаботСФизЛицом.Ссылка
			|ИЗ
			|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисленияРаботниковОрганизаций
			|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.НачислениеЗарплатыРаботникамОрганизаций.ДоговорыНаВыполнениеРабот КАК НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот
			|		ПО ДополнительныеНачисленияРаботниковОрганизаций.Регистратор = НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Ссылка
			|			И ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета = НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.ВидРасчета
			|			И ДополнительныеНачисленияРаботниковОрганизаций.Сотрудник = НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.Сотрудник
			|			И ДополнительныеНачисленияРаботниковОрганизаций.НомерСтроки = НачислениеЗарплатыРаботникамОрганизацийДоговорыНаВыполнениеРабот.НомерСтроки
			|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ДоговорНаВыполнениеРаботСФизЛицом КАК ДоговорНаВыполнениеРаботСФизЛицом
			|		ПО ДополнительныеНачисленияРаботниковОрганизаций.ДокументОснование = ДоговорНаВыполнениеРаботСФизЛицом.Ссылка
			|ГДЕ
			|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой)
			|	И ДополнительныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
			|	И &ДатаНачала МЕЖДУ ДоговорНаВыполнениеРаботСФизЛицом.ДатаНачала И ДоговорНаВыполнениеРаботСФизЛицом.ДатаОкончания
			|	И ДополнительныеНачисленияРаботниковОрганизаций.Результат <> 0";
			
			ЗапросДоговор.УстановитьПараметр("Сотрудник", Сотрудник);
			ЗапросДоговор.УстановитьПараметр("ДатаНачала", ДатаНачала);
			
			РезультатЗапросаДоговор = ЗапросДоговор.Выполнить();
			
			ВыборкаДетальныеЗаписи = РезультатЗапросаДоговор.Выбрать();
			ДатаНачДоговора = Дата(1,1,1);
			СписокДокументов = Новый СписокЗначений;
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				ДатаНачДоговора = ВыборкаДетальныеЗаписи.ДатаНачала;
				СписокДокументов.Добавить(ВыборкаДетальныеЗаписи.Ссылка);
				ПервичныйДог = ВыборкаДетальныеЗаписи.ПервичныйДоговор;
				Пока ЗначениеЗаполнено(ПервичныйДог) Цикл 
					Если ПервичныйДог.Проведен Тогда 
						СписокДокументов.Добавить(ПервичныйДог);
					КонецЕсли;
					ДатаНачДоговора = ПервичныйДог.ДатаНачала;
					//+ СВЭЙ КДЯ 02.12.19 СВФР-005149
					//ПервичныйДог = ПервичныйДог.ПервичныйДоговор; 
					//- СВЭЙ КДЯ 02.12.19 СВФР-005149
					
					//+ СВЭЙ КДЯ 02.12.19 СВФР-005149
					Если ПервичныйДог = ПервичныйДог.ПервичныйДоговор Тогда
						//защита от зацикливания
						ПервичныйДог = Неопределено;
					Иначе	
						ПервичныйДог = ПервичныйДог.ПервичныйДоговор; 
					КонецЕсли; 					   
					//- СВЭЙ КДЯ 02.12.19 СВФР-005149
				КонецЦикла;
				
			КонецЦикла;
			
			Запрос = Новый Запрос;
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	ДополнительныеНачисленияРаботниковОрганизаций.Регистратор
			|ИЗ
			|	РегистрРасчета.ДополнительныеНачисленияРаботниковОрганизаций КАК ДополнительныеНачисленияРаботниковОрганизаций
			|ГДЕ
			|	ДополнительныеНачисленияРаботниковОрганизаций.ВидРасчета.СпособРасчета = ЗНАЧЕНИЕ(Перечисление.СпособыРасчетаОплатыТруда.ПоДоговоруФиксированнойСуммой)
			|	И ДополнительныеНачисленияРаботниковОрганизаций.Сотрудник = &Сотрудник
			|	И ДополнительныеНачисленияРаботниковОрганизаций.ДокументОснование В(&ссылка)
			|	И ДополнительныеНачисленияРаботниковОрганизаций.ПериодРегистрации МЕЖДУ &ДатаН И &ДатаК
			|	И ДополнительныеНачисленияРаботниковОрганизаций.Результат <> 0";
			
			Запрос.УстановитьПараметр("ДатаК", Движение.ДатаОкончанияРасчетногоПериода);
			Запрос.УстановитьПараметр("ДатаН", ДатаНачДоговора);
			Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
			Запрос.УстановитьПараметр("ссылка", СписокДокументов);
			
			РезПроверкаНаличия = Запрос.Выполнить().Выгрузить();
			Если РезПроверкаНаличия.Количество()=0 Тогда 
				Движение.ДатаОкончанияРасчетногоПериода = КонецМесяца(ДобавитьМесяц(Движение.ДатаОкончанияРасчетногоПериода,1));
			КонецЕсли;
			
			Если ДатаНачДоговора <> Дата(1,1,1) 
				//+ СВЭЙ КДЯ 16.11.19 СВФР-004756
				И НЕ ЗначениеЗаполнено( Движение.ДатаНачалаРасчетногоПериода )
				//- СВЭЙ КДЯ 16.11.19 СВФР-004756
				Тогда
				Движение.ДатаНачалаРасчетногоПериода	= ДатаНачДоговора;
			КонецЕсли;
			
			//+ СВЭЙ КДЯ 16.11.19 СВФР-004756
			Движение.ПериодРасчетаСреднегоЗаработка = ВыборкаПоСтрокамДокумента.Количество();
			//- СВЭЙ КДЯ 16.11.19 СВФР-004756
			
			Если Движение.ДатаНачалаРасчетногоПериода >=Движение.ДатаОкончанияРасчетногоПериода Тогда  
				Движение.ДатаОкончанияРасчетногоПериода = КонецМесяца(Движение.ДатаНачалаРасчетногоПериода);
			КонецЕсли;
		КонецЕсли;
		
		
		
		
	КонецЕсли;
	
КонецПроцедуры // ДобавитьСтрокуРасчетаСреднего()

// По строке выборки результата запроса по документу формируем движения по регистрам
//
// Параметры:
//	ВыборкаПоШапкеДокумента                  - выборка из результата запроса по шапке документа
//	СтруктураПроведенияПоРегистрамНакопления - структура, содержащая имена регистров 
//											   накопления по которым надо проводить документ
//	СтруктураПараметров						 - структура параметров проведения.
//
// Возвращаемое значение:
//	Нет.
//
Процедура ДобавитьСтрокуВДвиженияПоРегистрамНакопления(ВыборкаПоШапкеДокумента, ВыборкаПоТЧ, УчетЗадолженностиПоМесяцам)
	
	Если ЗначениеЗаполнено(ВыборкаПоТЧ.КодДоходаНДФЛ) Тогда
		
		Движение = Движения.НДФЛСведенияОДоходах.Добавить();
		
		// Свойства
		Движение.Период					= ВыборкаПоТЧ.МесяцНалоговогоПериода;
		
		// Измерения
		Движение.Организация			= ВыборкаПоШапкеДокумента.Организация;
		Движение.ФизЛицо				= ВыборкаПоШапкеДокумента.ФизЛицо;
		Движение.КодДохода				= ВыборкаПоТЧ.КодДоходаНДФЛ;
		Движение.ПериодРегистрации		= ПериодРегистрации;
		
		// Ресурсы
		Движение.СуммаДохода			= ВыборкаПоТЧ.Результат; 
		Попытка
			Если (Число(СокрЛП(ВыборкаПоТЧ.КодДоходаНДФЛ))>501 и Число(СокрЛП(ВыборкаПоТЧ.КодДоходаНДФЛ))< 900) Тогда 
				Движение.КодВычета 	            = Справочники.ВычетыНДФЛ.НайтиПоКоду(СокрЛП(ВыборкаПоТЧ.КодДоходаНДФЛ));
				Движение.СуммаВычета			= ВыборкаПоТЧ.Результат;
			КонецЕсли;
		Исключение
		КонецПопытки;
		// Реквизиты
		Движение.ОбособленноеПодразделение  = ВыборкаПоШапкеДокумента.ОбособленноеПодразделение;
		Движение.ИсчисленоИзЗарплаты	= Истина;
		Движение.ПодразделениеОрганизации = ВыборкаПоТЧ.ПодразделениеОрганизации; 
	КонецЕсли;
	
	Движение = Движения.ВзаиморасчетыСРаботникамиОрганизаций.Добавить();
	
	// Свойства
	Движение.Период					= КонецМесяца(ПериодРегистрации);
	Движение.ВидДвижения			= ВидДвиженияНакопления.Приход;
	
	// Измерения
	Движение.Организация			= ВыборкаПоШапкеДокумента.ОбособленноеПодразделение;
	Движение.ФизЛицо				= ВыборкаПоШапкеДокумента.ФизЛицо;
	Если УчетЗадолженностиПоМесяцам Тогда
		Движение.ПериодВзаиморасчетов	= ПериодРегистрации;
	КонецЕсли;
	
	// Ресурсы
	Движение.СуммаВзаиморасчетов	= ВыборкаПоТЧ.Результат;
	
КонецПроцедуры // ДобавитьСтрокуВДвиженияПоРегистрамНакопления

// Добавляет движение в наборы записей БУОсновныеНачисления
//
Процедура ДобавитьСтрокуОтраженияВУчете(ВыборкаПоШапкеДокумента, ВыборкаПоСтрокамДокумента)
	
	СтрокаСвойствИзДокумента = "ПериодРегистрации,Сотрудник,ФизЛицо,Организация,ОбособленноеПодразделение,"
	+ "ГрафикРаботы,ВидУчетаВремени,ВидРасчета";
	
	СтрокаСвойствИзСтрокиДокумента = "ПериодДействияНачало,ПериодДействияКонец,Результат," 
	+ "СчетДт,СчетКт,СчетДтНУ,СчетКтНУ,ОтражениеВУСН,"
	+ "СубконтоДт1,СубконтоДт2,СубконтоДт3,СубконтоКт1,СубконтоКт2,СубконтоКт3,"
	+ "СубконтоДтНУ1,СубконтоДтНУ2,СубконтоДтНУ3,СубконтоКтНУ1,СубконтоКтНУ2,СубконтоКтНУ3,Сторно";
	
	Движение = Движения.БУОсновныеНачисления.Добавить();
	ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоШапкеДокумента,СтрокаСвойствИзДокумента);
	ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоСтрокамДокумента,СтрокаСвойствИзСтрокиДокумента);
	Движение.ДокументОснование = Ссылка;
	
	СтрокаСвойствИзСтрокиДокумента = "ПериодДействияНачало,ПериодДействияКонец,Результат," 
	+ "КодДоходаЕСН,ОблагаетсяЕНВД,Сторно";
	
	Движение = Движения.ЕСНОсновныеНачисления.Добавить();
	ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоШапкеДокумента,СтрокаСвойствИзДокумента);
	ЗаполнитьЗначенияСвойств(Движение,ВыборкаПоСтрокамДокумента,СтрокаСвойствИзСтрокиДокумента);
	Движение.ДокументОснование = Ссылка;
	
КонецПроцедуры  // ДобавитьСтрокуОтраженияВУчете

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ПриКопировании(ОбъектКопирования)
	ПерерассчитываемыйДокумент = Неопределено;
	//ПСА 13.08.2024+++
	ДвоичныеДанныеСообщенияПортала = Неопределено;
	ДокВыгруженНаПортал = Ложь;
	ПодключениеКПорталуФСЗН_ID_Дока = 0;
	ПУ3Сдано = Ложь;
	//+++ПСА 13.08.2024
КонецПроцедуры

Процедура ОбработкаЗаполнения(Основание)
	
	Если ТипЗнч(Основание) = Тип("ДокументСсылка.НачислениеПоБольничномуЛистуПоДоговорамПодряда") Тогда
		
		// Скопируем параметры начисления
		СтрокаРеквизитов = "Организация,Сотрудник,ФизЛицо,ПервичныйБольничныйЛист,ДатаНарушенияРежима,"
		+ "ПричинаНетрудоспособности,ДатаОкончания,ПроцентОплаты,ОграничениеПособия";
		
		
		ЗаполнитьЗначенияСвойств(ЭтотОбъект,Основание,СтрокаРеквизитов);	
		
		// добавим другие реквизиты
		Если ПервичныйБольничныйЛист.Пустая() Тогда
			ПервичныйБольничныйЛист	= Основание;
		КонецЕсли;
		ДатаНачала = КонецДня(ДатаОкончания) + 1;
		ДатаОкончания = '00010101';
		
	КонецЕсли;
	
КонецПроцедуры // ОбработкаЗаполнения()

Процедура ОбработкаПроведения(Отказ, Режим)
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);
	
	РезультатЗапросаПоШапке = СформироватьЗапросПоШапке(Ложь); // данные по отразжению в учете уже не нужны
	
	// Получим реквизиты шапки из запроса
	ВыборкаПоШапкеДокумента = РезультатЗапросаПоШапке.Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	//Надо позвать проверку заполнения реквизитов шапки
	ПроверитьЗаполнениеШапки(ВыборкаПоШапкеДокумента, Отказ, Заголовок);
	
	ПроверятьМестоРаботы = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия >= мДатаЗакона180ФЗ;
	
	// Движения стоит добавлять, если в проведении еще не отказано (отказ =ложь)
	Если НЕ Отказ Тогда
		
		// Проверим непрерывность следования записей начислений
		ПроверитьНепрерывностьЗаписейНачислений(Отказ, Заголовок);
		
		// Получение учетной политики по персоналу организации
		УчетЗадолженностиПоМесяцам	= ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "УчетЗадолженностиПоМесяцам");
		
		Движения.ОсновныеНачисленияРаботниковОрганизаций.мВыполнятьВспомогательныеРасчеты = Истина;
		
		// перепишем данные из таблицы начислений в набор записей
		ВыборкаПоНачислениям = СформироватьЗапросПоНачислениям(ВыборкаПоШапкеДокумента).Выбрать();
		Пока ВыборкаПоНачислениям.Следующий() Цикл 
			
			// проверим очередную строку табличной части
			ПроверитьЗаполнениеСтрокиНачисления(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям, Отказ, Заголовок, ПроверятьМестоРаботы);
			
			Если НЕ Отказ Тогда
				Если ВыборкаПоНачислениям.ОсновныеНачисления Тогда
					ДобавитьСтрокуОсновныхНачислений(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям);
				Иначе
					ПроведениеРасчетов.ДобавитьСтрокуДополнительныхНачислений(Движения.ДополнительныеНачисленияРаботниковОрганизаций, ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям);
				КонецЕсли;	
				ДобавитьСтрокуВДвиженияПоРегистрамНакопления(ВыборкаПоШапкеДокумента, ВыборкаПоНачислениям, УчетЗадолженностиПоМесяцам);
			КонецЕсли;
		КонецЦикла;
		
		// получим реквизиты табличной части
		ВыборкаПоРасчетСреднего = СформироватьЗапросПоРасчетСреднего().Выбрать();
		Пока ВыборкаПоРасчетСреднего.Следующий() Цикл
			
			// проверим очередную строку табличной части
			ПроверитьЗаполнениеСтрокиРасчетСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоРасчетСреднего, Отказ, Заголовок, ПроверятьМестоРаботы);
			
			Если НЕ Отказ Тогда
				ДобавитьСтрокуРасчетаСреднего(ВыборкаПоШапкеДокумента, ВыборкаПоРасчетСреднего, Движения.РасчетСреднегоЗаработка);
			КонецЕсли;
			
		КонецЦикла;
		
		Если ПособиеОтражаетсяВРеглУчетеТекущимДокументом Тогда
			
			// определим налоговый режим
			БухгалтерскийИНалоговыйУчет.ОбновитьДанныеУчетнойПолитикиПоНалоговомуУчету(глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете"), КонецМесяца(ПериодРегистрации), Организация);
			УчетнаяПолитика = глЗначениеПеременной("УчетнаяПолитикаОтраженияЗарплатыВУчете")[КонецМесяца(ПериодРегистрации)][Организация];
			
			ВыборкаПоОтражениеВУчете = СформироватьЗапросПоОтражениеВУчете().Выбрать();
			Пока ВыборкаПоОтражениеВУчете.Следующий() Цикл
				
				// проверим очередную строку табличной части
				ПроверитьЗаполнениеСтрокиОтраженияВУчете(ВыборкаПоОтражениеВУчете, Отказ, Не УчетнаяПолитика.УСН, Заголовок);
				
				Если НЕ Отказ Тогда
					ДобавитьСтрокуОтраженияВУчете(ВыборкаПоШапкеДокумента, ВыборкаПоОтражениеВУчете);
				КонецЕсли;
				
			КонецЦикла;
			
			Если НЕ Отказ Тогда
				
				ТаблицаДвижений = Движения.ЕСНОсновныеНачисления.Выгрузить();
				// Свернем таблицу, в ней могут быть дубли строк из-за доли больничного за счет работодателя
				ТаблицаДвижений.Свернуть("ВидРасчета,ВидУчетаВремени,ГрафикРаботы,Организация,ОбособленноеПодразделение,Сотрудник,ФизЛицо,КодДоходаЕСН,ОблагаетсяЕНВД,ПериодДействия,ПериодДействияНачало,ПериодДействияКонец,Сторно,ДокументОснование,ПериодРегистрации","Результат");
				Движения.ЕСНОсновныеНачисления.Загрузить(ТаблицаДвижений);
				
				ТаблицаДвижений.Свернуть("Организация,ФизЛицо,КодДоходаЕСН,ОблагаетсяЕНВД,ОбособленноеПодразделение,ПериодРегистрации","Результат");
				ТаблицаДвижений.Колонки.ПериодРегистрации.Имя = "Период";
				Движения.ЕСНСведенияОДоходах.Загрузить(ТаблицаДвижений);
				
				Если НачалоМесяца(ПериодРегистрации) >= НачалоМесяца(мДатаЗакона255ФЗ) Тогда
					
					ТаблицаДвижений = Движения.ЕСНОсновныеНачисления.Выгрузить();
					
					// временно добавим сторно-записи для формирования правильного ФПД записей по пособиям
					ТаблицаСторно = Движения.ЕСНОсновныеНачисления.ПолучитьДополнение();
					Для каждого СтрокаТаблицы Из ТаблицаСторно Цикл
						Движение = Движения.ЕСНОсновныеНачисления.Добавить();
						ЗаполнитьЗначенияСвойств(Движение, СтрокаТаблицы);
						Движение.Сторно = Истина;
						Движение.ПериодДействияНачало = СтрокаТаблицы.ПериодДействияНачалоСторно;
						Движение.ПериодДействияКонец  = СтрокаТаблицы.ПериодДействияКонецСторно;
						Движение.ПериодРегистрации    = СтрокаТаблицы.ПериодРегистрацииСторно;
					КонецЦикла;
					Движения.ЕСНОсновныеНачисления.Записать();
					
					Выборка = СформироватьЗапросПоПособияСоциальномуСтрахованию().Выбрать();
					Пока Выборка.Следующий() Цикл 
						Движение = Движения.ПособияСоциальномуСтрахованию.Добавить();
						ЗаполнитьЗначенияСвойств(Движение,Выборка);
						Движение.ДатаСтраховогоСлучая = ВыборкаПоШапкеДокумента.ДатаНачалаСобытия;
					КонецЦикла;
					// избавимся от временных строк учета
					Движения.ЕСНОсновныеНачисления.Загрузить(ТаблицаДвижений);
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЕсли;
		
		Если НЕ Отказ Тогда
			
			// выполним удаление перерасчетов исправленного документа
			Если ЗначениеЗаполнено(ПерерассчитываемыйДокумент) Тогда
				ПроведениеРасчетов.УдалитьСведенияОПерерасчетеДокумента(Ссылка, Истина); // Только по исправленным документам
			КонецЕсли;
			
			Для Каждого Набор Из Движения Цикл
				ТипНабораЗаписей = ТипЗнч(Набор);
				Если ТипНабораЗаписей = Тип("РегистрРасчетаНаборЗаписей.ОсновныеНачисленияРаботниковОрганизаций") 
					Или ТипНабораЗаписей = Тип("РегистрРасчетаНаборЗаписей.ДополнительныеНачисленияРаботниковОрганизаций") Тогда
					//ПСА 09.09.2021 СВФР-008101 +++
					Если РучнойРасчетСреднегоЗаработка Тогда
						Для Каждого СтрокаНабора Из Набор Цикл
							СтрокаНабора.РучнойРасчетСреднегоЗаработка = Истина;
							СтрокаНабора.РазмерСреднегоЗаработка = РазмерСреднегоЗаработка;
						КонецЦикла;	
						//Аверсон 15.02.2022 КВВ СВФР-008743 (
					Иначе
						СписокСоставляющихСреднегоЗаработка = Новый Массив(5); 
						СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
						СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
						СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
						СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
						ИспользоватьСреднеЧасовойЗаработок = Ложь;
						ТочностьСреднего = Константы.ТочностьСреднегоЗаработка.Получить();
						Если ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр0 Тогда 
							ЗначениеТочностьСреднего = 0;
						ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр1 Тогда 
							ЗначениеТочностьСреднего = 1;
						ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр2 Тогда 
							ЗначениеТочностьСреднего = 2;
						ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр3 Тогда 
							ЗначениеТочностьСреднего = 3;
						ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр4 Тогда 
							ЗначениеТочностьСреднего = 4;
						иначе
							ЗначениеТочностьСреднего = 0;
						КонецЕсли;
						
						СреднедневнойЗаработок_ = Формат(?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Окр( РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ВыборкаПоШапкеДокумента.ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок),ЗначениеТочностьСреднего),
						РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ВыборкаПоШапкеДокумента.ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок)),"ЧЦ=12; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"4")+"; ЧН=");
						Для Каждого СтрокаНабора Из Набор Цикл
							СтрокаНабора.РучнойРасчетСреднегоЗаработка = Истина;
							СтрокаНабора.РазмерСреднегоЗаработка = СреднедневнойЗаработок_;
						КонецЦикла;
						//Аверсон 15.02.2022 КВВ СВФР-008743 )
					КонецЕсли;
					//+++ПСА 09.09.2021 СВФР-008101					
					Набор.Записать();
				КонецЕсли;
			КонецЦикла;
			ПроведениеРасчетов.ОбработатьТаблицуПерерасчетов(Ссылка);
			
		КонецЕсли;	
		
	КонецЕсли;
	
КонецПроцедуры // ОбработкаПроведения()

Процедура ОбработкаУдаленияПроведения(Отказ)
	Движения.ОсновныеНачисленияРаботниковОрганизаций.мВыполнятьВспомогательныеРасчеты = Истина;
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если Не (ПолучитьДатуНачалаСобытия() < мДатаЗакона255ФЗ И ДатаОкончания >= мДатаЗакона255ФЗ И ПричинаНетрудоспособности <> Перечисления.ПричиныНетрудоспособности.ТравмаНаПроизводстве) Тогда
		ПроцентОплатыПереходногоПериода = 0;
		ПричинаНетрудоспособностиПереходногоПериода = "";
		СлучайУходаЗаБольнымРебенкомПереходногоПериода = "";
		ОграничениеПособияПереходногоПериода = "";
	КонецЕсли;
	
	ЗаполнитьМестоРаботы = Не ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "ПоддержкаВнутреннегоСовместительства");
	Если ЗаполнитьМестоРаботы Тогда
		Для каждого СтрокаТЧ Из РасчетСреднего Цикл
			СтрокаТЧ.Сотрудник = Сотрудник
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПечатьОборота11072013(ИмяМакета, КоличествоЭкземпляров = 1, НаПринтер = Ложь)
	//Аверсон 24.11.2020 КВВ СВФР-006808 (
	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_НачислениеПоБольничномуЛисту_Оборот11072013";
	
	Макет = ПолучитьМакет(ИмяМакета);
	
	ТочностьСреднего = Константы.ТочностьСреднегоЗаработка.Получить();
	Если ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр0 Тогда 
		ЗначениеТочностьСреднего = 0;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр1 Тогда 
		ЗначениеТочностьСреднего = 1;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр2 Тогда 
		ЗначениеТочностьСреднего = 2;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр3 Тогда 
		ЗначениеТочностьСреднего = 3;
	ИначеЕсли ТочностьСреднего = Перечисления.ПорядокОкругленияСреднегоЗаработка.Окр4 Тогда 
		ЗначениеТочностьСреднего = 4;
	иначе
		ЗначениеТочностьСреднего = 0;
	КонецЕсли;
	
	СекцияЛицеваяСторона = Макет.ПолучитьОбласть("ЛицеваяСторона");
	СекцияШапкаОплаты = Макет.ПолучитьОбласть("РазмерПособияШапка");
	СекцияСтрокаОплаты = Макет.ПолучитьОбласть("РазмерПособияСтрока");
	СекцияНижняяГраницаОплаты = Макет.ПолучитьОбласть("РазмерПособияНижняяГраница");
	
	СекцияПодвал = Макет.ПолучитьОбласть("Подвал");
	
	ВыборкаПоШапкеДокументадляПечати = СформироватьЗапросПоШапкеДляПечати().Выбрать();
	ВыборкаПоШапкеДокументадляПечати.Следующий();
	
	ВыборкаПоШапкеДокумента = СформироватьЗапросПоШапке().Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	// Определение даты начала и конца оплачиваемого события 
	ДатаНачалаСобытия 			= ВыборкаПоШапкеДокумента.ДатаНачала;
	ДатаОкончанияСобытия 		= ВыборкаПоШапкеДокумента.ДатаОкончания;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Регистратор", Ссылка);
	Запрос.УстановитьПараметр("ФизЛицо", ФизЛицо);
	Запрос.УстановитьПараметр("ДатаНачалаСобытия", ДатаНачалаСобытия);
	
	//Выборка годовой премии
	
	Запрос.Текст = "ВЫБРАТЬ
	|	СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.Результат) КАК Результат,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.ВидРасчета = &ВидРасчетаПоГодовойПремии
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации";
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоГодовойПремии", ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	Годовая = Запрос.Выполнить().Выбрать();
	годоваяВМесяц = 0;
	Если Годовая.Следующий() тогда
		ГодоваяВМесяц = Годовая.Результат / 12 * Годовая.КоэффициентИндексации;
	КонецЕсли;
	
	// Запрос выборки среднего заработка
	
	Запрос.Текст = "ВЫБРАТЬ
	|	СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.Результат) КАК Результат,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТарифнаяСтавкаПериода,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТекущаяТарифнаяСтавка,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	//|	НачислениеПоБольничнымЛистамРасчетСреднего.Результат <> 0
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.КоэффициентИндексации,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТарифнаяСтавкаПериода,
	|	НачислениеПоБольничнымЛистамРасчетСреднего.ТекущаяТарифнаяСтавка
	|	УПОРЯДОЧИТЬ ПО
	|	МесяцВыборки";
	
	Измерения = Новый Массив(1);
	Измерения[0] = "Сотрудник";
	
	// основные начисления собираем по периодам действия
	РазрезыОсновных = Новый Массив(1);
	РазрезыОсновных[0] = "ПериодДействия";
	
	// дополнительные начисления собираем по периодам регистрации
	РазрезыДополнительных = Новый Массив(2);
	РазрезыДополнительных[0] = "ПериодРегистрации";
	РазрезыДополнительных[1] = "ЧислоМесяцев";
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("Измерения", Измерения);
	Запрос.УстановитьПараметр("РазрезыОсновных", РазрезыОсновных);
	Запрос.УстановитьПараметр("РазрезыДополнительных", РазрезыДополнительных);
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоГодовойПремии", ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	ТаблицаСреднего = Новый ТаблицаЗначений;        
	ТаблицаСреднего.Колонки.Добавить("Месяц");
	ТаблицаСреднего.Колонки.Добавить("Сумма");
	ТаблицаСреднего.Колонки.Добавить("Описание");
	
	ВыборкаСреднегоЗаработка = Запрос.Выполнить().Выбрать();
	
	// Запрос выборки отработанного времени
	ТекстЗапроса = "ВЫБРАТЬ
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки,
	|	//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.РасчетСреднего КАК НачислениеПоБольничнымЛистамРасчетСреднего
	|ГДЕ
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки <> &ПустаяДата
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.ВидРасчета = &ВидРасчетаПоЗаработку
	|	И НачислениеПоБольничнымЛистамРасчетСреднего.Ссылка = &Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничнымЛистамРасчетСреднего.МесяцВыборки";
	
	Если СпособРасчетаВДнях Тогда 
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке","СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноДней) КАК ОтработаноПоПятидневке");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"//СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке","СУММА(НачислениеПоБольничнымЛистамРасчетСреднего.ОтработаноЧасов) КАК ОтработаноПоПятидневке");
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.УстановитьПараметр("ПустаяДата", Дата("00010101"));
	Запрос.УстановитьПараметр("Измерения", Измерения);
	Запрос.УстановитьПараметр("РазрезыОсновных", РазрезыОсновных);
	Запрос.УстановитьПараметр("РазрезыДополнительных", РазрезыДополнительных);
	Запрос.УстановитьПараметр("ВидРасчетаПоФиксПремиям", ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям);
	Запрос.УстановитьПараметр("ВидРасчетаПоЗаработку", ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ);
	Запрос.УстановитьПараметр("ГодоваяПремия", Перечисления.ВидыПремии.ГодоваяПремия);
	Запрос.УстановитьПараметр("ГодПредшествующийСобытию", ГОД(ДатаНачалаСобытия) - 1);
	
	ТаблицаСреднего.Колонки.Добавить("Отработано");
	
	ВыборкаОтработаноПоПятидневке = Запрос.Выполнить().Выгрузить();
	
	СекцияЛицеваяСторона.Параметры.ДатаНачала = Формат(ВыборкаПоШапкеДокумента.ДатаНачала,"ДФ=""дд.ММ.гггг""");
	СекцияЛицеваяСторона.Параметры.ДатаОкончания = Формат(ВыборкаПоШапкеДокумента.ДатаОкончания,"ДФ=""дд.ММ.гггг""");
	
	СекцияЛицеваяСторона.Параметры.Заполнить(ВыборкаПоШапкеДокументаДляПечати);
	
	Попытка
		СекцияЛицеваяСторона.Параметры.ДатаПриема = ПрочиеПроцедуры.ПолучитьДанныеОСотруднике('18000101000000', ЭтотОбъект.Сотрудник, 0,Организация).Период;//О.Т. Аверсон 16.10.2017 № 1120
		
	Исключение
	КонецПопытки;
	
	// вывод данных о сумме заработка за расчетный период
	НомерСтроки = 0;
	ИтогоЗаработок = 0;
	ИтогоОтработано = 0;
	СтруктураПоиска = Новый Структура("МесяцВыборки");
	
	Если ЭтотОбъект.РучнойРасчетСреднегоЗаработка Тогда
		СекцияЛицеваяСторона.Параметры["Месяц1"] 		= "Ручной ввод";
		СекцияЛицеваяСторона.Параметры["СреднийЗаработок"] = Формат(ЭтотОбъект.РазмерСреднегоЗаработка,"ЧЦ=15; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"2"));//Островская Татьяна 22.07.2013 № 16645
	Иначе 
		Пока ВыборкаСреднегоЗаработка.Следующий() Цикл
			
			НомерСтроки = НомерСтроки  + 1;
			Если НомерСтроки > 6 Тогда
				Если НомерСтроки = 7 Тогда
					Сообщить("Месяцев больше 6 в табличной части ""Расчет среднего заработка"". Выводим первые 6.");
				КонецЕсли;
				Продолжить;
			КонецЕсли;
			
			ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
			Если ПериодРегистрации >= Дата(2016,07,1) Тогда 
				ОписаниеСуммы = "Заработок " +  Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
			иначе  					
				ОписаниеСуммы = "Заработок " +  Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ=2");
			КонецЕсли;
			
			СтруктураПоиска.МесяцВыборки =  ВыборкаСреднегоЗаработка.МесяцВыборки;
			
			ОтработаноДней = ВыборкаОтработаноПоПятидневке.НайтиСтроки(СтруктураПоиска);
			Отработано = 0;
			Для каждого Строка из ОтработаноДней цикл
				Отработано = Отработано + Строка.ОтработаноПоПятидневке;
			КонецЦикла;
			Коэфф = Отработано;
			
			ИтогоЗаработок = ИтогоЗаработок + ВыборкаСреднегоЗаработка.Результат;// + ГодоваяВМесяц;
			ИтогоОтработано = ИтогоОтработано + Отработано;
			ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
			СекцияЛицеваяСторона.Параметры["Месяц"+НомерСтроки] = Формат(ВыборкаСреднегоЗаработка.Месяцвыборки, "ДФ='MMMM'");
			СекцияЛицеваяСторона.Параметры["Дней"+НомерСтроки] = Коэфф;
			Если ПериодРегистрации >=Дата(2016,07,1) Тогда 
				СекцияЛицеваяСторона.Параметры["Заработок"+НомерСтроки] = Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
			иначе
				СекцияЛицеваяСторона.Параметры["Заработок"+НомерСтроки] = Формат(ВыборкаСреднегоЗаработка.Результат,"ЧЦ=15; ЧДЦ=2");
			КонецЕсли;		
			Если ВыборкаСреднегоЗаработка.Количество() = 1 Тогда
				ИтогоОтработано = ?(ИтогоОтработано=0, 1, ИтогоОтработано);
				СекцияЛицеваяСторона.Параметры["ИтогоОтработанно"] = Формат(ИтогоОтработано,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
				СекцияЛицеваяСторона.Параметры["ИтогоЗаработок"] = Формат(ИтогоЗаработок,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
				СекцияЛицеваяСторона.Параметры["СреднийЗаработок"] = Формат(ИтогоЗаработок / ИтогоОтработано,"ЧЦ=15; ЧДЦ="+?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Строка(ЗначениеТочностьСреднего),"0"));//Островская Татьяна 18.04.2014 № 17287
			КонецЕсли;
			
		КонецЦикла;
		
		СписокСоставляющихСреднегоЗаработка = Новый Массив(5); 
		СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
		СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
		СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
		СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
		
		
		ИспользоватьСреднеЧасовойЗаработок = Ложь;
		СреднедневнойЗаработок = РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок);
		
		ЗначениеОкругления = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(ПериодРегистрации,Новый Структура("ВидПараметра",Перечисления.ВидыПараметровДляРасчетаЗарплаты.ТочностьРасчетов)).Размер; //О.Т. Аверсон 22.06.2016 № 949
		СекцияЛицеваяСторона.Параметры["ИтогоОтработанно"] = Формат(ИтогоОтработано,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
		СекцияЛицеваяСторона.Параметры["ИтогоЗаработок"] = Формат(ИтогоЗаработок,"ЧЦ=15; ЧДЦ="+Строка(ЗначениеОкругления));
		СекцияЛицеваяСторона.Параметры["СреднийЗаработок"] = ?(ЗначениеЗаполнено(ЗначениеТочностьСреднего),Окр(СреднедневнойЗаработок,ЗначениеТочностьСреднего),Окр(СреднедневнойЗаработок,0));//Островская Татьяна 17.04.2014 № 17287	
		
	КонецЕсли; 
	
	ТабДокумент.Вывести(СекцияЛицеваяСторона);
	ТабДокумент.Вывести(СекцияШапкаОплаты);
	
	если ТипРасчета = Перечисления.ТипРасчетаБЛ.ПоОкладу Тогда 
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(НачислениеПоБольничномуЛистуНачисления.ДатаНачала, МЕСЯЦ) КАК Датаначала,
		|	НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов
		|ИЗ
		|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК НачислениеПоБольничномуЛистуНачисления
		|ГДЕ
		|	НачислениеПоБольничномуЛистуНачисления.ВидРасчета.СпособРасчета = &парамПоСреднемуФСЗН
		|	И НачислениеПоБольничномуЛистуНачисления.Ссылка = &парамРегистратор";
		Запрос.УстановитьПараметр("парамПоСреднемуФСЗН", Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
		Запрос.УстановитьПараметр("парамРегистратор", Ссылка);
		ТаблицаСреднийЗП = Новый ТаблицаЗначений;
		ТаблицаСреднийЗП.Колонки.Добавить("Дата",Новый ОписаниеТипов("Дата"));
		ТаблицаСреднийЗП.Колонки.Добавить("СреднийЗП",Новый ОписаниеТипов("Число",,,Новый КвалификаторыЧисла(15, 4)));
		ТЗСредний = Запрос.Выполнить().Выгрузить();
		Для Каждого стрТЗСредний из ТЗСредний Цикл 
			стрТаблицаСреднийЗП = ТаблицаСреднийЗП.Добавить();
			стрТаблицаСреднийЗП.Дата = стрТЗСредний.Датаначала;
			СписокСоставляющихСреднегоЗаработка = Новый Массив(5); 
			СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
			СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
			СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
			СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
			
			ИспользоватьСреднеЧасовойЗаработок = Ложь;
			ДатаСр = стрТЗСредний.Датаначала;
			СреднедневнойЗаработок = РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок);
			
			
			
			стрТаблицаСреднийЗП.СреднийЗП = СреднедневнойЗаработок;
		КонецЦикла;
		ТаблицаСреднийЗП.Свернуть("Дата,СреднийЗП"); 
		Запрос.Текст = "Выбрать ТЗСредний.Дата, ТЗСредний.СреднийЗП Поместить ВТСреднийПоДате из &ТЗСредний как ТЗСредний";
		Запрос.УстановитьПараметр("ТЗСредний",ТаблицаСреднийЗП);
		Запрос.Выполнить();
	КонецЕсли;
	если ТипРасчета = Перечисления.ТипРасчетаБЛ.ПоОкладу Тогда
		Запрос.Текст = "ВЫБРАТЬ
		|	НачислениеПоБольничномуЛистуНачисления.Показатель1 КАК процент,
		|	НачислениеПоБольничномуЛистуНачисления.Результат,
		|	НАЧАЛОПЕРИОДА(НачислениеПоБольничномуЛистуНачисления.ДатаНачала, МЕСЯЦ) КАК Датаначала,
		|	НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов,
		|	ВТСреднийПоДате.СреднийЗП * НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов КАК Результат1
		|ПОМЕСТИТЬ вт
		|ИЗ
		|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК НачислениеПоБольничномуЛистуНачисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСреднийПоДате КАК ВТСреднийПоДате
		|		ПО (НАЧАЛОПЕРИОДА(НачислениеПоБольничномуЛистуНачисления.ДатаНачала, МЕСЯЦ) = ВТСреднийПоДате.Дата)
		|ГДЕ
		|	НачислениеПоБольничномуЛистуНачисления.ВидРасчета.СпособРасчета = &парамПоСреднемуФСЗН
		|	И НачислениеПоБольничномуЛистуНачисления.Ссылка = &парамРегистратор
		|;
		|";
	иначе
		Запрос.Текст = "ВЫБРАТЬ
		|	НачислениеПоБольничномуЛистуНачисления.Показатель1 КАК процент,
		|	НачислениеПоБольничномуЛистуНачисления.Результат как результат1,
		|	НАЧАЛОПЕРИОДА(НачислениеПоБольничномуЛистуНачисления.ДатаНачала, МЕСЯЦ) КАК Датаначала,
		|	НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов,
		|	&СреднийЗаработок * НачислениеПоБольничномуЛистуНачисления.ОплаченоДнейЧасов * НачислениеПоБольничномуЛистуНачисления.Показатель1/100 КАК Результат //О.Т. Аверсон 19.06.2017 № 734
		|ПОМЕСТИТЬ вт
		|ИЗ
		|	Документ.НачислениеПоБольничномуЛистуПоДоговорамПодряда.Начисления КАК НачислениеПоБольничномуЛистуНачисления
		|ГДЕ
		|	НачислениеПоБольничномуЛистуНачисления.ВидРасчета.СпособРасчета = &парамПоСреднемуФСЗН
		|	И НачислениеПоБольничномуЛистуНачисления.Ссылка = &парамРегистратор
		|;
		|";
	КонецЕсли;
	Запрос.Текст = Запрос.Текст + "ВЫБРАТЬ
	
	|	вт.Датаначала,
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент <= 80
	|				ТОГДА вт.Результат
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК процент80,
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент = 100
	|				ТОГДА вт.Результат
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК процент100,
	
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент <= 80
	|				ТОГДА вт.ОплаченоДнейЧасов
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ОплаченоДнейЧасов80,
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент <= 80
	|				ТОГДА вт.Результат1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК процент801,
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент = 100
	|				ТОГДА вт.Результат1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК процент1001,
	|	СУММА(ВЫБОР
	|			КОГДА вт.процент = 100
	|				ТОГДА вт.ОплаченоДнейЧасов
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ОплаченоДнейЧасов100,
	|	СУММА(вт.ОплаченоДнейЧасов) КАК ОплаченоДнейЧасов
	|ИЗ
	|	вт КАК вт
	|
	|СГРУППИРОВАТЬ ПО
	|	вт.Датаначала";
	
	Запрос.УстановитьПараметр("парамПоСреднемуФСЗН", Перечисления.СпособыРасчетаОплатыТруда.ПоСреднемуЗаработкуФСС);
	Запрос.УстановитьПараметр("парамРегистратор", Ссылка);
	СписокСоставляющихСреднегоЗаработка = Новый Массив(5); 
	СписокСоставляющихСреднегоЗаработка[0] = ПланыВидовРасчета.СреднийЗаработок.ПоЗаработкуБЛ;
	СписокСоставляющихСреднегоЗаработка[1] = ПланыВидовРасчета.СреднийЗаработок.ПоФиксПремиям;
	СписокСоставляющихСреднегоЗаработка[2] = ПланыВидовРасчета.СреднийЗаработок.ПоПремиям;
	СписокСоставляющихСреднегоЗаработка[3] = ПланыВидовРасчета.СреднийЗаработок.ПоГодовойПремии;
	
	ИспользоватьСреднеЧасовойЗаработок = Ложь; 
	СреднедневнойЗаработок = РасчетСреднегоЗаработка(СписокСоставляющихСреднегоЗаработка, ДатаНачалаСобытия, ИспользоватьСреднеЧасовойЗаработок);
	
	Запрос.УстановитьПараметр("СреднийЗаработок", СреднедневнойЗаработок);
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	
	ИтогоКВыплате = 0;
	ИтогоМаксПособия = 0;
	
	
	ЗапросНормаДней = Новый Запрос;
	
	ЗапросНормаДней.УстановитьПараметр("парамДатаС", НачалоМесяца(ВыборкаПоШапкеДокумента.ДатаНачала));
	ЗапросНормаДней.УстановитьПараметр("парамДатаПо", КонецМесяца(ВыборкаПоШапкеДокумента.ДатаОкончания)); 
	
	
	ВсегоЗаписей = Выборка.Количество();
	инд=0;
	Пока Выборка.Следующий() Цикл
		
		СекцияСтрокаОплаты.Параметры.Месяц = Формат(Выборка.ДатаНачала, "ДФ='MMMM'");
		
		СекцияСтрокаОплаты.Параметры.КолДней = Строка(Выборка.ОплаченоДнейЧасов80) + ";"+ Строка(Выборка.ОплаченоДнейЧасов100);
		Процент80 = 0;
		если ЗначениеЗаполнено(Выборка.Процент80) Тогда 
			Процент80 = ОбщегоНазначения.ОкруглитьРезультат(Выборка.Процент80, Константы.ОкруглениеСуммДляБЛ.Получить()); //*80/100
		КонецЕсли;  
		Процент100 = 0;
		если ЗначениеЗаполнено(Выборка.Процент100) Тогда 
			Процент100 = ОбщегоНазначения.ОкруглитьРезультат(Выборка.Процент100, Константы.ОкруглениеСуммДляБЛ.Получить());
		КонецЕсли;
		
		Если ВыборкаПоШапкеДокумента.ТипРасчета = Перечисления.ТипРасчетаБЛ.БПМ Тогда
			Процент100 = ОбщегоНазначения.ОкруглитьРезультат(Выборка.Процент1001, Константы.ОкруглениеСуммДляБЛ.Получить());	
		КонецЕсли;
		
		СекцияСтрокаОплаты.Параметры.Пособие80 = Формат(Процент80,"ЧДЦ=2");
		СекцияСтрокаОплаты.Параметры.Пособие100 = Формат(Процент100,"ЧДЦ=2");			 
		
		СекцияСтрокаОплаты.Параметры.ПособиеВсего = Формат(ОбщегоНазначения.ОкруглитьЗначение2016(Процент80+Процент100,ПериодРегистрации),"ЧДЦ=2");
		
		Если ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОбщееОграничение или 
			ВыборкаПоШапкеДокументадляПечати.ОграничениеПособия = Перечисления.ВидыОграниченияПособия.ОграничениеРазмераПособияПоСуммеБЛ Тогда
			СредняяПоРБ = РегистрыСведений.РазмерыПараметровДляРасчетаРБ.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ДатаНачала, -1)), 
			Новый Структура("ВидПараметра", Перечисления.ВидыПараметровДляРасчетаЗарплаты.СредняяЗПРаботников)).Размер; 
			
			НормаВремени = ПрочиеПроцедуры.ПолучитьНормуВремениПоГраффику(НачалоМесяца(Выборка.ДатаНачала),КонецМесяца(Выборка.ДатаНачала), Сотрудник).НормаЧасов;
			если КалендарныеДни Тогда 
				НормаВремени = (КонецМесяца(Выборка.ДатаНачала) - НачалоМесяца(Выборка.ДатаНачала)+1)/86400;
			КонецЕсли;
			Если Сотрудник.ВидНалогообложенияОсновной = Справочники.ВидыНалогообложения.ПустаяСсылка() Тогда 
				ВидНалогообложения = Организация.ОсновнаяСтавкаНалогообложения;
			иначе
				ВидНалогообложения = Сотрудник.ВидНалогообложенияОсновной;
			КонецЕсли;
			
			если ПричинаНетрудоспособности = Перечисления.ПричиныНетрудоспособности.ПоБеременностиИРодам Тогда 
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).РазмерПоБеременности;//О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			иначе
				РазмерОграничения = РегистрыСведений.РазмерОграниченияПособияПоНетрудоспособности.ПолучитьПоследнее(КонецМесяца(ДобавитьМесяц(ПериодРегистрации, -1)),Новый Структура("Организация,ВидНалогоОбложения", Организация,ВидНалогообложения)).Размер; //О.Т. Аверсон 28.04.2016 № 7777 НачалоМесяца(Выборка.ДатаНачала)
			КонецЕсли;
			РазмерОграничения = (РазмерОграничения * СредняяПоРБ) / НормаВремени * Выборка.ОплаченоДнейЧасов;
			СекцияСтрокаОплаты.Параметры.МаксРазмерПособия =  ОбщегоНазначения.ОкруглитьЗначение2016(РазмерОграничения, ПериодРегистрации);
		КонецЕсли;                                     
		
		ИтогоКВыплате = ИтогоКВыплате + ОбщегоНазначения.ОкруглитьЗначение2016(Выборка.Процент80+?(ВыборкаПоШапкеДокумента.ТипРасчета = Перечисления.ТипРасчетаБЛ.БПМ,Выборка.Процент1001,Выборка.Процент100),ПериодРегистрации);  //Аверсон 04.05.2020 КВВ СВФР-005943
		ИтогоМаксПособия = ИтогоМаксПособия + ОбщегоНазначения.ОкруглитьЗначение2016(РазмерОграничения, ПериодРегистрации);
		
		инд = инд+1;
		Если инд = ВсегоЗаписей Тогда 
			СекцияСтрокаОплаты.Параметры.СуммаПособияКВыплате = Формат(ОбщегоНазначения.ОкруглитьЗначение2016(Мин(ИтогоКВыплате,ИтогоМаксПособия),ПериодРегистрации),"ЧДЦ=2");//О.Т. Аверсон 15.03.2016 № 949 ,734
			ИтогоКВыплате = ОбщегоНазначения.ОкруглитьЗначение2016(Мин(ИтогоКВыплате,ИтогоМаксПособия),ПериодРегистрации); //О.Т. Аверсон 19.06.2017 № 734
		КонецЕсли;
		ТабДокумент.Вывести(СекцияСтрокаОплаты);
	КонецЦикла;
	ТабДокумент.Вывести(СекцияНижняяГраницаОплаты);
	
	СекцияПодвал.Параметры.СуммаПособияКВыплатеПрописью = РаботаСДиалогами.СформироватьСуммуПрописью(ИтогоКВыплате, Константы.ВалютаРегламентированногоУчета.Получить());
	СекцияПодвал.Параметры.ВедомостьМесяц =  Формат(ВыборкаПоШапкеДокумента.ПериодРегистрации, "ДФ='MMMM'");
	СекцияПодвал.Параметры.ВедомостьГод =  Год(ВыборкаПоШапкеДокумента.ПериодРегистрации);
	СекцияПодвал.Параметры.Ответственный = Ответственный;
	Для Каждого стрОтв из Организация.ОтветственныеЛица Цикл 
		Если стрОтв.ОтветственноеЛицо = Перечисления.ОтветственныеЛицаОрганизаций.ГлавныйБухгалтер Тогда 
			СекцияПодвал.Параметры.ГлБухгалтер = ОбщегоНазначения.ФамилияИнициалыФизЛица(стрОтв.Сотрудник);
		КонецЕсли;
		
	КонецЦикла;
	ТабДокумент.Вывести(СекцияПодвал);
	РаботаСДиалогами.НапечататьДокумент(ТабДокумент, КоличествоЭкземпляров, НаПринтер, РаботаСДиалогами.СформироватьЗаголовокДокумента(ЭтотОбъект,Метаданные().Синоним) + " (оборот листка нетрудоспособности)");
	//Аверсон 24.11.2020 КВВ СВФР-006808 )		
КонецПроцедуры	


////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

мДлинаСуток		 = 86400;		// в секундах
мДатаЗакона180ФЗ = '20060101';	// 1 января 2006 года
мДатаЗакона255ФЗ = ПроведениеРасчетов.ПолучитьДатуВступленияВСилуИзмененийПоСоциальнымПособиям2006();

