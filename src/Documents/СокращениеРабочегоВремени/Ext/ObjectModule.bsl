Процедура ПроверкаДублейСтрок(ПроверяемыеРеквизиты,Отказ)
 
	ТаблицаДокумента = ОтработанноеВремяПоСотр.Выгрузить();
	ТаблицаДокумента.Колонки.Добавить("КвоПроверкаДублей"); 
	ТаблицаДокумента.ЗаполнитьЗначения(1, "КвоПроверкаДублей");
	
	ТаблицаДокумента.Свернуть(ПроверяемыеРеквизиты,"КвоПроверкаДублей");
	
	Для Каждого ТекущаяСтрока Из ТаблицаДокумента Цикл 
		Если ТекущаяСтрока.КвоПроверкаДублей > 1 Тогда
			РеквизитыДляСообщения = "";
			Стр = СокрЛП(ПроверяемыеРеквизиты);
			Пока Найти(Стр,",") > 0 Цикл
				НаимРеквизита = СокрЛП(Лев(Стр,Найти(Стр,",") - 1));
				Стр = Прав(Стр,СтрДлина(Стр) - Найти(Стр,","));
				РеквизитыДляСообщения = РеквизитыДляСообщения+ТекущаяСтрока[НаимРеквизита]+", ";
			КонецЦикла; 
			РеквизитыДляСообщения = РеквизитыДляСообщения+ТекущаяСтрока[СокрЛП(Стр)];
			
			Сообщить("Информация """ + РеквизитыДляСообщения+""" введена несколько раз в табличную часть, проведение невозможно!");
			Отказ = Истина;
		КонецЕсли; 
	КонецЦикла;
 
 КонецПроцедуры


 Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	 
	Если ОтработанноеВремяПоСотр.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	ПроверкаДублейСтрок("Сотрудник,ОтработаннаяДата", Отказ);
	
	Для Каждого Строка Из ОтработанноеВремяПоСотр Цикл
		Если НЕ ЗначениеЗаполнено(Строка.ПодразделениеОрганизации) ИЛИ НЕ ЗначениеЗаполнено(Строка.ОтработаннаяДата) ИЛИ
			НЕ (НачалоМесяца(Строка.ОтработаннаяДата) = НачалоМесяца(Дата) ИЛИ НачалоМесяца(Строка.ОтработаннаяДата) = НачалоМесяца(ДобавитьМесяц(Дата,1))) ИЛИ
			(НЕ ЗначениеЗаполнено(Строка.ОтработанныеЧасы) И НЕ ЗначениеЗаполнено(Строка.ОтработанныеМинуты)) Тогда
			Сообщить("Некорректные данные по сотруднику " + СокрЛП(Строка.Сотрудник) + ", строка № " + СокрЛП(Строка.НомерСтроки) + " (проверьте дату, часы и минуты в табличной части)");
			Отказ = Истина;
			Прервать;
		КонецЕсли;
		З = Новый Запрос;
		З.Текст = "ВЫБРАТЬ 
		|СокращенныеДни.Регистратор
		|ИЗ РегистрСведений.СокращенныеДниРаботниковОрганизации КАК СокращенныеДни
		|ГДЕ СокращенныеДни.Сотрудник В (&Сотрудник)
		|И СокращенныеДни.Период = &Период";
		З.УстановитьПараметр("Сотрудник",Строка.Сотрудник);
		З.УстановитьПараметр("Период",НачалоДня(Строка.ОтработаннаяДата));
		РезЗ = З.Выполнить().Выгрузить();
		Если РезЗ.Количество()>0 Тогда
			Сообщить(СокрЛП(Строка.Сотрудник) + " на дату " + Формат(Строка.ОтработаннаяДата,"ДЛФ=Д") + " в регистре сведений ""Сокращенные дни работников организации"" уже внесены данные!");
			Отказ = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;

	
	Если НЕ Отказ Тогда
		НачатьТранзакцию();
		Движения.СокращенныеДниРаботниковОрганизации.Записывать = Истина;
		Движения.СокращенныеДниРаботниковОрганизации.Очистить();
		Для Каждого ТекСтрокаОтработанноеВремяПоСотр Из ОтработанноеВремяПоСотр Цикл
			Движение = Движения.СокращенныеДниРаботниковОрганизации.Добавить();
			Движение.Период = ТекСтрокаОтработанноеВремяПоСотр.ОтработаннаяДата;
			Движение.Организация = Организация;
			Движение.Сотрудник = ТекСтрокаОтработанноеВремяПоСотр.Сотрудник;
			Движение.ФизЛицо = ТекСтрокаОтработанноеВремяПоСотр.Физлицо;
			Движение.ПодразделениеОрганизации = ТекСтрокаОтработанноеВремяПоСотр.ПодразделениеОрганизации;
			Движение.КоличествоЧасов = ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеЧасы + ?(НЕ ЗначениеЗаполнено(ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеМинуты),0,Окр(ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеМинуты/60,2));
			//ПСА 11.03.2021 СВФР-007321 +++
			Если НочныеЧасы Тогда
				Движение.КоличествоНочныхЧасов = ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеНочныеЧасы + ?(НЕ ЗначениеЗаполнено(ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеНочныеМинуты),0,Окр(ТекСтрокаОтработанноеВремяПоСотр.ОтработанныеНочныеМинуты/60,2));
			Иначе
				Движение.КоличествоНочныхЧасов = 0;
			КонецЕсли;	
			//+++ПСА 11.03.2021 СВФР-007321
		КонецЦикла;
		Попытка
			ЗафиксироватьТранзакцию();
		Исключение
			Сообщить("Не удалось!");
		КонецПопытки;
	КонецЕсли;
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	КраткийСоставДокумента = ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(ОтработанноеВремяПоСотр);
КонецПроцедуры

//Аверсон ЕАЕ 09.01.2025 СВФР-013997
// Возвращает доступные варианты печати документа
//
// Вовращаемое значение:
//  Струткура, каждая строка которой соответствует одному из вариантов печати
//  
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	
	СтруктураПечатныхФорм = Новый Структура;
	
	Возврат СтруктураПечатныхФорм;
	
КонецФункции // ПолучитьСтруктуруПечатныхФорм()
//Аверсон СВФР-013997
